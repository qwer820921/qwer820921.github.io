1:"$Sreact.fragment"
2:I[69243,["6283","static/chunks/6283-1586b7e20e5a28d4.js","7177","static/chunks/app/layout-984d35e9d146542e.js"],""]
3:I[6476,["6283","static/chunks/6283-1586b7e20e5a28d4.js","7177","static/chunks/app/layout-984d35e9d146542e.js"],"default"]
4:I[87555,[],""]
5:I[31295,[],""]
6:I[39543,["6283","static/chunks/6283-1586b7e20e5a28d4.js","7177","static/chunks/app/layout-984d35e9d146542e.js"],"default"]
8:I[59665,[],"MetadataBoundary"]
a:I[59665,[],"OutletBoundary"]
d:I[74911,[],"AsyncMetadataOutlet"]
f:I[59665,[],"ViewportBoundary"]
11:I[26614,[],""]
:HL["https://qwer820921.github.io/_next/static/css/f71b761575b48bd6.css","style"]
:HL["https://qwer820921.github.io/_next/static/css/e57a9f01512809bb.css","style"]
:HL["https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css","style"]
:HL["https://qwer820921.github.io/_next/static/css/45df6ee84bc085cd.css","style"]
0:{"P":null,"b":"p98YH7OclWa6EpvEbkE28","p":"https://qwer820921.github.io","c":["","blog","transition-from-prompt-engineering-to-dspy"],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","transition-from-prompt-engineering-to-dspy","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/f71b761575b48bd6.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/e57a9f01512809bb.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","2",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"zh-Hant","children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico"}],["$","link",null,{"rel":"apple-touch-icon","href":"/logo192.png"}],["$","link",null,{"rel":"manifest","href":"/manifest.json"}],["$","link",null,{"rel":"preload","href":"/logo192.png","as":"image"}],["$","$L2",null,{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-CCKVESHCQ1"}],["$","$L2",null,{"id":"google-analytics","children":"\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-CCKVESHCQ1');\n          "}],["$","$L2",null,{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2709303513603814","crossOrigin":"anonymous"}]]}],["$","body",null,{"children":[["$","$L3",null,{"children":["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","$L6",null,{}]]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","transition-from-prompt-engineering-to-dspy","d"],["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L7",["$","$L8",null,{"children":"$L9"}],[["$","link","0",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/45df6ee84bc085cd.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$La",null,{"children":["$Lb","$Lc",["$","$Ld",null,{"promise":"$@e"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","hGssLDhOwqD9Dv9jFEvVX",{"children":[["$","$Lf",null,{"children":"$L10"}],null]}],null]}],false]],"m":"$undefined","G":["$11","$undefined"],"s":false,"S":true}
12:"$Sreact.suspense"
13:I[74911,[],"AsyncMetadata"]
9:["$","$12",null,{"fallback":null,"children":["$","$L13",null,{"promise":"$@14"}]}]
15:I[57113,["5953","static/chunks/app/blog/%5Bslug%5D/page-625d55d419426b5e.js"],"default"]
c:null
7:["$","article",null,{"className":"container py-5","children":[["$","div",null,{"className":"row justify-content-center","children":["$","div",null,{"className":"col-12 col-lg-8","children":["$","div",null,{"className":"card blogPost_articleCard__LIiRr","children":["$","div",null,{"className":"card-body blogPost_cardBody__5xHPD","children":[["$","header",null,{"className":"blogPost_articleHeader__dQ5vG","children":[["$","$L15",null,{"mode":"static","id":"static-back-btn"}],["$","h1",null,{"className":"blogPost_articleTitle__BCXQE","children":"【提示工程終結者】從 Prompt Engineering 轉向 DSPy (Declarative Self-improving Python)"}],["$","div",null,{"className":"blogPost_articleMeta__1R_wB","children":[["$","div",null,{"className":"blogPost_metaItem__xpKuj","children":[["$","i",null,{"className":"bi bi-person-fill blogPost_metaIcon__h8wBb"}],["$","span",null,{"className":"blogPost_metaLabel__y0uVD","children":"作者:"}],"子yee"]}],["$","div",null,{"className":"blogPost_metaItem__xpKuj","children":[["$","i",null,{"className":"bi bi-calendar3 blogPost_metaIcon__h8wBb"}],["$","span",null,{"className":"blogPost_metaLabel__y0uVD","children":"日期:"}],"2026-02-12"]}]]}]]}],["$","div",null,{"className":"blogContent_blogContent__VY_R4","children":"$L16"}]]}]}]}]}],["$","$L15",null,{"mode":"floating","targetId":"static-back-btn"}]]}]
17:Taf3,import dspy
import os
import re
from dotenv import load_dotenv
from dspy.teleprompter import BootstrapFewShot

# 載入環境變數
load_dotenv()

# 1. 配置 LLM
llm = dspy.OpenAI(model=\"gpt-3.5-turbo\", api_key=os.getenv(\"OPENAI_API_KEY\"))
dspy.settings.configure(lm=llm)

# 2. 定義 Signature
class BasicQA(dspy.Signature):
    \"\"\"根據問題提供簡潔的答案。\"\"\"
    question = dspy.InputField(desc=\"使用者提出的問題\")
    answer = dspy.OutputField(desc=\"問題的簡潔答案\")

# 3. 定義 Module
class SimpleQAModule(dspy.Module):
    def __init__(self):
        super().__init__()
        self.predict = dspy.Predict(BasicQA)

    def forward(self, question):
        return self.predict(question=question)

# 4. 準備數據集與評估指標
qa_dataset = [
    dspy.Example(question=\"地球是圓的嗎？\", answer=\"是的，地球是圓的。\"),
    dspy.Example(question=\"水的化學式是什麼？\", answer=\"水的化學式是 H2O。\"),
    dspy.Example(question=\"誰發明了燈泡？\", answer=\"托馬斯·愛迪生。\"),
    dspy.Example(question=\"光速是多少？\", answer=\"約每秒 299,792,458 公尺。\"),
]

def simple_evaluate(pred_answer, gold_answer):
    return gold_answer.lower() in pred_answer.lower()

class MyEvaluator(dspy.evaluate.Evaluator):
    def __init__(self):
        super().__init__(metric=self.metric)

    def metric(self, example, pred, trace=None):
        return simple_evaluate(pred.answer, example.answer)

my_evaluator = MyEvaluator()

# 5. 使用 Teleprompter 進行優化
teleprompter = BootstrapFewShot(metric=my_evaluator.metric)
optimized_qa_module = teleprompter.compile(SimpleQAModule(), trainset=qa_dataset)

# 顯示優化後的提示詞 (會包含自動生成的 Few-shot 範例)
print("\n--- 優化後的提示詞 (部分) ---")
# 注意：這裡的索引可能需要根據實際運行情況調整，以獲取正確的提示詞
# 這是獲取 dspy.Predict 內部提示詞的一種方式
if optimized_qa_module.predict.extended_predictors:
    print(optimized_qa_module.predict.extended_predictors[0].lm.history[-1].prompt)
else:
    print("無法獲取優化後的提示詞，可能需要更多訓練數據或不同的 Teleprompter。")

# 6. 執行優化後的模組
print("\n--- 使用優化後的模組進行推理 ---")
response = optimized_qa_module(question=\"太陽系的中心是什麼？\")
print(f\"問題: 太陽系的中心是什麼？\n答案: {response.answer}\")

response = optimized_qa_module(question=\"Python 的創始人是誰？\")
print(f\"問題: Python 的創始人是誰？\n答案: {response.answer}\")

response = optimized_qa_module(question=\"萬有引力定律是誰提出的？\")
print(f\"問題: 萬有引力定律是誰提出的？\n答案: {response.answer}\")
16:[["$","h2",null,{"children":"1. Overview"}],"\n",["$","p",null,{"children":["在大型語言模型（LLM）應用開發的早期階段，「提示工程（Prompt Engineering）」是核心技能。開發者花費大量時間精心設計、迭代和微調提示詞（Prompt），以引導 LLM 產生期望的輸出。然而，這種手動的提示詞工程方法存在顯著的局限性：它",["$","strong",null,{"children":"脆弱"}],"、",["$","strong",null,{"children":"難以維護"}],"、",["$","strong",null,{"children":"難以擴展"}],"，且",["$","strong",null,{"children":"缺乏系統性"}]," [1]。當底層 LLM 模型更新、任務需求變化或需要遷移到不同模型時，手寫的提示詞往往會失效，導致巨大的維護成本。"]}],"\n",["$","p",null,{"children":["進入 2026 年，業界對 LLM 應用開發的觀點已發生根本性轉變：「手寫 Prompt 是脆弱的」。由史丹佛大學提出的 ",["$","strong",null,{"children":"DSPy (Declarative Self-improving Python)"}]," 框架，正是為了解決這一痛點而生。DSPy 允許開發者以宣告式（Declarative）的方式定義 LLM 應用程式的邏輯和任務模組，而不是直接編寫提示詞。它將提示詞的生成與優化交給了自動化的「編譯器（Compiler）」和「優化器（Optimizer）」，這些工具能夠透過少量的數據集，自動迭代出比人類手寫更強大、更穩健的提示詞結構 [2]。"]}],"\n",["$","p",null,{"children":"本文件將深入解析 DSPy 的核心原理與架構，探討其如何透過 Signatures、Modules 和 Teleprompters 等抽象層，將 LLM 應用開發從藝術轉變為科學。我們將學習如何使用 Python 程式碼定義 AI 的任務模組，並透過 DSPy 的自動優化機制，實現 LLM 應用程式的自動化、可擴展和高性能開發，從而徹底告別傳統提示工程的困境。"}],"\n",["$","h2",null,{"children":"2. Architecture / Design"}],"\n",["$","p",null,{"children":"DSPy 的核心設計理念是將 LLM 應用程式視為一個可編譯的系統，其架構圍繞著三個關鍵的抽象層：Signatures、Modules 和 Teleprompters (或稱 Optimizers)。這些抽象層共同構成了一個強大的框架，使得開發者能夠以宣告式的方式構建、優化和部署 LLM 應用 [3]。"}],"\n",["$","h3",null,{"children":"2.1 DSPy 的三大抽象層"}],"\n",["$","h4",null,{"children":"2.1.1 Signatures (簽名)"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"定義"}],"：Signature 是 DSPy 中最基礎的抽象，它以宣告式的方式定義了 LLM 任務的",["$","strong",null,{"children":"輸入-輸出行為"}],"。它描述了「",["$","strong",null,{"children":"做什麼"}],"」，而不是「",["$","strong",null,{"children":"怎麼做"}],"」 [4]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"功能"}],"：一個 Signature 就像一個函數簽名，它明確指定了輸入欄位（input fields）和輸出欄位（output fields），以及它們的簡短描述。例如，一個問答任務的 Signature 可以是 ",["$","code",null,{"children":"question -> answer"}],"，其中 ",["$","code",null,{"children":"question"}]," 和 ",["$","code",null,{"children":"answer"}]," 都是帶有描述的字串。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"優勢"}],"：透過 Signature，開發者無需關心底層的提示詞具體措辭，只需專注於任務的邏輯定義。DSPy 會根據這個 Signature 自動生成最適合 LLM 的提示詞。"]}],"\n"]}],"\n",["$","h4",null,{"children":"2.1.2 Modules (模組)"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"定義"}],"：Module 是 DSPy 中用於定義 LLM 應用程式",["$","strong",null,{"children":"邏輯結構"}],"的抽象。它將 LLM 應用程式分解為可組合、可重用的組件，類似於 PyTorch 中的 ",["$","code",null,{"children":"nn.Module"}]," [5]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"功能"}],"：一個 Module 可以是一個簡單的 LLM 調用（例如 ",["$","code",null,{"children":"dspy.Predict"}],"），也可以是一個複雜的多步驟推理鏈（例如 ",["$","code",null,{"children":"dspy.ChainOfThought"}],"、",["$","code",null,{"children":"dspy.ReAct"}],"）。開發者可以將多個 Module 組合起來，構建複雜的 LLM 管道（Pipeline）。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"優勢"}],"：Module 使得 LLM 應用程式的開發更加模組化和結構化。每個 Module 都有明確的輸入和輸出，易於測試、調試和重用。當底層 LLM 模型或策略需要更換時，只需替換相應的 Module 即可，而無需修改整個應用程式的邏輯。"]}],"\n"]}],"\n",["$","h4",null,{"children":"2.1.3 Teleprompters / Optimizers (優化器)"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"定義"}],"：Teleprompter（在 DSPy 中也常稱為 Optimizer）是 DSPy 的核心創新之一，它是一個",["$","strong",null,{"children":"自動化演算法"}],"，負責根據給定的數據集和評估指標，自動優化 DSPy 程式中的提示詞和/或 LLM 權重 [6]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"功能"}],"：Teleprompter 不會手動編寫提示詞，而是透過迭代和搜索，找到最能提升 LLM 應用程式性能的提示詞結構、Few-shot 範例、推理步驟等。常見的 Teleprompters 包括 ",["$","code",null,{"children":"BootstrapFewShot"}],"、",["$","code",null,{"children":"BayesianSignatureOptimizer"}]," 等 [7]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"優勢"}],"：Teleprompter 徹底解決了手動提示詞工程的痛點。它使得 LLM 應用程式能夠自我改進，自動適應不同的數據集和模型，從而實現更高的性能和更強的魯棒性。開發者只需提供少量帶標籤的數據和一個評估指標，Teleprompter 就能自動完成提示詞的優化工作。"]}],"\n"]}],"\n",["$","h3",null,{"children":"2.2 DSPy 編譯工作流 (Compilation Workflow)"}],"\n",["$","p",null,{"children":"DSPy 的開發流程可以概括為一個「編譯」過程，類似於傳統軟體開發中的編譯器將高階語言轉換為機器碼："}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"定義程式 (Define Program)"}],"：開發者使用 Python 程式碼，透過 DSPy 的 Signatures 和 Modules 來定義 LLM 應用程式的邏輯。這是一個宣告式的過程，專注於「做什麼」和「如何組合」。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"定義指標 (Define Metric)"}],"：開發者需要為應用程式定義一個或多個評估指標（Metric），用於衡量其性能。例如，對於問答系統，可以是答案的精確度、語意相似度或召回率。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"編譯 (Compile)"}],"：這是 DSPy 最獨特的一步。開發者選擇一個 Teleprompter（Optimizer），並提供一個小的訓練數據集和定義好的指標。Teleprompter 會在這個數據集上運行，透過迭代和搜索，自動生成或調整 DSPy 程式中所有 Modules 的內部提示詞、Few-shot 範例和推理步驟。最終，它會輸出一個「編譯後」的 DSPy 程式物件 [8]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"執行 (Execute)"}],"：一旦程式被「編譯」完成，開發者就可以使用這個優化後的 DSPy 程式物件來處理新的輸入。此時，所有的提示詞和推理邏輯都已經被 Teleprompter 自動優化，應用程式將以最佳性能運行。"]}],"\n"]}],"\n",["$","h2",null,{"children":"3. Prerequisites"}],"\n",["$","p",null,{"children":"要開始使用 DSPy 進行 LLM 應用開發，您需要具備以下環境和知識："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Python 環境"}],"：建議使用 Python 3.9 或更高版本。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"基礎 Python 程式設計知識"}],"：熟悉 Python 的類別、函數和物件導向程式設計。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"LLM 基礎知識"}],"：理解大型語言模型的基本工作原理、提示詞工程的基本概念。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"數據集概念"}],"：理解訓練數據集、評估指標在機器學習中的作用。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"安裝 DSPy"}],"：透過 ",["$","code",null,{"children":"pip install dspy-ai"}]," 安裝 DSPy 框架。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"LLM API 金鑰"}],"：需要配置您選擇的 LLM 服務提供商的 API 金鑰，例如 OpenAI、Anthropic、Google Gemini 等。"]}],"\n"]}],"\n",["$","h2",null,{"children":"4. Implementation / Code Example"}],"\n",["$","p",null,{"children":"本節將提供一個使用 DSPy 實現簡單問答系統的範例，展示如何定義 Signature、使用 Module，並透過 Teleprompter 進行自動優化。"}],"\n",["$","h3",null,{"children":"4.1 專案初始化與安裝"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-bash","children":"mkdir dspy-qa-example\ncd dspy-qa-example\npip install dspy-ai openai # 假設使用 OpenAI 作為 LLM\n"}]}],"\n",["$","h3",null,{"children":"4.2 配置 LLM"}],"\n",["$","p",null,{"children":["創建 ",["$","code",null,{"children":".env"}]," 檔案來儲存您的 OpenAI API 金鑰："]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-dotenv","children":"OPENAI_API_KEY=your_openai_api_key_here\n"}]}],"\n",["$","p",null,{"children":"然後在程式碼中配置 DSPy 使用該 LLM："}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"import dspy\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\n# 配置 LLM\nllm = dspy.OpenAI(model=\\\"gpt-3.5-turbo\\\", api_key=os.getenv(\\\"OPENAI_API_KEY\\\"))\ndspy.settings.configure(lm=llm)\n"}]}],"\n",["$","h3",null,{"children":"4.3 定義 Signature"}],"\n",["$","p",null,{"children":["我們定義一個簡單的問答 Signature，它接收一個 ",["$","code",null,{"children":"question"}]," 並返回一個 ",["$","code",null,{"children":"answer"}],"。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"class BasicQA(dspy.Signature):\n    \\\"\\\"\\\"根據問題提供簡潔的答案。\\\"\\\"\\\"\n    question = dspy.InputField(desc=\\\"使用者提出的問題\\\")\n    answer = dspy.OutputField(desc=\\\"問題的簡潔答案\\\")\n"}]}],"\n",["$","h3",null,{"children":"4.4 定義 Module"}],"\n",["$","p",null,{"children":["對於這個簡單的問答任務，我們可以直接使用 ",["$","code",null,{"children":"dspy.Predict"}]," Module，它會根據 Signature 自動生成提示詞。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"class SimpleQAModule(dspy.Module):\n    def __init__(self):\n        super().__init__()\n        self.predict = dspy.Predict(BasicQA) # 使用 BasicQA Signature\n\n    def forward(self, question):\n        return self.predict(question=question)\n"}]}],"\n",["$","h3",null,{"children":"4.5 準備數據集與評估指標"}],"\n",["$","p",null,{"children":"DSPy 需要少量帶標籤的數據來進行優化。這裡我們創建一個小的範例數據集。評估指標則用於衡量答案的正確性。"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"# 範例數據集 (通常來自真實世界的數據)\n# 每個範例包含輸入 (question) 和期望的輸出 (answer)\nqa_dataset = [\n    dspy.Example(question=\\\"地球是圓的嗎？\\\", answer=\\\"是的，地球是圓的。\\\"),\n    dspy.Example(question=\\\"水的化學式是什麼？\\\", answer=\\\"水的化學式是 H2O。\\\"),\n    dspy.Example(question=\\\"誰發明了燈泡？\\\", answer=\\\"托馬斯·愛迪生。\\\"),\n]\n\n# 定義一個簡單的評估函數 (實際應用中會更複雜)\n# 這裡我們只檢查答案是否包含關鍵詞\ndef simple_evaluate(pred_answer, gold_answer):\n    return gold_answer.lower() in pred_answer.lower()\n\nclass MyEvaluator(dspy.evaluate.Evaluator):\n    def __init__(self):\n        super().__init__(metric=self.metric)\n\n    def metric(self, example, pred, trace=None):\n        # 這裡的 example 是 qa_dataset 中的一個 dspy.Example\n        # pred 是 LLM 的預測結果\n        # trace 是 DSPy 內部執行的軌跡 (用於調試)\n        return simple_evaluate(pred.answer, example.answer)\n\nmy_evaluator = MyEvaluator()\n"}]}],"\n",["$","h3",null,{"children":"4.6 使用 Teleprompter 進行優化"}],"\n",["$","p",null,{"children":["我們使用 ",["$","code",null,{"children":"BootstrapFewShot"}]," Teleprompter 來自動生成 Few-shot 範例，以優化 ",["$","code",null,{"children":"SimpleQAModule"}],"。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"from dspy.teleprompter import BootstrapFewShot\n\n# 創建一個 Teleprompter\nteleprompter = BootstrapFewShot(metric=my_evaluator.metric)\n\n# 編譯/優化我們的 QA 模組\n# 會在 qa_dataset 上運行，並嘗試找到最佳的 Few-shot 範例\noptimized_qa_module = teleprompter.compile(SimpleQAModule(), trainset=qa_dataset)\n\n# 顯示優化後的提示詞 (會包含自動生成的 Few-shot 範例)\nprint(\"\\n--- 優化後的提示詞 (部分) ---\")\nprint(optimized_qa_module.predict.extended_predictors[0].lm.history[-1].prompt)\n"}]}],"\n",["$","h3",null,{"children":"4.7 執行優化後的模組"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"# 使用優化後的模組進行推理\nprint(\"\\n--- 使用優化後的模組進行推理 ---\")\nresponse = optimized_qa_module(question=\\\"太陽系的中心是什麼？\\\")\nprint(f\\\"問題: 太陽系的中心是什麼？\\n答案: {response.answer}\\\")\n\nresponse = optimized_qa_module(question=\\\"Python 的創始人是誰？\\\")\nprint(f\\\"問題: Python 的創始人是誰？\\n答案: {response.answer}\\\")\n"}]}],"\n",["$","h3",null,{"children":["4.8 完整程式碼 (",["$","code",null,{"children":"main.py"}],")"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-python","children":"$17"}]}],"\n",["$","h2",null,{"children":"5. Parameters / API Reference"}],"\n",["$","p",null,{"children":"DSPy 的 API 參考主要體現在其核心類別和函數上，這些構成了開發者構建和優化 LLM 應用程式的介面。"}],"\n",["$","h3",null,{"children":["5.1 ",["$","code",null,{"children":"dspy.Signature"}]," 相關參數"]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"style":{"textAlign":"left"},"children":"參數/屬性"}],["$","th",null,{"style":{"textAlign":"left"},"children":"類型"}],["$","th",null,{"style":{"textAlign":"left"},"children":"描述"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"InputField"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.Field"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["定義 Signature 的輸入欄位，可指定 ",["$","code",null,{"children":"desc"}]," (描述) 和 ",["$","code",null,{"children":"prefix"}]," (前綴)。"]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"OutputField"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.Field"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["定義 Signature 的輸出欄位，可指定 ",["$","code",null,{"children":"desc"}]," (描述) 和 ",["$","code",null,{"children":"prefix"}]," (前綴)。"]}]]}]]}]]}],"\n",["$","h3",null,{"children":["5.2 ",["$","code",null,{"children":"dspy.Module"}]," 相關類別"]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"style":{"textAlign":"left"},"children":"類別"}],["$","th",null,{"style":{"textAlign":"left"},"children":"描述"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.Predict"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"最基本的 Module，根據 Signature 進行單次 LLM 預測。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.ChainOfThought"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"實現思維鏈（Chain-of-Thought）推理，將複雜任務分解為多個步驟。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.ReAct"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"實現 ReAct（Reasoning and Acting）模式，結合推理和工具使用。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.Retrieve"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"實現檢索（Retrieval）功能，從外部知識庫獲取相關資訊。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.Program"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"用於組合多個 Module 形成一個完整的 LLM 應用程式。"}]]}]]}]]}],"\n",["$","h3",null,{"children":["5.3 ",["$","code",null,{"children":"dspy.Teleprompter"}]," (Optimizer) 相關類別"]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"style":{"textAlign":"left"},"children":"類別"}],["$","th",null,{"style":{"textAlign":"left"},"children":"描述"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"BootstrapFewShot"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"透過引導（Bootstrapping）生成 Few-shot 範例來優化提示詞。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"BayesianSignatureOptimizer"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"使用貝葉斯優化來搜索最佳的 Signature 結構和提示詞。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"SignatureOptimizer"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"基礎的 Signature 優化器，用於調整提示詞的措辭。"}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"Ensemble"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":"組合多個優化後的程式，以提高魯棒性。"}]]}]]}]]}],"\n",["$","h3",null,{"children":["5.4 ",["$","code",null,{"children":"dspy.settings.configure"}]," 參數"]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"style":{"textAlign":"left"},"children":"參數名稱"}],["$","th",null,{"style":{"textAlign":"left"},"children":"類型"}],["$","th",null,{"style":{"textAlign":"left"},"children":"描述"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"lm"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.LM"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["配置要使用的語言模型實例（例如 ",["$","code",null,{"children":"dspy.OpenAI"}],"）。"]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"rm"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"dspy.RM"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["配置要使用的檢索模型實例（例如 ",["$","code",null,{"children":"dspy.ColBERTv2"}],"）。"]}]]}]]}]]}],"\n",["$","h2",null,{"children":"6. Notes & Best Practices"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"從 Signature 開始"}],"：始終從清晰地定義任務的 Signature 開始。這是 DSPy 程式的基石，它明確了輸入和輸出，讓 DSPy 能夠自動生成提示詞 [4]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"模組化設計"}],"：將複雜的 LLM 應用程式分解為小的、可管理的 Module。這不僅提高了程式碼的可讀性和可維護性，也使得每個 Module 都可以獨立優化 [5]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"數據集的重要性"}],"：儘管 DSPy 減少了手動提示詞工程，但它仍然需要少量的高品質數據集來進行優化。這些數據集用於訓練 Teleprompter，使其能夠學習如何生成最佳的提示詞和 Few-shot 範例 [8]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"選擇合適的 Teleprompter"}],"：不同的 Teleprompter 適用於不同的優化目標和場景。例如，",["$","code",null,{"children":"BootstrapFewShot"}]," 適合於生成 Few-shot 範例，而 ",["$","code",null,{"children":"BayesianSignatureOptimizer"}]," 則更適合於搜索最佳的 Signature 結構 [7]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"迭代優化"}],"：DSPy 的優化過程是迭代的。您可能需要嘗試不同的 Teleprompter、調整數據集或評估指標，以找到最佳的程式性能。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"評估指標的精確性"}],"：優化器的效果直接取決於評估指標的精確性。一個好的評估指標能夠準確地反映應用程式的性能，從而引導優化器找到更好的解決方案。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"可解釋性與調試"}],"：DSPy 提供了 ",["$","code",null,{"children":"dspy.settings.trace()"}]," 等工具，可以追蹤 LLM 的內部調用和提示詞生成過程，這對於理解和調試優化後的程式非常有幫助。"]}],"\n"]}],"\n",["$","h2",null,{"children":"7. 為什麼選擇這種方式？"}],"\n",["$","p",null,{"children":"從傳統的手寫 Prompt Engineering 轉向 DSPy 框架，代表著 LLM 應用開發範式的重大演進，其優勢在於："}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"告別手寫 Prompt 的脆弱性"}],"：傳統的手寫 Prompt 極易受到 LLM 模型更新、任務細節變化或不同模型之間差異的影響，導致測試失敗和高昂的維護成本。DSPy 透過將提示詞的生成自動化，使得應用程式對這些變化更具彈性，從根本上解決了 Prompt 的脆弱性問題 [1]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"實現 LLM 應用程式的自動化優化"}],"：DSPy 的 Teleprompters 能夠根據數據集和評估指標，自動搜索和迭代出最佳的提示詞、Few-shot 範例和推理步驟。這意味著開發者不再需要憑藉直覺或經驗來猜測最佳提示詞，而是讓 AI 自己學習如何更好地完成任務，從而實現 LLM 應用程式的自我改進和性能最大化 [2]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"提升開發效率與可維護性"}],"：DSPy 引入了 Signatures 和 Modules 等抽象層，使得 LLM 應用程式的開發更加模組化、結構化和宣告式。開發者可以像編寫傳統軟體一樣，定義清晰的任務邏輯和組件，這極大地提升了程式碼的可讀性、可重用性和可維護性 [3]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"增強 LLM 應用程式的魯棒性與可擴展性"}],"：透過自動優化，DSPy 程式在面對不同的輸入數據或底層 LLM 模型時，能夠表現出更強的魯棒性。同時，模組化的設計也使得應用程式更容易擴展，以應對更複雜的任務和不斷變化的需求 [8]。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"從「提示詞工程師」轉向「AI 系統架構師」"}],"：DSPy 改變了 AI 開發者的角色。開發者不再是提示詞的「工匠」，而是專注於設計數據流、定義評估指標和構建模組化邏輯的「AI 系統架構師」。這使得開發者能夠從低層次的提示詞細節中解放出來，專注於更高層次的系統設計和業務價值 [9]。"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"參考資料"}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["[1] Statsig. (2025, October 31). ",["$","em",null,{"children":"DSPy vs prompt engineering: Systematic vs manual tuning"}],". Retrieved from ",["$","a",null,{"href":"https://www.statsig.com/perspectives/dspy-vs-prompt-tuning","children":"https://www.statsig.com/perspectives/dspy-vs-prompt-tuning"}]]}],"\n",["$","li",null,{"children":["[2] DSPy. (n.d.). ",["$","em",null,{"children":"Programming LLMs with DSPy"}],". Retrieved from ",["$","a",null,{"href":"https://dspy.ai/learn/programming/","children":"https://dspy.ai/learn/programming/"}]]}],"\n",["$","li",null,{"children":["[3] Medium. (2024, June 3). ",["$","em",null,{"children":"An Exploratory Tour of DSPy: A Framework for Programing LLMs"}],". Retrieved from ",["$","a",null,{"href":"https://medium.com/the-modern-scientist/an-exploratory-tour-of-dspy-a-framework-for-programing-language-models-not-prompting-711bc4a56376","children":"https://medium.com/the-modern-scientist/an-exploratory-tour-of-dspy-a-framework-for-programing-language-models-not-prompting-711bc4a56376"}]]}],"\n",["$","li",null,{"children":["[4] DSPy. (n.d.). ",["$","em",null,{"children":"Signatures"}],". Retrieved from ",["$","a",null,{"href":"https://dspy.ai/learn/programming/signatures/","children":"https://dspy.ai/learn/programming/signatures/"}]]}],"\n",["$","li",null,{"children":["[5] IBM. (n.d.). ",["$","em",null,{"children":"What is DSPy?"}],". Retrieved from ",["$","a",null,{"href":"https://www.ibm.com/think/topics/dspy","children":"https://www.ibm.com/think/topics/dspy"}]]}],"\n",["$","li",null,{"children":["[6] DSPy. (n.d.). ",["$","em",null,{"children":"Optimizers"}],". Retrieved from ",["$","a",null,{"href":"https://dspy.ai/learn/optimization/optimizers/","children":"https://dspy.ai/learn/optimization/optimizers/"}]]}],"\n",["$","li",null,{"children":["[7] The Data Quarry. (2025, October 13). ",["$","em",null,{"children":"Learning DSPy (3): Working with optimizers"}],". Retrieved from ",["$","a",null,{"href":"https://thedataquarry.com/blog/learning-dspy-3-working-with-optimizers","children":"https://thedataquarry.com/blog/learning-dspy-3-working-with-optimizers"}]]}],"\n",["$","li",null,{"children":["[8] Statsig. (2025, October 31). ",["$","em",null,{"children":"DSPy fundamentals: Programmatic LLM optimization"}],". Retrieved from ",["$","a",null,{"href":"https://www.statsig.com/perspectives/dspy-fundamentals-llm-optimization","children":"https://www.statsig.com/perspectives/dspy-fundamentals-llm-optimization"}]]}],"\n",["$","li",null,{"children":["[9] blog.devwithawais.com. (2025, November 27). ",["$","em",null,{"children":"6 Surprising Truths About DSPy That Make Manual Prompting Obsolete"}],". Retrieved from ",["$","a",null,{"href":"https://blog.devwithawais.com/6-surprising-truths-about-dspy-that-make-manual-prompting-obsolete-a13c85a5c458","children":"https://blog.devwithawais.com/6-surprising-truths-about-dspy-that-make-manual-prompting-obsolete-a13c85a5c458"}]]}],"\n"]}]]
10:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:null
14:{"metadata":[["$","title","0",{"children":"【提示工程終結者】從 Prompt Engineering 轉向 DSPy (Declarative Self-improving Python) | 子yee 萬事屋 | 子yee"}],["$","meta","1",{"name":"description","content":"深入解析 DSPy 框架如何透過宣告式程式設計與自動優化機制，徹底改變 LLM 應用開發範式，告別手寫 Prompt 的脆弱性。"}],["$","meta","2",{"name":"author","content":"子yee"}],["$","meta","3",{"name":"keywords","content":"子yee 萬事屋, 台股查詢, 自選股, 技術小工具, 股票資訊平台, 技術顧問, 自動化工具"}],["$","meta","4",{"name":"google-site-verification","content":"adHIcDQiasHY4YzPlrpmSSPKl7Oj1WxrPJ_4GV4PQcM"}],["$","meta","5",{"property":"og:title","content":"【提示工程終結者】從 Prompt Engineering 轉向 DSPy (Declarative Self-improving Python)"}],["$","meta","6",{"property":"og:description","content":"深入解析 DSPy 框架如何透過宣告式程式設計與自動優化機制，徹底改變 LLM 應用開發範式，告別手寫 Prompt 的脆弱性。"}],["$","meta","7",{"property":"og:image","content":"https://qwer820921.github.io/images/img15.jpg"}],["$","meta","8",{"property":"og:image:width","content":"1200"}],["$","meta","9",{"property":"og:image:height","content":"630"}],["$","meta","10",{"property":"og:image:alt","content":"【提示工程終結者】從 Prompt Engineering 轉向 DSPy (Declarative Self-improving Python)"}],["$","meta","11",{"property":"og:type","content":"article"}],["$","meta","12",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","13",{"name":"twitter:title","content":"【提示工程終結者】從 Prompt Engineering 轉向 DSPy (Declarative Self-improving Python)"}],["$","meta","14",{"name":"twitter:description","content":"深入解析 DSPy 框架如何透過宣告式程式設計與自動優化機制，徹底改變 LLM 應用開發範式，告別手寫 Prompt 的脆弱性。"}],["$","meta","15",{"name":"twitter:image","content":"https://qwer820921.github.io/images/img15.jpg"}],["$","link","16",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"64x64"}]],"error":null,"digest":"$undefined"}
e:{"metadata":"$14:metadata","error":null,"digest":"$undefined"}
