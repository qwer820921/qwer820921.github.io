<!DOCTYPE html><html lang="zh-Hant"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css" data-precedence="next"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css" data-precedence="next"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css" data-precedence="next"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://qwer820921.github.io/_next/static/chunks/webpack-97372da6a069f2e6.js"/><script src="https://qwer820921.github.io/_next/static/chunks/4bd1b696-e100a0b1879d5e6b.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/1684-9b53760636e10952.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/main-app-c0d2570cf703bee2.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/6283-1586b7e20e5a28d4.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/app/layout-984d35e9d146542e.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/app/blog/%5Bslug%5D/page-55dd06bf73e32a25.js" async=""></script><link rel="preload" href="https://qwer820921.github.io/_next/static/chunks/2990.dad4388d14b132db.js" as="script" fetchPriority="low"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-CCKVESHCQ1" as="script"/><link rel="preload" href="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2709303513603814" as="script" crossorigin=""/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/logo192.png"/><link rel="manifest" href="/manifest.json"/><link rel="preload" href="/logo192.png" as="image"/><title>【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理 | 子yee 萬事屋 | 子yee</title><meta name="description" content="深入教學如何建構符合 Model Context Protocol (MCP) 標準的 AI 代理伺服器，實現 AI 安全存取本地 SQL Server 資料庫，提升開發效率與資料隱私。"/><meta name="author" content="子yee"/><meta name="keywords" content="子yee 萬事屋, 台股查詢, 自選股, 技術小工具, 股票資訊平台, 技術顧問, 自動化工具"/><meta name="google-site-verification" content="adHIcDQiasHY4YzPlrpmSSPKl7Oj1WxrPJ_4GV4PQcM"/><meta property="og:title" content="【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理"/><meta property="og:description" content="深入教學如何建構符合 Model Context Protocol (MCP) 標準的 AI 代理伺服器，實現 AI 安全存取本地 SQL Server 資料庫，提升開發效率與資料隱私。"/><meta property="og:image" content="https://qwer820921.github.io/images/img15.jpg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理"/><meta name="twitter:description" content="深入教學如何建構符合 Model Context Protocol (MCP) 標準的 AI 代理伺服器，實現 AI 安全存取本地 SQL Server 資料庫，提升開發效率與資料隱私。"/><meta name="twitter:image" content="https://qwer820921.github.io/images/img15.jpg"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="https://qwer820921.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><main class="container-fluid mt-5 p-0"><article class="container py-5"><div class="row justify-content-center"><div class="col-12 col-lg-8"><div class="card shadow-sm border-0"><div class="card-body p-4 p-md-5"><header class="mb-5 pb-4 border-bottom"><div id="static-back-btn" style="display:inline-flex;margin-bottom:1rem;cursor:pointer;position:relative;z-index:1"><div class="btn d-inline-flex align-items-center gap-2 shadow rounded-pill px-4 py-2 text-decoration-none" role="button" style="pointer-events:auto;background-color:#fff;backdrop-filter:none;border:1px solid rgba(0,0,0,0.08);color:#495057;font-weight:500;transition:all 0.2s ease;cursor:pointer"><span>回到文章列表</span></div></div><h1 class="fw-bold mb-3 display-6">【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理</h1><div class="text-muted d-flex align-items-center gap-3"><div class="d-flex align-items-center gap-2"><i class="bi bi-person-fill"></i><span>作者:</span>子yee</div><div class="d-flex align-items-center gap-2"><i class="bi bi-calendar3"></i><span>日期:</span>2026-02-10</div></div></header><div class="blogContent_blogContent__VY_R4"><h2>1. Overview</h2>
<p>隨著大型語言模型（LLM）在各領域的應用日益普及，如何讓這些強大的 AI 代理安全、高效地與本地資料和工具互動，成為了業界關注的焦點。傳統上，開發者需要手動複製貼上資料，或透過複雜的 API 整合來橋接 AI 與本地系統，這不僅效率低下，也存在潛在的資料安全風險。為了解決這一挑戰，Model Context Protocol (MCP) 應運而生，它是一個開放標準，旨在為 AI 應用程式與外部資料源及工具之間建立安全、雙向的連接 [1]。</p>
<p>本文件將深入探討 MCP 的核心概念與架構，並提供一份實戰指南，教您如何從零開始建構一個符合 MCP 標準的 AI 代理伺服器（MCP Server）。我們將以整合本地 SQL Server 資料庫為例，展示如何定義 Tools 讓 AI 能夠安全地查詢資料、獲取資料表結構，而無需每次手動操作。透過實作 MCP Server，您可以讓 Claude Desktop、IDE 中的 AI 助手（如 Cursor 或 VS Code Copilot）直接存取您的本地數據，極大提升開發效率，同時確保資料隱私與安全性。</p>
<h2>2. Architecture / Design</h2>
<p>Model Context Protocol (MCP) 採用 Client-Host-Server 的架構模型，旨在提供一個標準化的框架，讓 AI 應用程式（Host）能夠與外部資料和能力（Server）進行整合 [2]。</p>
<h3>2.1 Client-Host-Server 模型</h3>
<ul>
<li><strong>Host (AI 工具)</strong>：這是使用者直接互動的 AI 應用程式，例如 Anthropic 的 Claude Desktop、整合 AI 功能的 IDE（如 Cursor 或 Visual Studio Code），或是其他支援 MCP 的 AI 代理平台。Host 負責向使用者呈現 AI 的回應，並在需要時透過 MCP Client 向 MCP Server 發送請求。</li>
<li><strong>Client (MCP Client)</strong>：通常內建於 Host 應用程式中，負責處理與 MCP Server 的通訊細節。它會根據 Host 的需求，將 AI 生成的 Tool Call 請求轉換為符合 MCP 規範的訊息，並發送給 MCP Server。同時，它也會接收 MCP Server 的回應，並將結果傳回給 Host。</li>
<li><strong>Server (MCP Server)</strong>：這是由開發者實作的應用程式，運行在本地環境中。MCP Server 的核心職責是連接到本地資料源（如 SQL Server、檔案系統、API）或本地工具，並將這些能力以標準化的 Resources 和 Tools 形式暴露給 MCP Client。它接收來自 Client 的請求，執行相應的操作，並將結果返回 [3]。</li>
</ul>
<h3>2.2 MCP 的三大核心概念</h3>
<p>MCP 透過以下三個核心概念，實現 AI 代理與外部世界的互動：</p>
<ul>
<li><strong>Resources (資源)</strong>：Resources 代表 AI 可以讀取的靜態資料，例如文件、程式碼檔案、日誌檔、配置檔等。當 AI 需要額外的上下文資訊來理解問題或生成回應時，它可以請求讀取這些 Resources。MCP Server 負責提供這些 Resources 的內容 [4]。</li>
<li><strong>Tools (工具)</strong>：Tools 代表 AI 可以呼叫的動態操作或功能，例如執行 SQL 查詢、呼叫本地 API、寫入檔案、執行腳本等。Tools 允許 AI 不僅僅是「讀取」資訊，還能「執行」操作，從而實現更強大的 Agentic 能力。每個 Tool 都會有明確的輸入參數和預期的輸出格式 [5]。</li>
<li><strong>Prompts (提示)</strong>：Prompts 是預定義的提示模板，它們指導 AI 如何理解和使用 MCP Server 提供的 Resources 和 Tools。這些 Prompts 通常包含對 Server 功能的描述、Tools 的使用說明、以及如何處理特定情境的指引。透過 Prompts，開發者可以精確地控制 AI 與 Server 的互動方式，確保 AI 能夠正確地利用本地能力 [6]。</li>
</ul>
<h3>2.3 SQL Server 整合工作流</h3>
<p>當 AI 代理需要與本地 SQL Server 互動時，其工作流如下：</p>
<ol>
<li><strong>AI 意圖識別</strong>：使用者向 AI 提出一個需要查詢本地資料庫的問題（例如：「查詢 <code>Orders</code> 表中最近 10 筆訂單的資訊」）。</li>
<li><strong>Tool Call 生成</strong>：AI 代理（Host）根據其內部的邏輯和 MCP Server 提供的 Tools 描述，判斷需要呼叫哪個 Tool（例如 <code>query_database</code>），並生成相應的 Tool Call 請求，包含必要的參數（例如 SQL 查詢語句）。</li>
<li><strong>請求發送</strong>：MCP Client 將 Tool Call 請求封裝為符合 MCP 規範的訊息，透過本地網路發送給 MCP Server。</li>
<li><strong>Server 執行 Tool</strong>：MCP Server 接收到請求後，解析 Tool Call，並執行對應的 Tool 邏輯。例如，它會連接到本地 SQL Server，執行 AI 提供的 SQL 查詢。</li>
<li><strong>結果返回</strong>：SQL Server 返回查詢結果給 MCP Server。MCP Server 將結果格式化，並透過 MCP Client 返回給 AI 代理。</li>
<li><strong>AI 回應生成</strong>：AI 代理接收到查詢結果後，將其整合到其上下文中，生成一個自然語言的回應給使用者。</li>
</ol>
<h2>3. Prerequisites</h2>
<p>要實作一個整合 SQL Server 的 MCP Server，您需要具備以下環境和知識：</p>
<ul>
<li><strong>Node.js 環境</strong>：建議使用 LTS 版本，因為 MCP Server 通常會使用 TypeScript/JavaScript 進行開發。</li>
<li><strong>TypeScript 知識</strong>：MCP SDK 通常以 TypeScript 提供，熟悉 TypeScript 將有助於開發和理解程式碼。</li>
<li><strong>SQL Server 實例</strong>：一個可訪問的本地 SQL Server 實例，包含您希望 AI 存取的資料庫和資料表。</li>
<li><strong>SQL Server 連接資訊</strong>：包括伺服器位址、資料庫名稱、使用者名稱和密碼。</li>
<li><strong>MCP SDK</strong>：安裝官方提供的 <code>@modelcontextprotocol/sdk</code> 套件。</li>
<li><strong>基礎網路知識</strong>：理解本地網路通訊和埠號。</li>
<li><strong>AI 工具</strong>：一個支援 MCP 的 AI Host 應用程式，例如 Claude Desktop 或 VS Code 的 AI 擴充功能，用於測試您的 MCP Server。</li>
</ul>
<h2>4. Implementation / Code Example</h2>
<p>本節將提供一個使用 TypeScript 和 Node.js 實作 MCP Server 的範例，該 Server 將暴露三個 Tools，允許 AI 代理與本地 SQL Server 進行互動：<code>list_tables</code> (列出所有資料表)、<code>describe_table</code> (描述特定資料表的 Schema) 和 <code>query_database</code> (執行 SQL 查詢)。</p>
<h3>4.1 專案初始化</h3>
<p>首先，創建一個新的 Node.js 專案並安裝必要的套件：</p>
<pre><code class="language-bash">mkdir mcp-sql-server-agent
cd mcp-sql-server-agent
npm init -y
npm install typescript @types/node @modelcontextprotocol/sdk mssql @types/mssql dotenv
npx tsc --init
</code></pre>
<p>在 <code>tsconfig.json</code> 中，確保 <code>target</code> 設置為 <code>es2020</code> 或更高，<code>module</code> 設置為 <code>commonjs</code> 或 <code>esnext</code>。</p>
<h3>4.2 配置 SQL Server 連接</h3>
<p>創建 <code>.env</code> 檔案來儲存敏感的資料庫連接資訊：</p>
<pre><code class="language-dotenv">SQL_SERVER_HOST=localhost
SQL_SERVER_PORT=1433
SQL_SERVER_DATABASE=YourDatabaseName
SQL_SERVER_USER=YourUsername
SQL_SERVER_PASSWORD=YourPassword
</code></pre>
<h3>4.3 實作 MCP Server (<code>src/server.ts</code>)</h3>
<pre><code class="language-typescript">import { Server, Tool, RequestHandler } from &quot;@modelcontextprotocol/sdk&quot;;
import * as mssql from &quot;mssql&quot;;
import * as dotenv from &quot;dotenv&quot;;

dotenv.config(); // 加載 .env 檔案

// SQL Server 配置
const sqlConfig: mssql.config = {
  user: process.env.SQL_SERVER_USER,
  password: process.env.SQL_SERVER_PASSWORD,
  server: process.env.SQL_SERVER_HOST || &quot;localhost&quot;, // 您 SQL Server 的 IP 或主機名
  port: parseInt(process.env.SQL_SERVER_PORT || &quot;1433&quot;),
  database: process.env.SQL_SERVER_DATABASE,
  options: {
    encrypt: false, // For Azure SQL Database, set true
    trustServerCertificate: true, // Change to false for production
  },
};

// 創建一個 SQL Server 連接池
let pool: mssql.ConnectionPool | undefined;

async function getSqlConnection() {
  if (!pool || !pool.connected) {
    try {
      pool = new mssql.ConnectionPool(sqlConfig);
      await pool.connect();
      console.log(&quot;Connected to SQL Server&quot;);
    } catch (err) {
      console.error(&quot;SQL Server Connection Failed:&quot;, err);
      throw new Error(&quot;Failed to connect to SQL Server&quot;);
    }
  }
  return pool;
}

// 1. Tool: 列出所有資料表
const listTablesTool: Tool = {
  name: &quot;list_tables&quot;,
  description: &quot;列出當前資料庫中所有可用的資料表名稱。&quot;,
  parameters: {
    type: &quot;object&quot;,
    properties: {},
    required: [],
  },
  returns: {
    type: &quot;array&quot;,
    items: {
      type: &quot;string&quot;,
    },
  },
};

const listTablesHandler: RequestHandler&lt;typeof listTablesTool&gt; = async () =&gt; {
  const pool = await getSqlConnection();
  const request = pool.request();
  const result = await request.query(
    &quot;SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = &#x27;BASE TABLE&#x27; AND TABLE_CATALOG = @databaseName&quot;
  );
  return result.recordset.map((row) =&gt; row.TABLE_NAME);
};

// 2. Tool: 描述特定資料表的 Schema
const describeTableTool: Tool = {
  name: &quot;describe_table&quot;,
  description: &quot;獲取指定資料表的欄位名稱、資料類型和是否允許為空。&quot;,
  parameters: {
    type: &quot;object&quot;,
    properties: {
      tableName: {
        type: &quot;string&quot;,
        description: &quot;要描述的資料表名稱。&quot;,
      },
    },
    required: [&quot;tableName&quot;],
  },
  returns: {
    type: &quot;array&quot;,
    items: {
      type: &quot;object&quot;,
      properties: {
        columnName: { type: &quot;string&quot; },
        dataType: { type: &quot;string&quot; },
        isNullable: { type: &quot;boolean&quot; },
      },
    },
  },
};

const describeTableHandler: RequestHandler&lt;typeof describeTableTool&gt; = async ({
  tableName,
}) =&gt; {
  const pool = await getSqlConnection();
  const request = pool.request();
  request.input(&quot;tableName&quot;, mssql.NVarChar, tableName);
  const result = await request.query(
    `SELECT COLUMN_NAME as columnName, DATA_TYPE as dataType, IS_NULLABLE as isNullable
     FROM INFORMATION_SCHEMA.COLUMNS
     WHERE TABLE_NAME = @tableName AND TABLE_CATALOG = @databaseName`
  );
  return result.recordset.map((row) =&gt; ({
    columnName: row.columnName,
    dataType: row.dataType,
    isNullable: row.isNullable === &quot;YES&quot;,
  }));
};

// 3. Tool: 執行 SQL 查詢 (唯讀)
const queryDatabaseTool: Tool = {
  name: &quot;query_database&quot;,
  description: &quot;執行一個 SQL SELECT 查詢並返回結果。僅支援 SELECT 語句。&quot;,
  parameters: {
    type: &quot;object&quot;,
    properties: {
      query: {
        type: &quot;string&quot;,
        description: &quot;要執行的 SQL SELECT 查詢語句。&quot;,
      },
    },
    required: [&quot;query&quot;],
  },
  returns: {
    type: &quot;array&quot;,
    items: {
      type: &quot;object&quot;, // 返回任意 JSON 物件陣列
    },
  },
};

const queryDatabaseHandler: RequestHandler&lt;typeof queryDatabaseTool&gt; = async ({
  query,
}) =&gt; {
  if (!query.trim().toLowerCase().startsWith(&quot;select&quot;)) {
    throw new Error(&quot;Only SELECT queries are allowed for security reasons.&quot;);
  }
  const pool = await getSqlConnection();
  const request = pool.request();
  // 注意：這裡直接執行查詢，實際生產環境應考慮更嚴格的 SQL 注入防護和權限控制。
  // 建議使用參數化查詢或預處理語句來處理使用者輸入。
  const result = await request.query(query);
  return result.recordset;
};

async function main() {
  const server = new Server();

  // 註冊 Tools
  server.registerTool(listTablesTool, listTablesHandler);
  server.registerTool(describeTableTool, describeTableHandler);
  server.registerTool(queryDatabaseTool, queryDatabaseHandler);

  // 啟動 Server
  const port = 3000; // 您可以自定義埠號
  await server.start(port);
  console.log(`MCP Server started on port ${port}`);

  // 為了讓 AI 代理知道如何使用這些 Tools，您需要提供 Prompts。
  // 這些 Prompts 通常會被 AI Host 應用程式讀取並用於引導 AI 的行為。
  // 範例 Prompt (這部分通常在 AI Host 端配置，或透過 MCP Server 的 Resource 暴露):
  console.log(&quot;\n--- 範例 AI Prompt ---&quot;);
  console.log(
    &quot;你是一個專業的資料庫分析師。當使用者需要查詢本地 SQL Server 資料時，請使用以下工具：&quot;
  );
  console.log(&quot;- `list_tables()`: 列出所有資料表。&quot;);
  console.log(
    &quot;- `describe_table(tableName: string)`: 獲取特定資料表的 Schema。&quot;
  );
  console.log(&quot;- `query_database(query: string)`: 執行 SQL SELECT 查詢。&quot;);
  console.log(
    &quot;請務必先使用 `list_tables` 和 `describe_table` 來理解資料庫結構，然後再執行 `query_database`。&quot;
  );
  console.log(&quot;--- 範例 AI Prompt ---&quot;);
}

main().catch(console.error);
</code></pre>
<h3>4.4 編譯與運行</h3>
<pre><code class="language-bash">npx tsc
node dist/server.js
</code></pre>
<h3>4.5 與 AI Host 整合 (以 Claude Desktop 為例)</h3>
<ol>
<li>
<p><strong>配置 <code>claude_desktop_config.json</code></strong>：
在您的使用者目錄下（例如 <code>~/.claude_desktop/claude_desktop_config.json</code>），添加以下配置，指向您的 MCP Server：</p>
<pre><code class="language-json">{
  &quot;mcp_servers&quot;: [
    {
      &quot;name&quot;: &quot;Local SQL Server Agent&quot;,
      &quot;url&quot;: &quot;http://localhost:3000&quot;, // 您的 MCP Server 運行地址和埠號
      &quot;description&quot;: &quot;提供對本地 SQL Server 資料庫的查詢和結構檢視能力。&quot;
    }
  ]
}
</code></pre>
</li>
<li>
<p><strong>重啟 Claude Desktop</strong>：確保配置生效。</p>
</li>
<li>
<p><strong>與 AI 互動</strong>：現在，您可以在 Claude Desktop 中向 AI 提問，例如：「我的本地資料庫裡有哪些資料表？」或「請查詢 <code>Products</code> 表中價格大於 100 的所有產品。」AI 將會自動呼叫您的 MCP Server 提供的 Tools 來獲取答案。</p>
</li>
</ol>
<h2>5. Parameters / API Reference</h2>
<p>MCP Server 的 API 參考主要體現在其暴露的 Tools 定義上。這些 Tools 的 <code>name</code>、<code>description</code>、<code>parameters</code> 和 <code>returns</code> 結構，共同構成了 AI 代理理解和使用這些功能的介面。</p>
<h3>5.1 MCP SDK 核心介面</h3>
<table><thead><tr><th style="text-align:left">介面/類別</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>Server</code></td><td style="text-align:left">MCP Server 的主類別，用於註冊 Tools 和啟動 Server。</td></tr><tr><td style="text-align:left"><code>Tool</code></td><td style="text-align:left">定義一個 AI 可呼叫的工具，包含名稱、描述、輸入參數和預期返回值。</td></tr><tr><td style="text-align:left"><code>RequestHandler</code></td><td style="text-align:left">處理 Tool 呼叫的非同步函數，接收 Tool 的參數並返回結果。</td></tr><tr><td style="text-align:left"><code>Resource</code></td><td style="text-align:left">定義一個 AI 可讀取的靜態資源，包含名稱、描述和內容。</td></tr></tbody></table>
<h3>5.2 本地 SQL Server Agent 暴露的 Tools</h3>
<table><thead><tr><th style="text-align:left">Tool 名稱</th><th style="text-align:left">描述</th><th style="text-align:left">輸入參數</th><th style="text-align:left">返回值</th></tr></thead><tbody><tr><td style="text-align:left"><code>list_tables</code></td><td style="text-align:left">列出當前資料庫中所有可用的資料表名稱。</td><td style="text-align:left">無</td><td style="text-align:left"><code>Array&lt;string&gt;</code> (資料表名稱陣列)</td></tr><tr><td style="text-align:left"><code>describe_table</code></td><td style="text-align:left">獲取指定資料表的欄位名稱、資料類型和是否允許為空。</td><td style="text-align:left"><code>tableName: string</code> (要描述的資料表名稱)</td><td style="text-align:left"><code>Array&lt;{ columnName: string, dataType: string, isNullable: boolean }&gt;</code></td></tr><tr><td style="text-align:left"><code>query_database</code></td><td style="text-align:left">執行一個 SQL SELECT 查詢並返回結果。僅支援 SELECT 語句。</td><td style="text-align:left"><code>query: string</code> (要執行的 SQL SELECT 查詢語句)</td><td style="text-align:left"><code>Array&lt;Object&gt;</code> (查詢結果的 JSON 物件陣列)</td></tr></tbody></table>
<h2>6. Notes &amp; Best Practices</h2>
<ol>
<li><strong>安全性至上</strong>：<!-- -->
<ul>
<li><strong>最小權限原則</strong>：為 MCP Server 連接 SQL Server 的帳戶配置最小必要的權限，例如只讀取特定資料庫或資料表，避免使用 <code>sa</code> 帳戶。</li>
<li><strong>SQL 注入防護</strong>：在 <code>query_database</code> Tool 中，直接執行 AI 生成的 SQL 查詢存在 SQL 注入風險。在生產環境中，應嚴格限制 AI 只能生成預定義的查詢模板，或使用參數化查詢來處理使用者輸入，絕不能直接拼接字串 [7]。</li>
<li><strong>資料量限制</strong>：在 <code>query_database</code> Tool 的實作中，應限制查詢結果的行數（例如使用 <code>TOP 100</code>），以防止 AI 請求過大的數據量導致上下文溢出或性能問題。</li>
<li><strong>網路隔離</strong>：考慮將 MCP Server 部署在受保護的內部網路中，僅允許受信任的 AI Host 應用程式訪問。</li>
</ul>
</li>
<li><strong>錯誤處理與日誌</strong>：<!-- -->
<ul>
<li>在每個 Tool 的 <code>RequestHandler</code> 中，應包含完善的錯誤處理機制，捕獲資料庫連接失敗、查詢語法錯誤等異常，並返回清晰的錯誤訊息給 AI 代理。</li>
<li>實作詳細的日誌記錄，記錄 AI 代理的 Tool Call 請求、執行結果和任何錯誤，以便於調試和審計。</li>
</ul>
</li>
<li><strong>Prompts 優化</strong>：<!-- -->
<ul>
<li>為 AI 代理提供清晰、詳細的 Prompts，明確說明每個 Tool 的功能、輸入輸出和使用限制。例如，強調 <code>query_database</code> 僅支援 <code>SELECT</code> 語句。</li>
<li>引導 AI 代理在執行查詢前，先使用 <code>list_tables</code> 和 <code>describe_table</code> 來理解資料庫結構，以減少錯誤的 Tool Call。</li>
</ul>
</li>
<li><strong>性能考量</strong>：<!-- -->
<ul>
<li>使用資料庫連接池來管理 SQL Server 連接，避免頻繁建立和關閉連接，提升性能。</li>
<li>對於複雜或耗時的查詢，考慮在 Tool 內部進行優化，或提供非同步的 Tool 執行機制。</li>
</ul>
</li>
<li><strong>版本控制與可維護性</strong>：<!-- -->
<ul>
<li>將 MCP Server 的程式碼納入版本控制系統，並遵循良好的程式碼編寫規範。</li>
<li>隨著資料庫結構或 AI 代理需求的變化，定期更新和維護 MCP Server 的 Tools 定義和實作。</li>
</ul>
</li>
</ol>
<h2>7. 為什麼選擇這種方式？</h2>
<p>在 AI 代理與本地資料互動的場景中，選擇實作 Model Context Protocol (MCP) 標準的 AI 代理伺服器，具有以下不可替代的優勢：</p>
<ol>
<li><strong>標準化與互通性</strong>：MCP 作為一個開放標準，確保了您的 MCP Server 可以與任何支援 MCP 的 AI Host 應用程式（如 Claude Desktop、Cursor、VS Code 等）無縫協作 [1]。這避免了為每個 AI 工具開發獨立整合的重複工作，極大地提升了互通性和開發效率。</li>
<li><strong>資料隱私與安全性</strong>：透過 MCP，您的敏感本地資料無需上傳到雲端或第三方服務。AI 代理僅透過本地運行的 MCP Server 進行互動，資料始終保留在您的控制之下。MCP Server 可以實作精細的權限控制和資料過濾，確保 AI 代理只能存取其被授權的資料和執行被允許的操作，有效防範資料洩露風險 [8]。</li>
<li><strong>增強 AI 上下文與準確性</strong>：AI 代理可以透過 MCP Server 即時獲取最新的本地資料，這為其提供了遠超訓練資料的豐富上下文。這種「即時 RAG」能力使得 AI 能夠生成更精確、更相關的回應，特別是在處理不斷變化的業務數據或個人筆記時 [9]。</li>
<li><strong>消除手動操作，提升效率</strong>：MCP 讓 AI 代理能夠自動執行查詢、分析和操作本地數據，從而消除了開發者手動複製貼上、切換應用程式的繁瑣步驟。這將顯著提升開發、數據分析和日常工作的效率。</li>
<li><strong>Agentic AI 的基石</strong>：MCP 是構建真正 Agentic AI 的關鍵基礎設施之一。它賦予 AI 代理「行動」的能力，使其不僅能理解和生成文本，還能與真實世界的工具和數據進行有意義的互動，開啟了 AI 應用程式的全新可能性。</li>
</ol>
<hr/>
<p><strong>參考資料</strong></p>
<ul>
<li>[1] Anthropic. (2024, November 25). <em>Introducing the Model Context Protocol</em>. Retrieved from <a href="https://www.anthropic.com/news/model-context-protocol">https://www.anthropic.com/news/model-context-protocol</a></li>
<li>[2] Model Context Protocol. (n.d.). <em>Architecture - Model Context Protocol (MCP)</em>. Retrieved from <a href="https://modelcontextprotocol.info/specification/draft/architecture/">https://modelcontextprotocol.info/specification/draft/architecture/</a></li>
<li>[3] Model Context Protocol. (n.d.). <em>Specification - Model Context Protocol</em>. Retrieved from <a href="https://modelcontextprotocol.io/specification/2025-11-25">https://modelcontextprotocol.io/specification/2025-11-25</a></li>
<li>[4] Model Context Protocol. (n.d.). <em>Architecture overview - Model Context Protocol</em>. Retrieved from <a href="https://modelcontextprotocol.io/docs/learn/architecture">https://modelcontextprotocol.io/docs/learn/architecture</a></li>
<li>[5] Codilime. (2026, February 1). <em>Model Context Protocol (MCP) explained: A practical technical guide</em>. Retrieved from <a href="https://codilime.com/blog/model-context-protocol-explained/">https://codilime.com/blog/model-context-protocol-explained/</a></li>
<li>[6] Medium. (2026, January 10). <em>Build Your First MCP Server with Plain and TypeScript</em>. Retrieved from <a href="https://medium.com/@thecraftman/build-your-first-mcp-server-with-plain-and-typescript-6dd13494b95e">https://medium.com/@thecraftman/build-your-first-mcp-server-with-plain-and-typescript-6dd13494b95e</a></li>
<li>[7] Microsoft Learn. (2026, January 27). <em>Quickstart: Use SQL MCP Server with Visual Studio Code locally</em>. Retrieved from <a href="https://learn.microsoft.com/en-us/azure/data-api-builder/mcp/quickstart-visual-studio-code">https://learn.microsoft.com/en-us/azure/data-api-builder/mcp/quickstart-visual-studio-code</a></li>
<li>[8] Elastic. (n.d.). <em>What is the Model Context Protocol (MCP)?</em>. Retrieved from <a href="https://www.elastic.co/what-is/mcp">https://www.elastic.co/what-is/mcp</a></li>
<li>[9] Medium. (2025, July 27). <em>Building an MCP Server for Databases: A Simple Guide for Beginners</em>. Retrieved from <a href="https://medium.com/@ambhargava.cts/building-an-mcp-server-for-databases-a-simple-guide-for-beginners-859ba77bc4c9">https://medium.com/@ambhargava.cts/building-an-mcp-server-for-databases-a-simple-guide-for-beginners-859ba77bc4c9</a></li>
</ul></div></div></div></div></div></article><!--$--><!--/$--><!--$--><!--/$--></main><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><noscript>You need to enable JavaScript to run this app.</noscript><div class="position-fixed" style="z-index:1050;bottom:20px;right:20px;transform:translate(0px, 0px);touch-action:none;cursor:default;display:flex;flex-direction:column;align-items:flex-end;transition:transform 0.3s ease"><div class="position-relative"><button class="btn rounded-circle d-flex align-items-center justify-content-center shadow-lg" style="width:60px;height:60px;cursor:grab;background:linear-gradient(135deg, #0d6efd, #0a58ca);border:2px solid rgba(255,255,255,0.2);transition:transform 0.2s ease" aria-label="切換聊天視窗"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="white" style="width:28px;height:28px;pointer-events:none"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg></button><span class="position-absolute bg-danger rounded-circle" style="width:12px;height:12px;top:0;right:0;border:2px solid white"></span></div></div><script src="https://qwer820921.github.io/_next/static/chunks/webpack-97372da6a069f2e6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[69243,[\"6283\",\"static/chunks/6283-1586b7e20e5a28d4.js\",\"7177\",\"static/chunks/app/layout-984d35e9d146542e.js\"],\"\"]\n3:I[6476,[\"6283\",\"static/chunks/6283-1586b7e20e5a28d4.js\",\"7177\",\"static/chunks/app/layout-984d35e9d146542e.js\"],\"default\"]\n4:I[87555,[],\"\"]\n5:I[31295,[],\"\"]\n6:I[39543,[\"6283\",\"static/chunks/6283-1586b7e20e5a28d4.js\",\"7177\",\"static/chunks/app/layout-984d35e9d146542e.js\"],\"default\"]\n8:I[59665,[],\"MetadataBoundary\"]\na:I[59665,[],\"OutletBoundary\"]\nd:I[74911,[],\"AsyncMetadataOutlet\"]\nf:I[59665,[],\"ViewportBoundary\"]\n11:I[26614,[],\"\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css\",\"style\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css\",\"style\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css\",\"style\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ybPSf2UyqpFN3vsSzrCop\",\"p\":\"https://qwer820921.github.io\",\"c\":[\"\",\"blog\",\"implement-mcp-server-for-ai-agents\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"implement-mcp-server-for-ai-agents\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"zh-Hant\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/logo192.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/manifest.json\"}],[\"$\",\"link\",null,{\"rel\":\"preload\",\"href\":\"/logo192.png\",\"as\":\"image\"}],[\"$\",\"$L2\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-CCKVESHCQ1\"}],[\"$\",\"$L2\",null,{\"id\":\"google-analytics\",\"children\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-CCKVESHCQ1');\\n          \"}],[\"$\",\"$L2\",null,{\"async\":true,\"src\":\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2709303513603814\",\"crossOrigin\":\"anonymous\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"$L3\",null,{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L6\",null,{}]]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"implement-mcp-server-for-ai-agents\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"fMEy0dHpfIt-bvUYUOePs\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.suspense\"\n13:I[74911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$12\",null,{\"fallback\":null,\"children\":[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]}]\n"])</script><script>self.__next_f.push([1,"15:I[57113,[\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-55dd06bf73e32a25.js\"],\"default\"]\nc:null\n7:[\"$\",\"article\",null,{\"className\":\"container py-5\",\"children\":[[\"$\",\"div\",null,{\"className\":\"row justify-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"col-12 col-lg-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"card shadow-sm border-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"card-body p-4 p-md-5\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-5 pb-4 border-bottom\",\"children\":[[\"$\",\"$L15\",null,{\"mode\":\"static\",\"id\":\"static-back-btn\"}],[\"$\",\"h1\",null,{\"className\":\"fw-bold mb-3 display-6\",\"children\":\"【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理\"}],[\"$\",\"div\",null,{\"className\":\"text-muted d-flex align-items-center gap-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"d-flex align-items-center gap-2\",\"children\":[[\"$\",\"i\",null,{\"className\":\"bi bi-person-fill\"}],[\"$\",\"span\",null,{\"children\":\"作者:\"}],\"子yee\"]}],[\"$\",\"div\",null,{\"className\":\"d-flex align-items-center gap-2\",\"children\":[[\"$\",\"i\",null,{\"className\":\"bi bi-calendar3\"}],[\"$\",\"span\",null,{\"children\":\"日期:\"}],\"2026-02-10\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"blogContent_blogContent__VY_R4\",\"children\":\"$L16\"}]]}]}]}]}],[\"$\",\"$L15\",null,{\"mode\":\"floating\",\"targetId\":\"static-back-btn\"}]]}]\n"])</script><script>self.__next_f.push([1,"17:T1581,"])</script><script>self.__next_f.push([1,"import { Server, Tool, RequestHandler } from \"@modelcontextprotocol/sdk\";\nimport * as mssql from \"mssql\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config(); // 加載 .env 檔案\n\n// SQL Server 配置\nconst sqlConfig: mssql.config = {\n  user: process.env.SQL_SERVER_USER,\n  password: process.env.SQL_SERVER_PASSWORD,\n  server: process.env.SQL_SERVER_HOST || \"localhost\", // 您 SQL Server 的 IP 或主機名\n  port: parseInt(process.env.SQL_SERVER_PORT || \"1433\"),\n  database: process.env.SQL_SERVER_DATABASE,\n  options: {\n    encrypt: false, // For Azure SQL Database, set true\n    trustServerCertificate: true, // Change to false for production\n  },\n};\n\n// 創建一個 SQL Server 連接池\nlet pool: mssql.ConnectionPool | undefined;\n\nasync function getSqlConnection() {\n  if (!pool || !pool.connected) {\n    try {\n      pool = new mssql.ConnectionPool(sqlConfig);\n      await pool.connect();\n      console.log(\"Connected to SQL Server\");\n    } catch (err) {\n      console.error(\"SQL Server Connection Failed:\", err);\n      throw new Error(\"Failed to connect to SQL Server\");\n    }\n  }\n  return pool;\n}\n\n// 1. Tool: 列出所有資料表\nconst listTablesTool: Tool = {\n  name: \"list_tables\",\n  description: \"列出當前資料庫中所有可用的資料表名稱。\",\n  parameters: {\n    type: \"object\",\n    properties: {},\n    required: [],\n  },\n  returns: {\n    type: \"array\",\n    items: {\n      type: \"string\",\n    },\n  },\n};\n\nconst listTablesHandler: RequestHandler\u003ctypeof listTablesTool\u003e = async () =\u003e {\n  const pool = await getSqlConnection();\n  const request = pool.request();\n  const result = await request.query(\n    \"SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_CATALOG = @databaseName\"\n  );\n  return result.recordset.map((row) =\u003e row.TABLE_NAME);\n};\n\n// 2. Tool: 描述特定資料表的 Schema\nconst describeTableTool: Tool = {\n  name: \"describe_table\",\n  description: \"獲取指定資料表的欄位名稱、資料類型和是否允許為空。\",\n  parameters: {\n    type: \"object\",\n    properties: {\n      tableName: {\n        type: \"string\",\n        description: \"要描述的資料表名稱。\",\n      },\n    },\n    required: [\"tableName\"],\n  },\n  returns: {\n    type: \"array\",\n    items: {\n      type: \"object\",\n      properties: {\n        columnName: { type: \"string\" },\n        dataType: { type: \"string\" },\n        isNullable: { type: \"boolean\" },\n      },\n    },\n  },\n};\n\nconst describeTableHandler: RequestHandler\u003ctypeof describeTableTool\u003e = async ({\n  tableName,\n}) =\u003e {\n  const pool = await getSqlConnection();\n  const request = pool.request();\n  request.input(\"tableName\", mssql.NVarChar, tableName);\n  const result = await request.query(\n    `SELECT COLUMN_NAME as columnName, DATA_TYPE as dataType, IS_NULLABLE as isNullable\n     FROM INFORMATION_SCHEMA.COLUMNS\n     WHERE TABLE_NAME = @tableName AND TABLE_CATALOG = @databaseName`\n  );\n  return result.recordset.map((row) =\u003e ({\n    columnName: row.columnName,\n    dataType: row.dataType,\n    isNullable: row.isNullable === \"YES\",\n  }));\n};\n\n// 3. Tool: 執行 SQL 查詢 (唯讀)\nconst queryDatabaseTool: Tool = {\n  name: \"query_database\",\n  description: \"執行一個 SQL SELECT 查詢並返回結果。僅支援 SELECT 語句。\",\n  parameters: {\n    type: \"object\",\n    properties: {\n      query: {\n        type: \"string\",\n        description: \"要執行的 SQL SELECT 查詢語句。\",\n      },\n    },\n    required: [\"query\"],\n  },\n  returns: {\n    type: \"array\",\n    items: {\n      type: \"object\", // 返回任意 JSON 物件陣列\n    },\n  },\n};\n\nconst queryDatabaseHandler: RequestHandler\u003ctypeof queryDatabaseTool\u003e = async ({\n  query,\n}) =\u003e {\n  if (!query.trim().toLowerCase().startsWith(\"select\")) {\n    throw new Error(\"Only SELECT queries are allowed for security reasons.\");\n  }\n  const pool = await getSqlConnection();\n  const request = pool.request();\n  // 注意：這裡直接執行查詢，實際生產環境應考慮更嚴格的 SQL 注入防護和權限控制。\n  // 建議使用參數化查詢或預處理語句來處理使用者輸入。\n  const result = await request.query(query);\n  return result.recordset;\n};\n\nasync function main() {\n  const server = new Server();\n\n  // 註冊 Tools\n  server.registerTool(listTablesTool, listTablesHandler);\n  server.registerTool(describeTableTool, describeTableHandler);\n  server.registerTool(queryDatabaseTool, queryDatabaseHandler);\n\n  // 啟動 Server\n  const port = 3000; // 您可以自定義埠號\n  await server.start(port);\n  console.log(`MCP Server started on port ${port}`);\n\n  // 為了讓 AI 代理知道如何使用這些 Tools，您需要提供 Prompts。\n  // 這些 Prompts 通常會被 AI Host 應用程式讀取並用於引導 AI 的行為。\n  // 範例 Prompt (這部分通常在 AI Host 端配置，或透過 MCP Server 的 Resource 暴露):\n  console.log(\"\\n--- 範例 AI Prompt ---\");\n  console.log(\n    \"你是一個專業的資料庫分析師。當使用者需要查詢本地 SQL Server 資料時，請使用以下工具：\"\n  );\n  console.log(\"- `list_tables()`: 列出所有資料表。\");\n  console.log(\n    \"- `describe_table(tableName: string)`: 獲取特定資料表的 Schema。\"\n  );\n  console.log(\"- `query_database(query: string)`: 執行 SQL SELECT 查詢。\");\n  console.log(\n    \"請務必先使用 `list_tables` 和 `describe_table` 來理解資料庫結構，然後再執行 `query_database`。\"\n  );\n  console.log(\"--- 範例 AI Prompt ---\");\n}\n\nmain().catch(console.error);\n"])</script><script>self.__next_f.push([1,"16:[[\"$\",\"h2\",null,{\"children\":\"1. Overview\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"隨著大型語言模型（LLM）在各領域的應用日益普及，如何讓這些強大的 AI 代理安全、高效地與本地資料和工具互動，成為了業界關注的焦點。傳統上，開發者需要手動複製貼上資料，或透過複雜的 API 整合來橋接 AI 與本地系統，這不僅效率低下，也存在潛在的資料安全風險。為了解決這一挑戰，Model Context Protocol (MCP) 應運而生，它是一個開放標準，旨在為 AI 應用程式與外部資料源及工具之間建立安全、雙向的連接 [1]。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"本文件將深入探討 MCP 的核心概念與架構，並提供一份實戰指南，教您如何從零開始建構一個符合 MCP 標準的 AI 代理伺服器（MCP Server）。我們將以整合本地 SQL Server 資料庫為例，展示如何定義 Tools 讓 AI 能夠安全地查詢資料、獲取資料表結構，而無需每次手動操作。透過實作 MCP Server，您可以讓 Claude Desktop、IDE 中的 AI 助手（如 Cursor 或 VS Code Copilot）直接存取您的本地數據，極大提升開發效率，同時確保資料隱私與安全性。\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2. Architecture / Design\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Model Context Protocol (MCP) 採用 Client-Host-Server 的架構模型，旨在提供一個標準化的框架，讓 AI 應用程式（Host）能夠與外部資料和能力（Server）進行整合 [2]。\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.1 Client-Host-Server 模型\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Host (AI 工具)\"}],\"：這是使用者直接互動的 AI 應用程式，例如 Anthropic 的 Claude Desktop、整合 AI 功能的 IDE（如 Cursor 或 Visual Studio Code），或是其他支援 MCP 的 AI 代理平台。Host 負責向使用者呈現 AI 的回應，並在需要時透過 MCP Client 向 MCP Server 發送請求。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Client (MCP Client)\"}],\"：通常內建於 Host 應用程式中，負責處理與 MCP Server 的通訊細節。它會根據 Host 的需求，將 AI 生成的 Tool Call 請求轉換為符合 MCP 規範的訊息，並發送給 MCP Server。同時，它也會接收 MCP Server 的回應，並將結果傳回給 Host。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Server (MCP Server)\"}],\"：這是由開發者實作的應用程式，運行在本地環境中。MCP Server 的核心職責是連接到本地資料源（如 SQL Server、檔案系統、API）或本地工具，並將這些能力以標準化的 Resources 和 Tools 形式暴露給 MCP Client。它接收來自 Client 的請求，執行相應的操作，並將結果返回 [3]。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.2 MCP 的三大核心概念\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"MCP 透過以下三個核心概念，實現 AI 代理與外部世界的互動：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Resources (資源)\"}],\"：Resources 代表 AI 可以讀取的靜態資料，例如文件、程式碼檔案、日誌檔、配置檔等。當 AI 需要額外的上下文資訊來理解問題或生成回應時，它可以請求讀取這些 Resources。MCP Server 負責提供這些 Resources 的內容 [4]。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Tools (工具)\"}],\"：Tools 代表 AI 可以呼叫的動態操作或功能，例如執行 SQL 查詢、呼叫本地 API、寫入檔案、執行腳本等。Tools 允許 AI 不僅僅是「讀取」資訊，還能「執行」操作，從而實現更強大的 Agentic 能力。每個 Tool 都會有明確的輸入參數和預期的輸出格式 [5]。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Prompts (提示)\"}],\"：Prompts 是預定義的提示模板，它們指導 AI 如何理解和使用 MCP Server 提供的 Resources 和 Tools。這些 Prompts 通常包含對 Server 功能的描述、Tools 的使用說明、以及如何處理特定情境的指引。透過 Prompts，開發者可以精確地控制 AI 與 Server 的互動方式，確保 AI 能夠正確地利用本地能力 [6]。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.3 SQL Server 整合工作流\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"當 AI 代理需要與本地 SQL Server 互動時，其工作流如下：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"AI 意圖識別\"}],\"：使用者向 AI 提出一個需要查詢本地資料庫的問題（例如：「查詢 \",[\"$\",\"code\",null,{\"children\":\"Orders\"}],\" 表中最近 10 筆訂單的資訊」）。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Tool Call 生成\"}],\"：AI 代理（Host）根據其內部的邏輯和 MCP Server 提供的 Tools 描述，判斷需要呼叫哪個 Tool（例如 \",[\"$\",\"code\",null,{\"children\":\"query_database\"}],\"），並生成相應的 Tool Call 請求，包含必要的參數（例如 SQL 查詢語句）。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"請求發送\"}],\"：MCP Client 將 Tool Call 請求封裝為符合 MCP 規範的訊息，透過本地網路發送給 MCP Server。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Server 執行 Tool\"}],\"：MCP Server 接收到請求後，解析 Tool Call，並執行對應的 Tool 邏輯。例如，它會連接到本地 SQL Server，執行 AI 提供的 SQL 查詢。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"結果返回\"}],\"：SQL Server 返回查詢結果給 MCP Server。MCP Server 將結果格式化，並透過 MCP Client 返回給 AI 代理。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"AI 回應生成\"}],\"：AI 代理接收到查詢結果後，將其整合到其上下文中，生成一個自然語言的回應給使用者。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"3. Prerequisites\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"要實作一個整合 SQL Server 的 MCP Server，您需要具備以下環境和知識：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Node.js 環境\"}],\"：建議使用 LTS 版本，因為 MCP Server 通常會使用 TypeScript/JavaScript 進行開發。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"TypeScript 知識\"}],\"：MCP SDK 通常以 TypeScript 提供，熟悉 TypeScript 將有助於開發和理解程式碼。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SQL Server 實例\"}],\"：一個可訪問的本地 SQL Server 實例，包含您希望 AI 存取的資料庫和資料表。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SQL Server 連接資訊\"}],\"：包括伺服器位址、資料庫名稱、使用者名稱和密碼。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"MCP SDK\"}],\"：安裝官方提供的 \",[\"$\",\"code\",null,{\"children\":\"@modelcontextprotocol/sdk\"}],\" 套件。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"基礎網路知識\"}],\"：理解本地網路通訊和埠號。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"AI 工具\"}],\"：一個支援 MCP 的 AI Host 應用程式，例如 Claude Desktop 或 VS Code 的 AI 擴充功能，用於測試您的 MCP Server。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"4. Implementation / Code Example\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"本節將提供一個使用 TypeScript 和 Node.js 實作 MCP Server 的範例，該 Server 將暴露三個 Tools，允許 AI 代理與本地 SQL Server 進行互動：\",[\"$\",\"code\",null,{\"children\":\"list_tables\"}],\" (列出所有資料表)、\",[\"$\",\"code\",null,{\"children\":\"describe_table\"}],\" (描述特定資料表的 Schema) 和 \",[\"$\",\"code\",null,{\"children\":\"query_database\"}],\" (執行 SQL 查詢)。\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"4.1 專案初始化\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"首先，創建一個新的 Node.js 專案並安裝必要的套件：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"mkdir mcp-sql-server-agent\\ncd mcp-sql-server-agent\\nnpm init -y\\nnpm install typescript @types/node @modelcontextprotocol/sdk mssql @types/mssql dotenv\\nnpx tsc --init\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"在 \",[\"$\",\"code\",null,{\"children\":\"tsconfig.json\"}],\" 中，確保 \",[\"$\",\"code\",null,{\"children\":\"target\"}],\" 設置為 \",[\"$\",\"code\",null,{\"children\":\"es2020\"}],\" 或更高，\",[\"$\",\"code\",null,{\"children\":\"module\"}],\" 設置為 \",[\"$\",\"code\",null,{\"children\":\"commonjs\"}],\" 或 \",[\"$\",\"code\",null,{\"children\":\"esnext\"}],\"。\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"4.2 配置 SQL Server 連接\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"創建 \",[\"$\",\"code\",null,{\"children\":\".env\"}],\" 檔案來儲存敏感的資料庫連接資訊：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-dotenv\",\"children\":\"SQL_SERVER_HOST=localhost\\nSQL_SERVER_PORT=1433\\nSQL_SERVER_DATABASE=YourDatabaseName\\nSQL_SERVER_USER=YourUsername\\nSQL_SERVER_PASSWORD=YourPassword\\n\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":[\"4.3 實作 MCP Server (\",[\"$\",\"code\",null,{\"children\":\"src/server.ts\"}],\")\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript\",\"children\":\"$17\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"4.4 編譯與運行\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"npx tsc\\nnode dist/server.js\\n\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"4.5 與 AI Host 整合 (以 Claude Desktop 為例)\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"配置 \",[\"$\",\"code\",null,{\"children\":\"claude_desktop_config.json\"}]]}],\"：\\n在您的使用者目錄下（例如 \",[\"$\",\"code\",null,{\"children\":\"~/.claude_desktop/claude_desktop_config.json\"}],\"），添加以下配置，指向您的 MCP Server：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-json\",\"children\":\"{\\n  \\\"mcp_servers\\\": [\\n    {\\n      \\\"name\\\": \\\"Local SQL Server Agent\\\",\\n      \\\"url\\\": \\\"http://localhost:3000\\\", // 您的 MCP Server 運行地址和埠號\\n      \\\"description\\\": \\\"提供對本地 SQL Server 資料庫的查詢和結構檢視能力。\\\"\\n    }\\n  ]\\n}\\n\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"重啟 Claude Desktop\"}],\"：確保配置生效。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"與 AI 互動\"}],\"：現在，您可以在 Claude Desktop 中向 AI 提問，例如：「我的本地資料庫裡有哪些資料表？」或「請查詢 \",[\"$\",\"code\",null,{\"children\":\"Products\"}],\" 表中價格大於 100 的所有產品。」AI 將會自動呼叫您的 MCP Server 提供的 Tools 來獲取答案。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"5. Parameters / API Reference\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"MCP Server 的 API 參考主要體現在其暴露的 Tools 定義上。這些 Tools 的 \",[\"$\",\"code\",null,{\"children\":\"name\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"description\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"parameters\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"returns\"}],\" 結構，共同構成了 AI 代理理解和使用這些功能的介面。\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"5.1 MCP SDK 核心介面\"}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"介面/類別\"}],[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"描述\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"Server\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"MCP Server 的主類別，用於註冊 Tools 和啟動 Server。\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"Tool\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"定義一個 AI 可呼叫的工具，包含名稱、描述、輸入參數和預期返回值。\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"RequestHandler\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"處理 Tool 呼叫的非同步函數，接收 Tool 的參數並返回結果。\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"Resource\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"定義一個 AI 可讀取的靜態資源，包含名稱、描述和內容。\"}]]}]]}]]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"5.2 本地 SQL Server Agent 暴露的 Tools\"}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"Tool 名稱\"}],[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"描述\"}],[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"輸入參數\"}],[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"返回值\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"list_tables\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"列出當前資料庫中所有可用的資料表名稱。\"}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"無\"}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"code\",null,{\"children\":\"Array\u003cstring\u003e\"}],\" (資料表名稱陣列)\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"describe_table\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"獲取指定資料表的欄位名稱、資料類型和是否允許為空。\"}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"code\",null,{\"children\":\"tableName: string\"}],\" (要描述的資料表名稱)\"]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"Array\u003c{ columnName: string, dataType: string, isNullable: boolean }\u003e\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"query_database\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"執行一個 SQL SELECT 查詢並返回結果。僅支援 SELECT 語句。\"}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"code\",null,{\"children\":\"query: string\"}],\" (要執行的 SQL SELECT 查詢語句)\"]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"code\",null,{\"children\":\"Array\u003cObject\u003e\"}],\" (查詢結果的 JSON 物件陣列)\"]}]]}]]}]]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"6. Notes \u0026 Best Practices\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"安全性至上\"}],\"：\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"最小權限原則\"}],\"：為 MCP Server 連接 SQL Server 的帳戶配置最小必要的權限，例如只讀取特定資料庫或資料表，避免使用 \",[\"$\",\"code\",null,{\"children\":\"sa\"}],\" 帳戶。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SQL 注入防護\"}],\"：在 \",[\"$\",\"code\",null,{\"children\":\"query_database\"}],\" Tool 中，直接執行 AI 生成的 SQL 查詢存在 SQL 注入風險。在生產環境中，應嚴格限制 AI 只能生成預定義的查詢模板，或使用參數化查詢來處理使用者輸入，絕不能直接拼接字串 [7]。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"資料量限制\"}],\"：在 \",[\"$\",\"code\",null,{\"children\":\"query_database\"}],\" Tool 的實作中，應限制查詢結果的行數（例如使用 \",[\"$\",\"code\",null,{\"children\":\"TOP 100\"}],\"），以防止 AI 請求過大的數據量導致上下文溢出或性能問題。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"網路隔離\"}],\"：考慮將 MCP Server 部署在受保護的內部網路中，僅允許受信任的 AI Host 應用程式訪問。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"錯誤處理與日誌\"}],\"：\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"在每個 Tool 的 \",[\"$\",\"code\",null,{\"children\":\"RequestHandler\"}],\" 中，應包含完善的錯誤處理機制，捕獲資料庫連接失敗、查詢語法錯誤等異常，並返回清晰的錯誤訊息給 AI 代理。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"實作詳細的日誌記錄，記錄 AI 代理的 Tool Call 請求、執行結果和任何錯誤，以便於調試和審計。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Prompts 優化\"}],\"：\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"為 AI 代理提供清晰、詳細的 Prompts，明確說明每個 Tool 的功能、輸入輸出和使用限制。例如，強調 \",[\"$\",\"code\",null,{\"children\":\"query_database\"}],\" 僅支援 \",[\"$\",\"code\",null,{\"children\":\"SELECT\"}],\" 語句。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"引導 AI 代理在執行查詢前，先使用 \",[\"$\",\"code\",null,{\"children\":\"list_tables\"}],\" 和 \",[\"$\",\"code\",null,{\"children\":\"describe_table\"}],\" 來理解資料庫結構，以減少錯誤的 Tool Call。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"性能考量\"}],\"：\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"使用資料庫連接池來管理 SQL Server 連接，避免頻繁建立和關閉連接，提升性能。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"對於複雜或耗時的查詢，考慮在 Tool 內部進行優化，或提供非同步的 Tool 執行機制。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"版本控制與可維護性\"}],\"：\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"將 MCP Server 的程式碼納入版本控制系統，並遵循良好的程式碼編寫規範。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"隨著資料庫結構或 AI 代理需求的變化，定期更新和維護 MCP Server 的 Tools 定義和實作。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"7. 為什麼選擇這種方式？\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在 AI 代理與本地資料互動的場景中，選擇實作 Model Context Protocol (MCP) 標準的 AI 代理伺服器，具有以下不可替代的優勢：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"標準化與互通性\"}],\"：MCP 作為一個開放標準，確保了您的 MCP Server 可以與任何支援 MCP 的 AI Host 應用程式（如 Claude Desktop、Cursor、VS Code 等）無縫協作 [1]。這避免了為每個 AI 工具開發獨立整合的重複工作，極大地提升了互通性和開發效率。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"資料隱私與安全性\"}],\"：透過 MCP，您的敏感本地資料無需上傳到雲端或第三方服務。AI 代理僅透過本地運行的 MCP Server 進行互動，資料始終保留在您的控制之下。MCP Server 可以實作精細的權限控制和資料過濾，確保 AI 代理只能存取其被授權的資料和執行被允許的操作，有效防範資料洩露風險 [8]。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"增強 AI 上下文與準確性\"}],\"：AI 代理可以透過 MCP Server 即時獲取最新的本地資料，這為其提供了遠超訓練資料的豐富上下文。這種「即時 RAG」能力使得 AI 能夠生成更精確、更相關的回應，特別是在處理不斷變化的業務數據或個人筆記時 [9]。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"消除手動操作，提升效率\"}],\"：MCP 讓 AI 代理能夠自動執行查詢、分析和操作本地數據，從而消除了開發者手動複製貼上、切換應用程式的繁瑣步驟。這將顯著提升開發、數據分析和日常工作的效率。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Agentic AI 的基石\"}],\"：MCP 是構建真正 Agentic AI 的關鍵基礎設施之一。它賦予 AI 代理「行動」的能力，使其不僅能理解和生成文本，還能與真實世界的工具和數據進行有意義的互動，開啟了 AI 應用程式的全新可能性。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"參考資料\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[1] Anthropic. (2024, November 25). \",[\"$\",\"em\",null,{\"children\":\"Introducing the Model Context Protocol\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://www.anthropic.com/news/model-context-protocol\",\"children\":\"https://www.anthropic.com/news/model-context-protocol\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[2] Model Context Protocol. (n.d.). \",[\"$\",\"em\",null,{\"children\":\"Architecture - Model Context Protocol (MCP)\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://modelcontextprotocol.info/specification/draft/architecture/\",\"children\":\"https://modelcontextprotocol.info/specification/draft/architecture/\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[3] Model Context Protocol. (n.d.). \",[\"$\",\"em\",null,{\"children\":\"Specification - Model Context Protocol\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://modelcontextprotocol.io/specification/2025-11-25\",\"children\":\"https://modelcontextprotocol.io/specification/2025-11-25\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[4] Model Context Protocol. (n.d.). \",[\"$\",\"em\",null,{\"children\":\"Architecture overview - Model Context Protocol\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://modelcontextprotocol.io/docs/learn/architecture\",\"children\":\"https://modelcontextprotocol.io/docs/learn/architecture\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[5] Codilime. (2026, February 1). \",[\"$\",\"em\",null,{\"children\":\"Model Context Protocol (MCP) explained: A practical technical guide\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://codilime.com/blog/model-context-protocol-explained/\",\"children\":\"https://codilime.com/blog/model-context-protocol-explained/\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[6] Medium. (2026, January 10). \",[\"$\",\"em\",null,{\"children\":\"Build Your First MCP Server with Plain and TypeScript\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://medium.com/@thecraftman/build-your-first-mcp-server-with-plain-and-typescript-6dd13494b95e\",\"children\":\"https://medium.com/@thecraftman/build-your-first-mcp-server-with-plain-and-typescript-6dd13494b95e\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[7] Microsoft Learn. (2026, January 27). \",[\"$\",\"em\",null,{\"children\":\"Quickstart: Use SQL MCP Server with Visual Studio Code locally\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://learn.microsoft.com/en-us/azure/data-api-builder/mcp/quickstart-visual-studio-code\",\"children\":\"https://learn.microsoft.com/en-us/azure/data-api-builder/mcp/quickstart-visual-studio-code\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[8] Elastic. (n.d.). \",[\"$\",\"em\",null,{\"children\":\"What is the Model Context Protocol (MCP)?\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://www.elastic.co/what-is/mcp\",\"children\":\"https://www.elastic.co/what-is/mcp\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"[9] Medium. (2025, July 27). \",[\"$\",\"em\",null,{\"children\":\"Building an MCP Server for Databases: A Simple Guide for Beginners\"}],\". Retrieved from \",[\"$\",\"a\",null,{\"href\":\"https://medium.com/@ambhargava.cts/building-an-mcp-server-for-databases-a-simple-guide-for-beginners-859ba77bc4c9\",\"children\":\"https://medium.com/@ambhargava.cts/building-an-mcp-server-for-databases-a-simple-guide-for-beginners-859ba77bc4c9\"}]]}],\"\\n\"]}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理 | 子yee 萬事屋 | 子yee\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"深入教學如何建構符合 Model Context Protocol (MCP) 標準的 AI 代理伺服器，實現 AI 安全存取本地 SQL Server 資料庫，提升開發效率與資料隱私。\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"子yee\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"子yee 萬事屋, 台股查詢, 自選股, 技術小工具, 股票資訊平台, 技術顧問, 自動化工具\"}],[\"$\",\"meta\",\"4\",{\"name\":\"google-site-verification\",\"content\":\"adHIcDQiasHY4YzPlrpmSSPKl7Oj1WxrPJ_4GV4PQcM\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"深入教學如何建構符合 Model Context Protocol (MCP) 標準的 AI 代理伺服器，實現 AI 安全存取本地 SQL Server 資料庫，提升開發效率與資料隱私。\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image\",\"content\":\"https://qwer820921.github.io/images/img15.jpg\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:image:alt\",\"content\":\"【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"【Agentic AI】實作 Model Context Protocol (MCP) 標準的 AI 代理\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"深入教學如何建構符合 Model Context Protocol (MCP) 標準的 AI 代理伺服器，實現 AI 安全存取本地 SQL Server 資料庫，提升開發效率與資料隱私。\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:image\",\"content\":\"https://qwer820921.github.io/images/img15.jpg\"}],[\"$\",\"link\",\"16\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:{\"metadata\":\"$14:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>