1:"$Sreact.fragment"
2:I[69243,["6283","static/chunks/6283-1586b7e20e5a28d4.js","7177","static/chunks/app/layout-984d35e9d146542e.js"],""]
3:I[6476,["6283","static/chunks/6283-1586b7e20e5a28d4.js","7177","static/chunks/app/layout-984d35e9d146542e.js"],"default"]
4:I[87555,[],""]
5:I[31295,[],""]
6:I[39543,["6283","static/chunks/6283-1586b7e20e5a28d4.js","7177","static/chunks/app/layout-984d35e9d146542e.js"],"default"]
8:I[59665,[],"MetadataBoundary"]
a:I[59665,[],"OutletBoundary"]
d:I[74911,[],"AsyncMetadataOutlet"]
f:I[59665,[],"ViewportBoundary"]
11:I[26614,[],""]
:HL["https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css","style"]
:HL["https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css","style"]
:HL["https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css","style"]
:HL["https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css","style"]
0:{"P":null,"b":"a6fkMmdzKiQkN24CpWhxx","p":"https://qwer820921.github.io","c":["","blog","rxjs-common-state-management"],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","rxjs-common-state-management","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","2",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"zh-Hant","children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico"}],["$","link",null,{"rel":"apple-touch-icon","href":"/logo192.png"}],["$","link",null,{"rel":"manifest","href":"/manifest.json"}],["$","link",null,{"rel":"preload","href":"/logo192.png","as":"image"}],["$","$L2",null,{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-CCKVESHCQ1"}],["$","$L2",null,{"id":"google-analytics","children":"\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-CCKVESHCQ1');\n          "}],["$","$L2",null,{"async":true,"src":"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2709303513603814","crossOrigin":"anonymous"}]]}],["$","body",null,{"children":[["$","$L3",null,{"children":["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}],["$","$L6",null,{}]]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","rxjs-common-state-management","d"],["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L7",["$","$L8",null,{"children":"$L9"}],[["$","link","0",{"rel":"stylesheet","href":"https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$La",null,{"children":["$Lb","$Lc",["$","$Ld",null,{"promise":"$@e"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","JEtJ2behGQvqPPnx2ZFHQ",{"children":[["$","$Lf",null,{"children":"$L10"}],null]}],null]}],false]],"m":"$undefined","G":["$11","$undefined"],"s":false,"S":true}
12:"$Sreact.suspense"
13:I[74911,[],"AsyncMetadata"]
9:["$","$12",null,{"fallback":null,"children":["$","$L13",null,{"promise":"$@14"}]}]
15:I[57113,["5953","static/chunks/app/blog/%5Bslug%5D/page-55dd06bf73e32a25.js"],"default"]
c:null
7:["$","article",null,{"className":"container py-5","children":[["$","div",null,{"className":"row justify-content-center","children":["$","div",null,{"className":"col-12 col-lg-8","children":["$","div",null,{"className":"card shadow-sm border-0","children":["$","div",null,{"className":"card-body p-4 p-md-5","children":[["$","header",null,{"className":"mb-5 pb-4 border-bottom","children":[["$","$L15",null,{"mode":"static","id":"static-back-btn"}],["$","h1",null,{"className":"fw-bold mb-3 display-6","children":"【前端組件化】封裝通用的 RxJS 狀態管理組件"}],["$","div",null,{"className":"text-muted d-flex align-items-center gap-3","children":[["$","div",null,{"className":"d-flex align-items-center gap-2","children":[["$","i",null,{"className":"bi bi-person-fill"}],["$","span",null,{"children":"作者:"}],"子yee"]}],["$","div",null,{"className":"d-flex align-items-center gap-2","children":[["$","i",null,{"className":"bi bi-calendar3"}],["$","span",null,{"children":"日期:"}],"2026-02-03"]}]]}]]}],["$","div",null,{"className":"blogContent_blogContent__VY_R4","children":"$L16"}]]}]}]}]}],["$","$L15",null,{"mode":"floating","targetId":"static-back-btn"}]]}]
17:T55c,import { Component, OnDestroy } from "@angular/core";
import { BehaviorSubject, Observable, Subscription, of } from "rxjs";
import { catchError, finalize, tap } from "rxjs/operators";

@Component({ template: "" })
export abstract class BaseStateComponent<T> implements OnDestroy {
  // 內部狀態管理
  private readonly _state = new BehaviorSubject<AsyncState<T>>({
    data: null,
    loading: false,
    error: null,
  });

  // 公開給 Template 訂閱的 Observable
  readonly state$: Observable<AsyncState<T>> = this._state.asObservable();

  protected subscriptions = new Subscription();

  /**
   * 執行非同步操作並自動管理狀態
   */
  protected executeAsyncOperation(operation$: Observable<T>): void {
    this._state.next({ ...this._state.value, loading: true, error: null });

    const sub = operation$
      .pipe(
        tap((data) => this._state.next({ data, loading: false, error: null })),
        catchError((error) => {
          this._state.next({ ...this._state.value, loading: false, error });
          return of(null);
        }),
        finalize(() => {
          if (this._state.value.loading) {
            this._state.next({ ...this._state.value, loading: false });
          }
        })
      )
      .subscribe();

    this.subscriptions.add(sub);
  }

  ngOnDestroy(): void {
    this.subscriptions.unsubscribe();
  }
}
16:[["$","p",null,{"children":["在現代前端開發中，處理非同步資料請求（Async Operations）是組件開發最核心的任務之一。本文件將展示如何利用 ",["$","strong",null,{"children":"RxJS"}]," 的響應式程式設計特性，結合 Angular 的組件繼承機制，封裝出一個通用的狀態管理基礎組件（Base Component）。"]}],"\n",["$","h3",null,{"children":"Overview"}],"\n",["$","p",null,{"children":["開發者經常需要在多個組件中重複編寫處理 ",["$","code",null,{"children":"loading"}],"、",["$","code",null,{"children":"error"}]," 與 ",["$","code",null,{"children":"data"}]," 的邏輯。這不僅導致程式碼冗餘，也使得 UI 狀態的維護變得破碎且難以追蹤。"]}],"\n",["$","p",null,{"children":["透過封裝通用的 ",["$","code",null,{"children":"BaseStateComponent"}],"，我們旨在解決以下問題："]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"減少樣板程式碼 (Boilerplate)"}],"：不再需要在每個組件手動宣告狀態變數。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"統一狀態流"}],"：確保所有非同步操作都遵循相同的狀態轉換生命週期。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"自動化資源清理"}],"：利用基底類別統一處理訂閱取消，避免記憶體洩漏。"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"Architecture / Design"}],"\n",["$","p",null,{"children":["此設計採用 ",["$","strong",null,{"children":"Reactive State Management"}]," 模式，將組件視為一個狀態機。"]}],"\n",["$","h4",null,{"children":"1. 邏輯說明與資料流"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"State 封裝"}],"：定義 ",["$","code",null,{"children":"AsyncState<T>"}]," 介面，統一封裝資料、載入中與錯誤資訊。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"狀態傳播"}],"：使用 ",["$","code",null,{"children":"BehaviorSubject"}]," 作為狀態源，並透過 ",["$","code",null,{"children":"Observable"}]," 暴露給 UI 層。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"單向資料流"}],"：組件觸發 Action -> Base 處理 Logic -> 更新 State -> UI 透過 ",["$","code",null,{"children":"AsyncPipe"}]," 自動響應。"]}],"\n"]}],"\n",["$","h4",null,{"children":"2. 狀態模型定義"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-typescript","children":"export interface AsyncState<T> {\n  data: T | null;\n  loading: boolean;\n  error: any | null;\n}\n"}]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"Prerequisites"}],"\n",["$","p",null,{"children":"在使用此模式前，請確保您的環境具備以下依賴："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Angular"}],": v16.0.0+ (支援 Standalone Component)"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"RxJS"}],": v7.4.0+"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"TypeScript"}],": v4.9+"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"Implementation / Code Example"}],"\n",["$","p",null,{"children":["以下是通用 ",["$","code",null,{"children":"BaseStateComponent"}]," 的核心實作與應用範例。"]}],"\n",["$","h4",null,{"children":"1. Base State Component (核心封裝)"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-typescript","children":"$17"}]}],"\n",["$","h4",null,{"children":"2. Sub Component Application (子組件應用)"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-typescript","children":"@Component({\n  selector: \"app-user-list\",\n  standalone: true,\n  template: `\n    <div *ngIf=\"state$ | async as state\">\n      <p *ngIf=\"state.loading\">載入中...</p>\n      <ul *ngIf=\"state.data\">\n        <li *ngFor=\"let user of state.data\">{{ user.name }}</li>\n      </ul>\n      <p *ngIf=\"state.error\" class=\"error\">{{ state.error.message }}</p>\n    </div>\n  `,\n})\nexport class UserListComponent\n  extends BaseStateComponent<User[]>\n  implements OnInit\n{\n  constructor(private userService: UserService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.executeAsyncOperation(this.userService.getUsers());\n  }\n}\n"}]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"Parameters / API Reference"}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"style":{"textAlign":"left"},"children":"參數 / 屬性"}],["$","th",null,{"style":{"textAlign":"left"},"children":"類型"}],["$","th",null,{"style":{"textAlign":"left"},"children":"描述"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"state$"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"Observable<AsyncState<T>>"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":[["$","strong",null,{"children":"Output"}],": 提供給 UI 訂閱的唯讀狀態流。"]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"executeAsyncOperation"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"(op: Observable<T>) => void"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":[["$","strong",null,{"children":"Method"}],": 接收一個非同步 Observable 並開始追蹤其狀態。"]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"data"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"T | null"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":[["$","strong",null,{"children":"State Field"}],": 成功取得的資料內容。"]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"loading"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"boolean"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":[["$","strong",null,{"children":"State Field"}],": 目前是否處於請求進行中狀態。"]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"error"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":["$","code",null,{"children":"any | null"}]}],["$","td",null,{"style":{"textAlign":"left"},"children":[["$","strong",null,{"children":"State Field"}],": 請求失敗時回傳的錯誤物件。"]}]]}]]}]]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"Notes & Best Practices"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"效能建議"}],"：建議在子組件開啟 ",["$","code",null,{"children":"ChangeDetectionStrategy.OnPush"}],"。由於狀態是透過 ",["$","code",null,{"children":"Observable"}]," 驅動的，這能極大化 Angular 的變更檢測效能。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Rendering 優化"}],"：在 Template 中始終優先使用 ",["$","code",null,{"children":"AsyncPipe"}],"。它能自動處理訂閱與取消訂閱，避免手動 ",["$","code",null,{"children":"subscribe"}]," 造成的記憶體洩漏。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"錯誤粒度"}],"：",["$","code",null,{"children":"catchError"}]," 中可以根據 HTTP Status Code 進行初步過濾，再將精確的錯誤訊息傳遞給 ",["$","code",null,{"children":"error"}]," 狀態。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Component 繼承限制"}],"：如果組件需要同時管理多個互不相關的資料流，建議改用 ",["$","strong",null,{"children":"Composition (組合)"}]," 模式而非繼承。"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"為什麼選擇這種方式？"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"整合方便"}],"：封裝後，子組件只需關注業務邏輯，無需處理重複的 ",["$","code",null,{"children":"try-catch"}],"。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"靈活度高"}],"：完全掌控 RxJS Operator 的串接，易於擴展如 ",["$","code",null,{"children":"retry"}]," 或 ",["$","code",null,{"children":"debounce"}]," 等功能。"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"效能不錯"}],"：基於 RxJS 的推播機制，能與 Angular 的響應式系統完美結合。"]}],"\n"]}]]
10:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:null
14:{"metadata":[["$","title","0",{"children":"【前端組件化】封裝通用的 RxJS 狀態管理組件 | 子yee 萬事屋 | 子yee"}],["$","meta","1",{"name":"description","content":"針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。"}],["$","meta","2",{"name":"author","content":"子yee"}],["$","meta","3",{"name":"keywords","content":"子yee 萬事屋, 台股查詢, 自選股, 技術小工具, 股票資訊平台, 技術顧問, 自動化工具"}],["$","meta","4",{"name":"google-site-verification","content":"adHIcDQiasHY4YzPlrpmSSPKl7Oj1WxrPJ_4GV4PQcM"}],["$","meta","5",{"property":"og:title","content":"【前端組件化】封裝通用的 RxJS 狀態管理組件"}],["$","meta","6",{"property":"og:description","content":"針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。"}],["$","meta","7",{"property":"og:image","content":"https://qwer820921.github.io/images/img15.jpg"}],["$","meta","8",{"property":"og:image:width","content":"1200"}],["$","meta","9",{"property":"og:image:height","content":"630"}],["$","meta","10",{"property":"og:image:alt","content":"【前端組件化】封裝通用的 RxJS 狀態管理組件"}],["$","meta","11",{"property":"og:type","content":"article"}],["$","meta","12",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","13",{"name":"twitter:title","content":"【前端組件化】封裝通用的 RxJS 狀態管理組件"}],["$","meta","14",{"name":"twitter:description","content":"針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。"}],["$","meta","15",{"name":"twitter:image","content":"https://qwer820921.github.io/images/img15.jpg"}],["$","link","16",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]],"error":null,"digest":"$undefined"}
e:{"metadata":"$14:metadata","error":null,"digest":"$undefined"}
