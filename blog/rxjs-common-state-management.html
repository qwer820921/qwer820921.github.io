<!DOCTYPE html><html lang="zh-Hant"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css" data-precedence="next"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css" data-precedence="next"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css" data-precedence="next"/><link rel="stylesheet" href="https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://qwer820921.github.io/_next/static/chunks/webpack-8087487232f45dc8.js"/><script src="https://qwer820921.github.io/_next/static/chunks/4bd1b696-e100a0b1879d5e6b.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/1684-9b53760636e10952.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/main-app-c0d2570cf703bee2.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/6283-1586b7e20e5a28d4.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/app/layout-984d35e9d146542e.js" async=""></script><script src="https://qwer820921.github.io/_next/static/chunks/app/blog/%5Bslug%5D/page-55dd06bf73e32a25.js" async=""></script><link rel="preload" href="https://qwer820921.github.io/_next/static/chunks/2990.dad4388d14b132db.js" as="script" fetchPriority="low"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-CCKVESHCQ1" as="script"/><link rel="preload" href="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2709303513603814" as="script" crossorigin=""/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/logo192.png"/><link rel="manifest" href="/manifest.json"/><link rel="preload" href="/logo192.png" as="image"/><title>【前端組件化】封裝通用的 RxJS 狀態管理組件 | 子yee 萬事屋 | 子yee</title><meta name="description" content="針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。"/><meta name="author" content="子yee"/><meta name="keywords" content="子yee 萬事屋, 台股查詢, 自選股, 技術小工具, 股票資訊平台, 技術顧問, 自動化工具"/><meta name="google-site-verification" content="adHIcDQiasHY4YzPlrpmSSPKl7Oj1WxrPJ_4GV4PQcM"/><meta property="og:title" content="【前端組件化】封裝通用的 RxJS 狀態管理組件"/><meta property="og:description" content="針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。"/><meta property="og:image" content="https://qwer820921.github.io/images/img15.jpg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="【前端組件化】封裝通用的 RxJS 狀態管理組件"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="【前端組件化】封裝通用的 RxJS 狀態管理組件"/><meta name="twitter:description" content="針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。"/><meta name="twitter:image" content="https://qwer820921.github.io/images/img15.jpg"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="https://qwer820921.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><main class="container-fluid mt-5 p-0"><article class="container py-5"><div class="row justify-content-center"><div class="col-12 col-lg-8"><div class="card shadow-sm border-0"><div class="card-body p-4 p-md-5"><header class="mb-5 pb-4 border-bottom"><div id="static-back-btn" style="display:inline-flex;margin-bottom:1rem;cursor:pointer;position:relative;z-index:1"><div class="btn d-inline-flex align-items-center gap-2 shadow rounded-pill px-4 py-2 text-decoration-none" role="button" style="pointer-events:auto;background-color:#fff;backdrop-filter:none;border:1px solid rgba(0,0,0,0.08);color:#495057;font-weight:500;transition:all 0.2s ease;cursor:pointer"><span>回到文章列表</span></div></div><h1 class="fw-bold mb-3 display-6">【前端組件化】封裝通用的 RxJS 狀態管理組件</h1><div class="text-muted d-flex align-items-center gap-3"><div class="d-flex align-items-center gap-2"><i class="bi bi-person-fill"></i><span>作者:</span>子yee</div><div class="d-flex align-items-center gap-2"><i class="bi bi-calendar3"></i><span>日期:</span>2026-02-03</div></div></header><div class="blogContent_blogContent__VY_R4"><p>在現代前端開發中，處理非同步資料請求（Async Operations）是組件開發最核心的任務之一。本文件將展示如何利用 <strong>RxJS</strong> 的響應式程式設計特性，結合 Angular 的組件繼承機制，封裝出一個通用的狀態管理基礎組件（Base Component）。</p>
<h3>Overview</h3>
<p>開發者經常需要在多個組件中重複編寫處理 <code>loading</code>、<code>error</code> 與 <code>data</code> 的邏輯。這不僅導致程式碼冗餘，也使得 UI 狀態的維護變得破碎且難以追蹤。</p>
<p>透過封裝通用的 <code>BaseStateComponent</code>，我們旨在解決以下問題：</p>
<ol>
<li><strong>減少樣板程式碼 (Boilerplate)</strong>：不再需要在每個組件手動宣告狀態變數。</li>
<li><strong>統一狀態流</strong>：確保所有非同步操作都遵循相同的狀態轉換生命週期。</li>
<li><strong>自動化資源清理</strong>：利用基底類別統一處理訂閱取消，避免記憶體洩漏。</li>
</ol>
<hr/>
<h3>Architecture / Design</h3>
<p>此設計採用 <strong>Reactive State Management</strong> 模式，將組件視為一個狀態機。</p>
<h4>1. 邏輯說明與資料流</h4>
<ul>
<li><strong>State 封裝</strong>：定義 <code>AsyncState&lt;T&gt;</code> 介面，統一封裝資料、載入中與錯誤資訊。</li>
<li><strong>狀態傳播</strong>：使用 <code>BehaviorSubject</code> 作為狀態源，並透過 <code>Observable</code> 暴露給 UI 層。</li>
<li><strong>單向資料流</strong>：組件觸發 Action -&gt; Base 處理 Logic -&gt; 更新 State -&gt; UI 透過 <code>AsyncPipe</code> 自動響應。</li>
</ul>
<h4>2. 狀態模型定義</h4>
<pre><code class="language-typescript">export interface AsyncState&lt;T&gt; {
  data: T | null;
  loading: boolean;
  error: any | null;
}
</code></pre>
<hr/>
<h3>Prerequisites</h3>
<p>在使用此模式前，請確保您的環境具備以下依賴：</p>
<ul>
<li><strong>Angular</strong>: v16.0.0+ (支援 Standalone Component)</li>
<li><strong>RxJS</strong>: v7.4.0+</li>
<li><strong>TypeScript</strong>: v4.9+</li>
</ul>
<hr/>
<h3>Implementation / Code Example</h3>
<p>以下是通用 <code>BaseStateComponent</code> 的核心實作與應用範例。</p>
<h4>1. Base State Component (核心封裝)</h4>
<pre><code class="language-typescript">import { Component, OnDestroy } from &quot;@angular/core&quot;;
import { BehaviorSubject, Observable, Subscription, of } from &quot;rxjs&quot;;
import { catchError, finalize, tap } from &quot;rxjs/operators&quot;;

@Component({ template: &quot;&quot; })
export abstract class BaseStateComponent&lt;T&gt; implements OnDestroy {
  // 內部狀態管理
  private readonly _state = new BehaviorSubject&lt;AsyncState&lt;T&gt;&gt;({
    data: null,
    loading: false,
    error: null,
  });

  // 公開給 Template 訂閱的 Observable
  readonly state$: Observable&lt;AsyncState&lt;T&gt;&gt; = this._state.asObservable();

  protected subscriptions = new Subscription();

  /**
   * 執行非同步操作並自動管理狀態
   */
  protected executeAsyncOperation(operation$: Observable&lt;T&gt;): void {
    this._state.next({ ...this._state.value, loading: true, error: null });

    const sub = operation$
      .pipe(
        tap((data) =&gt; this._state.next({ data, loading: false, error: null })),
        catchError((error) =&gt; {
          this._state.next({ ...this._state.value, loading: false, error });
          return of(null);
        }),
        finalize(() =&gt; {
          if (this._state.value.loading) {
            this._state.next({ ...this._state.value, loading: false });
          }
        })
      )
      .subscribe();

    this.subscriptions.add(sub);
  }

  ngOnDestroy(): void {
    this.subscriptions.unsubscribe();
  }
}
</code></pre>
<h4>2. Sub Component Application (子組件應用)</h4>
<pre><code class="language-typescript">@Component({
  selector: &quot;app-user-list&quot;,
  standalone: true,
  template: `
    &lt;div *ngIf=&quot;state$ | async as state&quot;&gt;
      &lt;p *ngIf=&quot;state.loading&quot;&gt;載入中...&lt;/p&gt;
      &lt;ul *ngIf=&quot;state.data&quot;&gt;
        &lt;li *ngFor=&quot;let user of state.data&quot;&gt;{{ user.name }}&lt;/li&gt;
      &lt;/ul&gt;
      &lt;p *ngIf=&quot;state.error&quot; class=&quot;error&quot;&gt;{{ state.error.message }}&lt;/p&gt;
    &lt;/div&gt;
  `,
})
export class UserListComponent
  extends BaseStateComponent&lt;User[]&gt;
  implements OnInit
{
  constructor(private userService: UserService) {
    super();
  }

  ngOnInit() {
    this.executeAsyncOperation(this.userService.getUsers());
  }
}
</code></pre>
<hr/>
<h3>Parameters / API Reference</h3>
<table><thead><tr><th style="text-align:left">參數 / 屬性</th><th style="text-align:left">類型</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>state$</code></td><td style="text-align:left"><code>Observable&lt;AsyncState&lt;T&gt;&gt;</code></td><td style="text-align:left"><strong>Output</strong>: 提供給 UI 訂閱的唯讀狀態流。</td></tr><tr><td style="text-align:left"><code>executeAsyncOperation</code></td><td style="text-align:left"><code>(op: Observable&lt;T&gt;) =&gt; void</code></td><td style="text-align:left"><strong>Method</strong>: 接收一個非同步 Observable 並開始追蹤其狀態。</td></tr><tr><td style="text-align:left"><code>data</code></td><td style="text-align:left"><code>T | null</code></td><td style="text-align:left"><strong>State Field</strong>: 成功取得的資料內容。</td></tr><tr><td style="text-align:left"><code>loading</code></td><td style="text-align:left"><code>boolean</code></td><td style="text-align:left"><strong>State Field</strong>: 目前是否處於請求進行中狀態。</td></tr><tr><td style="text-align:left"><code>error</code></td><td style="text-align:left"><code>any | null</code></td><td style="text-align:left"><strong>State Field</strong>: 請求失敗時回傳的錯誤物件。</td></tr></tbody></table>
<hr/>
<h3>Notes &amp; Best Practices</h3>
<ol>
<li><strong>效能建議</strong>：建議在子組件開啟 <code>ChangeDetectionStrategy.OnPush</code>。由於狀態是透過 <code>Observable</code> 驅動的，這能極大化 Angular 的變更檢測效能。</li>
<li><strong>Rendering 優化</strong>：在 Template 中始終優先使用 <code>AsyncPipe</code>。它能自動處理訂閱與取消訂閱，避免手動 <code>subscribe</code> 造成的記憶體洩漏。</li>
<li><strong>錯誤粒度</strong>：<code>catchError</code> 中可以根據 HTTP Status Code 進行初步過濾，再將精確的錯誤訊息傳遞給 <code>error</code> 狀態。</li>
<li><strong>Component 繼承限制</strong>：如果組件需要同時管理多個互不相關的資料流，建議改用 <strong>Composition (組合)</strong> 模式而非繼承。</li>
</ol>
<hr/>
<h3>為什麼選擇這種方式？</h3>
<ol>
<li><strong>整合方便</strong>：封裝後，子組件只需關注業務邏輯，無需處理重複的 <code>try-catch</code>。</li>
<li><strong>靈活度高</strong>：完全掌控 RxJS Operator 的串接，易於擴展如 <code>retry</code> 或 <code>debounce</code> 等功能。</li>
<li><strong>效能不錯</strong>：基於 RxJS 的推播機制，能與 Angular 的響應式系統完美結合。</li>
</ol></div></div></div></div></div></article><!--$--><!--/$--><!--$--><!--/$--></main><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><noscript>You need to enable JavaScript to run this app.</noscript><div class="position-fixed" style="z-index:1050;bottom:20px;right:20px;transform:translate(0px, 0px);touch-action:none;cursor:default;display:flex;flex-direction:column;align-items:flex-end;transition:transform 0.3s ease"><div class="position-relative"><button class="btn rounded-circle d-flex align-items-center justify-content-center shadow-lg" style="width:60px;height:60px;cursor:grab;background:linear-gradient(135deg, #0d6efd, #0a58ca);border:2px solid rgba(255,255,255,0.2);transition:transform 0.2s ease" aria-label="切換聊天視窗"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="white" style="width:28px;height:28px;pointer-events:none"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg></button><span class="position-absolute bg-danger rounded-circle" style="width:12px;height:12px;top:0;right:0;border:2px solid white"></span></div></div><script src="https://qwer820921.github.io/_next/static/chunks/webpack-8087487232f45dc8.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[69243,[\"6283\",\"static/chunks/6283-1586b7e20e5a28d4.js\",\"7177\",\"static/chunks/app/layout-984d35e9d146542e.js\"],\"\"]\n3:I[6476,[\"6283\",\"static/chunks/6283-1586b7e20e5a28d4.js\",\"7177\",\"static/chunks/app/layout-984d35e9d146542e.js\"],\"default\"]\n4:I[87555,[],\"\"]\n5:I[31295,[],\"\"]\n6:I[39543,[\"6283\",\"static/chunks/6283-1586b7e20e5a28d4.js\",\"7177\",\"static/chunks/app/layout-984d35e9d146542e.js\"],\"default\"]\n8:I[59665,[],\"MetadataBoundary\"]\na:I[59665,[],\"OutletBoundary\"]\nd:I[74911,[],\"AsyncMetadataOutlet\"]\nf:I[59665,[],\"ViewportBoundary\"]\n11:I[26614,[],\"\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css\",\"style\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css\",\"style\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css\",\"style\"]\n:HL[\"https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"PeE_C8FEwaZJ0VTt3Q-kI\",\"p\":\"https://qwer820921.github.io\",\"c\":[\"\",\"blog\",\"rxjs-common-state-management\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"rxjs-common-state-management\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/be607b33620c6e00.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/739e5c607d9731d5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/4bb1c53d4d41ca49.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"zh-Hant\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/logo192.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/manifest.json\"}],[\"$\",\"link\",null,{\"rel\":\"preload\",\"href\":\"/logo192.png\",\"as\":\"image\"}],[\"$\",\"$L2\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-CCKVESHCQ1\"}],[\"$\",\"$L2\",null,{\"id\":\"google-analytics\",\"children\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-CCKVESHCQ1');\\n          \"}],[\"$\",\"$L2\",null,{\"async\":true,\"src\":\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2709303513603814\",\"crossOrigin\":\"anonymous\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"$L3\",null,{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"$L6\",null,{}]]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"rxjs-common-state-management\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://qwer820921.github.io/_next/static/css/828ce2d6ffc7bb41.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"5pYVnNpYdwQP06QqTW9UL\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.suspense\"\n13:I[74911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$12\",null,{\"fallback\":null,\"children\":[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]}]\n"])</script><script>self.__next_f.push([1,"15:I[57113,[\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-55dd06bf73e32a25.js\"],\"default\"]\nc:null\n7:[\"$\",\"article\",null,{\"className\":\"container py-5\",\"children\":[[\"$\",\"div\",null,{\"className\":\"row justify-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"col-12 col-lg-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"card shadow-sm border-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"card-body p-4 p-md-5\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-5 pb-4 border-bottom\",\"children\":[[\"$\",\"$L15\",null,{\"mode\":\"static\",\"id\":\"static-back-btn\"}],[\"$\",\"h1\",null,{\"className\":\"fw-bold mb-3 display-6\",\"children\":\"【前端組件化】封裝通用的 RxJS 狀態管理組件\"}],[\"$\",\"div\",null,{\"className\":\"text-muted d-flex align-items-center gap-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"d-flex align-items-center gap-2\",\"children\":[[\"$\",\"i\",null,{\"className\":\"bi bi-person-fill\"}],[\"$\",\"span\",null,{\"children\":\"作者:\"}],\"子yee\"]}],[\"$\",\"div\",null,{\"className\":\"d-flex align-items-center gap-2\",\"children\":[[\"$\",\"i\",null,{\"className\":\"bi bi-calendar3\"}],[\"$\",\"span\",null,{\"children\":\"日期:\"}],\"2026-02-03\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"blogContent_blogContent__VY_R4\",\"children\":\"$L16\"}]]}]}]}]}],[\"$\",\"$L15\",null,{\"mode\":\"floating\",\"targetId\":\"static-back-btn\"}]]}]\n"])</script><script>self.__next_f.push([1,"17:T55c,import { Component, OnDestroy } from \"@angular/core\";\nimport { BehaviorSubject, Observable, Subscription, of } from \"rxjs\";\nimport { catchError, finalize, tap } from \"rxjs/operators\";\n\n@Component({ template: \"\" })\nexport abstract class BaseStateComponent\u003cT\u003e implements OnDestroy {\n  // 內部狀態管理\n  private readonly _state = new BehaviorSubject\u003cAsyncState\u003cT\u003e\u003e({\n    data: null,\n    loading: false,\n    error: null,\n  });\n\n  // 公開給 Template 訂閱的 Observable\n  readonly state$: Observable\u003cAsyncState\u003cT\u003e\u003e = this._state.asObservable();\n\n  protected subscriptions = new Subscription();\n\n  /**\n   * 執行非同步操作並自動管理狀態\n   */\n  protected executeAsyncOperation(operation$: Observable\u003cT\u003e): void {\n    this._state.next({ ...this._state.value, loading: true, error: null });\n\n    const sub = operation$\n      .pipe(\n        tap((data) =\u003e this._state.next({ data, loading: false, error: null })),\n        catchError((error) =\u003e {\n          this._state.next({ ...this._state.value, loading: false, error });\n          return of(null);\n        }),\n        finalize(() =\u003e {\n          if (this._state.value.loading) {\n            this._state.next({ ...this._state.value, loading: false });\n          }\n        })\n      )\n      .subscribe();\n\n    this.subscriptions.add(sub);\n  }\n\n  ngOnDestroy(): void {\n    this.subscriptions.unsubscribe();\n  }\n}\n"])</script><script>self.__next_f.push([1,"16:[[\"$\",\"p\",null,{\"children\":[\"在現代前端開發中，處理非同步資料請求（Async Operations）是組件開發最核心的任務之一。本文件將展示如何利用 \",[\"$\",\"strong\",null,{\"children\":\"RxJS\"}],\" 的響應式程式設計特性，結合 Angular 的組件繼承機制，封裝出一個通用的狀態管理基礎組件（Base Component）。\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Overview\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"開發者經常需要在多個組件中重複編寫處理 \",[\"$\",\"code\",null,{\"children\":\"loading\"}],\"、\",[\"$\",\"code\",null,{\"children\":\"error\"}],\" 與 \",[\"$\",\"code\",null,{\"children\":\"data\"}],\" 的邏輯。這不僅導致程式碼冗餘，也使得 UI 狀態的維護變得破碎且難以追蹤。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"透過封裝通用的 \",[\"$\",\"code\",null,{\"children\":\"BaseStateComponent\"}],\"，我們旨在解決以下問題：\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"減少樣板程式碼 (Boilerplate)\"}],\"：不再需要在每個組件手動宣告狀態變數。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"統一狀態流\"}],\"：確保所有非同步操作都遵循相同的狀態轉換生命週期。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"自動化資源清理\"}],\"：利用基底類別統一處理訂閱取消，避免記憶體洩漏。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Architecture / Design\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"此設計採用 \",[\"$\",\"strong\",null,{\"children\":\"Reactive State Management\"}],\" 模式，將組件視為一個狀態機。\"]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"1. 邏輯說明與資料流\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"State 封裝\"}],\"：定義 \",[\"$\",\"code\",null,{\"children\":\"AsyncState\u003cT\u003e\"}],\" 介面，統一封裝資料、載入中與錯誤資訊。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"狀態傳播\"}],\"：使用 \",[\"$\",\"code\",null,{\"children\":\"BehaviorSubject\"}],\" 作為狀態源，並透過 \",[\"$\",\"code\",null,{\"children\":\"Observable\"}],\" 暴露給 UI 層。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"單向資料流\"}],\"：組件觸發 Action -\u003e Base 處理 Logic -\u003e 更新 State -\u003e UI 透過 \",[\"$\",\"code\",null,{\"children\":\"AsyncPipe\"}],\" 自動響應。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"2. 狀態模型定義\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript\",\"children\":\"export interface AsyncState\u003cT\u003e {\\n  data: T | null;\\n  loading: boolean;\\n  error: any | null;\\n}\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Prerequisites\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"在使用此模式前，請確保您的環境具備以下依賴：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Angular\"}],\": v16.0.0+ (支援 Standalone Component)\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"RxJS\"}],\": v7.4.0+\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"TypeScript\"}],\": v4.9+\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Implementation / Code Example\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"以下是通用 \",[\"$\",\"code\",null,{\"children\":\"BaseStateComponent\"}],\" 的核心實作與應用範例。\"]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"1. Base State Component (核心封裝)\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript\",\"children\":\"$17\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"2. Sub Component Application (子組件應用)\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript\",\"children\":\"@Component({\\n  selector: \\\"app-user-list\\\",\\n  standalone: true,\\n  template: `\\n    \u003cdiv *ngIf=\\\"state$ | async as state\\\"\u003e\\n      \u003cp *ngIf=\\\"state.loading\\\"\u003e載入中...\u003c/p\u003e\\n      \u003cul *ngIf=\\\"state.data\\\"\u003e\\n        \u003cli *ngFor=\\\"let user of state.data\\\"\u003e{{ user.name }}\u003c/li\u003e\\n      \u003c/ul\u003e\\n      \u003cp *ngIf=\\\"state.error\\\" class=\\\"error\\\"\u003e{{ state.error.message }}\u003c/p\u003e\\n    \u003c/div\u003e\\n  `,\\n})\\nexport class UserListComponent\\n  extends BaseStateComponent\u003cUser[]\u003e\\n  implements OnInit\\n{\\n  constructor(private userService: UserService) {\\n    super();\\n  }\\n\\n  ngOnInit() {\\n    this.executeAsyncOperation(this.userService.getUsers());\\n  }\\n}\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Parameters / API Reference\"}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"參數 / 屬性\"}],[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"類型\"}],[\"$\",\"th\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":\"描述\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"state$\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"Observable\u003cAsyncState\u003cT\u003e\u003e\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"strong\",null,{\"children\":\"Output\"}],\": 提供給 UI 訂閱的唯讀狀態流。\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"executeAsyncOperation\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"(op: Observable\u003cT\u003e) =\u003e void\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"strong\",null,{\"children\":\"Method\"}],\": 接收一個非同步 Observable 並開始追蹤其狀態。\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"data\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"T | null\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"strong\",null,{\"children\":\"State Field\"}],\": 成功取得的資料內容。\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"loading\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"boolean\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"strong\",null,{\"children\":\"State Field\"}],\": 目前是否處於請求進行中狀態。\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"error\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[\"$\",\"code\",null,{\"children\":\"any | null\"}]}],[\"$\",\"td\",null,{\"style\":{\"textAlign\":\"left\"},\"children\":[[\"$\",\"strong\",null,{\"children\":\"State Field\"}],\": 請求失敗時回傳的錯誤物件。\"]}]]}]]}]]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Notes \u0026 Best Practices\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"效能建議\"}],\"：建議在子組件開啟 \",[\"$\",\"code\",null,{\"children\":\"ChangeDetectionStrategy.OnPush\"}],\"。由於狀態是透過 \",[\"$\",\"code\",null,{\"children\":\"Observable\"}],\" 驅動的，這能極大化 Angular 的變更檢測效能。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rendering 優化\"}],\"：在 Template 中始終優先使用 \",[\"$\",\"code\",null,{\"children\":\"AsyncPipe\"}],\"。它能自動處理訂閱與取消訂閱，避免手動 \",[\"$\",\"code\",null,{\"children\":\"subscribe\"}],\" 造成的記憶體洩漏。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"錯誤粒度\"}],\"：\",[\"$\",\"code\",null,{\"children\":\"catchError\"}],\" 中可以根據 HTTP Status Code 進行初步過濾，再將精確的錯誤訊息傳遞給 \",[\"$\",\"code\",null,{\"children\":\"error\"}],\" 狀態。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Component 繼承限制\"}],\"：如果組件需要同時管理多個互不相關的資料流，建議改用 \",[\"$\",\"strong\",null,{\"children\":\"Composition (組合)\"}],\" 模式而非繼承。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"為什麼選擇這種方式？\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"整合方便\"}],\"：封裝後，子組件只需關注業務邏輯，無需處理重複的 \",[\"$\",\"code\",null,{\"children\":\"try-catch\"}],\"。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"靈活度高\"}],\"：完全掌控 RxJS Operator 的串接，易於擴展如 \",[\"$\",\"code\",null,{\"children\":\"retry\"}],\" 或 \",[\"$\",\"code\",null,{\"children\":\"debounce\"}],\" 等功能。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"效能不錯\"}],\"：基於 RxJS 的推播機制，能與 Angular 的響應式系統完美結合。\"]}],\"\\n\"]}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"【前端組件化】封裝通用的 RxJS 狀態管理組件 | 子yee 萬事屋 | 子yee\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"子yee\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"子yee 萬事屋, 台股查詢, 自選股, 技術小工具, 股票資訊平台, 技術顧問, 自動化工具\"}],[\"$\",\"meta\",\"4\",{\"name\":\"google-site-verification\",\"content\":\"adHIcDQiasHY4YzPlrpmSSPKl7Oj1WxrPJ_4GV4PQcM\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"【前端組件化】封裝通用的 RxJS 狀態管理組件\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image\",\"content\":\"https://qwer820921.github.io/images/img15.jpg\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:image:alt\",\"content\":\"【前端組件化】封裝通用的 RxJS 狀態管理組件\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"【前端組件化】封裝通用的 RxJS 狀態管理組件\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"針對 Angular 開發者，說明如何將重複的資料請求（如 API Loading/Error/Data）封裝成一個通用的 Base Component，展示 RxJS 非同步處理與程式碼重構的深度實踐。\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:image\",\"content\":\"https://qwer820921.github.io/images/img15.jpg\"}],[\"$\",\"link\",\"16\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:{\"metadata\":\"$14:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>