(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9394],{66997:()=>{},79394:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>_});var t=a(95155),s=a(12115);function i(e){let{player:l,combatPower:a,stageId:s,onAvatarClick:i}=e,{system:r,wallet:o}=l,c=r.currentXp/r.requiredXp*100;return(0,t.jsxs)("header",{className:"ca-header",children:[(0,t.jsxs)("div",{className:"ca-player-profile",children:[(0,t.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:i,children:[(0,t.jsx)("div",{className:"ca-avatar-ring",children:(0,t.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,t.jsx)("div",{className:"ca-level-badge",children:r.level})]}),(0,t.jsxs)("div",{className:"ca-profile-info",children:[(0,t.jsxs)("div",{className:"ca-profile-top",children:[(0,t.jsxs)("span",{className:"ca-level-text",children:["Lv.",r.level]}),(0,t.jsx)("span",{className:"ca-player-name",children:"冒險者"})]}),(0,t.jsxs)("div",{className:"ca-exp-container",children:[(0,t.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,t.jsx)("div",{className:"ca-exp-bar",children:(0,t.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,c),"%")}})}),(0,t.jsxs)("div",{className:"ca-exp-text",children:[r.currentXp.toLocaleString(),"/",r.requiredXp.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"ca-combat-power",children:[(0,t.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,t.jsx)("span",{className:"ca-cp-value",children:a.toLocaleString()})]})]})]}),(0,t.jsx)("div",{className:"ca-header-right",children:(0,t.jsxs)("div",{className:"ca-currency-stack",children:[(0,t.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,t.jsx)("span",{children:"\uD83D\uDCB0"}),(0,t.jsx)("span",{children:Math.floor(o.gold).toLocaleString()})]}),(0,t.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,t.jsx)("span",{children:"⚡"}),(0,t.jsx)("span",{children:Math.floor(o.clickPoints).toLocaleString()})]})]})})]})}function r(e){let{name:l,currentHp:a,maxHp:s,isBoss:i=!1}=e,r=Math.max(1,s),o=Math.min(Math.max(0,a),r);return(0,t.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,t.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,t.jsx)("span",{className:"text-slate-300 me-2",children:l})}),(0,t.jsx)("div",{className:"ca-hp-bar",children:(0,t.jsx)("div",{className:"ca-hp-bar-fill ".concat(i?"boss":"normal"),style:{width:"".concat(o/r*100,"%")}})}),(0,t.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[Math.ceil(o).toLocaleString()," /"," ",Math.ceil(r).toLocaleString()]})]})}function o(e){let{monster:l,stageId:a,onMonsterClick:i,baseDamage:o,criticalChance:c,criticalDamage:n,monstersKilled:d,monstersRequired:p,isBossActive:u,mercenaryLevel:m=0,partnerLevel:h=0,potionCount:x=0,activeBuffs:g,onUsePotion:v}=e,[f,j]=(0,s.useState)([]),[y,M]=(0,s.useState)(!1),[D,b]=(0,s.useState)(!1),S=(0,s.useRef)(null),N=(null==g?void 0:g.ragePotionExpiresAt)&&g.ragePotionExpiresAt>Date.now(),w=(e,l,a,t)=>{let s=crypto.randomUUID();j(i=>[...i,{id:s,text:e,x:l,y:a,type:t,createdAt:Date.now()}]),setTimeout(()=>{j(e=>e.filter(e=>e.id!==s))},1e3)},C=e=>{var a,t,s,r,d;let p,u;if(!l||l.currentHp<=0)return;let m=o;N&&(m*=2);let h=Math.random()<c,x=Math.ceil(m*(h?n:1)),g=null==(a=S.current)?void 0:a.getBoundingClientRect();if(!g)return;"touches"in e?(p=null!=(r=null==(t=e.touches[0])?void 0:t.clientX)?r:g.left+g.width/2,u=null!=(d=null==(s=e.touches[0])?void 0:s.clientY)?d:g.top+g.height/2):(p=e.clientX,u=e.clientY);let v=p-g.left+(60*Math.random()-30),f=u-g.top+(60*Math.random()-30);w(x.toLocaleString(),v,f,h?"CRIT":"CLICK"),M(!0),b(!0),setTimeout(()=>M(!1),300),setTimeout(()=>b(!1),150),i(x,h)},k=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,t.jsxs)("div",{ref:S,className:"ca-battle-area ".concat(y?"ca-shake":""),style:{background:N?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:C,onTouchStart:C,children:[(0,t.jsx)("div",{className:"ca-monster-container",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"ca-stage-display",children:["第 ",a," 關"]}),!u&&(0,t.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.3)",padding:"2px 8px",borderRadius:"12px"},children:[d," / ",p," \uD83D\uDC80"]}),u&&(0,t.jsx)("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"4px",marginBottom:"16px",fontWeight:"bold",background:"rgba(239, 68, 68, 0.1)",padding:"2px 8px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:"⚠️ BOSS 挑戰中 ⚠️"}),(0,t.jsx)("div",{className:"ca-monster-sprite ".concat(l.isBoss?"boss":""," ").concat(D?"ca-hit-flash":""," ca-bounce-slow"),children:l.emoji||(l.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")}),(0,t.jsx)("div",{className:"mt-6 w-56",children:(0,t.jsx)(r,{name:l.name,currentHp:l.currentHp,maxHp:l.maxHp,isBoss:l.isBoss})})]}):(0,t.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),(0,t.jsx)("div",{style:{position:"absolute",bottom:"20px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:m>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{fontSize:"2rem"},children:"⚔️"}),(0,t.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",m]})]})}),(0,t.jsx)("div",{style:{position:"absolute",bottom:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:h>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83E\uDDDA"}),(0,t.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",h]})]})}),x>0&&(0,t.jsxs)("div",{onClick:e=>{e.stopPropagation(),!N&&v&&v()},style:{position:"absolute",top:"60px",right:"20px",display:"flex",flexDirection:"column",alignItems:"center",cursor:N?"default":"pointer",opacity:N?.5:1,zIndex:20},children:[(0,t.jsx)("div",{style:{fontSize:"2rem",filter:N?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:N?"scale(0.9)":"scale(1)"},children:"\uD83E\uDDEA"}),(0,t.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"10px",padding:"2px 6px",marginTop:"-10px"},children:["x",x]})]}),(0,t.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",children:f.map(e=>(0,t.jsx)("div",{className:k(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function c(e){let{onOpenModal:l}=e;return(0,t.jsx)("footer",{className:"ca-footer",children:(0,t.jsxs)("nav",{className:"ca-footer-nav",children:[(0,t.jsxs)("button",{className:"ca-tab-btn",onClick:()=>l(null),children:[(0,t.jsx)("span",{className:"icon",children:"⚔️"}),(0,t.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,t.jsxs)("button",{className:"ca-tab-btn",onClick:()=>l("UPGRADES"),children:[(0,t.jsx)("span",{className:"icon",children:"⚡"}),(0,t.jsx)("span",{className:"label",children:"強化"})]}),(0,t.jsxs)("button",{className:"ca-tab-btn",onClick:()=>l("SHOP"),children:[(0,t.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,t.jsx)("span",{className:"label",children:"商店"})]}),(0,t.jsxs)("button",{className:"ca-tab-btn",onClick:()=>l("PROFILE"),children:[(0,t.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,t.jsx)("span",{className:"label",children:"角色"})]})]})})}function n(e){let{isOpen:l,onClose:a,title:s,headerContent:i,children:r}=e;return l?(0,t.jsx)("div",{className:"ca-modal-overlay",onClick:a,children:(0,t.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"ca-modal-header",children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,t.jsx)("h2",{className:"ca-modal-title",children:s}),i]}),(0,t.jsx)("button",{className:"ca-modal-close",onClick:a,children:"✕"})]}),(0,t.jsx)("div",{className:"ca-modal-content",children:r})]})}):null}a(66997);var d=function(e){return e.ADD_DAMAGE="ADD_DAMAGE",e.ADD_AUTO="ADD_AUTO",e.ADD_CRIT="ADD_CRIT",e.ADD_GOLD="ADD_GOLD",e}({});let p=[{id:"click_power",name:"點擊力量",description:"增加每次點擊的傷害",baseCost:10,costMultiplier:1.15,maxLevel:100,effectType:d.ADD_DAMAGE,icon:"⚔️"},{id:"crit_chance",name:"爆擊機率",description:"提升爆擊發動的機率",baseCost:50,costMultiplier:1.2,maxLevel:50,effectType:d.ADD_CRIT,icon:"\uD83D\uDCA5"},{id:"gold_bonus",name:"金幣加成",description:"增加擊殺怪物獲得的金幣",baseCost:100,costMultiplier:1.25,maxLevel:30,effectType:d.ADD_GOLD,icon:"\uD83D\uDCB0"},{id:"auto_attack",name:"自動攻擊",description:"每秒自動造成傷害",baseCost:500,costMultiplier:1.3,maxLevel:50,effectType:d.ADD_AUTO,icon:"⚡"}];function u(e){let{player:l,upgradeLevels:a,onPurchaseUpgrade:s}=e,i=(e,l,a)=>Math.floor(e*Math.pow(l,a));return(0,t.jsx)("div",{className:"space-y-3",children:p.map(e=>{let r=a[e.id]||0,o=i(e.baseCost,e.costMultiplier,r),c=l.wallet.gold>=o,n=r>=e.maxLevel;return(0,t.jsxs)("div",{className:"ca-upgrade-item",children:[(0,t.jsx)("div",{className:"ca-upgrade-icon",children:e.icon}),(0,t.jsxs)("div",{className:"ca-upgrade-info",children:[(0,t.jsx)("div",{className:"ca-upgrade-name",children:e.name}),(0,t.jsx)("div",{className:"ca-upgrade-desc",children:e.description}),(0,t.jsxs)("div",{className:"ca-upgrade-level",children:["Lv.",r," / ",e.maxLevel]})]}),(0,t.jsx)("button",{className:"ca-btn text-xs px-3 py-2 ".concat(n?"bg-slate-600":c?"ca-btn-gold":"bg-slate-700 opacity-50"),onClick:()=>!n&&c&&s(e.id,o),disabled:n||!c,children:n?(0,t.jsx)("span",{className:"text-slate-400",children:"MAX"}):(0,t.jsxs)("span",{className:"ca-upgrade-cost",children:["\uD83D\uDCB0 ",o.toLocaleString()]})})]},e.id)})})}let m=e=>e<=20?{name:"練氣期",color:"#a7f3d0"}:e<=40?{name:"築基期",color:"#6ee7b7"}:e<=60?{name:"金丹期",color:"#fbbf24"}:e<=80?{name:"元嬰期",color:"#f472b6"}:e<=100?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"};function h(e){let{player:l,onPurchase:a,gameConfig:i}=e,[r,o]=(0,s.useState)("DAILY"),c=m(l.system.level),n=e=>"gold_shop_weapon"===e?l.goldShop.weaponLevel:"gold_shop_mercenary"===e?l.goldShop.mercenaryLevel:"gold_shop_partner"===e?l.goldShop.partnerLevel:"gold_potion_rage"===e?l.inventory.ragePotionCount:"level_shop_wisdom"===e?l.levelShop.wisdomLevel:"level_shop_greed"===e?l.levelShop.greedLevel:"level_shop_auto"===e?l.levelShop.autoClickLevel:"level_shop_slayer"===e?l.levelShop.bossSlayerLevel:"level_shop_luck"===e?l.levelShop.luckLevel:"click_shop_damage"===e?l.clickShop.clickPowerLevel:"click_shop_crit"===e?l.clickShop.critDamageLevel:"click_shop_gold"===e?l.clickShop.goldBonusLevel:0,d=(e,l,a,t)=>"ADD_INVENTORY"===t?e:1===l||1===l?Math.floor(e+a):Math.floor(e*Math.pow(l,a)),p=e=>"GOLD"===e?"\uD83D\uDCB0":"LP"===e?"\uD83C\uDD99":"CP"===e?"⚡":"DIAMOND"===e?"\uD83D\uDC8E":e,u=e=>"GOLD"===e?l.wallet.gold:"LP"===e?l.wallet.levelPoints:"CP"===e?l.wallet.clickPoints:"DIAMOND"===e?l.wallet.diamonds:0,h=e=>{if(!i||!i.upgrades)return null;let l=i.upgrades.filter(l=>l.Shop_Type===e);return 0===l.length?null:(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:l.map(e=>{let l=n(e.ID),s=d(e.Cost_Base,e.Cost_Mult,l,e.Effect_Type),i=p(e.Currency),r=u(e.Currency),o=e.Desc_Template||e.Name;return o.includes("{val}")&&(o=o.replace("{val}",String(e.Effect_Val))),(0,t.jsx)(g,{name:e.Name,desc:"".concat(o," [Lv.").concat(l,"]"),level:l,cost:s,currencyLabel:i,canAfford:r>=s,onClick:()=>a(e.ID)},e.ID)})})},v=(()=>{if(!l.lastDailyRewardClaimTime)return!0;let e=new Date(l.lastDailyRewardClaimTime),a=new Date;return e.getDate()!==a.getDate()||e.getMonth()!==a.getMonth()||e.getFullYear()!==a.getFullYear()})();return(0,t.jsxs)("div",{className:"ca-shop-container",children:[(0,t.jsxs)("div",{className:"ca-shop-tabs",children:[(0,t.jsxs)("button",{onClick:()=>o("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===r?"active":""),children:[(0,t.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,t.jsx)("div",{className:"label",children:"每日商店"}),v&&(0,t.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,t.jsxs)("button",{onClick:()=>o("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===r?"active":""),children:[(0,t.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,t.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,t.jsxs)("button",{onClick:()=>o("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===r?"active":""),children:[(0,t.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,t.jsx)("div",{className:"label",children:"等級商店"})]}),(0,t.jsxs)("button",{onClick:()=>o("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===r?"active":""),children:[(0,t.jsx)("div",{className:"icon",children:"⚡"}),(0,t.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,t.jsxs)("button",{onClick:()=>o("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===r?"active":""),children:[(0,t.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,t.jsx)("div",{className:"label",children:"飛昇商店"})]})]}),(0,t.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===r&&(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,t.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,t.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,t.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,t.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,t.jsx)("div",{style:{fontSize:"3rem",filter:v?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,t.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#fde047"},children:"10 \uD83D\uDC8E + 500 \uD83D\uDCB0"})]}),(0,t.jsx)("button",{className:"ca-btn ".concat(v?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:v?1:.5,cursor:v?"pointer":"not-allowed",background:v?"":"#334155",color:v?"":"#64748b"},disabled:!v,onClick:()=>a("daily_checkin"),children:v?"領取獎勵":"明日再來"})]})}),"GOLD"===r&&(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,t.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,t.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,t.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:Math.floor(l.wallet.gold).toLocaleString()}),(0,t.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(null==i?void 0:i.upgrades)?h("GOLD"):(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,t.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config... (Fallback Mode)"})}),!(null==i?void 0:i.upgrades)&&(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,t.jsx)(g,{name:"鍛造武器 (Fallback)",desc:"基礎攻擊力 +1",level:l.goldShop.weaponLevel,cost:10,currencyLabel:"\uD83D\uDCB0",canAfford:!1,onClick:()=>{}})}),(0,t.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,t.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,t.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,t.jsx)(x,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:l.wallet.diamonds>=10,onClick:()=>a("gold_pack_1")}),(0,t.jsx)(x,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:l.wallet.diamonds>=80,onClick:()=>a("gold_pack_2")})]})]}),"LEVEL"===r&&(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,t.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,t.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,t.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:l.wallet.levelPoints}),(0,t.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"})]}),(0,t.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,t.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==i?void 0:i.upgrades)?h("LEVEL"):(0,t.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===r&&(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,t.jsxs)("div",{className:"ca-realm-card",children:[(0,t.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,t.jsx)("div",{className:"ca-realm-name",style:{color:c.color},children:c.name}),(0,t.jsxs)("div",{className:"ca-realm-level",children:["等級 ",l.system.level]})]}),(0,t.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,t.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==i?void 0:i.upgrades)?h("CLICK"):(0,t.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===r&&(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 0",opacity:.5,gap:"16px"},children:[(0,t.jsx)("div",{style:{fontSize:"4rem",filter:"grayscale(1)"},children:"\uD83D\uDD4A️"}),(0,t.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"飛昇商店"}),(0,t.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)"},children:"敬請期待"})]})]})]})}function x(e){let{name:l,desc:a,icon:s,cost:i,canAfford:r,onClick:o}=e;return(0,t.jsxs)("div",{className:"ca-glass-static",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"transform 0.1s"},onClick:()=>r&&o(),children:[(0,t.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:s}),(0,t.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:l}),(0,t.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:a}),(0,t.jsx)("div",{className:"ca-btn ".concat(r?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:r?"":"#334155",color:r?"":"#64748b",cursor:r?"pointer":"not-allowed"},children:i})]})}function g(e){let{name:l,desc:a,level:s,cost:i,canAfford:r,onClick:o,currencyLabel:c="⚡"}=e;return(0,t.jsxs)("div",{className:"ca-upgrade-row",children:[(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,t.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:l}),(0,t.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",s]})]}),(0,t.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:a})]}),(0,t.jsxs)("button",{onClick:()=>r&&o(),disabled:!r,className:"ca-upgrade-btn",children:[(0,t.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:"bold"},children:"升級"}),(0,t.jsxs)("span",{style:{fontSize:"0.7rem"},children:[c," ",i.toLocaleString()]})]})]})}function v(e){var l;let{player:a,combatPower:i,userId:r,onLogin:o,onLogout:c,onManualSave:n,gameConfig:d}=e,{system:p,stats:u,records:m}=a,[h,x]=s.useState(""),g=e=>e.toLocaleString(),v=e=>"".concat((100*e).toFixed(1),"%");return(0,t.jsxs)("div",{className:"ca-profile-page",children:[(0,t.jsx)("div",{className:"ca-profile-section",children:(0,t.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,t.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,t.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(r||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,t.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",p.level]})]}),(0,t.jsx)("div",{className:"ca-profile-summary",children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsxs)("span",{children:["勇者 ",r]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,t.jsx)("button",{onClick:n,style:{fontSize:"0.7rem",background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",border:"none",borderRadius:"4px",padding:"2px 8px",cursor:"pointer"},children:"上傳"}),(0,t.jsx)("button",{onClick:c,style:{fontSize:"0.7rem",background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5",border:"none",borderRadius:"4px",padding:"2px 8px",cursor:"pointer"},children:"登出"})]})]}),(0,t.jsxs)("div",{className:"ca-profile-cp",children:[(0,t.jsx)("span",{className:"label",children:"戰鬥力"}),(0,t.jsx)("span",{className:"value",children:g(i)})]}),(0,t.jsxs)("div",{className:"ca-profile-exp",children:[(0,t.jsxs)("div",{className:"info",children:[(0,t.jsx)("span",{children:"EXP"}),(0,t.jsxs)("span",{children:[g(p.currentXp)," /"," ",g(p.requiredXp)]})]}),(0,t.jsx)("div",{className:"bar-bg",children:(0,t.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,p.currentXp/p.requiredXp*100),"%")}})})]})]}):(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},children:[(0,t.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)"},children:"輸入 ID 以讀取/建立存檔"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,t.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff",padding:"4px 8px",borderRadius:"4px"},placeholder:"User ID...",value:h,onChange:e=>x(e.target.value)}),(0,t.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"4px 12px",fontSize:"0.9rem"},onClick:()=>{h.trim()&&o(h.trim())},children:"讀取"})]})]})})]})}),(0,t.jsxs)("div",{className:"ca-profile-section",children:[(0,t.jsx)("h3",{className:"ca-section-title",children:"戰鬥屬性"}),(0,t.jsxs)("div",{className:"ca-stats-grid",children:[(0,t.jsx)(f,{label:"基礎攻擊",value:g(u.baseDamage),icon:"⚔️"}),(0,t.jsx)(f,{label:"自動攻擊",value:g(u.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,t.jsx)(f,{label:"爆擊機率",value:v(u.criticalChance),icon:"\uD83C\uDFAF"}),(0,t.jsx)(f,{label:"爆擊倍率",value:v(u.criticalDamage),icon:"\uD83D\uDCA5"}),(0,t.jsx)(f,{label:"金幣加成",value:"x".concat(u.goldMultiplier.toFixed(2)),icon:"\uD83D\uDCB0"}),(0,t.jsx)(f,{label:"CP 加成",value:"x".concat(u.cpMultiplier.toFixed(2)),icon:"✨"})]})]}),(0,t.jsxs)("div",{className:"ca-profile-section",children:[(0,t.jsx)("h3",{className:"ca-section-title",children:"冒險記錄"}),(0,t.jsxs)("div",{className:"ca-records-list ca-glass-static",children:[(0,t.jsx)(j,{label:"總點擊次數",value:g(m.totalClicks)}),(0,t.jsx)(j,{label:"總造成傷害",value:g(m.totalDamageDealt)}),(0,t.jsx)(j,{label:"擊殺怪物",value:g(m.monstersKilled)}),(0,t.jsx)(j,{label:"擊殺 BOSS",value:g(m.bossesKilled)}),(0,t.jsx)(j,{label:"最高到達關卡",value:g(m.maxStageReached)}),(0,t.jsx)(j,{label:"總獲得金幣",value:g(m.totalGoldEarned)}),(0,t.jsx)(j,{label:"遊玩時間",value:(e=>{let l=Math.floor(e/3600),a=Math.floor(e%3600/60),t=e%60;return l>0?"".concat(l,"h ").concat(a,"m ").concat(t,"s"):a>0?"".concat(a,"m ").concat(t,"s"):"".concat(t,"s")})(m.playtimeSeconds)})]})]}),(0,t.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.75rem",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[(0,t.jsx)("div",{children:"\uD83C\uDFAE Click Ascension"}),(0,t.jsxs)("div",{style:{marginTop:"4px"},children:["版本 ",String((null==d||null==(l=d.settings)?void 0:l.GAME_VERSION)||"1.0.0")]})]})]})}function f(e){let{label:l,value:a,icon:s}=e;return(0,t.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,t.jsx)("div",{className:"ca-stat-icon",children:s}),(0,t.jsxs)("div",{className:"ca-stat-content",children:[(0,t.jsx)("div",{className:"ca-stat-label",children:l}),(0,t.jsx)("div",{className:"ca-stat-value",children:a})]})]})}function j(e){let{label:l,value:a}=e;return(0,t.jsxs)("div",{className:"ca-record-row",children:[(0,t.jsx)("span",{className:"ca-record-label",children:l}),(0,t.jsx)("span",{className:"ca-record-value",children:a})]})}let y={STAGE_1_20:[{name:"史萊姆",emoji:"\uD83D\uDC7E",rarity:"COMMON",hpMultiplier:1,goldMultiplier:1,xpMultiplier:1},{name:"小蘑菇",emoji:"\uD83C\uDF44",rarity:"COMMON",hpMultiplier:.9,goldMultiplier:.9,xpMultiplier:.9},{name:"野狼",emoji:"\uD83D\uDC3A",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1.1,xpMultiplier:1.1},{name:"野豬",emoji:"\uD83D\uDC17",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.1,xpMultiplier:1.1},{name:"青蛇",emoji:"\uD83D\uDC0D",rarity:"COMMON",hpMultiplier:.8,goldMultiplier:1,xpMultiplier:1.2}],STAGE_21_40:[{name:"大蝙蝠",emoji:"\uD83E\uDD87",rarity:"COMMON",hpMultiplier:.9,goldMultiplier:1.2,xpMultiplier:1.1},{name:"毒蜘蛛",emoji:"\uD83D\uDD77️",rarity:"COMMON",hpMultiplier:1,goldMultiplier:1.1,xpMultiplier:1.1},{name:"骷髏兵",emoji:"\uD83D\uDC80",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.1,xpMultiplier:1.1},{name:"蠍子",emoji:"\uD83E\uDD82",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.3,xpMultiplier:1.2},{name:"巨鼠",emoji:"\uD83D\uDC00",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1,xpMultiplier:1}],STAGE_41_60:[{name:"靈狐",emoji:"\uD83E\uDD8A",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.5,xpMultiplier:1.5},{name:"竹妖",emoji:"\uD83C\uDF8B",rarity:"COMMON",hpMultiplier:1.4,goldMultiplier:1.3,xpMultiplier:1.3},{name:"武道家",emoji:"\uD83E\uDD4B",rarity:"COMMON",hpMultiplier:1.5,goldMultiplier:1.4,xpMultiplier:1.6},{name:"白虎",emoji:"\uD83D\uDC2F",rarity:"COMMON",hpMultiplier:1.6,goldMultiplier:1.6,xpMultiplier:1.6},{name:"靈鷹",emoji:"\uD83E\uDD85",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1.4,xpMultiplier:1.4}],STAGE_61_80:[{name:"火元素",emoji:"\uD83D\uDD25",rarity:"COMMON",hpMultiplier:1.4,goldMultiplier:1.6,xpMultiplier:1.5},{name:"冰魔像",emoji:"❄️",rarity:"COMMON",hpMultiplier:1.6,goldMultiplier:1.6,xpMultiplier:1.5},{name:"雷靈",emoji:"⚡",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.8,xpMultiplier:1.6},{name:"風怪",emoji:"\uD83C\uDF2A️",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.5,xpMultiplier:1.5},{name:"岩石巨人",emoji:"\uD83D\uDDFF",rarity:"COMMON",hpMultiplier:2,goldMultiplier:1.5,xpMultiplier:1.2}],STAGE_81_PLUS:[{name:"惡鬼",emoji:"\uD83D\uDC79",rarity:"COMMON",hpMultiplier:1.8,goldMultiplier:2,xpMultiplier:2},{name:"幽靈",emoji:"\uD83D\uDC7B",rarity:"COMMON",hpMultiplier:1.5,goldMultiplier:1.8,xpMultiplier:1.8},{name:"吸血鬼",emoji:"\uD83E\uDDDB",rarity:"COMMON",hpMultiplier:1.7,goldMultiplier:2.2,xpMultiplier:2},{name:"殭屍",emoji:"\uD83E\uDDDF",rarity:"COMMON",hpMultiplier:2.2,goldMultiplier:1.6,xpMultiplier:1.8}]},M=[{name:"黃金史萊姆",emoji:"\uD83D\uDCB0",rarity:"RARE",hpMultiplier:.5,goldMultiplier:5,xpMultiplier:1},{name:"金屬史萊姆",emoji:"\uD83E\uDD16",rarity:"RARE",hpMultiplier:5,goldMultiplier:1,xpMultiplier:5},{name:"寶箱怪",emoji:"\uD83D\uDCE6",rarity:"RARE",hpMultiplier:2,goldMultiplier:2,xpMultiplier:1,dropDiamonds:2},{name:"幸運草精",emoji:"\uD83C\uDF40",rarity:"RARE",hpMultiplier:.1,goldMultiplier:1,xpMultiplier:1}],D=[{name:"金剛",emoji:"\uD83E\uDD8D",rarity:"BOSS",hpMultiplier:5,goldMultiplier:10,xpMultiplier:10},{name:"巨鱷",emoji:"\uD83D\uDC0A",rarity:"BOSS",hpMultiplier:5,goldMultiplier:10,xpMultiplier:10},{name:"霸王龍",emoji:"\uD83E\uDD96",rarity:"BOSS",hpMultiplier:6,goldMultiplier:12,xpMultiplier:12}],b=[{name:"魔龍",emoji:"\uD83D\uDC32",rarity:"BOSS",hpMultiplier:15,goldMultiplier:20,xpMultiplier:20,dropDiamonds:5},{name:"赤鬼王",emoji:"\uD83D\uDC7A",rarity:"BOSS",hpMultiplier:12,goldMultiplier:18,xpMultiplier:18,dropDiamonds:3},{name:"克拉肯",emoji:"\uD83E\uDD91",rarity:"BOSS",hpMultiplier:14,goldMultiplier:19,xpMultiplier:19,dropDiamonds:4},{name:"撒旦",emoji:"\uD83D\uDC7F",rarity:"BOSS",hpMultiplier:16,goldMultiplier:25,xpMultiplier:25,dropDiamonds:6}];var S=a(23464);let N="https://script.google.com/macros/s/AKfycbytd_hvb2K_jpkXM9ZoY5Feyi2ddZYI112UG0cUZpZrTcjZ5IZnsZCwAhU3xSSUYJxj/exec",w={loadPlayerSave:async e=>{try{let l=await S.A.get("".concat(N,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(l.data&&l.data.exists)return l.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,l)=>{try{if(!e)throw Error("User ID is required for saving");let a=await S.A.post(N,{action:"save_progress",userId:e,saveData:l},{headers:{"Content-Type":"text/plain"}});if(a.data&&a.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await S.A.get("".concat(N,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},C={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,bossDamageMultiplier:1},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{clickPowerLevel:0,critDamageLevel:0,goldBonusLevel:0},levelShop:{wisdomLevel:0,greedLevel:0,autoClickLevel:0,bossSlayerLevel:0,luckLevel:0},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0}},k={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10};function _(){let[e,l]=(0,s.useState)(null),[a,r]=(0,s.useState)(C),[d,p]=(0,s.useState)(k),[m,x]=(0,s.useState)(null),[g,f]=(0,s.useState)({}),[j,S]=(0,s.useState)(null),N=Math.floor(10*a.stats.baseDamage+20*a.stats.autoAttackDamage+1e3*a.stats.criticalChance+500*a.stats.criticalDamage);(0,s.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await w.getGameConfigs();e&&(console.log("[Config] Loaded:",e),S(e))})();let e=localStorage.getItem("ca_last_user_id");e&&O(e)},[]);let _=(0,s.useCallback)(()=>{let e=d.isBossActive;!e&&d.autoChallengeBoss&&d.monstersKilledInStage>=d.monstersRequiredForBoss&&(e=!0);let l=function(e,l){if(l)return e%10==0?b[Math.floor(Math.random()*b.length)]:D[Math.floor(Math.random()*D.length)];let a=Math.random();if(a<.11)return a<.05?M[0]:a<.08?M[1]:a<.1?M[2]:M[3];let t=y.STAGE_1_20;return e>80?t=y.STAGE_81_PLUS:e>60?t=y.STAGE_61_80:e>40?t=y.STAGE_41_60:e>20&&(t=y.STAGE_21_40),t[Math.floor(Math.random()*t.length)]}(d.currentStageId,e),a=Math.ceil((20*Math.pow(1.18,d.currentStageId-1)+10*d.currentStageId)*l.hpMultiplier),t=.15*a*l.goldMultiplier,s=.08*a*l.xpMultiplier;x({id:crypto.randomUUID(),name:"".concat(l.name," Lv.").concat(d.currentStageId),level:d.currentStageId,maxHp:a,currentHp:a,isBoss:"BOSS"===l.rarity,rewardGold:Math.max(1,Math.floor(t)),rewardXp:Math.max(1,Math.floor(s)),emoji:l.emoji})},[d]),[L,A]=(0,s.useState)(null);(0,s.useEffect)(()=>{m||_()},[m,_]),(0,s.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&O(e)},[]),(0,s.useEffect)(()=>{if(!L)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(L," to Cloud..."));let e={player:a,stage:d,timestamp:Date.now()};try{await w.savePlayerProgress(L,e),localStorage.setItem("ca_save_".concat(L),JSON.stringify(e))}catch(l){console.warn("[AutoSave] Cloud save failed, using local backup",l),localStorage.setItem("ca_save_".concat(L),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[L,a,d]);let O=async e=>{if(!e)return;A(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let l=await w.loadPlayerSave(e);if(l){console.log("[Login] Cloud save found!"),l.player&&r(e=>({...e,...l.player})),l.stage&&p(e=>({...e,...l.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let l=localStorage.getItem("ca_save_".concat(e));if(l){console.log("[Login] Found local backup.");try{let e=JSON.parse(l);r(l=>({...l,...e.player})),p(l=>({...l,...e.stage}))}catch(e){}}},I=async()=>{if(!L)return;let e={player:a,stage:d,timestamp:Date.now()};try{alert("☁️ 上傳中..."),await w.savePlayerProgress(L,e),alert("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(L),JSON.stringify(e))}catch(l){console.error("Save failed",l),alert("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(L),JSON.stringify(e))}};(0,s.useEffect)(()=>{if(!m||m.currentHp<=0||a.stats.autoAttackDamage<=0)return;let e=setInterval(()=>{let e=a.stats.autoAttackDamage;m.isBoss&&(e=Math.ceil(e*a.stats.bossDamageMultiplier)),x(l=>{if(!l||l.currentHp<=0)return l;let a=l.currentHp-e;return a<=0?(setTimeout(()=>P(l),0),{...l,currentHp:0}):{...l,currentHp:Math.max(0,a)}}),r(l=>({...l,records:{...l.records,totalDamageDealt:l.records.totalDamageDealt+e}}))},1e3);return()=>clearInterval(e)},[m,a.stats.autoAttackDamage,a.stats.bossDamageMultiplier]);let P=e=>{if(!e)return;let l=Math.ceil(e.rewardGold*a.stats.goldMultiplier),t=Math.ceil(e.rewardXp*a.stats.xpMultiplier);r(a=>{let{level:s,currentXp:i,requiredXp:r}=a.system,{levelPoints:o}=a.wallet;for(i+=t;i>=r;)i-=r,s+=1,o+=5,r=Math.floor(1.2*r);return{...a,wallet:{...a.wallet,gold:a.wallet.gold+l,levelPoints:o},system:{...a.system,level:s,currentXp:i,requiredXp:r},records:{...a.records,monstersKilled:a.records.monstersKilled+1,totalGoldEarned:a.records.totalGoldEarned+l,bossesKilled:e.isBoss?a.records.bossesKilled+1:a.records.bossesKilled}}}),p(l=>{if(e.isBoss)return{...l,currentStageId:l.currentStageId+1,maxStageReached:Math.max(l.maxStageReached,l.currentStageId+1),isBossActive:!1,monstersKilledInStage:0};let a=l.monstersKilledInStage+1;return{...l,monstersKilledInStage:a}}),x(null)},E=e=>{"RAGE"===e&&a.inventory.ragePotionCount>0&&r(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))};return(0,t.jsxs)("div",{className:"ca-game-container",children:[(0,t.jsx)(i,{player:a,combatPower:N,stageId:d.currentStageId,onAvatarClick:()=>l("PROFILE")}),(0,t.jsx)(o,{monster:m,stageId:d.currentStageId,onMonsterClick:(e,l)=>{if(!m||m.currentHp<=0)return;let t=e;m.isBoss&&(t=Math.ceil(e*a.stats.bossDamageMultiplier));let s=m.currentHp-t;x(e=>e?{...e,currentHp:Math.max(0,s)}:null),r(e=>({...e,records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+t},wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+ +e.stats.cpMultiplier}})),s<=0&&P(m)},baseDamage:a.stats.baseDamage,criticalChance:a.stats.criticalChance,criticalDamage:a.stats.criticalDamage,monstersKilled:d.monstersKilledInStage,monstersRequired:d.monstersRequiredForBoss,isBossActive:d.isBossActive,mercenaryLevel:a.goldShop.mercenaryLevel,partnerLevel:a.goldShop.partnerLevel,potionCount:a.inventory.ragePotionCount,activeBuffs:a.activeBuffs,onUsePotion:()=>E("RAGE")}),(0,t.jsx)(c,{onOpenModal:l}),(0,t.jsx)(n,{isOpen:"PROFILE"===e,onClose:()=>l(null),title:"玩家資料",children:(0,t.jsx)(v,{player:a,combatPower:N,userId:L,onLogin:O,onLogout:()=>{A(null),localStorage.removeItem("ca_last_user_id"),r(C),p(k)},onManualSave:I,gameConfig:j})}),(0,t.jsx)(n,{isOpen:"UPGRADES"===e,onClose:()=>l(null),title:"升級強化",children:(0,t.jsx)(u,{player:a,upgradeLevels:g,onPurchaseUpgrade:(e,l)=>{if(!(a.wallet.gold<l))switch(r(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-l}})),f(l=>({...l,[e]:(l[e]||0)+1})),e){case"click_power":r(e=>({...e,stats:{...e.stats,baseDamage:e.stats.baseDamage+1}}));break;case"crit_chance":r(e=>({...e,stats:{...e.stats,criticalChance:Math.min(.5,e.stats.criticalChance+.01)}}));break;case"gold_bonus":r(e=>({...e,stats:{...e.stats,goldMultiplier:e.stats.goldMultiplier+.1}}));break;case"auto_attack":r(e=>({...e,stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+1}}))}}})}),(0,t.jsx)(n,{isOpen:"SHOP"===e,onClose:()=>l(null),title:"商店",headerContent:(0,t.jsxs)("div",{className:"ca-shop-currency-bar",style:{border:"none",background:"transparent",padding:0,marginLeft:"12px",gap:"12px"},children:[(0,t.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},children:[(0,t.jsx)("span",{children:"\uD83D\uDCB0"}),(0,t.jsx)("span",{children:Math.floor(a.wallet.gold).toLocaleString()})]}),(0,t.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},children:[(0,t.jsx)("span",{children:"\uD83D\uDC8E"}),(0,t.jsx)("span",{children:a.wallet.diamonds.toLocaleString()})]})]}),children:(0,t.jsx)(h,{player:a,onPurchase:e=>{if("daily_checkin"===e)return void r(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+10,gold:e.wallet.gold+500},lastDailyRewardClaimTime:Date.now()}));if(e.startsWith("level_shop_")){let{levelShop:l}=a,t=0;switch(e){case"level_shop_wisdom":t=3+l.wisdomLevel,a.wallet.levelPoints>=t&&r(e=>({...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints-t},levelShop:{...e.levelShop,wisdomLevel:e.levelShop.wisdomLevel+1},stats:{...e.stats,xpMultiplier:e.stats.xpMultiplier+.05}}));break;case"level_shop_greed":t=2+l.greedLevel,a.wallet.levelPoints>=t&&r(e=>({...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints-t},levelShop:{...e.levelShop,greedLevel:e.levelShop.greedLevel+1},stats:{...e.stats,goldMultiplier:e.stats.goldMultiplier+.05}}));break;case"level_shop_auto":t=0===l.autoClickLevel?10:2+l.autoClickLevel,a.wallet.levelPoints>=t&&r(e=>({...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints-t},levelShop:{...e.levelShop,autoClickLevel:e.levelShop.autoClickLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+5}}));break;case"level_shop_slayer":t=3+l.bossSlayerLevel,a.wallet.levelPoints>=t&&r(e=>({...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints-t},levelShop:{...e.levelShop,bossSlayerLevel:e.levelShop.bossSlayerLevel+1},stats:{...e.stats,bossDamageMultiplier:e.stats.bossDamageMultiplier+.1}}));break;case"level_shop_luck":t=4+2*l.luckLevel,a.wallet.levelPoints>=t&&r(e=>({...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints-t},levelShop:{...e.levelShop,luckLevel:e.levelShop.luckLevel+1},stats:{...e.stats,criticalChance:e.stats.criticalChance+.01}}))}return}if(e.startsWith("click_shop_")){let{clickShop:l}=a,t=0;switch(e){case"click_shop_damage":t=Math.floor(10*Math.pow(1.5,l.clickPowerLevel)),a.wallet.clickPoints>=t&&r(e=>({...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints-t},clickShop:{...e.clickShop,clickPowerLevel:e.clickShop.clickPowerLevel+1},stats:{...e.stats,baseDamage:e.stats.baseDamage+5}}));break;case"click_shop_crit":t=Math.floor(50*Math.pow(1.5,l.critDamageLevel)),a.wallet.clickPoints>=t&&r(e=>({...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints-t},clickShop:{...e.clickShop,critDamageLevel:e.clickShop.critDamageLevel+1},stats:{...e.stats,criticalDamage:e.stats.criticalDamage+.1}}));break;case"click_shop_gold":t=Math.floor(100*Math.pow(1.5,l.goldBonusLevel)),a.wallet.clickPoints>=t&&r(e=>({...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints-t},clickShop:{...e.clickShop,goldBonusLevel:e.clickShop.goldBonusLevel+1},stats:{...e.stats,goldMultiplier:e.stats.goldMultiplier+.1}}))}return}let l=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:"DIAMOND"},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:"DIAMOND"}].find(l=>l.id===e);if(l&&"DIAMOND"===l.currency&&a.wallet.diamonds>=l.cost&&r(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds-l.cost,gold:e.wallet.gold+l.reward}})),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:l}=a,t=0;switch(e){case"gold_shop_weapon":t=Math.floor(10*Math.pow(1.2,l.weaponLevel)),a.wallet.gold>=t&&r(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,weaponLevel:e.goldShop.weaponLevel+1},stats:{...e.stats,baseDamage:e.stats.baseDamage+1}}));break;case"gold_shop_mercenary":t=Math.floor(100*Math.pow(1.3,l.mercenaryLevel)),a.wallet.gold>=t&&r(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,mercenaryLevel:e.goldShop.mercenaryLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+2}}));break;case"gold_shop_partner":t=Math.floor(500*Math.pow(1.3,l.partnerLevel)),a.wallet.gold>=t&&r(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,partnerLevel:e.goldShop.partnerLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+5}}));break;case"gold_potion_rage":t=500,a.wallet.gold>=t&&r(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount+1}}))}}},gameConfig:j})})]})}}}]);