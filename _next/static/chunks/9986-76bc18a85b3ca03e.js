(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9986],{66997:()=>{},79986:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>q});var l=a(95155),i=a(12115),s=function(e){return e.COMMON="COMMON",e.RARE="RARE",e.BOSS="BOSS",e}({}),n=function(e){return e.MAIN_HAND="MAIN_HAND",e.HEAD="HEAD",e.BODY="BODY",e.HANDS="HANDS",e.LEGS="LEGS",e.RELIC="RELIC",e}({});let r="LETTER";function o(e){r=e,console.log("[NumberFormat] 數值單位已切換為: ".concat(e))}let c=[{unit:"",value:1},{unit:"萬",value:1e4},{unit:"億",value:1e8},{unit:"兆",value:1e12},{unit:"京",value:1e16},{unit:"垓",value:1e20},{unit:"秭",value:1e24},{unit:"穰",value:1e28},{unit:"溝",value:1e32},{unit:"澗",value:1e36},{unit:"正",value:1e40},{unit:"載",value:1e44},{unit:"極",value:1e48}];function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,l=arguments.length>3?arguments[3]:void 0;if(e<0)return"-"+d(-e,t,a,l);switch(l||r){case"SCIENTIFIC":if(e<a)return Math.floor(e).toLocaleString();let i=Math.floor(Math.log10(e)),s=e/Math.pow(10,i);return"".concat(s.toFixed(t),"e").concat(i);case"CHINESE":if(e<a)return Math.floor(e).toLocaleString();for(let l=c.length-1;l>=0;l--){let{unit:i,value:s}=c[l];if(e>=s&&s>=a){let a=e/s,l=t;return a>=100&&(l=Math.max(0,t-1)),a>=1e3&&(l=0),a.toFixed(l)+i}}return Math.floor(e).toLocaleString();default:if(e<a)return Math.floor(e).toLocaleString();let n=Math.floor(Math.floor(Math.log10(e))/3)-1;if(n<0)return Math.floor(e).toLocaleString();let o=e/Math.pow(10,(n+1)*3),p=function(e){if(e<0)return"";let t="",a=e;for(;a>=0;)t=String.fromCharCode(65+a%26)+t,a=Math.floor(a/26)-1;return t}(n),u=t;return o>=100&&(u=Math.max(0,t-1)),o>=1e3&&(u=0),o.toFixed(u)+p}}a(66997);let p=e=>d(e,2,1e3);function u(e){let{player:t,combatPower:a,stageId:i,userId:s,onAvatarClick:n,onAscension:r,potentialPoints:o}=e,{system:c,wallet:d}=t,u=c.currentXp/c.requiredXp*100;return(0,l.jsxs)("header",{className:"ca-header",children:[(0,l.jsxs)("div",{className:"ca-player-profile",children:[(0,l.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:n,children:[(0,l.jsx)("div",{className:"ca-avatar-ring",children:(0,l.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,l.jsx)("div",{className:"ca-level-badge",children:c.level})]}),(0,l.jsxs)("div",{className:"ca-profile-info",children:[(0,l.jsxs)("div",{className:"ca-profile-top",children:[(0,l.jsxs)("span",{className:"ca-level-text",children:["Lv.",c.level]}),(0,l.jsx)("span",{className:"ca-player-name",children:s||"冒險者"})]}),(0,l.jsxs)("div",{className:"ca-exp-container",children:[(0,l.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,l.jsx)("div",{className:"ca-exp-bar",children:(0,l.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,u),"%")}})}),(0,l.jsxs)("div",{className:"ca-exp-text",children:[p(c.currentXp),"/",p(c.requiredXp)]})]}),(0,l.jsxs)("div",{className:"ca-combat-power",style:{justifyContent:"space-between",width:"100%"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,l.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,l.jsx)("span",{className:"ca-cp-value",children:p(a)})]}),(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),r()},style:{display:"flex",alignItems:"center",gap:"4px",background:"linear-gradient(135deg, #a855f7 0%, #d946ef 100%)",color:"white",padding:"4px 10px",fontSize:"0.65rem",fontWeight:"bold",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:"0 0 10px rgba(168, 85, 247, 0.3)",flexShrink:0},children:["⚡ 渡劫飛升 (+",p(o),")"]})]})]})]}),(0,l.jsx)("div",{className:"ca-header-right",children:(0,l.jsxs)("div",{className:"ca-currency-stack",children:[(0,l.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,l.jsx)("span",{children:"\uD83D\uDCB0"}),(0,l.jsx)("span",{children:p(Math.floor(d.gold))})]}),(0,l.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:p(Math.floor(d.clickPoints))})]}),(0,l.jsxs)("div",{className:"ca-currency text-xs",style:{color:"#10b981"},children:[(0,l.jsx)("span",{children:"\uD83C\uDD99"}),(0,l.jsx)("span",{children:p(Math.floor(d.levelPoints))})]})]})})]})}function x(e){let{name:t,currentHp:a,maxHp:i,isBoss:s=!1}=e,n=Math.max(1,i),r=Math.min(Math.max(0,a),n);return(0,l.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,l.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,l.jsx)("span",{className:"text-slate-300 me-2",children:t})}),(0,l.jsx)("div",{className:"ca-hp-bar",children:(0,l.jsx)("div",{className:"ca-hp-bar-fill ".concat(s?"boss":"normal"),style:{width:"".concat(r/n*100,"%")}})}),(0,l.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[d(Math.ceil(r),2,1e3)," /"," ",d(Math.ceil(n),2,1e3)]})]})}let m=e=>{let{monster:t}=e,[a,s]=(0,i.useState)(!1),[n,r]=(0,i.useState)(null);return((0,i.useEffect)(()=>{s(!1),t.configId?r("/clickAscension/monsters/".concat(t.configId,".webp")):r(null)},[t.configId]),!a&&n)?(0,l.jsx)("img",{src:n,alt:t.name,className:"ca-monster-image",onError:()=>s(!0)}):(0,l.jsx)(l.Fragment,{children:t.emoji||(t.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")})},g={gold_shop_mercenary:"⚔️",gold_shop_partner:"\uD83E\uDDDA",gold_shop_archer:"\uD83C\uDFF9",gold_shop_knight:"\uD83D\uDEE1️",gold_shop_warlord:"\uD83D\uDD31",gold_shop_oracle:"\uD83D\uDD2E",gold_shop_void:"\uD83C\uDF0C",gold_shop_titan:"⛰️",gold_shop_dragon:"\uD83D\uDC09",gold_shop_creation:"✨"};function h(e){let{monster:t,stageId:a,onMonsterClick:s,baseDamage:n,criticalChance:r,criticalDamage:o,monstersKilled:c,monstersRequired:p,isBossActive:u,bossDamageMultiplier:h=1,goldShop:f={},gameConfig:D,potionCount:b=0,activeBuffs:v,onUsePotion:y,lastAutoAttack:_,lastAutoClickEvent:C,bossTimeLeft:j,bossTimeLimit:S=60,onChallengeBoss:A,autoUsePotion:M=!1,onToggleAutoPotion:N}=e,E=Object.entries(f).filter(e=>{var t;let[a,l]=e;if(!a.startsWith("gold_shop_")||l<=0)return!1;let i=null==D||null==(t=D.upgrades)?void 0:t.find(e=>e.ID===a);return"ADD_AUTO_DMG"===String((null==i?void 0:i.Effect_Type)||"").toUpperCase().trim()}).map(e=>{let[t,a]=e;return{id:t,level:a}}),I=(0,i.useCallback)(e=>{var t;let a=null==D||null==(t=D.upgrades)?void 0:t.find(t=>t.ID===e);return(null==a?void 0:a.Emoji)?a.Emoji:g[e]?g[e]:(null==a?void 0:a.Name)?a.Name.substring(0,2):e.replace("gold_shop_","").substring(0,2)},[D]),[T,w]=(0,i.useState)([]),[L,k]=(0,i.useState)(!1),[R,P]=(0,i.useState)(!1),[G,O]=(0,i.useState)({}),U=(0,i.useRef)(null),B=(0,i.useRef)({}),z=(0,i.useRef)(0),q=(0,i.useRef)(""),W=(null==v?void 0:v.ragePotionExpiresAt)&&v.ragePotionExpiresAt>Date.now(),K=(e,t,a,l)=>{var i;let s=null==(i=U.current)?void 0:i.getBoundingClientRect(),n=s?Math.max(50,Math.min(s.width-50,t)):t,r=crypto.randomUUID();w(t=>[...t,{id:r,text:e,x:n,y:a,type:l,createdAt:Date.now()}]),setTimeout(()=>{w(e=>e.filter(e=>e.id!==r))},1e3)};i.useEffect(()=>{var e;if(!C||C.id===q.current)return;q.current=C.id,P(!0),setTimeout(()=>P(!1),50);let t=null==(e=U.current)?void 0:e.getBoundingClientRect();if(t){let e=t.width/2+(60*Math.random()-30),a=t.height/2+(60*Math.random()-30),l=C.isCrit?"CRIT":"CLICK";K(d(C.damage,1,1e3),e,a,l)}},[C]),i.useEffect(()=>{var e;if(!_||_.time===z.current)return;z.current=_.time,P(!0),setTimeout(()=>P(!1),150);let t=null==(e=U.current)?void 0:e.getBoundingClientRect();_.breakdown&&t&&Object.entries(_.breakdown).forEach(e=>{let[a,l]=e;if("player"===a||l<=0)return;let i=I(a),s=B.current[a];if(s){let e=s.getBoundingClientRect(),n=e.left-t.left+e.width/2,r=e.top-t.top;K("".concat(i," ").concat(d(l,1,1e3)),n,r-20,"AUTO"),O(e=>({...e,[a]:!0})),setTimeout(()=>{O(e=>({...e,[a]:!1}))},300)}else{let e=t.width/2+(80*Math.random()-40),a=.3*t.height+(40*Math.random()-20);K("".concat(i," ").concat(d(l,1,1e3)),e,a,"AUTO")}})},[_,f,D,I]);let H=e=>{var a,l,i,c,p;let u,x;if(!t||t.currentHp<=0)return;let m=n;W&&(m*=2),t.isBoss&&(m*=h);let g=Math.random()<r,f=Math.ceil(m*(g?o:1)),D=null==(a=U.current)?void 0:a.getBoundingClientRect();if(!D)return;"touches"in e?(u=null!=(c=null==(l=e.touches[0])?void 0:l.clientX)?c:D.left+D.width/2,x=null!=(p=null==(i=e.touches[0])?void 0:i.clientY)?p:D.top+D.height/2):(u=e.clientX,x=e.clientY);let b=u-D.left+(60*Math.random()-30),v=x-D.top+(60*Math.random()-30);K(d(f,1,1e3),b,v,g?"CRIT":"CLICK"),k(!0),P(!0),setTimeout(()=>k(!1),300),setTimeout(()=>P(!1),150),s(f,g)},F=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,l.jsxs)("div",{ref:U,className:"ca-battle-area ".concat(L?"ca-shake":""),style:{background:W?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:H,onTouchStart:H,children:[t&&(0,l.jsx)("div",{className:"ca-monster-sprite ".concat(t.isBoss?"boss":""," ").concat(R?"ca-hit-flash":""," ca-bounce-slow"),children:(0,l.jsx)(m,{monster:t})}),(0,l.jsx)("div",{className:"ca-monster-container",style:{position:"relative",zIndex:1,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:t?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",position:"relative"},children:[u&&(0,l.jsxs)("div",{style:{position:"absolute",top:"-120px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",width:"100%",maxWidth:"240px",zIndex:10},children:[(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#ef4444",fontWeight:"bold",background:"rgba(239, 68, 68, 0.2)",padding:"2px 10px",borderRadius:"10px",border:"1px solid rgba(239, 68, 68, 0.4)",letterSpacing:"1px",marginBottom:"4px"},children:"\uD83D\uDC79 BOSS 戰進行中"}),null!=j&&(0,l.jsxs)("div",{style:{width:"100%"},children:[(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:(0,l.jsxs)("span",{style:{fontSize:"1.2rem",fontWeight:"900",color:j<=10?"#ff4d4d":"#fbbf24",textShadow:"0 0 10px rgba(0,0,0,0.8)",fontFamily:"monospace"},children:["⏱️ ",j,"s"]})}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)",marginTop:"2px"},children:(0,l.jsx)("div",{style:{height:"100%",width:"".concat(j/S*100,"%"),background:j<=10?"linear-gradient(90deg, #ef4444, #b91c1c)":"linear-gradient(90deg, #fbbf24, #d97706)",transition:"width 1s linear, background 0.3s"}})})]})]}),t.note&&(0,l.jsxs)("div",{className:"ca-note-badge",style:{position:"relative",top:"0",left:"0",transform:"none",marginBottom:"8px"},children:[(0,l.jsx)("span",{children:"\uD83D\uDCCD"}),(0,l.jsx)("span",{children:t.note})]}),(0,l.jsxs)("div",{className:"ca-stage-display",children:["第 ",a," 關"]}),!u&&(c>=p?(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",onClick:e=>{e.stopPropagation(),null==A||A()},style:{pointerEvents:"auto",marginBottom:"16px",padding:"8px 20px",fontSize:"1rem",background:"linear-gradient(to right, #ef4444, #b91c1c)",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",border:"none"},children:"⚔️ 挑戰 BOSS"}):(0,l.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.5)",padding:"2px 8px",borderRadius:"12px"},children:[c," / ",p," \uD83D\uDC80"]})),(0,l.jsx)("div",{style:{height:"100px"}}),(0,l.jsx)("div",{className:"w-56",style:{marginTop:"auto"},children:(0,l.jsx)(x,{name:t.name,currentHp:t.currentHp,maxHp:t.maxHp,isBoss:t.isBoss})})]}):(0,l.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),E.length>0&&(()=>{let e=E.filter((e,t)=>t%2==0),t=E.filter((e,t)=>t%2==1),a=(e,t,a)=>a?e%2==0?t?"ca-attack-lunge-left":"ca-attack-lunge-right":t?"ca-attack-magic-left":"ca-attack-magic-right":"";return(0,l.jsxs)(l.Fragment,{children:[e.map((e,t)=>{let{id:i,level:s}=e;return(0,l.jsxs)("div",{ref:e=>{B.current[i]=e},className:a(t,!0,G[i]||!1),style:{position:"absolute",top:"".concat(80+70*t,"px"),left:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:[(0,l.jsx)("div",{style:{fontSize:"1.8rem"},children:I(i)}),(0,l.jsxs)("div",{style:{fontSize:"0.65rem",color:"#a78bfa"},children:["Lv.",s]})]},i)}),t.map((e,t)=>{let{id:i,level:s}=e;return(0,l.jsxs)("div",{ref:e=>{B.current[i]=e},className:a(t,!1,G[i]||!1),style:{position:"absolute",top:"".concat(80+70*t,"px"),right:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:[(0,l.jsx)("div",{style:{fontSize:"1.8rem"},children:I(i)}),(0,l.jsxs)("div",{style:{fontSize:"0.65rem",color:"#a78bfa"},children:["Lv.",s]})]},i)})]})})(),b>0&&(0,l.jsx)("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"row",alignItems:"center",gap:"16px",zIndex:20},children:(0,l.jsxs)("div",{onClick:e=>{e.stopPropagation(),!((null==v?void 0:v.ragePotionExpiresAt)&&v.ragePotionExpiresAt>Date.now())&&y&&y()},style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",gap:"2px"},children:[(0,l.jsx)("div",{style:{fontSize:"2rem",filter:(null==v?void 0:v.ragePotionExpiresAt)&&v.ragePotionExpiresAt>Date.now()?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:(null==v?void 0:v.ragePotionExpiresAt)&&v.ragePotionExpiresAt>Date.now()?"scale(0.9)":"scale(1)",transition:"all 0.3s"},children:"\uD83E\uDDEA"}),(0,l.jsxs)("div",{style:{fontSize:"0.65rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"8px",padding:"1px 5px",marginTop:"-8px"},children:["x",b]}),(0,l.jsxs)("div",{onClick:e=>{e.stopPropagation(),N&&N()},style:{display:"flex",alignItems:"center",gap:"3px",background:M?"rgba(34, 197, 94, 0.3)":"rgba(255, 255, 255, 0.1)",padding:"2px 6px",borderRadius:"10px",border:"1px solid ".concat(M?"rgba(34, 197, 94, 0.5)":"rgba(255, 255, 255, 0.2)"),cursor:"pointer",pointerEvents:"auto",transition:"all 0.3s",marginTop:"2px"},children:[(0,l.jsx)("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:M?"#22c55e":"#94a3b8",boxShadow:M?"0 0 4px #22c55e":"none"}}),(0,l.jsx)("span",{style:{fontSize:"0.5rem",color:M?"#4ade80":"#94a3b8",fontWeight:"bold",letterSpacing:"0.3px"},children:"AUTO"})]})]})}),(0,l.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",style:{zIndex:100},children:T.map(e=>(0,l.jsx)("div",{className:F(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function f(e){let{activeView:t,onSwitchView:a,onOpenModal:i}=e;return(0,l.jsx)("footer",{className:"ca-footer",children:(0,l.jsxs)("nav",{className:"ca-footer-nav",children:[(0,l.jsxs)("button",{className:"ca-tab-btn ".concat("CHARACTER"===t?"active":""),onClick:()=>{a("CHARACTER"),i(null)},children:[(0,l.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,l.jsx)("span",{className:"label",children:"角色"})]}),(0,l.jsxs)("button",{className:"ca-tab-btn ".concat("BATTLE"===t?"active":""),onClick:()=>{a("BATTLE"),i(null)},children:[(0,l.jsx)("span",{className:"icon",children:"⚔️"}),(0,l.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,l.jsxs)("button",{className:"ca-tab-btn",onClick:()=>i("SHOP"),children:[(0,l.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,l.jsx)("span",{className:"label",children:"商店"})]})]})})}function D(e){let{isOpen:t,onClose:a,title:i,headerContent:s,children:n}=e;return t?(0,l.jsx)("div",{className:"ca-modal-overlay",onClick:a,children:(0,l.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"ca-modal-header",children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,l.jsx)("h2",{className:"ca-modal-title",children:i}),s]}),(0,l.jsx)("button",{className:"ca-modal-close",onClick:a,children:"✕"})]}),(0,l.jsx)("div",{className:"ca-modal-content",children:n})]})}):null}let b=e=>e<=50?{name:"練氣期",color:"#a7f3d0"}:e<=150?{name:"築基期",color:"#6ee7b7"}:e<=300?{name:"金丹期",color:"#fbbf24"}:e<=500?{name:"元嬰期",color:"#f472b6"}:e<=800?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"},v=e=>d(e,2,1e3);function y(e){let{player:t,onPurchase:a,onResetLevelPoints:s,gameConfig:n,autoGachaBox:r,onToggleAutoGacha:o}=e,[c,d]=(0,i.useState)("DAILY"),[p,u]=(0,i.useState)("UPGRADE"),[x,m]=(0,i.useState)(null),g=i.useMemo(()=>(null==n?void 0:n.upgrades)?n.upgrades.filter(e=>"CLICK"===e.Shop_Type).map(e=>e.ID).reduce((e,a)=>e+(t.clickShop[a]||0),0):0,[t.clickShop,n]),h=b(g);console.log("[ShopPage] Rendering. ActiveTab:",c,"isProbModalOpen:",x);let f=e=>"gold_potion_rage"===e?t.inventory.ragePotionCount||0:e.startsWith("gold_shop_")?t.goldShop[e]||0:e.startsWith("level_shop_")?t.levelShop[e]||0:e.startsWith("click_shop_")?t.clickShop[e]||0:(e.startsWith("ascension_shop_")||e.startsWith("asc_"))&&t.ascensionShop[e]||0,D=(e,t,a,l)=>"ADD_INVENTORY"===l?e:1===t||1===t?Math.floor(e+a):Math.floor(e*Math.pow(t,a)),y=e=>"GOLD"===e?"\uD83D\uDCB0":"LP"===e?"\uD83C\uDD99":"CP"===e?"⚡":"DIAMOND"===e?"\uD83D\uDC8E":"AP"===e?"\uD83D\uDD4A️":e,S=e=>"GOLD"===e?t.wallet.gold:"LP"===e?t.wallet.levelPoints:"CP"===e?t.wallet.clickPoints:"DIAMOND"===e?t.wallet.diamonds:"AP"===e?t.wallet.ascensionPoints:0,A=(e,t)=>0===e.length?(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"gray"},children:"無項目"}):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(e=>{let i=f(e.ID),s=D(e.Cost_Base,e.Cost_Mult,i,e.Effect_Type),n=y(e.Currency),r=S(e.Currency),o=Number(e.Max_Level||0),c=o>0&&i>=o,d=0,p=!1,u="GOLD"===t||"GOLD"===e.Shop_Type;if(u&&!c){let t=o>0?Math.min(25,o-i):25;if(t>0){for(let a=0;a<t;a++)d+=D(e.Cost_Base,e.Cost_Mult,i+a,e.Effect_Type);p=r>=d&&25===t}}let x=e.Desc_Template||e.Name;return x.includes("{val}")&&(x=x.replace("{val}",String(e.Effect_Val))),(0,l.jsx)(C,{name:e.Name,desc:"".concat(x," [Lv.").concat(i,"]"),level:i,cost:s,currencyLabel:n,canAfford:!c&&r>=s,isMaxed:c,onClick:()=>a(e.ID),showBulkUpgrade:u,cost25:d,canAfford25:p,onBulkUpgrade:()=>{for(let t=0;t<25;t++)a(e.ID)}},e.ID)})}),N=e=>n&&n.upgrades?A(n.upgrades.filter(t=>t.Shop_Type===e),e):null,E=(()=>{if(!t.lastDailyRewardClaimTime)return!0;let e=new Date(t.lastDailyRewardClaimTime),a=new Date;return e.getDate()!==a.getDate()||e.getMonth()!==a.getMonth()||e.getFullYear()!==a.getFullYear()})();return(0,l.jsxs)("div",{className:"ca-shop-container",children:[(0,l.jsxs)("div",{className:"ca-shop-tabs",children:[(0,l.jsxs)("button",{onClick:()=>d("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===c?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,l.jsx)("div",{className:"label",children:"每日商店"}),E&&(0,l.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,l.jsxs)("button",{onClick:()=>d("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===c?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,l.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,l.jsxs)("button",{onClick:()=>d("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===c?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,l.jsx)("div",{className:"label",children:"等級商店"})]}),(0,l.jsxs)("button",{onClick:()=>d("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===c?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"⚡"}),(0,l.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,l.jsxs)("button",{onClick:()=>d("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===c?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,l.jsx)("div",{className:"label",children:"飛昇商店"})]}),(0,l.jsxs)("button",{onClick:()=>d("EQUIPMENT"),className:"ca-shop-tab-btn equipment ".concat("EQUIPMENT"===c?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"⚔️"}),(0,l.jsx)("div",{className:"label",children:"裝備扭蛋"})]})]}),(0,l.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===c&&(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,l.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,l.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,l.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,l.jsx)("div",{style:{fontSize:"3rem",filter:E?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#fde047"},children:"10 \uD83D\uDC8E + 500 \uD83D\uDCB0"})]}),(0,l.jsx)("button",{className:"ca-btn ".concat(E?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:E?1:.5,cursor:E?"pointer":"not-allowed",background:E?"":"#334155",color:E?"":"#64748b"},disabled:!E,onClick:()=>a("daily_checkin"),children:E?"領取獎勵":"明日再來"})]})}),"GOLD"===c&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:v(Math.floor(t.wallet.gold))}),(0,l.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(0,l.jsxs)("div",{className:"ca-shop-subtabs",style:{display:"flex",gap:"10px",marginBottom:"8px"},children:[(0,l.jsx)("button",{className:"ca-btn ".concat("UPGRADE"===p?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"UPGRADE"===p?"":"rgba(255,255,255,0.1)"},onClick:()=>u("UPGRADE"),children:"\uD83D\uDEE0️ 金幣強化"}),(0,l.jsx)("button",{className:"ca-btn ".concat("RECRUIT"===p?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"RECRUIT"===p?"":"rgba(255,255,255,0.1)"},onClick:()=>u("RECRUIT"),children:"\uD83D\uDEA9 招兵買馬"})]}),(null==n?void 0:n.upgrades)?A(n.upgrades.filter(e=>"GOLD"===e.Shop_Type).filter(e=>"RECRUIT"===p?"ADD_AUTO_DMG"===e.Effect_Type:"ADD_AUTO_DMG"!==e.Effect_Type)):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,l.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config..."})}),(0,l.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,l.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,l.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,l.jsx)(_,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:t.wallet.diamonds>=10,onClick:()=>a("gold_pack_1")}),(0,l.jsx)(_,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:t.wallet.diamonds>=80,onClick:()=>a("gold_pack_2")})]})]}),"LEVEL"===c&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:t.wallet.levelPoints}),(0,l.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"}),s&&(0,l.jsx)("button",{onClick:s,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"\uD83D\uDD04 重製點數"})]}),(0,l.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,l.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==n?void 0:n.upgrades)?N("LEVEL"):(0,l.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===c&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:h.color},children:h.name}),(0,l.jsxs)("div",{className:"ca-realm-level",children:["修練總層數 ",g]})]}),(0,l.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,l.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==n?void 0:n.upgrades)?N("CLICK"):(0,l.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===c&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c084fc 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"飛昇商店 (Permanent)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff"},children:"永恆加成"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.7)",marginTop:"4px"},children:"飛昇後不會重置的永久強化"})]}),(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:N("ASCENSION")})]}),"EQUIPMENT"===c&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",position:"relative"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"裝備扭蛋 (Gacha)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.2rem"},children:"試試你的手氣！"})]}),(0,l.jsxs)("div",{className:"ca-shop-item-grid",style:{width:"100%"},children:[(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #94a3b8"},children:[(0,l.jsx)("button",{onClick:()=>m("basic"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDCE6"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fff"},children:"基礎裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"隨機獲得裝備 (最高至 Epic)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:"含: Common, Uncommon, Rare, Epic"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(M,{label:"1 抽",cost:"1,000",onClick:()=>a("gacha_equipment_basic")}),(0,l.jsx)(M,{label:"10 抽",cost:"10,000",onClick:()=>a("gacha_equipment_basic_10")}),(0,l.jsx)(M,{label:"100 抽",cost:"100,000",onClick:()=>a("gacha_equipment_basic_100")}),(0,l.jsx)(M,{label:"1000 抽",cost:"1,000,000",onClick:()=>a("gacha_equipment_basic_1000")}),(0,l.jsxs)("div",{onClick:()=>null==o?void 0:o("basic"===r?null:"basic"),style:{padding:"12px 16px",borderRadius:"8px",background:"basic"===r?"#10b981":"rgba(255,255,255,0.1)",color:"basic"===r?"#fff":"#94a3b8",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid ".concat("basic"===r?"#4ade80":"rgba(255,255,255,0.2)"),transition:"all 0.3s",flex:"1 1 100%"},children:[(0,l.jsx)("span",{children:"basic"===r?"⏹️ 停止":"\uD83E\uDD16 自動"}),(0,l.jsx)("span",{children:"1000連抽"})]})]})]}),(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #eab308",background:"rgba(234, 179, 8, 0.05)"},children:[(0,l.jsx)("button",{onClick:()=>m("advanced"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83C\uDF81"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#facc15"},children:"高級裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"更高機率獲得稀有裝備 (最高至 Legendary)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#fef08a"},children:"含: Common ~ Legendary"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(M,{label:"1 抽",cost:"10,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced")}),(0,l.jsx)(M,{label:"10 抽",cost:"100,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced_10")}),(0,l.jsx)(M,{label:"100 抽",cost:"1,000,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced_100")}),(0,l.jsx)(M,{label:"1000 抽",cost:"10,000,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced_1000")}),(0,l.jsxs)("div",{onClick:()=>null==o?void 0:o("advanced"===r?null:"advanced"),style:{padding:"12px 16px",borderRadius:"8px",background:"advanced"===r?"#f59e0b":"rgba(255,255,255,0.1)",color:"advanced"===r?"#fff":"#94a3b8",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid ".concat("advanced"===r?"#fbbf24":"rgba(255,255,255,0.2)"),transition:"all 0.3s",flex:"1 1 100%"},children:[(0,l.jsx)("span",{children:"advanced"===r?"⏹️ 停止":"\uD83E\uDD16 自動"}),(0,l.jsx)("span",{children:"1000連抽"})]})]})]}),(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #a855f7",background:"rgba(168, 85, 247, 0.05)"},children:[(0,l.jsx)("button",{onClick:()=>m("premium"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDC8E"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#d8b4fe"},children:"頂級裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"最高機率獲得稀有裝備 (最高至 Mythic)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#e9d5ff"},children:"含: Common ~ Mythic (包含所有稀有度)"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(M,{label:"1 抽",cost:"100,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium")}),(0,l.jsx)(M,{label:"10 抽",cost:"1,000,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium_10")}),(0,l.jsx)(M,{label:"100 抽",cost:"10,000,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium_100")}),(0,l.jsx)(M,{label:"1000 抽",cost:"100,000,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium_1000")}),(0,l.jsxs)("div",{onClick:()=>null==o?void 0:o("premium"===r?null:"premium"),style:{padding:"12px 16px",borderRadius:"8px",background:"premium"===r?"#ec4899":"rgba(255,255,255,0.1)",color:"premium"===r?"#fff":"#94a3b8",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid ".concat("premium"===r?"#f472b6":"rgba(255,255,255,0.2)"),transition:"all 0.3s",flex:"1 1 100%"},children:[(0,l.jsx)("span",{children:"premium"===r?"⏹️ 停止":"\uD83E\uDD16 自動"}),(0,l.jsx)("span",{children:"1000連抽"})]})]})]})]})]})]}),x&&(0,l.jsx)(j,{gameConfig:n,onClose:()=>m(null),boxType:x})]})}function _(e){let{name:t,desc:a,icon:i,cost:s,canAfford:n,onClick:r}=e;return(0,l.jsxs)("div",{className:"ca-glass-static ca-shop-item-card",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>n&&r(),children:[(0,l.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:i}),(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:t}),(0,l.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:a}),(0,l.jsx)("div",{className:"ca-btn ".concat(n?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:n?"":"#334155",color:n?"":"#64748b",cursor:n?"pointer":"not-allowed"},children:s})]})}function C(e){let{name:t,desc:a,level:i,cost:s,canAfford:n,onClick:r,currencyLabel:o="⚡",isMaxed:c,showBulkUpgrade:d,cost25:p,canAfford25:u,onBulkUpgrade:x}=e;return(0,l.jsxs)("div",{className:"ca-upgrade-row",children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px",flex:1,minWidth:0},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:t}),(0,l.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",i]})]}),(0,l.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:a})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"6px",flexShrink:0},children:[(0,l.jsxs)("button",{onClick:()=>!c&&n&&r(),disabled:c||!n,className:"ca-upgrade-btn",style:{opacity:c||!n?.5:1,cursor:c||!n?"not-allowed":"pointer",minWidth:d?"70px":"90px",padding:"6px 8px"},children:[(0,l.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:"bold"},children:c?"已滿級":"升級"}),!c&&(0,l.jsxs)("span",{style:{fontSize:"0.6rem"},children:[o," ",v(s)]})]}),d&&!c&&(0,l.jsxs)("button",{onClick:()=>u&&x&&x(),disabled:!u,className:"ca-upgrade-btn",style:{opacity:u?1:.5,cursor:u?"pointer":"not-allowed",minWidth:"85px",padding:"6px 8px",background:u?"linear-gradient(135deg, #f59e0b, #d97706)":"rgba(255,255,255,0.1)"},children:[(0,l.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:"bold"},children:"+25級"}),(0,l.jsxs)("span",{style:{fontSize:"0.55rem"},children:[o," ",v(p||0)]})]})]})]})}function j(e){let{gameConfig:t,onClose:a,boxType:s}=e,[n,r]=i.useState(null),o=t&&t.equipments&&t.equipments.length>0,c=i.useMemo(()=>o?t.equipments.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===s||"gacha_equipment_basic"===s?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==s&&"gacha_equipment_advanced"!==s||"MYTHIC"!==t}):[],[o,t,s]),d=c.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),p={};d>0&&c.forEach(e=>{let t=Number(e.Gacha_Weight)||0;p[t]||(p[t]=[]),p[t].push(e)});let u=e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}};return(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:a,children:[(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"500px",maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#1e293b",border:"1px solid #334155",borderRadius:"16px",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"white"},children:["basic"===s?"基礎":"advanced"===s?"高級":"頂級","裝備機率一覽"]}),(0,l.jsx)("button",{onClick:a,style:{background:"none",border:"none",color:"gray",fontSize:"1.5rem",cursor:"pointer"},children:"\xd7"})]}),(0,l.jsx)("div",{style:{padding:"16px",overflowY:"auto",flex:1},children:o?Object.entries(p).sort((e,t)=>Number(t[0])-Number(e[0])).map(e=>{let[t,a]=e,i=(Number(t)/d*100).toFixed(2);return(0,l.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,l.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px",fontSize:"0.9rem",color:"#93c5fd",fontWeight:"bold"},children:["機率: ",i,"% (權重: ",t,", 共 ",a.length," 種)"]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:a.map(e=>{var t;let a=u(e.Rarity);return(0,l.jsxs)("div",{onClick:()=>r(e),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:"pointer",transition:"transform 0.1s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[(0,l.jsx)("div",{style:{width:"56px",height:"56px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem",border:"1px solid ".concat(a,"44"),boxShadow:"inset 0 0 10px ".concat(a,"22")},children:A(e.Slot)}),(0,l.jsx)("div",{style:{fontSize:"0.65rem",color:a,textAlign:"center",lineHeight:"1.2",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",fontWeight:(null==(t=e.Rarity)?void 0:t.toLowerCase())==="common"?"normal":"bold"},children:e.Name})]},e.ID)})})]},t)}):(0,l.jsxs)("div",{style:{textAlign:"center",color:"var(--ca-text-muted)",padding:"20px"},children:["暫無裝備資料",(0,l.jsx)("br",{}),(0,l.jsx)("span",{style:{fontSize:"0.8rem"},children:"請檢查 Google Sheet 設定或重新載入"})]})})]}),n&&(0,l.jsx)(S,{item:n,onClose:()=>r(null)})]})}function S(e){let{item:t,onClose:a}=e,i=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(t.Rarity);return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:10001,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:a,children:(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(i,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(i,"22")},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(i,"44")},children:A(t.Slot)}),(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:i},children:t.Name}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:i,fontWeight:"bold"},children:t.Rarity}),(0,l.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:t.Slot})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,l.jsx)("div",{style:{color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:"裝備初始屬性:"}),(0,l.jsx)("div",{children:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=(Number(t.Base_Val)||0)+(a-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",v(l))}(t.Desc_Template,t,1)}),(0,l.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"單件提升戰力 (Est. CP)"}),(0,l.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",v(function(e,t){let a=(Number(e.Base_Val)||0)+0*(Number(e.Level_Mult)||0),l=String(e.Effect_Type||"").toUpperCase().trim();return["ADD_BASE_DMG","CLICK_DMG","ADD_DAMAGE","CLICK_DAMAGE","ADD_CLICK_DMG"].includes(l)?Math.floor(10*a):["ADD_AUTO_DMG","AUTO_DMG","AUTO_DAMAGE","ADD_AUTO"].includes(l)?Math.floor(20*a):["ADD_CRIT_CHANCE","CRIT_RATE","ADD_CRIT_RATE","LUCK","ADD_CRIT"].includes(l)?Math.floor(10*a):["ADD_CRIT_DMG","CRIT_DMG","CRIT_DAMAGE","ADD_CRIT_DMG"].includes(l)?Math.floor(5*a):0}(t,0))]})]})]}),(0,l.jsx)("button",{className:"ca-btn",onClick:a,style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"},children:"返回"})]})})}function A(e){switch(e){case"MAIN_HAND":return"⚔️";case"HEAD":return"\uD83E\uDE96";case"BODY":return"\uD83D\uDC55";case"HANDS":return"\uD83E\uDDE4";case"LEGS":return"\uD83D\uDC62";case"RELIC":return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function M(e){let{label:t,cost:a,onClick:i,color:s="#22d3ee"}=e;return(0,l.jsxs)("button",{className:"ca-btn ca-btn-primary",style:{padding:"12px 16px",fontSize:"1rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flex:1,borderColor:s,background:"linear-gradient(to bottom, rgba(0,0,0,0) 0%, ".concat(s,"22 100%)")},onClick:i,children:[(0,l.jsx)("span",{children:t}),(0,l.jsxs)("span",{style:{background:"rgba(0,0,0,0.2)",padding:"2px 8px",borderRadius:"12px",fontSize:"0.8rem",color:s},children:["\uD83D\uDCB0 ",a]})]})}function N(e){var t,a,s;let{player:n,effectiveStats:r,combatPower:o,userId:c,onLogin:p,onLogout:u,onManualSave:x,gameConfig:m}=e,{system:g,wallet:h,records:f}=n,[D,b]=i.useState(""),[v,y]=i.useState(!1),_=async()=>{if(!v){y(!0);try{await x()}finally{y(!1)}}},C=e=>d(Math.floor(e||0),2,1e3),j=e=>"".concat((100*e).toFixed(1),"%"),S=e=>{let t=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return t>0?"".concat(t,"h ").concat(a,"m ").concat(l,"s"):a>0?"".concat(a,"m ").concat(l,"s"):"".concat(l,"s")},A=(null==(t=n.activeBuffs)?void 0:t.ragePotionExpiresAt)>Date.now(),M=Math.max(0,Math.floor(((null==(a=n.activeBuffs)?void 0:a.ragePotionExpiresAt)-Date.now())/1e3));return(0,l.jsxs)("div",{className:"ca-profile-page",style:{paddingBottom:"20px"},children:[(0,l.jsx)("div",{className:"ca-profile-section",children:(0,l.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,l.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(c||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,l.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",g.level]})]}),(0,l.jsx)("div",{className:"ca-profile-summary",children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("span",{children:["勇者 ",c]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsx)("button",{onClick:_,className:"ca-profile-action-btn",style:{background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",cursor:v?"wait":"pointer",opacity:v?.7:1},children:v?"上傳中":"上傳"}),(0,l.jsx)("button",{onClick:u,className:"ca-profile-action-btn",style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5"},children:"登出"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-cp",children:[(0,l.jsx)("span",{className:"label",children:"戰鬥力"}),(0,l.jsx)("span",{className:"value",children:C(o)})]}),(0,l.jsxs)("div",{className:"ca-profile-exp",children:[(0,l.jsxs)("div",{className:"info",children:[(0,l.jsx)("span",{children:"EXP"}),(0,l.jsxs)("span",{children:[C(g.currentXp)," /"," ",C(g.requiredXp)]})]}),(0,l.jsx)("div",{className:"bar-bg",children:(0,l.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,g.currentXp/g.requiredXp*100),"%")}})})]})]}):(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",width:"100%",minWidth:0},children:[(0,l.jsx)("div",{style:{fontSize:"0.85rem",color:"var(--ca-text-secondary)",fontWeight:"600"},children:"輸入 ID 以讀取/建立存檔"}),(0,l.jsxs)("div",{style:{display:"flex",gap:"6px",width:"100%"},children:[(0,l.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,minWidth:0,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.15)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"0.9rem",outline:"none"},placeholder:"User ID...",value:D,onChange:e=>b(e.target.value)}),(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"0 16px",fontSize:"0.85rem",height:"auto",whiteSpace:"nowrap",flexShrink:0,borderRadius:"8px"},onClick:()=>D.trim()&&p(D.trim()),children:"讀取"})]})]})})]})}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"財富狀態"}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",background:"rgba(15, 23, 42, 0.4)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.05)"},children:[(0,l.jsx)(E,{icon:"\uD83D\uDCB0",label:"金幣",value:C(h.gold),color:"#fbbf24"}),(0,l.jsx)(E,{icon:"\uD83D\uDC8E",label:"鑽石",value:C(h.diamonds),color:"#38bdf8"}),(0,l.jsx)(E,{icon:"✨",label:"點擊點數",value:C(h.clickPoints),color:"#c084fc"}),(0,l.jsx)(E,{icon:"⚡",label:"飛昇點數",value:C(h.ascensionPoints),color:"#f472b6"}),(0,l.jsx)(E,{icon:"\uD83D\uDCDC",label:"等級積分",value:C(h.levelPoints),color:"#60a5fa"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"最終戰鬥屬性 (含裝備加成)"}),(0,l.jsxs)("div",{className:"ca-stats-grid",children:[(0,l.jsx)(I,{label:"點擊基礎傷害",value:C(r.baseDamage),icon:"⚔️"}),(0,l.jsx)(I,{label:"夥伴秒傷 (Ally DPS)",value:C(r.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,l.jsx)(I,{label:"爆擊機率",value:j(r.criticalChance),icon:"\uD83C\uDFAF"}),(0,l.jsx)(I,{label:"爆擊傷害",value:j(r.criticalDamage),icon:"\uD83D\uDCA5"}),(0,l.jsx)(I,{label:"金幣獲取倍率",value:"".concat(r.goldMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCB0"}),(0,l.jsx)(I,{label:"經驗獲取倍率",value:"".concat(r.xpMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCD6"}),(0,l.jsx)(I,{label:"BOSS 傷害加成",value:"".concat(r.bossDamageMultiplier.toFixed(2),"x"),icon:"\uD83D\uDC79"}),(0,l.jsx)(I,{label:"點擊點數倍率",value:"".concat(r.cpMultiplier.toFixed(2),"x"),icon:"✨"}),(0,l.jsx)(I,{label:"自動點擊 (每秒)",value:"".concat(r.autoClickPerSec.toFixed(1)," 次"),icon:"⚡"}),(0,l.jsx)(I,{label:"關卡目標減少",value:"-".concat(C(r.monsterKillReduction)," 隻"),icon:"\uD83D\uDCC9"}),(0,l.jsx)(I,{label:"稀有怪出現機率",value:j(r.rareMonsterChance),icon:"\uD83C\uDF1F"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"當前狀態 / 藥水"}),(0,l.jsx)("div",{className:"ca-glass-static",style:{padding:"12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:A?(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[(0,l.jsx)("span",{style:{fontSize:"1.4rem"},children:"\uD83E\uDDEA"}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.95rem"},children:"狂暴藥水 (Rage Potion)"}),(0,l.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:["剩餘時間:"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:S(M)})]})]}),(0,l.jsx)("div",{className:"ca-pulse",style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 10px #ef4444"}})]}):(0,l.jsx)("div",{style:{color:"var(--ca-text-muted)",fontSize:"0.85rem",textAlign:"center",padding:"10px"},children:"尚無啟用的增益效果"})})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"生涯冒險記錄"}),(0,l.jsxs)("div",{className:"ca-records-list ca-glass-static",style:{borderRadius:"12px"},children:[(0,l.jsx)(T,{label:"\uD83C\uDFAE 遊戲總點擊",value:C(f.totalClicks)}),(0,l.jsx)(T,{label:"⚔️ 累計總傷害",value:C(f.totalDamageDealt)}),(0,l.jsx)(T,{label:"\uD83D\uDC7E 擊敗怪物數",value:C(f.monstersKilled)}),(0,l.jsx)(T,{label:"\uD83D\uDE08 擊敗 BOSS 數",value:C(f.bossesKilled)}),(0,l.jsx)(T,{label:"\uD83D\uDCCD 歷史最高關卡",value:"第 ".concat(C(f.maxStageReached)," 關")}),(0,l.jsx)(T,{label:"\uD83D\uDC8E 累計儲蓄/金幣",value:C(f.totalGoldEarned)}),(0,l.jsx)(T,{label:"⏳ 生涯遊玩時間",value:S(f.playtimeSeconds)})]})]}),(0,l.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.7rem",opacity:.6},children:[(0,l.jsxs)("div",{children:["遊戲版本: ",String((null==m||null==(s=m.settings)?void 0:s.GAME_VERSION)||"1.0.0")]}),(0,l.jsx)("div",{style:{marginTop:"4px"},children:"Click Ascension Project \xa9 2026"})]})]})}function E(e){let{icon:t,label:a,value:i,color:s}=e;return(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("span",{style:{fontSize:"1rem"},children:t}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)("span",{style:{fontSize:"0.6rem",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:a}),(0,l.jsx)("span",{style:{fontSize:"0.85rem",color:s,fontWeight:"bold"},children:i})]})]})}function I(e){let{label:t,value:a,icon:i}=e;return(0,l.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,l.jsx)("div",{className:"ca-stat-icon",children:i}),(0,l.jsxs)("div",{className:"ca-stat-content",children:[(0,l.jsx)("div",{className:"ca-stat-label",children:t}),(0,l.jsx)("div",{className:"ca-stat-value",children:a})]})]})}function T(e){let{label:t,value:a}=e;return(0,l.jsxs)("div",{className:"ca-record-row",children:[(0,l.jsx)("span",{className:"ca-record-label",children:t}),(0,l.jsx)("span",{className:"ca-record-value",children:a})]})}function w(e){switch(null==e?void 0:e.toLowerCase()){case"common":default:return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b"}}function L(e){let{item:t,onClose:a,onEquip:i,onUnequip:s,isEquipped:n}=e,{config:r,level:o}=t,c=w(r.Rarity);return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(c,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(c,"22")},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(c,"44")},children:R(r.Slot)}),(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:c},children:r.Name}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:c,fontWeight:"bold"},children:r.Rarity}),(0,l.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:r.Slot})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:[(0,l.jsxs)("span",{children:["當前屬性 (Lv.",o,"/",r.Max_Level||"??","):"]}),o>=(r.Max_Level||99)&&(0,l.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold"},children:"MAX"})]}),(0,l.jsx)("div",{children:function(e,t,a){let l=(Number(t.Base_Val)||0)+(a-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",d(l,2,1e3))}(r.Desc_Template,r,o)}),(0,l.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"戰力加成 (Est. CP)"}),(0,l.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",d(function(e,t){let a=(Number(e.Base_Val)||0)+(t-1)*(Number(e.Level_Mult)||0),l=String(e.Effect_Type||"").toUpperCase().trim();return["ADD_BASE_DMG","CLICK_DMG","ADD_DAMAGE","CLICK_DAMAGE","ADD_CLICK_DMG"].includes(l)?Math.floor(10*a):["ADD_AUTO_DMG","AUTO_DMG","AUTO_DAMAGE","ADD_AUTO"].includes(l)?Math.floor(20*a):["ADD_CRIT_CHANCE","CRIT_RATE","ADD_CRIT_RATE","LUCK","ADD_CRIT"].includes(l)?Math.floor(10*a):["ADD_CRIT_DMG","CRIT_DMG","CRIT_DAMAGE","ADD_CRIT_DMG"].includes(l)?Math.floor(5*a):0}(r,o),2,1e3)]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"8px"},children:[n?(0,l.jsx)("button",{className:"ca-btn",onClick:()=>{s(r.Slot),a()},style:{flex:1,background:"#ef4444",color:"white",fontWeight:"bold"},children:"卸下"}):(0,l.jsx)("button",{className:"ca-btn",onClick:()=>{i(t.id,r.Slot),a()},style:{flex:1,background:"var(--ca-accent-gold)",color:"black",fontWeight:"bold"},children:"裝備"}),(0,l.jsx)("button",{className:"ca-btn",onClick:a,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"關閉"})]})]})})}function k(e){var t;let{player:a,effectiveStats:s,userId:r,gameConfig:o,onEquip:c,onUnequip:p}=e,[u,x]=i.useState(null),m=Object.entries((null==(t=a.equipment)?void 0:t.inventory)||{}).filter(e=>{let[,t]=e;return t>0}).map(e=>{var t;let[a,l]=e;return{id:a,level:l,config:null==o||null==(t=o.equipments)?void 0:t.find(e=>String(e.ID)===String(a))}}).filter(e=>!!e.config),g=i.useMemo(()=>{var e;let t={baseDamage:0,criticalChance:0,criticalDamage:0,goldMultiplier:0,xpMultiplier:0,autoAttackDamage:0};return(null==o?void 0:o.equipments)&&Object.values((null==(e=a.equipment)?void 0:e.equipped)||{}).forEach(e=>{var l,i;if(!e)return;let s=o.equipments.find(t=>String(t.ID)===String(e));if(!s)return;let n=Number((null==(i=a.equipment)||null==(l=i.inventory)?void 0:l[e])||1),r=Number(s.Base_Val||0)+(n-1)*Number(s.Level_Mult||0);switch(String(s.Effect_Type||"").toUpperCase().trim()){case"ADD_BASE_DMG":case"CLICK_DMG":case"CLICK_DAMAGE":case"ADD_DAMAGE":case"ADD_CLICK_DMG":t.baseDamage+=r;break;case"ADD_AUTO_DMG":case"AUTO_DMG":case"AUTO_DAMAGE":t.autoAttackDamage+=r;break;case"ADD_CRIT_CHANCE":case"CRIT_RATE":t.criticalChance+=r/100;break;case"ADD_CRIT_DMG":case"CRIT_DMG":t.criticalDamage+=r/100;break;case"ADD_GOLD_MULT":case"GOLD_MULT":t.goldMultiplier+=r/100;break;case"ADD_XP_MULT":case"XP_MULT":t.xpMultiplier+=r/100}}),t},[a.equipment,o]);return(0,l.jsxs)("div",{className:"ca-character-view",style:{flex:1,display:"flex",flexDirection:"column",width:"100%",height:"100%",padding:"12px",overflow:"hidden"},children:[(0,l.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"relative",paddingBottom:"12px"},children:[(0,l.jsxs)("div",{style:{width:"100%",maxWidth:"500px",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"8px",zIndex:10,padding:"0 4px"},children:[(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"⚔️"}),(0,l.jsx)("span",{className:"ca-stat-value",children:d(Math.floor(s.baseDamage),2,1e3)}),g.baseDamage>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",d(g.baseDamage,2,1e3),")"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83C\uDFAF"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*s.criticalChance).toFixed(1),"%"]}),g.criticalChance>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(100*g.criticalChance).toFixed(1),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83E\uDD16"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[Number(s.autoClickPerSec||0).toFixed(1),"/s"]}),s.autoClickPerSec>a.stats.autoClickPerSec&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(s.autoClickPerSec-a.stats.autoClickPerSec).toFixed(1),")"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCA5"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*s.criticalDamage).toFixed(0),"%"]}),g.criticalDamage>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(100*g.criticalDamage).toFixed(0),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCB0"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*s.goldMultiplier).toFixed(0),"%"]}),g.goldMultiplier>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(100*g.goldMultiplier).toFixed(0),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDC79"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*s.bossDamageMultiplier).toFixed(0),"%"]}),s.bossDamageMultiplier>a.stats.bossDamageMultiplier&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((s.bossDamageMultiplier-a.stats.bossDamageMultiplier)*100).toFixed(0),"%)"]})]})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr 60px",width:"100%",maxWidth:"500px",alignItems:"center",zIndex:2,padding:"0 4px",minHeight:"200px",margin:"0 auto"},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(P,{slot:n.MAIN_HAND,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(P,{slot:n.HEAD,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(P,{slot:n.BODY,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}})]}),(0,l.jsxs)("div",{className:"ca-character-figure",style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(r||"Guest"),alt:"Character",style:{width:"110px",height:"110px",filter:"drop-shadow(0 10px 20px rgba(0,0,0,0.5))"}}),(0,l.jsxs)("div",{className:"ca-glass",style:{marginTop:"4px",padding:"2px 10px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(15, 23, 42, 0.6)"},children:[(0,l.jsxs)("span",{style:{fontSize:"0.9rem"},children:["Lv.",a.system.level]}),(0,l.jsx)("span",{style:{width:"1px",height:"10px",background:"rgba(255,255,255,0.2)"}}),(0,l.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold",fontSize:"0.8rem"},children:r||"Guest"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(P,{slot:n.HANDS,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(P,{slot:n.LEGS,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(P,{slot:n.RELIC,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}})]})]}),(0,l.jsx)("div",{style:{position:"absolute",top:"55%",left:"50%",transform:"translate(-50%, -50%)",width:"220px",height:"220px",background:"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",pointerEvents:"none",zIndex:0}})]}),(0,l.jsxs)("div",{style:{flex:"1 1 0px",width:"100%",background:"rgba(15, 23, 42, 0.4)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden",minHeight:"0"},children:[(0,l.jsxs)("div",{style:{padding:"8px 12px",background:"rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[(0,l.jsxs)("span",{style:{fontWeight:"bold",color:"#e2e8f0",fontSize:"0.9rem"},children:["\uD83C\uDF92 裝備倉庫 (",m.length,")"]}),(0,l.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--ca-text-muted)"},children:"點擊裝備以穿戴"})]}),(0,l.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px"},children:0===m.length?(0,l.jsx)("div",{style:{textAlign:"center",color:"gray",padding:"20px 0",fontSize:"0.8rem"},children:"倉庫空空如也..."}):(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(56px, 1fr))",gap:"8px"},children:m.map(e=>{var t;let i=Object.values((null==(t=a.equipment)?void 0:t.equipped)||{}).includes(e.id),s=w(e.config.Rarity);return(0,l.jsxs)("div",{onClick:()=>x(e),className:"ca-inventory-item",style:{width:"56px",height:"56px",background:"rgba(30, 41, 59, 0.6)",border:"2px solid ".concat(s),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",opacity:i?1:.8,boxShadow:i?"0 0 10px #22c55e, inset 0 0 5px #22c55e":"none"},title:"".concat(e.config.Name," (Lv.").concat(e.level,") - ").concat(e.config.Slot),children:[(0,l.jsx)("span",{style:{fontSize:"1.5rem"},children:R(e.config.Slot)}),(0,l.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"4px",fontWeight:"bold"},children:["L.",e.level]}),i&&(0,l.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",background:"#22c55e",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"3px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"E"})]},e.id)})})})]}),u&&(0,l.jsx)(L,{item:u,onClose:()=>x(null),onEquip:c,onUnequip:p,isEquipped:Object.values(a.equipment.equipped).includes(u.id)})]})}function R(e){switch(e){case n.MAIN_HAND:return"⚔️";case n.HEAD:return"\uD83E\uDE96";case n.BODY:return"\uD83D\uDC55";case n.HANDS:return"\uD83E\uDDE4";case n.LEGS:return"\uD83D\uDC62";case n.RELIC:return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function P(e){var t,a,i,s,n;let{slot:r,player:o,gameConfig:c,onClick:d}=e,p=null==(a=o.equipment)||null==(t=a.equipped)?void 0:t[r],u=p?null==c||null==(i=c.equipments)?void 0:i.find(e=>String(e.ID)===String(p)):null,x=p?(null==(n=o.equipment)||null==(s=n.inventory)?void 0:s[p])||1:0,m=u?w(u.Rarity):"rgba(255,255,255,0.1)";return(0,l.jsxs)("div",{className:"ca-equipment-slot",style:{width:"54px",height:"54px",background:"rgba(15, 23, 42, 0.6)",border:u?"2px solid ".concat(m):"1px dashed rgba(255,255,255,0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",transition:"all 0.2s",boxShadow:u?"0 0 15px ".concat(m,"44"):"none"},onClick:()=>p&&(null==d?void 0:d(p)),title:u?"".concat(u.Name," (Lv.").concat(x,")"):"Empty Slot",children:[(0,l.jsx)("div",{style:{fontSize:"1.6rem",opacity:u?1:.3},children:R(r)}),u&&(0,l.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"6px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.2)"},children:["Lv.",x]})]})}var G=a(23464);let O="https://script.google.com/macros/s/AKfycbxegFPp4kJZXDxUNqQopqiWVa2JLLM__rJbm700mUQsovg2nkE6wSJd2lFQyJQ4dg10/exec",U={loadPlayerSave:async e=>{try{let t=await G.A.get("".concat(O,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(t.data&&t.data.exists)return t.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,t)=>{try{if(!e)throw Error("User ID is required for saving");let a=await G.A.post(O,{action:"save_progress",userId:e,saveData:t},{headers:{"Content-Type":"text/plain"}});if(a.data&&a.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await G.A.get("".concat(O,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},B={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0,ascensionPoints:0,equipmentShards:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,bossDamageMultiplier:1,autoClickPerSec:1,monsterKillReduction:0,rareMonsterChance:0},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{},levelShop:{},goldShop:{},ascensionShop:{},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0},equipment:{inventory:{},equipped:{}},lastDailyRewardClaimTime:0},z={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,autoUsePotion:!1,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10,bossTimeLeft:null,bossTimeLimit:60};function q(){let[e,t]=(0,i.useState)(null),[a,n]=(0,i.useState)("BATTLE"),[r,c]=(0,i.useState)(B),[p,x]=(0,i.useState)(z),[m,g]=(0,i.useState)(null),[b,v]=(0,i.useState)(null),[_,C]=(0,i.useState)(null),[j,S]=(0,i.useState)(null),[A,M]=(0,i.useState)(null),[E,I]=(0,i.useState)(null),T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"系統提示",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return M({title:t,message:e,isAutoGacha:a,gachaResults:l})},w=i.useMemo(()=>{var e,t,a,l;let i={baseDamage:r.stats.baseDamage||1,autoAttackDamage:0,criticalChance:r.stats.criticalChance||.05,criticalDamage:r.stats.criticalDamage||1.5,goldMultiplier:r.stats.goldMultiplier||1,cpMultiplier:r.stats.cpMultiplier||1,xpMultiplier:r.stats.xpMultiplier||1,bossDamageMultiplier:r.stats.bossDamageMultiplier||1,autoClickPerSec:r.stats.autoClickPerSec||1,monsterKillReduction:r.stats.monsterKillReduction||0,rareMonsterChance:r.stats.rareMonsterChance||0};return(null==b?void 0:b.equipments)&&(Object.values(r.equipment.equipped).forEach(e=>{if(!e)return;let t=b.equipments.find(t=>String(t.ID)===String(e));if(t){let a=Number(r.equipment.inventory[e]||1),l=Number(t.Base_Val||0)+(a-1)*Number(t.Level_Mult||0);switch(String(t.Effect_Type||"").toUpperCase().trim()){case"ADD_BASE_DMG":case"CLICK_DMG":case"CLICK_DAMAGE":case"ADD_DAMAGE":case"ADD_CLICK_DMG":i.baseDamage+=l;break;case"ADD_AUTO_DMG":case"AUTO_DMG":case"AUTO_DAMAGE":case"ADD_AUTO":i.autoAttackDamage+=l;break;case"ADD_CRIT_CHANCE":case"CRIT_RATE":case"ADD_CRIT_RATE":case"LUCK":i.criticalChance+=l/100;break;case"ADD_CRIT_DMG":case"CRIT_DMG":case"CRIT_DAMAGE":case"ADD_CRIT_DMG":i.criticalDamage+=l/100;break;case"ADD_GOLD_MULT":case"GOLD_MULT":case"ADD_GOLD":case"GOLD_BONUS":case"ADD_GOLD_MULT":i.goldMultiplier+=l/100;break;case"ADD_XP_MULT":case"XP_MULT":case"ADD_XP":case"XP_BONUS":case"ADD_XP_MULT":i.xpMultiplier+=l/100;break;case"ADD_BOSS_DMG":case"BOSS_DMG":case"BOSS_DAMAGE":i.bossDamageMultiplier+=l/100;break;case"CP_MULT":case"CP_BONUS":case"ADD_CP_MULT":i.cpMultiplier+=l/100;break;case"REDUCE_GOAL_V":case"REDUCE_STAGE_GOAL":i.monsterKillReduction+=l;break;case"RARE_CHANCE_P":case"RARE_SPAWN_CHANCE":case"RARE_CHANCE":i.rareMonsterChance+=l/100;break;case"AUTO_CLICK_V":case"AUTO_CLICK_CPS":i.autoClickPerSec+=l}}}),((null==b||null==(e=b.upgrades)?void 0:e.filter(e=>"GOLD"===e.Shop_Type))||[]).forEach(e=>{let t=e.ID,a=r.goldShop[t]||0;if(a<=0)return;let l=String(e.Effect_Type||"").toUpperCase().trim(),s=Math.pow(2,Math.floor(a/25)),n=Number(e.Effect_Val||0)*a*s;("ADD_DAMAGE"===l||"CLICK_DMG"===l||"ADD_BASE_DMG"===l)&&(i.baseDamage+=n),("ADD_AUTO_DMG"===l||"AUTO_DMG"===l||"ADD_AUTO"===l)&&(i.autoAttackDamage+=n),("ADD_GOLD_MULT"===l||"GOLD_MULT"===l||"ADD_GOLD"===l)&&(i.goldMultiplier+=n/100),("ADD_CRIT_DMG"===l||"CRIT_DMG"===l||"ADD_CRIT_DAMAGE"===l)&&(i.criticalDamage+=n/100)}),((null==b||null==(t=b.upgrades)?void 0:t.filter(e=>"LEVEL"===e.Shop_Type))||[]).forEach(e=>{let t=e.ID,a=r.levelShop[t]||0;if(a<=0)return;let l=String(e.Effect_Type||"").toUpperCase().trim(),s=Number(e.Effect_Val||0)*a;("ADD_XP_MULT"===l||"XP_MULT"===l)&&(i.xpMultiplier+=s/100),("ADD_GOLD_MULT"===l||"GOLD_MULT"===l||"ADD_GOLD"===l)&&(i.goldMultiplier+=s/100),("ADD_BASE_DMG"===l||"ADD_DAMAGE"===l)&&(i.baseDamage+=s),("ADD_CRIT_CHANCE"===l||"CRIT_RATE"===l)&&(i.criticalChance+=s/100),("ADD_CRIT_DMG"===l||"CRIT_DMG"===l)&&(i.criticalDamage+=s/100)}),((null==b||null==(a=b.upgrades)?void 0:a.filter(e=>"CLICK"===e.Shop_Type))||[]).forEach(e=>{let t=e.ID,a=r.clickShop[t]||0;if(a<=0)return;let l=String(e.Effect_Type||"").toUpperCase().trim(),s=Number(e.Effect_Val||0)*a;("ADD_BASE_DMG"===l||"ADD_DAMAGE"===l||"CLICK_DMG"===l)&&(i.baseDamage+=s),("ADD_CRIT_DMG"===l||"CRIT_DMG"===l||"ADD_CRIT_DAMAGE"===l)&&(i.criticalDamage+=s/100),("ADD_GOLD_MULT"===l||"GOLD_MULT"===l)&&(i.goldMultiplier+=s/100),("ADD_XP_MULT"===l||"XP_MULT"===l)&&(i.xpMultiplier+=s/100)}),((null==b||null==(l=b.upgrades)?void 0:l.filter(e=>"ASCENSION"===e.Shop_Type))||[]).forEach(e=>{let t=e.ID,a=r.ascensionShop[t]||0;if(a<=0)return;let l=String(e.Effect_Type||"").toUpperCase().trim(),s=Number(e.Effect_Val||0)*a;("ADD_XP_MULT"===l||"XP_MULT"===l)&&(i.xpMultiplier+=s/100),("ADD_GOLD_MULT"===l||"GOLD_MULT"===l||"ADD_GOLD"===l)&&(i.goldMultiplier+=s/100),("ADD_ATK_P"===l||"ATK_MULT"===l||"ADD_DAMAGE_MULT"===l)&&(i.baseDamage+=i.baseDamage*(s/100)),("RARE_CHANCE_P"===l||"RARE_SPAWN_CHANCE"===l)&&(i.rareMonsterChance+=s/100),("REDUCE_GOAL_V"===l||"REDUCE_STAGE_GOAL"===l)&&(i.monsterKillReduction+=s),("AUTO_CLICK_V"===l||"AUTO_CLICK_CPS"===l)&&(i.autoClickPerSec+=s)})),i},[r.stats,r.equipment.equipped,r.equipment.inventory,r.goldShop,r.levelShop,r.clickShop,r.ascensionShop,b]),L=(0,i.useCallback)((e,t)=>{var a,l,i,s;return{...e,...t,system:{...e.system,...t.system||{}},wallet:{...e.wallet,...t.wallet||{}},stats:{...e.stats,...t.stats||{}},records:{...e.records,...t.records||{}},clickShop:{...e.clickShop,...t.clickShop||{}},levelShop:{...e.levelShop,...t.levelShop||{}},goldShop:{...e.goldShop,...t.goldShop||{}},ascensionShop:{...e.ascensionShop,...t.ascensionShop||{}},inventory:{...e.inventory,...t.inventory||{}},activeBuffs:{...e.activeBuffs,...t.activeBuffs||{}},equipment:{...e.equipment,...t.equipment||{},inventory:{...(null==(a=e.equipment)?void 0:a.inventory)||{},...(null==(l=t.equipment)?void 0:l.inventory)||{}},equipped:{...(null==(i=e.equipment)?void 0:i.equipped)||{},...(null==(s=t.equipment)?void 0:s.equipped)||{}}}}},[]),R=w.autoAttackDamage,P=Math.floor(10*w.baseDamage+20*R+1e3*w.criticalChance+500*w.criticalDamage);(0,i.useEffect)(()=>{b&&(console.log("[Recalc] GameConfig loaded, refreshing stats..."),c(e=>({...e,stats:Z(e)})))},[b]),(0,i.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await U.getGameConfigs();e&&(console.log("[Config] Loaded:",e),v(e),function(e){if(!e)return console.log("[NumberFormat] 無設定資料，使用預設模式: LETTER");let t=String(e.NUMBER_FORMAT||"LETTER").toUpperCase().trim();"LETTER"===t||"SCIENTIFIC"===t||"CHINESE"===t?o(t):(console.warn("[NumberFormat] 未知的格式設定: ".concat(t,"，使用預設模式: LETTER")),o("LETTER"))}(e.settings))})();let e=localStorage.getItem("ca_last_user_id");e&&F(e)},[]);let G=(0,i.useCallback)(()=>{let e=p.isBossActive,t=Math.max(1,p.monstersRequiredForBoss-(w.monsterKillReduction||0)),a=p.currentStageId<p.maxStageReached,l=p.autoChallengeBoss||a;!e&&l&&p.monstersKilledInStage>=t?(e=!0,x(e=>({...e,isBossActive:!0,bossTimeLeft:e.bossTimeLimit}))):e&&null===p.bossTimeLeft&&x(e=>({...e,bossTimeLeft:e.bossTimeLimit}));let i=X(p.currentStageId,e,b),s=Math.ceil((20*Math.pow(1.18,p.currentStageId-1)+10*p.currentStageId)*i.hpMultiplier),n=.15*s*i.goldMultiplier,r=.08*s*i.xpMultiplier;g({id:crypto.randomUUID(),configId:i.configId,name:"".concat(i.name," Lv.").concat(p.currentStageId),level:p.currentStageId,maxHp:s,currentHp:s,isBoss:"BOSS"===i.rarity,rewardGold:Math.max(1,Math.floor(n)),rewardXp:Math.max(1,Math.floor(r)),emoji:i.emoji,note:i.note})},[p,w.monsterKillReduction]),[O,q]=(0,i.useState)(null);(0,i.useEffect)(()=>{m||G()},[m,G]),(0,i.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&F(e)},[]);let W=i.useRef(r),K=i.useRef(p),H=i.useRef(new Set);(0,i.useEffect)(()=>{W.current=r,K.current=p},[r,p]),(0,i.useEffect)(()=>{let e;return p.isBossActive&&m&&m.isBoss&&(null===p.bossTimeLeft||void 0===p.bossTimeLeft?x(e=>({...e,bossTimeLeft:e.bossTimeLimit||60})):p.bossTimeLeft>0?e=setInterval(()=>{x(e=>{var t,a;return{...e,bossTimeLeft:(null!=(t=e.bossTimeLeft)?t:0)>0?(null!=(a=e.bossTimeLeft)?a:0)-1:0}})},1e3):0===p.bossTimeLeft&&(x(e=>({...e,isBossActive:!1,autoChallengeBoss:!1,bossTimeLeft:null})),g(null),T("挑戰失敗！Boss 挑戰時間超時，已回到關卡掛機模式並關閉自動挑戰。","挑戰失敗"))),()=>{e&&clearInterval(e)}},[p.isBossActive,p.bossTimeLeft,null==m?void 0:m.id,null==m?void 0:m.isBoss]),(0,i.useEffect)(()=>{if(!O)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(O," to Cloud..."));let e={player:W.current,stage:K.current,timestamp:Date.now()};try{await U.savePlayerProgress(O,e),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}catch(t){console.warn("[AutoSave] Cloud save failed, using local backup",t),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[O]),(0,i.useEffect)(()=>{if(!p.autoUsePotion||r.inventory.ragePotionCount<=0)return;let e=setInterval(()=>{Date.now()>=(r.activeBuffs.ragePotionExpiresAt||0)&&r.inventory.ragePotionCount>0&&Q("RAGE")},1e3);return()=>clearInterval(e)},[p.autoUsePotion,r.inventory.ragePotionCount,r.activeBuffs.ragePotionExpiresAt]),(0,i.useEffect)(()=>{if(!E)return;let e=setInterval(()=>{if(r.wallet.gold<({basic:1e6,advanced:1e7,premium:1e8})[E]){I(null),T("金幣不足，已停止自動連續抽卡。");return}J("gacha_equipment_".concat(E,"_1000"))},1e3);return()=>clearInterval(e)},[E,r.wallet.gold]);let F=async e=>{if(!e)return;q(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let t=await U.loadPlayerSave(e);if(t){console.log("[Login] Cloud save found!"),t.player&&c(e=>L(e,t.player)),t.stage&&x(e=>({...e,...t.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let t=localStorage.getItem("ca_save_".concat(e));if(t){console.log("[Login] Found local backup.");try{let e=JSON.parse(t);c(t=>({...t,...e.player})),x(t=>({...t,...e.stage}))}catch(e){}}};(0,i.useEffect)(()=>{let e=setInterval(()=>{c(e=>({...e,records:{...e.records,playtimeSeconds:(e.records.playtimeSeconds||0)+1}}))},1e3);return()=>clearInterval(e)},[]);let V=async()=>{if(!O)return;let e={player:r,stage:p,timestamp:Date.now()};try{await U.savePlayerProgress(O,e),T("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}catch(t){console.error("Save failed",t),T("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}};(0,i.useEffect)(()=>{if(!m||m.currentHp<=0||w.autoAttackDamage<=0)return;let e=setInterval(()=>{var e;let t=w.autoAttackDamage,a=m.isBoss&&w.bossDamageMultiplier||1,l=Math.ceil(t*a);g(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-l;return t<=0?(setTimeout(()=>Y(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),c(e=>{let t=+w.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalDamageDealt:e.records.totalDamageDealt+l}}});let i={},s=0;((null==b||null==(e=b.upgrades)?void 0:e.filter(e=>"GOLD"===e.Shop_Type&&"ADD_AUTO_DMG"===e.Effect_Type))||[]).forEach(e=>{let t=e.ID,l=r.goldShop[t]||0;if(l<=0)return;let n=Math.pow(2,Math.floor(l/25)),o=Number(e.Effect_Val||0)*l*n;i[t]=Math.ceil(o*a),s+=o}),i.player=Math.ceil(Math.max(0,w.autoAttackDamage-s)*a),C({time:Date.now(),damage:l,breakdown:i})},1e3);return()=>clearInterval(e)},[null==m?void 0:m.id,w.autoAttackDamage,w.bossDamageMultiplier,w.cpMultiplier,r.goldShop,b]),(0,i.useEffect)(()=>{let e=w.autoClickPerSec||0;if(e<=0||!m||m.currentHp<=0)return;let t=setInterval(()=>{var e,t;let a=Math.random()<w.criticalChance,l=((null==(t=W.current)||null==(e=t.activeBuffs)?void 0:e.ragePotionExpiresAt)||0)>Date.now(),i=a?Math.floor(w.baseDamage*w.criticalDamage):w.baseDamage;l&&(i*=2);let s=i;m.isBoss&&(s=Math.ceil(i*(w.bossDamageMultiplier||1))),g(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-s;return t<=0?(setTimeout(()=>Y(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),c(e=>{let t=+w.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+s}}}),S({id:crypto.randomUUID(),damage:s,isCrit:a})},Math.max(50,1e3/e));return()=>clearInterval(t)},[w.autoClickPerSec,w.baseDamage,w.criticalChance,w.criticalDamage,w.bossDamageMultiplier,w.cpMultiplier,null==m?void 0:m.id]);let X=(0,i.useCallback)((e,t,a)=>{let l={configId:"fallback",name:"未知怪物",emoji:"❓",rarity:s.COMMON,hpMultiplier:1,goldMultiplier:1,xpMultiplier:1};if(!a||!a.monsters||0===a.monsters.length)return l;let i=a.monsters.filter(a=>{let l=Number(a.Stage_Min)||1,i=Number(a.Stage_Max)||9999;if(e<l||e>i)return!1;let s=(a.Rarity||"COMMON").toUpperCase();return t?"BOSS"===s:"BOSS"!==s});if(0===i.length)return l;let n=Math.random()*i.reduce((e,t)=>e+(Number(t.Weight)||0),0);for(let e of i){let t=Number(e.Weight)||0;if(n<t)return console.log("Selected Monster Config:",e),{configId:e.ID,name:e.Name,emoji:e.Emoji,rarity:e.Rarity||s.COMMON,hpMultiplier:Number(e.HP_Mult)||1,goldMultiplier:Number(e.Gold_Mult)||1,xpMultiplier:Number(e.XP_Mult)||1,dropDiamonds:Number(e.Drop_Diamonds)||0,note:e.Notes};n-=t}return l},[]),Y=e=>{if(!e||H.current.has(e.id))return;H.current.add(e.id),H.current.size>50&&H.current.clear();let t=Math.ceil(e.rewardGold*w.goldMultiplier),a=Math.ceil(e.rewardXp*w.xpMultiplier);c(l=>{let{level:i,currentXp:s,requiredXp:n}=l.system,{levelPoints:r}=l.wallet;for(s+=a;s>=n;)s-=n,i+=1,r+=5,n=Math.floor(1.2*n);return{...l,wallet:{...l.wallet,gold:l.wallet.gold+t,levelPoints:r},system:{...l.system,level:i,currentXp:s,requiredXp:n},records:{...l.records,monstersKilled:l.records.monstersKilled+1,totalGoldEarned:l.records.totalGoldEarned+t,bossesKilled:e.isBoss?l.records.bossesKilled+1:l.records.bossesKilled,maxStageReached:e.isBoss?Math.max(l.records.maxStageReached,e.level+1):l.records.maxStageReached}}}),x(t=>{if(e.isBoss)return{...t,currentStageId:e.level+1,maxStageReached:Math.max(t.maxStageReached,e.level+1),isBossActive:!1,monstersKilledInStage:0,bossTimeLeft:null};let a=t.monstersKilledInStage+1;return{...t,monstersKilledInStage:a}}),g(null)},J=e=>{var t,a,l,i,s,n,o;if("daily_checkin"===e)return void c(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+10,gold:e.wallet.gold+500},lastDailyRewardClaimTime:Date.now()}));if(e.startsWith("click_shop_")){let a=null==b||null==(t=b.upgrades)?void 0:t.find(t=>t.ID===e);if(!a)return;let l=r.clickShop[e]||0,i=Number(a.Max_Level||0);if(i>0&&l>=i)return void T("已達最大等級！");let n=Number(a.Cost_Base||0),o=Number(a.Cost_Mult||0),d=0;d=1===o||1===o?Math.floor(n+l):Math.floor(n*Math.pow(o,l));let p=a.Currency||"CP";return(s=r.wallet,("GOLD"===p?s.gold:"LP"===p?s.levelPoints:"DIAMOND"===p?s.diamonds:"AP"===p?s.ascensionPoints:s.clickPoints)>=d)?c(t=>{let i={...t.stats},s=a.Effect_Type,n=Number(a.Effect_Val||0);("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(i.baseDamage+=n),("ADD_CRIT_DMG"===s||"CRIT_DMG"===s)&&(i.criticalDamage+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(i.goldMultiplier+=n/100),"AUTO_CLICK_V"===s&&(i.autoClickPerSec+=n),"REDUCE_GOAL_V"===s&&(i.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(i.rareMonsterChance+=n/100);let r={...t.wallet};return"GOLD"===p?r.gold-=d:"LP"===p?r.levelPoints-=d:"DIAMOND"===p?r.diamonds-=d:"AP"===p?r.ascensionPoints-=d:r.clickPoints-=d,{...t,wallet:r,clickShop:{...t.clickShop,[e]:l+1},stats:i}}):T("".concat(p," 不足！")),void 0}if(e.startsWith("level_shop_")){let t=null==b||null==(a=b.upgrades)?void 0:a.find(t=>t.ID===e);if(!t)return;let l=r.levelShop[e]||0,i=Number(t.Max_Level||0);if(i>0&&l>=i)return void T("已達最大等級！");let s=Number(t.Cost_Base||0),o=Number(t.Cost_Mult||0),d=0;d=1===o||1===o?Math.floor(s+l):Math.floor(s*Math.pow(o,l));let p=t.Currency||"LP";return(n=r.wallet,("GOLD"===p?n.gold:"CP"===p?n.clickPoints:"DIAMOND"===p?n.diamonds:"AP"===p?n.ascensionPoints:n.levelPoints)>=d)?c(a=>{let i={...a.stats},s=t.Effect_Type,n=Number(t.Effect_Val||0);("ADD_XP"===s||"XP_MULT"===s)&&(i.xpMultiplier+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(i.goldMultiplier+=n/100),("ADD_AUTO"===s||"AUTO_DMG"===s)&&(i.autoAttackDamage+=n),("ADD_BOSS_DMG"===s||"BOSS_DMG"===s)&&(i.bossDamageMultiplier+=n/100),("ADD_CRIT"===s||"CRIT_RATE"===s)&&(i.criticalChance+=n/100),"AUTO_CLICK_V"===s&&(i.autoClickPerSec+=n),"REDUCE_GOAL_V"===s&&(i.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(i.rareMonsterChance+=n/100);let r={...a.wallet};return"GOLD"===p?r.gold-=d:"CP"===p?r.clickPoints-=d:"DIAMOND"===p?r.diamonds-=d:"AP"===p?r.ascensionPoints-=d:r.levelPoints-=d,{...a,wallet:r,levelShop:{...a.levelShop,[e]:l+1},stats:i}}):T("".concat(p," 不足！")),void 0}let d=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:"DIAMOND"},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:"DIAMOND"}].find(t=>t.id===e);if(d&&"DIAMOND"===d.currency&&r.wallet.diamonds>=d.cost&&c(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds-d.cost,gold:e.wallet.gold+d.reward}})),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:t}=r,a=null==b||null==(l=b.upgrades)?void 0:l.find(t=>t.ID===e);if(a){let l=t[e]||0,i=Number(a.Max_Level||0);if(i>0&&l>=i)return void T("已達最大等級！");let s=Number(a.Cost_Base||0),n=Number(a.Cost_Mult||1),o=0;return o="ADD_INVENTORY"===a.Effect_Type?s:1===n||1===n?Math.floor(s+l):Math.floor(s*Math.pow(n,l)),void(r.wallet.gold>=o?c(t=>{let l={...t.stats},i=a.Effect_Type,s=Number(a.Effect_Val||0);"ADD_DAMAGE"===i&&(l.baseDamage+=s),"ADD_AUTO_DMG"===i&&(l.autoAttackDamage+=s),"ADD_GOLD_MULT"===i&&(l.goldMultiplier+=s/100);let n={...t.goldShop};n[e]=(t.goldShop[e]||0)+1;let r={...t.inventory};return"ADD_INVENTORY"===i&&"gold_potion_rage"===e&&(r.ragePotionCount=(r.ragePotionCount||0)+1),{...t,wallet:{...t.wallet,gold:t.wallet.gold-o},goldShop:n,stats:l,inventory:r}}):T("金幣不足！"))}console.warn("[handleShopPurchase] Gold shop item not found in config: ".concat(e))}if(e.startsWith("gacha_equipment_")){let t=1;e.endsWith("_10")&&(t=10),e.endsWith("_100")&&(t=100),e.endsWith("_1000")&&(t=1e3);let a="basic";e.includes("advanced")&&(a="advanced"),e.includes("premium")&&(a="premium");let l=1e3;"advanced"===a&&(l=1e4),"premium"===a&&(l=1e5);let i=l*t;if(r.wallet.gold>=i){let e=(null==b?void 0:b.equipments)||[];if(e.length>0){let l=e.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===a?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==a||"MYTHIC"!==t});if(0===l.length)return void T("此箱子目前沒有可抽取的裝備設定。");let s=l.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),n={...r.equipment.inventory},o=[],d=[],p=0;for(let e=0;e<t;e++){let e=Math.random()*s,t=l[0];for(let a of l){let l=Number(a.Gacha_Weight)||0;if(e<l){t=a;break}e-=l}o.push(t);let a=n[t.ID]||0;if(a>=(Number(t.Max_Level)||10)){let e=(t.Rarity||"COMMON").toUpperCase(),a=1;switch(e){case"COMMON":default:a=1;break;case"UNCOMMON":a=3;break;case"RARE":a=10;break;case"EPIC":a=50;break;case"LEGENDARY":a=200;break;case"MYTHIC":a=1e3}p+=a,d.push({item:t,shards:a})}else n[t.ID]=a+1}if(c(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-i,equipmentShards:(e.wallet.equipmentShards||0)+p},equipment:{...e.equipment,inventory:n}})),1===t)if(d.length>0){let e=d[0];T("獲得裝備：".concat(e.item.Name," (已滿級)\n自動轉換為：\uD83E\uDDE9 裝備碎片 x").concat(e.shards),"獲得裝備")}else T("獲得裝備：".concat(o[0].Name," (Rarity: ").concat(o[0].Rarity,")"),"獲得裝備");else{let e={};o.forEach(t=>{e[t.Name]=(e[t.Name]||0)+1});let l=Object.entries(e).map(e=>{let[t,a]=e;return"".concat(t," x").concat(a)}).join("\n");p>0&&(l+="\n\n\uD83E\uDDE9 獲得碎片: ".concat(p," (滿級轉化)")),T("獲得 ".concat(t," 件裝備").concat("premium"===a?"(頂級)":"advanced"===a?"(高級)":"","：\n").concat(l),"獲得裝備",!!E,{summary:e,gainedShards:p,boxType:a,drawCount:t})}}else T("暫無裝備可抽取")}else T("金幣不足！"),E&&I(null)}if(e.startsWith("ascension_shop_")||e.startsWith("asc_")){let t=null==b||null==(i=b.upgrades)?void 0:i.find(t=>t.ID===e);if(!t)return;let a=r.ascensionShop[e]||0,l=Number(t.Max_Level||0);if(l>0&&a>=l)return void T("已達最大等級！");let s=Number(t.Cost_Base||0),n=Number(t.Cost_Mult||0),d=0;d=1===n||1===n?Math.floor(s+a):Math.floor(s*Math.pow(n,a));let p=t.Currency||"AP";(o=r.wallet,("GOLD"===p?o.gold:"CP"===p?o.clickPoints:"LP"===p?o.levelPoints:"DIAMOND"===p?o.diamonds:o.ascensionPoints)>=d)?c(l=>{let i={...l.stats},s=t.Effect_Type,n=Number(t.Effect_Val||0);("ADD_CRIT"===s||"CRIT_RATE"===s)&&(i.criticalChance+=n/100),("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(i.baseDamage+=n),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(i.goldMultiplier+=n/100),("ADD_XP"===s||"XP_MULT"===s)&&(i.xpMultiplier+=n/100),"REDUCE_GOAL_V"===s&&(i.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(i.rareMonsterChance+=n/100),"AUTO_CLICK_V"===s&&(i.autoClickPerSec+=n);let r={...l.wallet};return"GOLD"===p?r.gold-=d:"CP"===p?r.clickPoints-=d:"LP"===p?r.levelPoints-=d:"DIAMOND"===p?r.diamonds-=d:r.ascensionPoints-=d,{...l,wallet:r,ascensionShop:{...l.ascensionShop,[e]:a+1},stats:i}}):T("".concat(p," 不足！"))}},Q=e=>{"RAGE"===e&&r.inventory.ragePotionCount>0&&c(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))},Z=e=>{let t={...B.stats};return[{id:"gold_shop_weapon",levelKey:"weaponLevel"},{id:"gold_shop_mercenary",levelKey:"mercenaryLevel"},{id:"gold_shop_partner",levelKey:"partnerLevel"},{id:"gold_shop_archer",levelKey:"archerLevel"},{id:"gold_shop_knight",levelKey:"knightLevel"},{id:"gold_shop_warlord",levelKey:"warlordLevel"},{id:"gold_shop_oracle",levelKey:"oracleLevel"},{id:"gold_shop_void",levelKey:"voidLevel"},{id:"gold_shop_titan",levelKey:"titanLevel"},{id:"gold_shop_amulet",levelKey:"amuletLevel"}].forEach(a=>{var l;let{id:i,levelKey:s}=a,n=e.goldShop[s]||0;if(n<=0)return;let r=null==b||null==(l=b.upgrades)?void 0:l.find(e=>e.ID===i);if(r){let e=r.Effect_Type,a=Number(r.Effect_Val||0)*n;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(t.baseDamage+=a),("ADD_AUTO_DMG"===e||"AUTO_DMG"===e||"ADD_AUTO"===e)&&(t.autoAttackDamage+=a),("ADD_GOLD_MULT"===e||"GOLD_MULT"===e)&&(t.goldMultiplier+=a/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(t.criticalDamage+=a/100)}}),["clickShop","levelShop","ascensionShop"].forEach(a=>{Object.entries(e[a]).forEach(e=>{var a;let[l,i]=e,s=null==b||null==(a=b.upgrades)?void 0:a.find(e=>e.ID===l);if(s&&i>0){let e=s.Effect_Type,a=Number(s.Effect_Val||0)*i;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(t.baseDamage+=a),("ADD_CRIT"===e||"CRIT_RATE"===e)&&(t.criticalChance+=a/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(t.criticalDamage+=a/100),("ADD_GOLD"===e||"GOLD_MULT"===e)&&(t.goldMultiplier+=a/100),("ADD_XP"===e||"XP_MULT"===e)&&(t.xpMultiplier+=a/100),("ADD_AUTO"===e||"AUTO_DMG"===e)&&(t.autoAttackDamage+=a),("ADD_BOSS_DMG"===e||"BOSS_DMG"===e)&&(t.bossDamageMultiplier+=a/100),"REDUCE_GOAL_V"===e&&(t.monsterKillReduction+=a),"RARE_CHANCE_P"===e&&(t.rareMonsterChance+=a/100),"AUTO_CLICK_V"===e&&(t.autoClickPerSec+=a)}})}),t},$=()=>{ee<=0||(c(e=>{let t={...e,system:{level:1,currentXp:0,requiredXp:100},wallet:{...e.wallet,gold:0,levelPoints:0,ascensionPoints:(e.wallet.ascensionPoints||0)+ee,equipmentShards:e.wallet.equipmentShards||0},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,warlordLevel:0,oracleLevel:0,voidLevel:0,titanLevel:0,amuletLevel:0},levelShop:{},activeBuffs:{ragePotionExpiresAt:0}};return t.stats=Z(t),t}),x(e=>({...e,currentStageId:1,monstersKilledInStage:0,isBossActive:!1,maxStageReached:1,bossTimeLeft:null})),g(null),T("⚡ 渡劫成功！獲得 ".concat(ee.toLocaleString()," 點飛昇點數！\n等級與等級點數已重製，裝備與點擊加成已保留。"),"渡劫成功"),n("BATTLE"))},ee=i.useMemo(()=>Math.floor(10*Math.pow(1.2,Math.max(0,p.maxStageReached-0))),[p.maxStageReached]);return(0,l.jsxs)("div",{className:"ca-game-container",children:[(0,l.jsx)(u,{player:r,combatPower:P,stageId:p.currentStageId,userId:O,onAvatarClick:()=>t("PROFILE"),onAscension:()=>{if(ee<=0)return void T("尚未達到飛升條件！");window.confirm("確定要渡劫飛升嗎？\n\n將重置關卡與金幣，並獲得 ".concat(ee.toLocaleString()," 點飛升點數！"))&&$()},potentialPoints:ee}),"BATTLE"===a?(0,l.jsx)(h,{monster:m,stageId:p.currentStageId,onMonsterClick:(e,t)=>{m&&!(m.currentHp<=0)&&(g(t=>{if(!t||t.currentHp<=0)return t;let a=Math.max(0,t.currentHp-e);return a<=0&&setTimeout(()=>Y(t),0),{...t,currentHp:a}}),c(t=>({...t,records:{...t.records,totalClicks:t.records.totalClicks+1,totalDamageDealt:t.records.totalDamageDealt+e},wallet:{...t.wallet,clickPoints:t.wallet.clickPoints+ +w.cpMultiplier}})))},baseDamage:w.baseDamage,criticalChance:w.criticalChance,criticalDamage:w.criticalDamage,bossDamageMultiplier:w.bossDamageMultiplier||1,monstersKilled:p.monstersKilledInStage,monstersRequired:Math.max(1,p.monstersRequiredForBoss-(w.monsterKillReduction||0)),isBossActive:p.isBossActive,goldShop:r.goldShop,gameConfig:b,potionCount:r.inventory.ragePotionCount,activeBuffs:r.activeBuffs,onUsePotion:()=>Q("RAGE"),lastAutoAttack:_,lastAutoClickEvent:j,bossTimeLeft:p.bossTimeLeft,bossTimeLimit:p.bossTimeLimit,onChallengeBoss:()=>{x(e=>({...e,isBossActive:!0,autoChallengeBoss:!0,bossTimeLeft:e.bossTimeLimit||60})),g(null)},autoUsePotion:p.autoUsePotion,onToggleAutoPotion:()=>x(e=>({...e,autoUsePotion:!e.autoUsePotion}))}):(0,l.jsx)(k,{player:r,effectiveStats:w,userId:O,gameConfig:b,onEquip:(e,t)=>{c(a=>({...a,equipment:{...a.equipment,equipped:{...a.equipment.equipped,[t]:e}}}))},onUnequip:e=>{c(t=>{let a={...t.equipment.equipped};return delete a[e],{...t,equipment:{...t.equipment,equipped:a}}})}}),(0,l.jsx)(f,{activeView:a,onSwitchView:n,onOpenModal:t}),(0,l.jsx)(D,{isOpen:"PROFILE"===e,onClose:()=>t(null),title:"玩家資料",children:(0,l.jsx)(N,{player:r,effectiveStats:w,combatPower:P,userId:O,onLogin:F,onLogout:()=>{q(null),localStorage.removeItem("ca_last_user_id"),c(B),x(z)},onManualSave:V,gameConfig:b})}),(0,l.jsx)(D,{isOpen:"SHOP"===e,onClose:()=>t(null),title:"商店",headerContent:(0,l.jsxs)("div",{className:"ca-shop-currency-bar",style:{display:"flex",flexWrap:"wrap",border:"none",background:"transparent",padding:"0 8px",gap:"12px"},children:[(0,l.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},title:"金幣",children:[(0,l.jsx)("span",{children:"\uD83D\uDCB0"}),(0,l.jsx)("span",{children:d(Math.floor(r.wallet.gold),2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},title:"鑽石",children:[(0,l.jsx)("span",{children:"\uD83D\uDC8E"}),(0,l.jsx)("span",{children:d(r.wallet.diamonds,2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"var(--ca-accent-cyan, #22d3ee)"},title:"點擊點數",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:d(Math.floor(r.wallet.clickPoints),2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#4ade80"},title:"等級積分",children:[(0,l.jsx)("span",{children:"\uD83C\uDD99"}),(0,l.jsx)("span",{children:d(r.wallet.levelPoints,2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#d8b4fe"},title:"飛昇點數",children:[(0,l.jsx)("span",{children:"\uD83D\uDD4A️"}),(0,l.jsx)("span",{children:d(r.wallet.ascensionPoints,2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#fca5a5"},title:"裝備碎片",children:[(0,l.jsx)("span",{children:"\uD83E\uDDE9"}),(0,l.jsx)("span",{children:d(r.wallet.equipmentShards||0,2,1e3)})]})]}),children:(0,l.jsx)(y,{player:r,onPurchase:J,onResetLevelPoints:()=>{window.confirm("確定要重製等級積分嗎？\n所有已分配的點數將會返還，您可以重新分配天賦。")&&(c(e=>{let t=0;Object.entries(e.levelShop).forEach(e=>{var a;let[l,i]=e,s=null==b||null==(a=b.upgrades)?void 0:a.find(e=>e.ID===l);if(s)for(let e=0;e<i;e++){let a=Math.floor(s.Cost_Base*Math.pow(s.Cost_Mult,e));t+=a}});let a={...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints+t},levelShop:{}};return a.stats=Z(a),a}),T("✅ 等級積分已重製！"))},gameConfig:b,autoGachaBox:E,onToggleAutoGacha:e=>I(e)})}),(0,l.jsx)(D,{isOpen:!!A,onClose:()=>M(null),title:(null==A?void 0:A.title)||"系統提示",children:(0,l.jsxs)("div",{style:{textAlign:(null==A?void 0:A.gachaResults)?"left":"center",padding:"20px",fontSize:"1rem",color:"#e2e8f0",maxHeight:"60vh",overflowY:"auto"},children:[(null==A?void 0:A.gachaResults)?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fbbf24",marginBottom:"16px",textAlign:"center"},children:["\uD83C\uDF8A 連抽結果摘要 (",A.gachaResults.drawCount," 抽)"]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"10px",marginBottom:"20px"},children:Object.entries(A.gachaResults.summary).map(e=>{let[t,a]=e;return(0,l.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.9rem"},children:t}),(0,l.jsxs)("span",{style:{color:"#10b981",fontWeight:"bold",fontSize:"0.8rem"},children:["x",a]})]},t)})}),A.gachaResults.gainedShards>0&&(0,l.jsxs)("div",{style:{background:"rgba(16, 185, 129, 0.1)",padding:"12px",borderRadius:"8px",border:"1px solid rgba(16, 185, 129, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",fontWeight:"bold"},children:[(0,l.jsx)("span",{style:{fontSize:"1.2rem"},children:"\uD83E\uDDE9"}),(0,l.jsxs)("span",{style:{color:"#34d399"},children:["轉化獲得碎片: ",A.gachaResults.gainedShards]})]})]}):(0,l.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:null==A?void 0:A.message}),(0,l.jsxs)("div",{style:{marginTop:"24px",display:"flex",justifyContent:"center",gap:"12px",position:"sticky",bottom:0,background:"var(--ca-bg-modal, #1e293b)",paddingTop:"12px"},children:[(null==A?void 0:A.isAutoGacha)&&(0,l.jsxs)("button",{className:"ca-btn",style:{padding:"10px 24px",background:"linear-gradient(to bottom, #ef4444, #b91c1c)",color:"white",border:"none",fontWeight:"bold",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",gap:"8px"},onClick:()=>{I(null),M(null)},children:[(0,l.jsx)("span",{children:"⏹️"})," 停止自動抽取"]}),(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"10px 32px",minWidth:"120px",fontWeight:"bold"},onClick:()=>M(null),children:"確定"})]})]})})]})}}}]);