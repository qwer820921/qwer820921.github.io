(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4579],{66997:()=>{},94579:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>R});var a=t(95155),i=t(12115);function r(e){let{player:l,combatPower:t,stageId:i,onAvatarClick:r,onAscension:s,potentialPoints:n}=e,{system:o,wallet:c}=l,d=o.currentXp/o.requiredXp*100;return(0,a.jsxs)("header",{className:"ca-header",children:[(0,a.jsxs)("div",{className:"ca-player-profile",children:[(0,a.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:r,children:[(0,a.jsx)("div",{className:"ca-avatar-ring",children:(0,a.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,a.jsx)("div",{className:"ca-level-badge",children:o.level})]}),(0,a.jsxs)("div",{className:"ca-profile-info",children:[(0,a.jsxs)("div",{className:"ca-profile-top",children:[(0,a.jsxs)("span",{className:"ca-level-text",children:["Lv.",o.level]}),(0,a.jsx)("span",{className:"ca-player-name",children:"冒險者"})]}),(0,a.jsxs)("div",{className:"ca-exp-container",children:[(0,a.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,a.jsx)("div",{className:"ca-exp-bar",children:(0,a.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,d),"%")}})}),(0,a.jsxs)("div",{className:"ca-exp-text",children:[o.currentXp.toLocaleString(),"/",o.requiredXp.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"ca-combat-power",style:{justifyContent:"space-between",width:"100%"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,a.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,a.jsx)("span",{className:"ca-cp-value",children:t.toLocaleString()})]}),(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),s()},style:{display:"flex",alignItems:"center",gap:"4px",background:"linear-gradient(135deg, #a855f7 0%, #d946ef 100%)",color:"white",padding:"4px 10px",fontSize:"0.65rem",fontWeight:"bold",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:"0 0 10px rgba(168, 85, 247, 0.3)",flexShrink:0},children:["⚡ 渡劫飛升 (+",n.toLocaleString(),")"]})]})]})]}),(0,a.jsx)("div",{className:"ca-header-right",children:(0,a.jsxs)("div",{className:"ca-currency-stack",children:[(0,a.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{children:Math.floor(c.gold).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:Math.floor(c.clickPoints).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency text-xs",style:{color:"#10b981"},children:[(0,a.jsx)("span",{children:"\uD83C\uDD99"}),(0,a.jsx)("span",{children:Math.floor(c.levelPoints).toLocaleString()})]})]})})]})}function s(e){let{name:l,currentHp:t,maxHp:i,isBoss:r=!1}=e,s=Math.max(1,i),n=Math.min(Math.max(0,t),s);return(0,a.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,a.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,a.jsx)("span",{className:"text-slate-300 me-2",children:l})}),(0,a.jsx)("div",{className:"ca-hp-bar",children:(0,a.jsx)("div",{className:"ca-hp-bar-fill ".concat(r?"boss":"normal"),style:{width:"".concat(n/s*100,"%")}})}),(0,a.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[Math.ceil(n).toLocaleString()," /"," ",Math.ceil(s).toLocaleString()]})]})}function n(e){let{monster:l,stageId:t,onMonsterClick:r,baseDamage:n,criticalChance:o,criticalDamage:c,monstersKilled:d,monstersRequired:p,isBossActive:u,mercenaryLevel:g=0,partnerLevel:x=0,archerLevel:m=0,knightLevel:h=0,potionCount:f=0,activeBuffs:v,onUsePotion:y,lastAutoAttack:b}=e,[D,j]=(0,i.useState)([]),[S,M]=(0,i.useState)(!1),[C,N]=(0,i.useState)(!1),[w,_]=(0,i.useState)(!1),[k,L]=(0,i.useState)(!1),[A,I]=(0,i.useState)(!1),[E,O]=(0,i.useState)(!1),R=(0,i.useRef)(null),T=(0,i.useRef)(null),P=(0,i.useRef)(null),z=(0,i.useRef)(null),B=(0,i.useRef)(null),G=(0,i.useRef)(0),q=(null==v?void 0:v.ragePotionExpiresAt)&&v.ragePotionExpiresAt>Date.now(),U=(e,l,t,a)=>{let i=crypto.randomUUID();j(r=>[...r,{id:i,text:e,x:l,y:t,type:a,createdAt:Date.now()}]),setTimeout(()=>{j(e=>e.filter(e=>e.id!==i))},1e3)};i.useEffect(()=>{var e;if(!b||b.time===G.current)return;G.current=b.time,N(!0),setTimeout(()=>N(!1),150);let l=null==(e=R.current)?void 0:e.getBoundingClientRect();if(b.breakdown&&l){let{mercenary:e,partner:t,archer:a,knight:i,player:r}=b.breakdown;if(e>0&&T.current){let t=T.current.getBoundingClientRect(),a=t.left-l.left+t.width/2,i=t.top-l.top;U("⚔️ ".concat(e.toLocaleString()),a,i-20,"AUTO"),_(!0),setTimeout(()=>_(!1),300)}if(t>0&&P.current){let e=P.current.getBoundingClientRect(),a=e.left-l.left+e.width/2,i=e.top-l.top;U("\uD83E\uDDDA ".concat(t.toLocaleString()),a,i-20,"AUTO"),L(!0),setTimeout(()=>L(!1),400)}if(a>0&&z.current){let e=z.current.getBoundingClientRect(),t=e.left-l.left+e.width/2,i=e.top-l.top;U("\uD83C\uDFF9 ".concat(a.toLocaleString()),t,i-20,"AUTO"),I(!0),setTimeout(()=>I(!1),300)}if(i>0&&B.current){let e=B.current.getBoundingClientRect(),t=e.left-l.left+e.width/2,a=e.top-l.top;U("\uD83D\uDEE1️ ".concat(i.toLocaleString()),t,a-20,"AUTO"),O(!0),setTimeout(()=>O(!1),300)}if(r>0){let e=l.width/2+(40*Math.random()-20),t=l.height/2+(40*Math.random()-20)-50;U(r.toLocaleString(),e,t,"AUTO")}}else if(l){let e=l.width/2+(40*Math.random()-20),t=l.height/2+(40*Math.random()-20)-50;U(b.damage.toLocaleString(),e,t,"AUTO"),g>0&&(_(!0),setTimeout(()=>_(!1),300))}},[b,g,x,m,h]);let W=e=>{var t,a,i,s,d;let p,u;if(!l||l.currentHp<=0)return;let g=n;q&&(g*=2);let x=Math.random()<o,m=Math.ceil(g*(x?c:1)),h=null==(t=R.current)?void 0:t.getBoundingClientRect();if(!h)return;"touches"in e?(p=null!=(s=null==(a=e.touches[0])?void 0:a.clientX)?s:h.left+h.width/2,u=null!=(d=null==(i=e.touches[0])?void 0:i.clientY)?d:h.top+h.height/2):(p=e.clientX,u=e.clientY);let f=p-h.left+(60*Math.random()-30),v=u-h.top+(60*Math.random()-30);U(m.toLocaleString(),f,v,x?"CRIT":"CLICK"),M(!0),N(!0),setTimeout(()=>M(!1),300),setTimeout(()=>N(!1),150),r(m,x)},H=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,a.jsxs)("div",{ref:R,className:"ca-battle-area ".concat(S?"ca-shake":""),style:{background:q?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:W,onTouchStart:W,children:[(0,a.jsx)("div",{className:"ca-monster-container",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"ca-stage-display",children:["第 ",t," 關"]}),!u&&(0,a.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.3)",padding:"2px 8px",borderRadius:"12px"},children:[d," / ",p," \uD83D\uDC80"]}),u&&(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"4px",marginBottom:"16px",fontWeight:"bold",background:"rgba(239, 68, 68, 0.1)",padding:"2px 8px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:"⚠️ BOSS 挑戰中 ⚠️"}),(0,a.jsx)("div",{className:"ca-monster-sprite ".concat(l.isBoss?"boss":""," ").concat(C?"ca-hit-flash":""," ca-bounce-slow"),children:l.emoji||(l.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")}),(0,a.jsx)("div",{className:"mt-6 w-56",children:(0,a.jsx)(s,{name:l.name,currentHp:l.currentHp,maxHp:l.maxHp,isBoss:l.isBoss})})]}):(0,a.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),(0,a.jsx)("div",{ref:T,className:w?"ca-attack-lunge":"",style:{position:"absolute",bottom:"20px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:g>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"⚔️"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",g]})]})}),(0,a.jsx)("div",{ref:P,className:k?"ca-attack-magic":"",style:{position:"absolute",bottom:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:x>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83E\uDDDA"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",x]})]})}),f>0&&(0,a.jsxs)("div",{onClick:e=>{e.stopPropagation(),!q&&y&&y()},style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",cursor:q?"default":"pointer",opacity:q?.5:1,zIndex:20},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",filter:q?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:q?"scale(0.9)":"scale(1)"},children:"\uD83E\uDDEA"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"10px",padding:"2px 6px",marginTop:"-10px"},children:["x",f]})]}),(0,a.jsx)("div",{ref:z,className:A?"ca-attack-lunge":"",style:{position:"absolute",top:"80px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:m>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83C\uDFF9"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#a5b4fc"},children:["Lv.",m]})]})}),(0,a.jsx)("div",{ref:B,className:E?"ca-attack-lunge":"",style:{position:"absolute",top:"140px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:h>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDEE1️"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fca5a5"},children:["Lv.",h]})]})}),(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",children:D.map(e=>(0,a.jsx)("div",{className:H(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function o(e){let{activeView:l,onSwitchView:t,onOpenModal:i}=e;return(0,a.jsx)("footer",{className:"ca-footer",children:(0,a.jsxs)("nav",{className:"ca-footer-nav",children:[(0,a.jsxs)("button",{className:"ca-tab-btn ".concat("CHARACTER"===l?"active":""),onClick:()=>{t("CHARACTER"),i(null)},children:[(0,a.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,a.jsx)("span",{className:"label",children:"角色"})]}),(0,a.jsxs)("button",{className:"ca-tab-btn ".concat("BATTLE"===l?"active":""),onClick:()=>{t("BATTLE"),i(null)},children:[(0,a.jsx)("span",{className:"icon",children:"⚔️"}),(0,a.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,a.jsxs)("button",{className:"ca-tab-btn",onClick:()=>i("SHOP"),children:[(0,a.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,a.jsx)("span",{className:"label",children:"商店"})]})]})})}function c(e){let{isOpen:l,onClose:t,title:i,headerContent:r,children:s}=e;return l?(0,a.jsx)("div",{className:"ca-modal-overlay",onClick:t,children:(0,a.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"ca-modal-header",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,a.jsx)("h2",{className:"ca-modal-title",children:i}),r]}),(0,a.jsx)("button",{className:"ca-modal-close",onClick:t,children:"✕"})]}),(0,a.jsx)("div",{className:"ca-modal-content",children:s})]})}):null}t(66997);let d=e=>e<=20?{name:"練氣期",color:"#a7f3d0"}:e<=40?{name:"築基期",color:"#6ee7b7"}:e<=60?{name:"金丹期",color:"#fbbf24"}:e<=80?{name:"元嬰期",color:"#f472b6"}:e<=100?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"};function p(e){let{player:l,onPurchase:t,gameConfig:r}=e,[s,n]=(0,i.useState)("DAILY"),[o,c]=(0,i.useState)("UPGRADE"),[p,m]=(0,i.useState)(!1),h=d(l.system.level);console.log("[ShopPage] Rendering. ActiveTab:",s,"isProbModalOpen:",p);let f=e=>"gold_shop_weapon"===e?l.goldShop.weaponLevel||0:"gold_shop_mercenary"===e?l.goldShop.mercenaryLevel||0:"gold_shop_partner"===e?l.goldShop.partnerLevel||0:"gold_shop_archer"===e?l.goldShop.archerLevel||0:"gold_shop_knight"===e?l.goldShop.knightLevel||0:"gold_shop_amulet"===e?l.goldShop.amuletLevel||0:"gold_potion_rage"===e?l.inventory.ragePotionCount||0:e.startsWith("level_shop_")?l.levelShop[e]||0:e.startsWith("click_shop_")?l.clickShop[e]||0:e.startsWith("ascension_shop_")&&l.ascensionShop[e]||0,v=(e,l,t,a)=>"ADD_INVENTORY"===a?e:1===l||1===l?Math.floor(e+t):Math.floor(e*Math.pow(l,t)),y=e=>"GOLD"===e?"\uD83D\uDCB0":"LP"===e?"\uD83C\uDD99":"CP"===e?"⚡":"DIAMOND"===e?"\uD83D\uDC8E":"AP"===e?"⚡":e,b=e=>"GOLD"===e?l.wallet.gold:"LP"===e?l.wallet.levelPoints:"CP"===e?l.wallet.clickPoints:"DIAMOND"===e?l.wallet.diamonds:"AP"===e?l.wallet.ascensionPoints:0,D=e=>0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"gray"},children:"無項目"}):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(e=>{let l=f(e.ID),i=v(e.Cost_Base,e.Cost_Mult,l,e.Effect_Type),r=y(e.Currency),s=b(e.Currency),n=e.Desc_Template||e.Name;return n.includes("{val}")&&(n=n.replace("{val}",String(e.Effect_Val))),(0,a.jsx)(g,{name:e.Name,desc:"".concat(n," [Lv.").concat(l,"]"),level:l,cost:i,currencyLabel:r,canAfford:s>=i,onClick:()=>t(e.ID)},e.ID)})}),j=e=>r&&r.upgrades?D(r.upgrades.filter(l=>l.Shop_Type===e)):null,S=(()=>{if(!l.lastDailyRewardClaimTime)return!0;let e=new Date(l.lastDailyRewardClaimTime),t=new Date;return e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()||e.getFullYear()!==t.getFullYear()})();return(0,a.jsxs)("div",{className:"ca-shop-container",children:[(0,a.jsxs)("div",{className:"ca-shop-tabs",children:[(0,a.jsxs)("button",{onClick:()=>n("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===s?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,a.jsx)("div",{className:"label",children:"每日商店"}),S&&(0,a.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,a.jsxs)("button",{onClick:()=>n("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===s?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,a.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,a.jsxs)("button",{onClick:()=>n("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===s?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,a.jsx)("div",{className:"label",children:"等級商店"})]}),(0,a.jsxs)("button",{onClick:()=>n("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===s?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"⚡"}),(0,a.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,a.jsxs)("button",{onClick:()=>n("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===s?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,a.jsx)("div",{className:"label",children:"飛昇商店"})]}),(0,a.jsxs)("button",{onClick:()=>n("EQUIPMENT"),className:"ca-shop-tab-btn equipment ".concat("EQUIPMENT"===s?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"⚔️"}),(0,a.jsx)("div",{className:"label",children:"裝備扭蛋"})]})]}),(0,a.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===s&&(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,a.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,a.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,a.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,a.jsx)("div",{style:{fontSize:"3rem",filter:S?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#fde047"},children:"10 \uD83D\uDC8E + 500 \uD83D\uDCB0"})]}),(0,a.jsx)("button",{className:"ca-btn ".concat(S?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:S?1:.5,cursor:S?"pointer":"not-allowed",background:S?"":"#334155",color:S?"":"#64748b"},disabled:!S,onClick:()=>t("daily_checkin"),children:S?"領取獎勵":"明日再來"})]})}),"GOLD"===s&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:Math.floor(l.wallet.gold).toLocaleString()}),(0,a.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(0,a.jsxs)("div",{className:"ca-shop-subtabs",style:{display:"flex",gap:"10px",marginBottom:"8px"},children:[(0,a.jsx)("button",{className:"ca-btn ".concat("UPGRADE"===o?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"UPGRADE"===o?"":"rgba(255,255,255,0.1)"},onClick:()=>c("UPGRADE"),children:"\uD83D\uDEE0️ 金幣強化"}),(0,a.jsx)("button",{className:"ca-btn ".concat("RECRUIT"===o?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"RECRUIT"===o?"":"rgba(255,255,255,0.1)"},onClick:()=>c("RECRUIT"),children:"\uD83D\uDEA9 招兵買馬"})]}),(null==r?void 0:r.upgrades)?D(r.upgrades.filter(e=>"GOLD"===e.Shop_Type).filter(e=>"RECRUIT"===o?"ADD_AUTO_DMG"===e.Effect_Type:"ADD_AUTO_DMG"!==e.Effect_Type)):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,a.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config..."})}),(0,a.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,a.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,a.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,a.jsx)(u,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:l.wallet.diamonds>=10,onClick:()=>t("gold_pack_1")}),(0,a.jsx)(u,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:l.wallet.diamonds>=80,onClick:()=>t("gold_pack_2")})]})]}),"LEVEL"===s&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:l.wallet.levelPoints}),(0,a.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"})]}),(0,a.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,a.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==r?void 0:r.upgrades)?j("LEVEL"):(0,a.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===s&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:h.color},children:h.name}),(0,a.jsxs)("div",{className:"ca-realm-level",children:["等級 ",l.system.level]})]}),(0,a.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,a.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==r?void 0:r.upgrades)?j("CLICK"):(0,a.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===s&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c084fc 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"飛昇商店 (Permanent)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff"},children:"永恆加成"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.7)",marginTop:"4px"},children:"飛昇後不會重置的永久強化"})]}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:j("ASCENSION")})]}),"EQUIPMENT"===s&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",position:"relative"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"裝備扭蛋 (Gacha)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.2rem"},children:"試試你的手氣！"}),(0,a.jsx)("button",{onClick:()=>{console.log("[ShopPage] Click Probability Button"),m(!0)},style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"裝備機率一覽"})]}),(0,a.jsx)("div",{className:"ca-shop-item-grid",style:{width:"100%"},children:(0,a.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"4rem",animation:"bounce 2s infinite"},children:"\uD83C\uDF81"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fff"},children:"基礎裝備箱"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"隨機獲得一件裝備 (全屬性)"})]}),(0,a.jsxs)("button",{className:"ca-btn ca-btn-primary",style:{padding:"12px 32px",fontSize:"1.1rem",display:"flex",alignItems:"center",gap:"8px"},onClick:()=>t("gacha_equipment_basic"),children:[(0,a.jsx)("span",{children:"抽取一次"}),(0,a.jsx)("span",{style:{background:"rgba(0,0,0,0.2)",padding:"2px 8px",borderRadius:"12px",fontSize:"0.9rem"},children:"\uD83D\uDCB0 1,000"})]})]})})]})]}),p&&(0,a.jsx)(x,{gameConfig:r,onClose:()=>m(!1)})]})}function u(e){let{name:l,desc:t,icon:i,cost:r,canAfford:s,onClick:n}=e;return(0,a.jsxs)("div",{className:"ca-glass-static ca-shop-item-card",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>s&&n(),children:[(0,a.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:i}),(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:l}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:t}),(0,a.jsx)("div",{className:"ca-btn ".concat(s?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:s?"":"#334155",color:s?"":"#64748b",cursor:s?"pointer":"not-allowed"},children:r})]})}function g(e){let{name:l,desc:t,level:i,cost:r,canAfford:s,onClick:n,currencyLabel:o="⚡"}=e;return(0,a.jsxs)("div",{className:"ca-upgrade-row",children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:l}),(0,a.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",i]})]}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:t})]}),(0,a.jsxs)("button",{onClick:()=>s&&n(),disabled:!s,className:"ca-upgrade-btn",children:[(0,a.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:"bold"},children:"升級"}),(0,a.jsxs)("span",{style:{fontSize:"0.7rem"},children:[o," ",r.toLocaleString()]})]})]})}function x(e){let{gameConfig:l,onClose:t}=e,[r,s]=i.useState(null),n=l&&l.equipments&&l.equipments.length>0,o=n?l.equipments:[],c=o.reduce((e,l)=>e+(Number(l.Gacha_Weight)||0),0),d={};c>0&&o.forEach(e=>{let l=Number(e.Gacha_Weight)||0;d[l]||(d[l]=[]),d[l].push(e)});let p=e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}};return(0,a.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:[(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"500px",maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#1e293b",border:"1px solid #334155",borderRadius:"16px",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"white"},children:"裝備機率一覽"}),(0,a.jsx)("button",{onClick:t,style:{background:"none",border:"none",color:"gray",fontSize:"1.5rem",cursor:"pointer"},children:"\xd7"})]}),(0,a.jsx)("div",{style:{padding:"16px",overflowY:"auto",flex:1},children:n?Object.entries(d).sort((e,l)=>Number(l[0])-Number(e[0])).map(e=>{let[l,t]=e,i=(Number(l)/c*100).toFixed(2);return(0,a.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,a.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px",fontSize:"0.9rem",color:"#93c5fd",fontWeight:"bold"},children:["機率: ",i,"% (權重: ",l,", 共 ",t.length," 種)"]}),(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:t.map(e=>{var l;let t=p(e.Rarity);return(0,a.jsxs)("div",{onClick:()=>s(e),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:"pointer",transition:"transform 0.1s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[(0,a.jsx)("div",{style:{width:"56px",height:"56px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem",border:"1px solid ".concat(t,"44"),boxShadow:"inset 0 0 10px ".concat(t,"22")},children:h(e.Slot)}),(0,a.jsx)("div",{style:{fontSize:"0.65rem",color:t,textAlign:"center",lineHeight:"1.2",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",fontWeight:(null==(l=e.Rarity)?void 0:l.toLowerCase())==="common"?"normal":"bold"},children:e.Name})]},e.ID)})})]},l)}):(0,a.jsxs)("div",{style:{textAlign:"center",color:"var(--ca-text-muted)",padding:"20px"},children:["暫無裝備資料",(0,a.jsx)("br",{}),(0,a.jsx)("span",{style:{fontSize:"0.8rem"},children:"請檢查 Google Sheet 設定或重新載入"})]})})]}),r&&(0,a.jsx)(m,{item:r,onClose:()=>s(null)})]})}function m(e){let{item:l,onClose:t}=e,i=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(l.Rarity);return(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:10001,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:t,children:(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(i,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(i,"22")},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(i,"44")},children:h(l.Slot)}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:i},children:l.Name}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:i,fontWeight:"bold"},children:l.Rarity}),(0,a.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:l.Slot})]})]}),(0,a.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,a.jsx)("div",{style:{color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:"裝備初始屬性:"}),(0,a.jsx)("div",{children:function(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=(l.Base_Val||0)+(t-1)*(l.Level_Mult||0);return e.replace("{val}",a.toLocaleString())}(l.Desc_Template,l,1)})]}),(0,a.jsx)("button",{className:"ca-btn",onClick:t,style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"},children:"返回"})]})})}function h(e){switch(e){case"MAIN_HAND":return"⚔️";case"HEAD":return"\uD83E\uDE96";case"BODY":return"\uD83D\uDC55";case"HANDS":return"\uD83E\uDDE4";case"LEGS":return"\uD83D\uDC62";case"RELIC":return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function f(e){var l,t,r;let{player:s,effectiveStats:n,combatPower:o,userId:c,onLogin:d,onLogout:p,onManualSave:u,gameConfig:g}=e,{system:x,wallet:m,records:h}=s,[f,D]=i.useState(""),j=e=>Math.floor(e||0).toLocaleString(),S=e=>"".concat((100*e).toFixed(1),"%"),M=e=>{let l=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return l>0?"".concat(l,"h ").concat(t,"m ").concat(a,"s"):t>0?"".concat(t,"m ").concat(a,"s"):"".concat(a,"s")},C=(null==(l=s.activeBuffs)?void 0:l.ragePotionExpiresAt)>Date.now(),N=Math.max(0,Math.floor(((null==(t=s.activeBuffs)?void 0:t.ragePotionExpiresAt)-Date.now())/1e3));return(0,a.jsxs)("div",{className:"ca-profile-page",style:{paddingBottom:"20px"},children:[(0,a.jsx)("div",{className:"ca-profile-section",children:(0,a.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,a.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(c||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,a.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",x.level]})]}),(0,a.jsx)("div",{className:"ca-profile-summary",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{children:["勇者 ",c]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,a.jsx)("button",{onClick:u,className:"ca-profile-action-btn",style:{background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7"},children:"上傳"}),(0,a.jsx)("button",{onClick:p,className:"ca-profile-action-btn",style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5"},children:"登出"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-cp",children:[(0,a.jsx)("span",{className:"label",children:"戰鬥力"}),(0,a.jsx)("span",{className:"value",children:j(o)})]}),(0,a.jsxs)("div",{className:"ca-profile-exp",children:[(0,a.jsxs)("div",{className:"info",children:[(0,a.jsx)("span",{children:"EXP"}),(0,a.jsxs)("span",{children:[j(x.currentXp)," /"," ",j(x.requiredXp)]})]}),(0,a.jsx)("div",{className:"bar-bg",children:(0,a.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,x.currentXp/x.requiredXp*100),"%")}})})]})]}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",width:"100%",minWidth:0},children:[(0,a.jsx)("div",{style:{fontSize:"0.85rem",color:"var(--ca-text-secondary)",fontWeight:"600"},children:"輸入 ID 以讀取/建立存檔"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"6px",width:"100%"},children:[(0,a.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,minWidth:0,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.15)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"0.9rem",outline:"none"},placeholder:"User ID...",value:f,onChange:e=>D(e.target.value)}),(0,a.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"0 16px",fontSize:"0.85rem",height:"auto",whiteSpace:"nowrap",flexShrink:0,borderRadius:"8px"},onClick:()=>f.trim()&&d(f.trim()),children:"讀取"})]})]})})]})}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"財富狀態"}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",background:"rgba(15, 23, 42, 0.4)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.05)"},children:[(0,a.jsx)(v,{icon:"\uD83D\uDCB0",label:"金幣",value:j(m.gold),color:"#fbbf24"}),(0,a.jsx)(v,{icon:"\uD83D\uDC8E",label:"鑽石",value:j(m.diamonds),color:"#38bdf8"}),(0,a.jsx)(v,{icon:"✨",label:"點擊點數",value:j(m.clickPoints),color:"#c084fc"}),(0,a.jsx)(v,{icon:"⚡",label:"飛昇點數",value:j(m.ascensionPoints),color:"#f472b6"}),(0,a.jsx)(v,{icon:"\uD83D\uDCDC",label:"等級積分",value:j(m.levelPoints),color:"#60a5fa"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"最終戰鬥屬性 (含裝備加成)"}),(0,a.jsxs)("div",{className:"ca-stats-grid",children:[(0,a.jsx)(y,{label:"點擊基礎傷害",value:j(n.baseDamage),icon:"⚔️"}),(0,a.jsx)(y,{label:"自動秒傷 (DPS)",value:j(n.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,a.jsx)(y,{label:"爆擊機率",value:S(n.criticalChance),icon:"\uD83C\uDFAF"}),(0,a.jsx)(y,{label:"爆擊傷害",value:S(n.criticalDamage),icon:"\uD83D\uDCA5"}),(0,a.jsx)(y,{label:"金幣獲取倍率",value:"".concat(n.goldMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCB0"}),(0,a.jsx)(y,{label:"經驗獲取倍率",value:"".concat(n.xpMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCD6"}),(0,a.jsx)(y,{label:"BOSS 傷害加成",value:"".concat(n.bossDamageMultiplier.toFixed(2),"x"),icon:"\uD83D\uDC79"}),(0,a.jsx)(y,{label:"點擊點數倍率",value:"".concat(n.cpMultiplier.toFixed(2),"x"),icon:"✨"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"當前狀態 / 藥水"}),(0,a.jsx)("div",{className:"ca-glass-static",style:{padding:"12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:C?(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[(0,a.jsx)("span",{style:{fontSize:"1.4rem"},children:"\uD83E\uDDEA"}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.95rem"},children:"狂暴藥水 (Rage Potion)"}),(0,a.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:["剩餘時間:"," ",(0,a.jsx)("span",{style:{fontFamily:"monospace"},children:M(N)})]})]}),(0,a.jsx)("div",{className:"ca-pulse",style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 10px #ef4444"}})]}):(0,a.jsx)("div",{style:{color:"var(--ca-text-muted)",fontSize:"0.85rem",textAlign:"center",padding:"10px"},children:"尚無啟用的增益效果"})})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"生涯冒險記錄"}),(0,a.jsxs)("div",{className:"ca-records-list ca-glass-static",style:{borderRadius:"12px"},children:[(0,a.jsx)(b,{label:"\uD83C\uDFAE 遊戲總點擊",value:j(h.totalClicks)}),(0,a.jsx)(b,{label:"⚔️ 累計總傷害",value:j(h.totalDamageDealt)}),(0,a.jsx)(b,{label:"\uD83D\uDC7E 擊敗怪物數",value:j(h.monstersKilled)}),(0,a.jsx)(b,{label:"\uD83D\uDE08 擊敗 BOSS 數",value:j(h.bossesKilled)}),(0,a.jsx)(b,{label:"\uD83D\uDCCD 歷史最高關卡",value:"第 ".concat(j(h.maxStageReached)," 關")}),(0,a.jsx)(b,{label:"\uD83D\uDC8E 累計儲蓄/金幣",value:j(h.totalGoldEarned)}),(0,a.jsx)(b,{label:"⏳ 生涯遊玩時間",value:M(h.playtimeSeconds)})]})]}),(0,a.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.7rem",opacity:.6},children:[(0,a.jsxs)("div",{children:["遊戲版本: ",String((null==g||null==(r=g.settings)?void 0:r.GAME_VERSION)||"1.0.0")]}),(0,a.jsx)("div",{style:{marginTop:"4px"},children:"Click Ascension Project \xa9 2026"})]})]})}function v(e){let{icon:l,label:t,value:i,color:r}=e;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("span",{style:{fontSize:"1rem"},children:l}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,a.jsx)("span",{style:{fontSize:"0.6rem",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:t}),(0,a.jsx)("span",{style:{fontSize:"0.85rem",color:r,fontWeight:"bold"},children:i})]})]})}function y(e){let{label:l,value:t,icon:i}=e;return(0,a.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,a.jsx)("div",{className:"ca-stat-icon",children:i}),(0,a.jsxs)("div",{className:"ca-stat-content",children:[(0,a.jsx)("div",{className:"ca-stat-label",children:l}),(0,a.jsx)("div",{className:"ca-stat-value",children:t})]})]})}function b(e){let{label:l,value:t}=e;return(0,a.jsxs)("div",{className:"ca-record-row",children:[(0,a.jsx)("span",{className:"ca-record-label",children:l}),(0,a.jsx)("span",{className:"ca-record-value",children:t})]})}var D=function(e){return e.MAIN_HAND="MAIN_HAND",e.HEAD="HEAD",e.BODY="BODY",e.HANDS="HANDS",e.LEGS="LEGS",e.RELIC="RELIC",e}({});function j(e){let{item:l,onClose:t,onEquip:i,onUnequip:r,isEquipped:s}=e,{config:n,level:o}=l,c=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(n.Rarity);return(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(c,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(c,"22")},children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(c,"44")},children:M(n.Slot)}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:c},children:n.Name}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:c,fontWeight:"bold"},children:n.Rarity}),(0,a.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:n.Slot})]})]}),(0,a.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:[(0,a.jsxs)("span",{children:["當前屬性 (Lv.",o,"/",n.Max_Level||"??","):"]}),o>=(n.Max_Level||99)&&(0,a.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold"},children:"MAX"})]}),(0,a.jsx)("div",{children:function(e,l,t){let a=(l.Base_Val||0)+(t-1)*(l.Level_Mult||0);return e.replace("{val}",a.toLocaleString())}(n.Desc_Template,n,o)})]}),(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"8px"},children:[s?(0,a.jsx)("button",{className:"ca-btn",onClick:()=>{r(n.Slot),t()},style:{flex:1,background:"#ef4444",color:"white",fontWeight:"bold"},children:"卸下"}):(0,a.jsx)("button",{className:"ca-btn",onClick:()=>{i(l.id,n.Slot),t()},style:{flex:1,background:"var(--ca-accent-gold)",color:"black",fontWeight:"bold"},children:"裝備"}),(0,a.jsx)("button",{className:"ca-btn",onClick:t,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"關閉"})]})]})})}function S(e){var l;let{player:t,effectiveStats:r,totalDps:s,userId:n,gameConfig:o,onEquip:c,onUnequip:d}=e,[p,u]=i.useState(null),g=Object.entries((null==(l=t.equipment)?void 0:l.inventory)||{}).filter(e=>{let[,l]=e;return l>0}).map(e=>{var l;let[t,a]=e;return{id:t,level:a,config:null==o||null==(l=o.equipments)?void 0:l.find(e=>String(e.ID)===String(t))}}).filter(e=>!!e.config);return(0,a.jsxs)("div",{className:"ca-character-view",style:{flex:1,display:"flex",flexDirection:"column",width:"100%",height:"100%",padding:"16px",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{flex:"1 1 50%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",minHeight:"350px",position:"relative",paddingTop:"10px"},children:[(0,a.jsxs)("div",{style:{width:"100%",maxWidth:"450px",display:"flex",justifyContent:"center",gap:"8px",marginBottom:"12px",zIndex:10},children:[(0,a.jsxs)("div",{className:"ca-glass",style:{flex:1,padding:"10px 6px",borderRadius:"16px",background:"rgba(30, 41, 59, 0.4)",border:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",alignItems:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[(0,a.jsx)("span",{style:{fontSize:"0.65rem",color:"#94a3b8",marginBottom:"4px"},children:"⚔️ 點擊傷害"}),(0,a.jsx)("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#fff"},children:Math.floor(r.baseDamage).toLocaleString()}),r.baseDamage>t.stats.baseDamage&&(0,a.jsxs)("span",{style:{fontSize:"0.6rem",color:"#4ade80",fontWeight:"bold"},children:["+",(r.baseDamage-t.stats.baseDamage).toLocaleString()]})]}),(0,a.jsxs)("div",{className:"ca-glass",style:{flex:1,padding:"10px 6px",borderRadius:"16px",background:"rgba(30, 41, 59, 0.4)",border:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",alignItems:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[(0,a.jsx)("span",{style:{fontSize:"0.65rem",color:"#94a3b8",marginBottom:"4px"},children:"\uD83E\uDD16 秒傷 (DPS)"}),(0,a.jsx)("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#fff"},children:Math.floor(s).toLocaleString()}),r.autoAttackDamage>t.stats.autoAttackDamage&&(0,a.jsxs)("span",{style:{fontSize:"0.6rem",color:"#4ade80",fontWeight:"bold"},children:["+",(r.autoAttackDamage-t.stats.autoAttackDamage).toLocaleString()]})]}),(0,a.jsxs)("div",{className:"ca-glass",style:{flex:1,padding:"10px 6px",borderRadius:"16px",background:"rgba(30, 41, 59, 0.4)",border:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",alignItems:"center",boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:[(0,a.jsx)("span",{style:{fontSize:"0.65rem",color:"#fca5a5",marginBottom:"4px"},children:"\uD83D\uDC79 BOSS 傷害"}),(0,a.jsxs)("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#fff"},children:[(r.bossDamageMultiplier||1).toFixed(2),"x"]}),r.bossDamageMultiplier>t.stats.bossDamageMultiplier&&(0,a.jsxs)("span",{style:{fontSize:"0.6rem",color:"#4ade80",fontWeight:"bold"},children:["+",((r.bossDamageMultiplier-t.stats.bossDamageMultiplier)*100).toFixed(0),"%"]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",width:"100%",maxWidth:"500px",justifyContent:"space-between",alignItems:"center",zIndex:2,padding:"0 10px"},children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,a.jsx)(C,{slot:D.MAIN_HAND,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(C,{slot:D.HEAD,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(C,{slot:D.BODY,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}})]}),(0,a.jsxs)("div",{className:"ca-character-figure ca-bounce-slow",style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(n||"Guest"),alt:"Character",style:{width:"140px",height:"140px",filter:"drop-shadow(0 10px 20px rgba(0,0,0,0.5))"}}),(0,a.jsxs)("div",{className:"ca-glass",style:{marginTop:"8px",padding:"4px 12px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(15, 23, 42, 0.6)"},children:[(0,a.jsxs)("span",{style:{fontSize:"1rem"},children:["Lv.",t.system.level]}),(0,a.jsx)("span",{style:{width:"1px",height:"12px",background:"rgba(255,255,255,0.2)"}}),(0,a.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold",fontSize:"0.9rem"},children:n||"Guest"})]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[(0,a.jsx)(C,{slot:D.HANDS,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(C,{slot:D.LEGS,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(C,{slot:D.RELIC,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}})]})]}),(0,a.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"250px",height:"250px",background:"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",pointerEvents:"none",zIndex:0}})]}),(0,a.jsxs)("div",{style:{flex:"1 1 50%",width:"100%",background:"rgba(15, 23, 42, 0.4)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{padding:"12px 16px",background:"rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{style:{fontWeight:"bold",color:"#e2e8f0"},children:["\uD83C\uDF92 裝備倉庫 (",g.length,")"]}),(0,a.jsx)("span",{style:{fontSize:"0.7rem",color:"var(--ca-text-muted)"},children:"點擊裝備以穿戴"})]}),(0,a.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"12px"},children:0===g.length?(0,a.jsx)("div",{style:{textAlign:"center",color:"gray",padding:"40px 0"},children:"倉庫空空如也..."}):(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:g.map(e=>{var l;let i=Object.values((null==(l=t.equipment)?void 0:l.equipped)||{}).includes(e.id);return(0,a.jsxs)("div",{onClick:()=>u(e),className:"ca-inventory-item",style:{width:"64px",height:"64px",background:"rgba(30, 41, 59, 0.6)",border:i?"2px solid var(--ca-accent-gold)":"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",opacity:i?.6:1},title:"".concat(e.config.Name," (Lv.").concat(e.level,") - ").concat(e.config.Slot),children:[(0,a.jsx)("span",{style:{fontSize:"1.8rem"},children:M(e.config.Slot)}),(0,a.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.6rem",padding:"1px 4px",borderRadius:"4px",fontWeight:"bold"},children:["L.",e.level]}),i&&(0,a.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",background:"var(--ca-accent-gold)",color:"black",fontSize:"0.5rem",padding:"1px 3px",borderRadius:"3px",fontWeight:"bold"},children:"E"})]},e.id)})})})]}),p&&(0,a.jsx)(j,{item:p,onClose:()=>u(null),onEquip:c,onUnequip:d,isEquipped:Object.values(t.equipment.equipped).includes(p.id)})]})}function M(e){switch(e){case D.MAIN_HAND:return"⚔️";case D.HEAD:return"\uD83E\uDE96";case D.BODY:return"\uD83D\uDC55";case D.HANDS:return"\uD83E\uDDE4";case D.LEGS:return"\uD83D\uDC62";case D.RELIC:return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function C(e){var l,t,i,r,s;let{slot:n,player:o,gameConfig:c,onClick:d}=e,p=null==(t=o.equipment)||null==(l=t.equipped)?void 0:l[n],u=p?null==c||null==(i=c.equipments)?void 0:i.find(e=>String(e.ID)===String(p)):null,g=p?(null==(s=o.equipment)||null==(r=s.inventory)?void 0:r[p])||1:0;return(0,a.jsxs)("div",{className:"ca-equipment-slot",style:{width:"64px",height:"64px",background:"rgba(15, 23, 42, 0.6)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",transition:"all 0.2s"},onClick:()=>p&&(null==d?void 0:d(p)),title:u?"".concat(u.Name," (Lv.").concat(g,")"):"Empty Slot",children:[(0,a.jsx)("div",{style:{fontSize:"2rem",opacity:u?1:.3},children:M(n)}),u&&(0,a.jsxs)("div",{style:{position:"absolute",bottom:"-6px",right:"-6px",background:"#4f46e5",color:"white",fontSize:"0.6rem",padding:"2px 6px",borderRadius:"10px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.2)"},children:["Lv.",g]})]})}let N={STAGE_1_20:[{name:"史萊姆",emoji:"\uD83D\uDC7E",rarity:"COMMON",hpMultiplier:1,goldMultiplier:1,xpMultiplier:1},{name:"小蘑菇",emoji:"\uD83C\uDF44",rarity:"COMMON",hpMultiplier:.9,goldMultiplier:.9,xpMultiplier:.9},{name:"野狼",emoji:"\uD83D\uDC3A",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1.1,xpMultiplier:1.1},{name:"野豬",emoji:"\uD83D\uDC17",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.1,xpMultiplier:1.1},{name:"青蛇",emoji:"\uD83D\uDC0D",rarity:"COMMON",hpMultiplier:.8,goldMultiplier:1,xpMultiplier:1.2}],STAGE_21_40:[{name:"大蝙蝠",emoji:"\uD83E\uDD87",rarity:"COMMON",hpMultiplier:.9,goldMultiplier:1.2,xpMultiplier:1.1},{name:"毒蜘蛛",emoji:"\uD83D\uDD77️",rarity:"COMMON",hpMultiplier:1,goldMultiplier:1.1,xpMultiplier:1.1},{name:"骷髏兵",emoji:"\uD83D\uDC80",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.1,xpMultiplier:1.1},{name:"蠍子",emoji:"\uD83E\uDD82",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.3,xpMultiplier:1.2},{name:"巨鼠",emoji:"\uD83D\uDC00",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1,xpMultiplier:1}],STAGE_41_60:[{name:"靈狐",emoji:"\uD83E\uDD8A",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.5,xpMultiplier:1.5},{name:"竹妖",emoji:"\uD83C\uDF8B",rarity:"COMMON",hpMultiplier:1.4,goldMultiplier:1.3,xpMultiplier:1.3},{name:"武道家",emoji:"\uD83E\uDD4B",rarity:"COMMON",hpMultiplier:1.5,goldMultiplier:1.4,xpMultiplier:1.6},{name:"白虎",emoji:"\uD83D\uDC2F",rarity:"COMMON",hpMultiplier:1.6,goldMultiplier:1.6,xpMultiplier:1.6},{name:"靈鷹",emoji:"\uD83E\uDD85",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1.4,xpMultiplier:1.4}],STAGE_61_80:[{name:"火元素",emoji:"\uD83D\uDD25",rarity:"COMMON",hpMultiplier:1.4,goldMultiplier:1.6,xpMultiplier:1.5},{name:"冰魔像",emoji:"❄️",rarity:"COMMON",hpMultiplier:1.6,goldMultiplier:1.6,xpMultiplier:1.5},{name:"雷靈",emoji:"⚡",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.8,xpMultiplier:1.6},{name:"風怪",emoji:"\uD83C\uDF2A️",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.5,xpMultiplier:1.5},{name:"岩石巨人",emoji:"\uD83D\uDDFF",rarity:"COMMON",hpMultiplier:2,goldMultiplier:1.5,xpMultiplier:1.2}],STAGE_81_PLUS:[{name:"惡鬼",emoji:"\uD83D\uDC79",rarity:"COMMON",hpMultiplier:1.8,goldMultiplier:2,xpMultiplier:2},{name:"幽靈",emoji:"\uD83D\uDC7B",rarity:"COMMON",hpMultiplier:1.5,goldMultiplier:1.8,xpMultiplier:1.8},{name:"吸血鬼",emoji:"\uD83E\uDDDB",rarity:"COMMON",hpMultiplier:1.7,goldMultiplier:2.2,xpMultiplier:2},{name:"殭屍",emoji:"\uD83E\uDDDF",rarity:"COMMON",hpMultiplier:2.2,goldMultiplier:1.6,xpMultiplier:1.8}]},w=[{name:"黃金史萊姆",emoji:"\uD83D\uDCB0",rarity:"RARE",hpMultiplier:.5,goldMultiplier:5,xpMultiplier:1},{name:"金屬史萊姆",emoji:"\uD83E\uDD16",rarity:"RARE",hpMultiplier:5,goldMultiplier:1,xpMultiplier:5},{name:"寶箱怪",emoji:"\uD83D\uDCE6",rarity:"RARE",hpMultiplier:2,goldMultiplier:2,xpMultiplier:1,dropDiamonds:2},{name:"幸運草精",emoji:"\uD83C\uDF40",rarity:"RARE",hpMultiplier:.1,goldMultiplier:1,xpMultiplier:1}],_=[{name:"金剛",emoji:"\uD83E\uDD8D",rarity:"BOSS",hpMultiplier:5,goldMultiplier:10,xpMultiplier:10},{name:"巨鱷",emoji:"\uD83D\uDC0A",rarity:"BOSS",hpMultiplier:5,goldMultiplier:10,xpMultiplier:10},{name:"霸王龍",emoji:"\uD83E\uDD96",rarity:"BOSS",hpMultiplier:6,goldMultiplier:12,xpMultiplier:12}],k=[{name:"魔龍",emoji:"\uD83D\uDC32",rarity:"BOSS",hpMultiplier:15,goldMultiplier:20,xpMultiplier:20,dropDiamonds:5},{name:"赤鬼王",emoji:"\uD83D\uDC7A",rarity:"BOSS",hpMultiplier:12,goldMultiplier:18,xpMultiplier:18,dropDiamonds:3},{name:"克拉肯",emoji:"\uD83E\uDD91",rarity:"BOSS",hpMultiplier:14,goldMultiplier:19,xpMultiplier:19,dropDiamonds:4},{name:"撒旦",emoji:"\uD83D\uDC7F",rarity:"BOSS",hpMultiplier:16,goldMultiplier:25,xpMultiplier:25,dropDiamonds:6}];var L=t(23464);let A="https://script.google.com/macros/s/AKfycbxegFPp4kJZXDxUNqQopqiWVa2JLLM__rJbm700mUQsovg2nkE6wSJd2lFQyJQ4dg10/exec",I={loadPlayerSave:async e=>{try{let l=await L.A.get("".concat(A,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(l.data&&l.data.exists)return l.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,l)=>{try{if(!e)throw Error("User ID is required for saving");let t=await L.A.post(A,{action:"save_progress",userId:e,saveData:l},{headers:{"Content-Type":"text/plain"}});if(t.data&&t.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await L.A.get("".concat(A,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},E={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0,ascensionPoints:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,bossDamageMultiplier:1},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{},levelShop:{},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,amuletLevel:0},ascensionShop:{},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0},equipment:{inventory:{},equipped:{}},lastDailyRewardClaimTime:0},O={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10};function R(){let[e,l]=(0,i.useState)(null),[t,s]=(0,i.useState)("BATTLE"),[d,u]=(0,i.useState)(E),[g,x]=(0,i.useState)(O),[m,h]=(0,i.useState)(null),[v,y]=(0,i.useState)(null),[b,D]=(0,i.useState)(null),j=i.useMemo(()=>{let e={baseDamage:d.stats.baseDamage||1,autoAttackDamage:d.stats.autoAttackDamage||0,criticalChance:d.stats.criticalChance||.05,criticalDamage:d.stats.criticalDamage||1.5,goldMultiplier:d.stats.goldMultiplier||1,cpMultiplier:d.stats.cpMultiplier||1,xpMultiplier:d.stats.xpMultiplier||1,bossDamageMultiplier:d.stats.bossDamageMultiplier||1};return(null==v?void 0:v.equipments)&&Object.values(d.equipment.equipped).forEach(l=>{if(!l)return;let t=v.equipments.find(e=>String(e.ID)===String(l));if(t){let a=Number(d.equipment.inventory[l]||1),i=Number(t.Base_Val||0)+(a-1)*Number(t.Level_Mult||0);switch(String(t.Effect_Type||"").toUpperCase().trim()){case"ADD_BASE_DMG":case"CLICK_DMG":case"CLICK_DAMAGE":case"ADD_DAMAGE":case"ADD_CLICK_DMG":e.baseDamage+=i;break;case"ADD_AUTO_DMG":case"AUTO_DMG":case"AUTO_DAMAGE":case"ADD_AUTO":e.autoAttackDamage+=i;break;case"ADD_CRIT_CHANCE":case"CRIT_RATE":case"ADD_CRIT_RATE":case"LUCK":e.criticalChance+=i/100;break;case"ADD_CRIT_DMG":case"CRIT_DMG":case"CRIT_DAMAGE":case"ADD_CRIT_DMG":e.criticalDamage+=i/100;break;case"ADD_GOLD_MULT":case"GOLD_MULT":case"ADD_GOLD":case"GOLD_BONUS":e.goldMultiplier+=i/100;break;case"ADD_XP_MULT":case"XP_MULT":case"ADD_XP":case"XP_BONUS":e.xpMultiplier+=i/100;break;case"ADD_BOSS_DMG":case"BOSS_DMG":case"BOSS_DAMAGE":e.bossDamageMultiplier+=i/100;break;case"CP_MULT":case"CP_BONUS":case"ADD_CP_MULT":e.cpMultiplier+=i/100}}}),e},[d.stats,d.equipment.equipped,d.equipment.inventory,v]),M=(0,i.useCallback)((e,l)=>{var t,a,i,r;return{...e,...l,system:{...e.system,...l.system||{}},wallet:{...e.wallet,...l.wallet||{}},stats:{...e.stats,...l.stats||{}},clickShop:{...e.clickShop,...l.clickShop||{}},levelShop:{...e.levelShop,...l.levelShop||{}},goldShop:{...e.goldShop,...l.goldShop||{}},ascensionShop:{...e.ascensionShop,...l.ascensionShop||{}},inventory:{...e.inventory,...l.inventory||{}},activeBuffs:{...e.activeBuffs,...l.activeBuffs||{}},equipment:{...e.equipment,...l.equipment||{},inventory:{...(null==(t=e.equipment)?void 0:t.inventory)||{},...(null==(a=l.equipment)?void 0:a.inventory)||{}},equipped:{...(null==(i=e.equipment)?void 0:i.equipped)||{},...(null==(r=l.equipment)?void 0:r.equipped)||{}}}}},[]),C=2*(d.goldShop.mercenaryLevel||0)+5*(d.goldShop.partnerLevel||0)+20*(d.goldShop.archerLevel||0)+100*(d.goldShop.knightLevel||0),L=j.autoAttackDamage+C,A=Math.floor(10*j.baseDamage+20*L+1e3*j.criticalChance+500*j.criticalDamage);(0,i.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await I.getGameConfigs();e&&(console.log("[Config] Loaded:",e),y(e))})();let e=localStorage.getItem("ca_last_user_id");e&&G(e)},[]);let R=(0,i.useCallback)(()=>{let e=g.isBossActive;!e&&g.autoChallengeBoss&&g.monstersKilledInStage>=g.monstersRequiredForBoss&&(e=!0);let l=function(e,l){if(l)return e%10==0?k[Math.floor(Math.random()*k.length)]:_[Math.floor(Math.random()*_.length)];let t=Math.random();if(t<.11)return t<.05?w[0]:t<.08?w[1]:t<.1?w[2]:w[3];let a=N.STAGE_1_20;return e>80?a=N.STAGE_81_PLUS:e>60?a=N.STAGE_61_80:e>40?a=N.STAGE_41_60:e>20&&(a=N.STAGE_21_40),a[Math.floor(Math.random()*a.length)]}(g.currentStageId,e),t=Math.ceil((20*Math.pow(1.18,g.currentStageId-1)+10*g.currentStageId)*l.hpMultiplier),a=.15*t*l.goldMultiplier,i=.08*t*l.xpMultiplier;h({id:crypto.randomUUID(),name:"".concat(l.name," Lv.").concat(g.currentStageId),level:g.currentStageId,maxHp:t,currentHp:t,isBoss:"BOSS"===l.rarity,rewardGold:Math.max(1,Math.floor(a)),rewardXp:Math.max(1,Math.floor(i)),emoji:l.emoji})},[g]),[T,P]=(0,i.useState)(null);(0,i.useEffect)(()=>{m||R()},[m,R]),(0,i.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&G(e)},[]);let z=i.useRef(d),B=i.useRef(g);(0,i.useEffect)(()=>{z.current=d,B.current=g},[d,g]),(0,i.useEffect)(()=>{if(!T)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(T," to Cloud..."));let e={player:z.current,stage:B.current,timestamp:Date.now()};try{await I.savePlayerProgress(T,e),localStorage.setItem("ca_save_".concat(T),JSON.stringify(e))}catch(l){console.warn("[AutoSave] Cloud save failed, using local backup",l),localStorage.setItem("ca_save_".concat(T),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[T]);let G=async e=>{if(!e)return;P(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let l=await I.loadPlayerSave(e);if(l){console.log("[Login] Cloud save found!"),l.player&&u(e=>M(e,l.player)),l.stage&&x(e=>({...e,...l.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let l=localStorage.getItem("ca_save_".concat(e));if(l){console.log("[Login] Found local backup.");try{let e=JSON.parse(l);u(l=>({...l,...e.player})),x(l=>({...l,...e.stage}))}catch(e){}}},q=async()=>{if(!T)return;let e={player:d,stage:g,timestamp:Date.now()};try{alert("☁️ 上傳中..."),await I.savePlayerProgress(T,e),alert("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(T),JSON.stringify(e))}catch(l){console.error("Save failed",l),alert("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(T),JSON.stringify(e))}};(0,i.useEffect)(()=>{let e=2*(d.goldShop.mercenaryLevel||0)+5*(d.goldShop.partnerLevel||0)+20*(d.goldShop.archerLevel||0)+100*(d.goldShop.knightLevel||0);if(!m||m.currentHp<=0||j.autoAttackDamage<=0&&e<=0)return;let l=setInterval(()=>{let l=j.autoAttackDamage+e,t=m.isBoss&&j.bossDamageMultiplier||1,a=Math.ceil(l*t);h(e=>{if(!e||e.currentHp<=0)return e;let l=e.currentHp-a;return l<=0?(setTimeout(()=>U(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,l)}}),u(e=>{let l=+j.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+l},records:{...e.records,totalDamageDealt:e.records.totalDamageDealt+a}}}),D({time:Date.now(),damage:a,breakdown:{mercenary:Math.ceil(2*(d.goldShop.mercenaryLevel||0)*t),partner:Math.ceil(5*(d.goldShop.partnerLevel||0)*t),archer:Math.ceil(20*(d.goldShop.archerLevel||0)*t),knight:Math.ceil(100*(d.goldShop.knightLevel||0)*t),player:Math.ceil(j.autoAttackDamage*t)}})},1e3);return()=>clearInterval(l)},[null==m?void 0:m.id,j.autoAttackDamage,j.bossDamageMultiplier,j.cpMultiplier,d.goldShop.mercenaryLevel,d.goldShop.partnerLevel,d.goldShop.archerLevel,d.goldShop.knightLevel]);let U=e=>{if(!e)return;let l=Math.ceil(e.rewardGold*j.goldMultiplier),t=Math.ceil(e.rewardXp*j.xpMultiplier);u(a=>{let{level:i,currentXp:r,requiredXp:s}=a.system,{levelPoints:n}=a.wallet;for(r+=t;r>=s;)r-=s,i+=1,n+=5,s=Math.floor(1.2*s);return{...a,wallet:{...a.wallet,gold:a.wallet.gold+l,levelPoints:n},system:{...a.system,level:i,currentXp:r,requiredXp:s},records:{...a.records,monstersKilled:a.records.monstersKilled+1,totalGoldEarned:a.records.totalGoldEarned+l,bossesKilled:e.isBoss?a.records.bossesKilled+1:a.records.bossesKilled}}}),x(l=>{if(e.isBoss)return{...l,currentStageId:l.currentStageId+1,maxStageReached:Math.max(l.maxStageReached,l.currentStageId+1),isBossActive:!1,monstersKilledInStage:0};let t=l.monstersKilledInStage+1;return{...l,monstersKilledInStage:t}}),h(null)},W=e=>{"RAGE"===e&&d.inventory.ragePotionCount>0&&u(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))},H=()=>{let e=Math.floor(10*Math.pow(1.2,Math.max(0,g.maxStageReached-0)));e<=0||(u(l=>({...l,wallet:{...l.wallet,gold:0,ascensionPoints:(l.wallet.ascensionPoints||0)+e},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,amuletLevel:0},stats:{...l.stats,baseDamage:1+5*l.clickShop.clickPowerLevel,autoAttackDamage:0+5*l.levelShop.autoClickLevel,criticalChance:.05+.01*l.levelShop.luckLevel,criticalDamage:1.5+.1*l.clickShop.critDamageLevel,goldMultiplier:1+.1*l.clickShop.goldBonusLevel+.05*l.levelShop.greedLevel,xpMultiplier:1+.05*l.levelShop.wisdomLevel,bossDamageMultiplier:1+.1*l.levelShop.bossSlayerLevel,cpMultiplier:1}})),u(e=>{let l={...e.stats};return["clickShop","levelShop","ascensionShop"].forEach(t=>{Object.entries(e[t]).forEach(e=>{var t;let[a,i]=e,r=null==v||null==(t=v.upgrades)?void 0:t.find(e=>e.ID===a);if(r&&i>0){let e=r.Effect_Type,t=Number(r.Effect_Val||0)*i;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(l.baseDamage+=t),("ADD_CRIT"===e||"CRIT_RATE"===e)&&(l.criticalChance+=t/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(l.criticalDamage+=t/100),("ADD_GOLD"===e||"GOLD_MULT"===e)&&(l.goldMultiplier+=t/100),("ADD_XP"===e||"XP_MULT"===e)&&(l.xpMultiplier+=t/100),("ADD_AUTO"===e||"AUTO_DMG"===e)&&(l.autoAttackDamage+=t),("ADD_BOSS_DMG"===e||"BOSS_DMG"===e)&&(l.bossDamageMultiplier+=t/100)}})}),{...e,stats:l}}),x(e=>({...e,currentStageId:1,monstersKilledInStage:0,isBossActive:!1,maxStageReached:1})),h(null),alert("⚡ 渡劫成功！獲得 ".concat(e," 點飛昇點數！")),s("BATTLE"))},F=i.useMemo(()=>Math.floor(10*Math.pow(1.2,Math.max(0,g.maxStageReached-0))),[g.maxStageReached]);return(0,a.jsxs)("div",{className:"ca-game-container",children:[(0,a.jsx)(r,{player:d,combatPower:A,stageId:g.currentStageId,onAvatarClick:()=>l("PROFILE"),onAscension:()=>{if(F<=0)return void alert("尚未達到飛升條件！");window.confirm("確定要渡劫飛升嗎？\n\n將重置關卡與金幣，並獲得 ".concat(F.toLocaleString()," 點飛升點數！"))&&H()},potentialPoints:F}),"BATTLE"===t?(0,a.jsx)(n,{monster:m,stageId:g.currentStageId,onMonsterClick:(e,l)=>{if(!m||m.currentHp<=0)return;let t=e;m.isBoss&&(t=Math.ceil(e*j.bossDamageMultiplier));let a=m.currentHp-t;h(e=>e?{...e,currentHp:Math.max(0,a)}:null),u(e=>({...e,records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+t},wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+ +j.cpMultiplier}})),a<=0&&U(m)},baseDamage:j.baseDamage,criticalChance:j.criticalChance,criticalDamage:j.criticalDamage,monstersKilled:g.monstersKilledInStage,monstersRequired:g.monstersRequiredForBoss,isBossActive:g.isBossActive,mercenaryLevel:d.goldShop.mercenaryLevel,partnerLevel:d.goldShop.partnerLevel,archerLevel:d.goldShop.archerLevel,knightLevel:d.goldShop.knightLevel,potionCount:d.inventory.ragePotionCount,activeBuffs:d.activeBuffs,onUsePotion:()=>W("RAGE"),lastAutoAttack:b}):(0,a.jsx)(S,{player:d,effectiveStats:j,totalDps:L,userId:T,gameConfig:v,onEquip:(e,l)=>{u(t=>({...t,equipment:{...t.equipment,equipped:{...t.equipment.equipped,[l]:e}}}))},onUnequip:e=>{u(l=>{let t={...l.equipment.equipped};return delete t[e],{...l,equipment:{...l.equipment,equipped:t}}})}}),(0,a.jsx)(o,{activeView:t,onSwitchView:s,onOpenModal:l}),(0,a.jsx)(c,{isOpen:"PROFILE"===e,onClose:()=>l(null),title:"玩家資料",children:(0,a.jsx)(f,{player:d,effectiveStats:j,combatPower:A,userId:T,onLogin:G,onLogout:()=>{P(null),localStorage.removeItem("ca_last_user_id"),u(E),x(O)},onManualSave:q,gameConfig:v})}),(0,a.jsx)(c,{isOpen:"SHOP"===e,onClose:()=>l(null),title:"商店",headerContent:(0,a.jsxs)("div",{className:"ca-shop-currency-bar",style:{display:"flex",flexWrap:"wrap",border:"none",background:"transparent",padding:"0 8px",gap:"12px"},children:[(0,a.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},title:"金幣",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{children:Math.floor(d.wallet.gold).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},title:"鑽石",children:[(0,a.jsx)("span",{children:"\uD83D\uDC8E"}),(0,a.jsx)("span",{children:d.wallet.diamonds.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"var(--ca-accent-cyan, #22d3ee)"},title:"點擊點數",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:Math.floor(d.wallet.clickPoints).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#4ade80"},title:"等級積分",children:[(0,a.jsx)("span",{children:"\uD83C\uDD99"}),(0,a.jsx)("span",{children:d.wallet.levelPoints.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#d8b4fe"},title:"飛昇點數",children:[(0,a.jsx)("span",{children:"\uD83D\uDD4A️"}),(0,a.jsx)("span",{children:d.wallet.ascensionPoints.toLocaleString()})]})]}),children:(0,a.jsx)(p,{player:d,onPurchase:e=>{var l,t,a;if("daily_checkin"===e)return void u(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+10,gold:e.wallet.gold+500},lastDailyRewardClaimTime:Date.now()}));if(e.startsWith("click_shop_")){let t=null==v||null==(l=v.upgrades)?void 0:l.find(l=>l.ID===e);if(!t)return;let a=d.clickShop[e]||0,i=Math.floor(t.Cost_Base*Math.pow(t.Cost_Mult,a));d.wallet.clickPoints>=i?u(l=>{let r={...l.stats},s=t.Effect_Type,n=Number(t.Effect_Val||0);return("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(r.baseDamage+=n),("ADD_CRIT_DMG"===s||"CRIT_DMG"===s)&&(r.criticalDamage+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(r.goldMultiplier+=n/100),{...l,wallet:{...l.wallet,clickPoints:l.wallet.clickPoints-i},clickShop:{...l.clickShop,[e]:a+1},stats:r}}):alert("點擊點數不足！");return}if(e.startsWith("level_shop_")){let l=null==v||null==(t=v.upgrades)?void 0:t.find(l=>l.ID===e);if(!l)return;let a=d.levelShop[e]||0,i=Math.floor(l.Cost_Base*Math.pow(l.Cost_Mult,a));d.wallet.levelPoints>=i?u(t=>{let r={...t.stats},s=l.Effect_Type,n=Number(l.Effect_Val||0);return("ADD_XP"===s||"XP_MULT"===s)&&(r.xpMultiplier+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(r.goldMultiplier+=n/100),("ADD_AUTO"===s||"AUTO_DMG"===s)&&(r.autoAttackDamage+=n),("ADD_BOSS_DMG"===s||"BOSS_DMG"===s)&&(r.bossDamageMultiplier+=n/100),("ADD_CRIT"===s||"CRIT_RATE"===s)&&(r.criticalChance+=n/100),{...t,wallet:{...t.wallet,levelPoints:t.wallet.levelPoints-i},levelShop:{...t.levelShop,[e]:a+1},stats:r}}):alert("等級積分不足！");return}let i=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:"DIAMOND"},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:"DIAMOND"}].find(l=>l.id===e);if(i&&"DIAMOND"===i.currency&&d.wallet.diamonds>=i.cost&&u(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds-i.cost,gold:e.wallet.gold+i.reward}})),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:l}=d,t=0;switch(e){case"gold_shop_weapon":t=Math.floor(10*Math.pow(1.2,l.weaponLevel)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,weaponLevel:e.goldShop.weaponLevel+1},stats:{...e.stats,baseDamage:e.stats.baseDamage+1}}));break;case"gold_shop_mercenary":t=Math.floor(100*Math.pow(1.3,l.mercenaryLevel)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,mercenaryLevel:e.goldShop.mercenaryLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+2}}));break;case"gold_shop_partner":t=Math.floor(500*Math.pow(1.3,l.partnerLevel)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,partnerLevel:e.goldShop.partnerLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+5}}));break;case"gold_shop_archer":t=Math.floor(2e3*Math.pow(1.4,l.archerLevel||0)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,archerLevel:(e.goldShop.archerLevel||0)+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+20}}));break;case"gold_shop_knight":t=Math.floor(1e4*Math.pow(1.5,l.knightLevel||0)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,knightLevel:(e.goldShop.knightLevel||0)+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+100}}));break;case"gold_shop_amulet":t=Math.floor(5e3*Math.pow(1.5,l.amuletLevel||0)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,amuletLevel:(e.goldShop.amuletLevel||0)+1},stats:{...e.stats,goldMultiplier:e.stats.goldMultiplier+.05}}));break;case"gold_potion_rage":t=500,d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount+1}}))}}if("gacha_equipment_basic"===e)if(d.wallet.gold>=1e3){let e=(null==v?void 0:v.equipments)||[];if(e.length>0){let l=Math.random()*e.reduce((e,l)=>e+(Number(l.Gacha_Weight)||0),0),t=e[0];for(let a of e){let e=Number(a.Gacha_Weight)||0;if(l<e){t=a;break}l-=e}u(e=>{var l,a;let i=(null==(a=e.equipment)||null==(l=a.inventory)?void 0:l[t.ID])||0,r=t.Max_Level||99;if(i>=r){let l=Math.floor(500);return alert("".concat(t.Name," 已達最高等級 (Lv.").concat(r,")！\n轉化為補償金幣：").concat(l)),{...e,wallet:{...e.wallet,gold:e.wallet.gold-1e3+l}}}return{...e,wallet:{...e.wallet,gold:e.wallet.gold-1e3},equipment:{...e.equipment,inventory:{...e.equipment.inventory,[t.ID]:i+1}}}}),alert("獲得裝備：".concat(t.Name," (Rarity: ").concat(t.Rarity,")"))}else alert("暫無裝備可抽取")}else alert("金幣不足！");if(e.startsWith("ascension_shop_")){let l=null==v||null==(a=v.upgrades)?void 0:a.find(l=>l.ID===e);if(!l)return;let t=d.ascensionShop[e]||0,i=Math.floor(l.Cost_Base*Math.pow(l.Cost_Mult,t));d.wallet.ascensionPoints>=i?u(a=>{let r={...a.stats},s=l.Effect_Type,n=Number(l.Effect_Val||0);return("ADD_CRIT"===s||"CRIT_RATE"===s)&&(r.criticalChance+=n/100),("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(r.baseDamage+=n),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(r.goldMultiplier+=n/100),("ADD_XP"===s||"XP_MULT"===s)&&(r.xpMultiplier+=n/100),{...a,wallet:{...a.wallet,ascensionPoints:a.wallet.ascensionPoints-i},ascensionShop:{...a.ascensionShop,[e]:t+1},stats:r}}):alert("氣運點數不足！")}},gameConfig:v})})]})}}}]);