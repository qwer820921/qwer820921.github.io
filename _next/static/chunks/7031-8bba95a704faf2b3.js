(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7031],{26682:(e,t,n)=>{"use strict";n.d(t,{z:()=>_});var o=n(65453),r=n(32588);let a=(e,t)=>"".concat(e,"-").concat(t),_=(0,o.v)((e,t)=>({novels:[],novelsLoading:!1,novelsError:null,novelsFetchedAt:null,chaptersMap:{},chaptersLoading:{},chaptersError:{},chapterContentMap:{},fetchLibrary:async function(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=t(),a=Date.now(),_=o.novels.length>0&&null!==o.novelsFetchedAt;if(_&&a-o.novelsFetchedAt<3e5&&!n)return o.novels;if(_&&!n)return(0,r.wK)().then(t=>{t.success&&t.data&&e({novels:t.data,novelsFetchedAt:Date.now(),novelsError:null})}).catch(()=>{}),o.novels;e({novelsLoading:!0,novelsError:null});try{let t=await (0,r.wK)();if(t.success&&t.data)return e({novels:t.data,novelsFetchedAt:Date.now(),novelsLoading:!1,novelsError:null}),t.data;{let n=t.error||"無法取得書籍資料";return e({novelsLoading:!1,novelsError:n}),[]}}catch(t){return e({novelsLoading:!1,novelsError:t instanceof Error?t.message:"伺服器連線異常，請稍後再試"}),[]}},fetchChapters:async function(n){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t(),_=Date.now(),s=a.chaptersMap[n],l=!!s;if(l&&_-s.fetchedAt<3e5&&!o)return s.data;if(l&&!o)return(0,r.hE)(n).then(t=>{t.success&&t.data&&e(e=>({chaptersMap:{...e.chaptersMap,[n]:{data:t.data,fetchedAt:Date.now()}},chaptersError:{...e.chaptersError,[n]:null}}))}).catch(()=>{}),s.data;e(e=>({chaptersLoading:{...e.chaptersLoading,[n]:!0},chaptersError:{...e.chaptersError,[n]:null}}));try{let t=await (0,r.hE)(n);if(t.success&&t.data)return e(e=>({chaptersMap:{...e.chaptersMap,[n]:{data:t.data,fetchedAt:Date.now()}},chaptersLoading:{...e.chaptersLoading,[n]:!1},chaptersError:{...e.chaptersError,[n]:null}})),t.data;return e(e=>({chaptersLoading:{...e.chaptersLoading,[n]:!1},chaptersError:{...e.chaptersError,[n]:"無法取得章節資料"}})),[]}catch(o){let t=o instanceof Error?o.message:"章節目錄載入失敗";return e(e=>({chaptersLoading:{...e.chaptersLoading,[n]:!1},chaptersError:{...e.chaptersError,[n]:t}})),[]}},fetchChapterContent:async(n,o)=>{let _=a(n,o),s=t().chapterContentMap[_];if(s)return s;try{let t=await (0,r.L3)(n,o);if(t.success&&t.data)return e(e=>({chapterContentMap:{...e.chapterContentMap,[_]:t.data}})),t.data;return null}catch(e){return null}},getNovelById:e=>t().novels.find(t=>t.id===e)}))},30908:e=>{e.exports={pageContainer:"novels_pageContainer__ahS0I",pageHeader:"novels_pageHeader___b4E7",novelGrid:"novels_novelGrid__vbCIi",card:"novels_card__7t6VH",coverWrapper:"novels_coverWrapper__kiuSJ",coverImage:"novels_coverImage__gHLR8",noCover:"novels_noCover__Zc8Xb",statusBadge:"novels_statusBadge__bA6WA",cardContent:"novels_cardContent__TGtTu",bookTitle:"novels_bookTitle__KRDP1",authorName:"novels_authorName__CrtPO",tagsContainer:"novels_tagsContainer__a0Uve",tag:"novels_tag__c0iRx",metaData:"novels_metaData__Y9E_w",loadingState:"novels_loadingState__uQeq0",errorState:"novels_errorState__beznA",emptyState:"novels_emptyState__otVM1",retryBtn:"novels_retryBtn__dHS2x",backNav:"novels_backNav__JlxT_",detailHeader:"novels_detailHeader__8SOUZ",detailCover:"novels_detailCover__xafPD",detailInfo:"novels_detailInfo__gCSVy",favoriteBtn:"novels_favoriteBtn__oPZqB",favorited:"novels_favorited__loLkz",summarySection:"novels_summarySection__m_reN",chaptersSection:"novels_chaptersSection__NAUJf",chaptersHeader:"novels_chaptersHeader__Kbt_I",chapterCount:"novels_chapterCount__JQLYi",chapterList:"novels_chapterList__ncPhF",chapterItem:"novels_chapterItem___0Bkf",chapterTitle:"novels_chapterTitle__uAPX_",chapterDate:"novels_chapterDate__SqCQQ",bottomTabs:"novels_bottomTabs__d3aUY",tabItem:"novels_tabItem__6fIX5",tabIcon:"novels_tabIcon__AoED4",tabLabel:"novels_tabLabel__PIZoB",tabActive:"novels_tabActive__Hs_A2",settingsSection:"novels_settingsSection__l699M",settingsSectionTitle:"novels_settingsSectionTitle__NVHab",themeSelector:"novels_themeSelector__6SYJw",themeOption:"novels_themeOption__sDRch",themeCircle:"novels_themeCircle__rzvZA",themeOptionActive:"novels_themeOptionActive__tkjyo",themeLabel:"novels_themeLabel__nM_uf",settingsRow:"novels_settingsRow__DOgd0",settingsRowLabel:"novels_settingsRowLabel__AIImX",fontFamilySelector:"novels_fontFamilySelector__771g8",fontFamilyOption:"novels_fontFamilyOption__Wea3K",fontFamilyActive:"novels_fontFamilyActive___lvqQ",fontSizeControl:"novels_fontSizeControl__xmRbq",fontSizeBtn:"novels_fontSizeBtn__KwMeL",fontSizeValue:"novels_fontSizeValue__5GaLY",lineHeightSelector:"novels_lineHeightSelector__4Sj39",lineHeightOption:"novels_lineHeightOption__tZVfF",lineHeightActive:"novels_lineHeightActive__R_mMj",previewBox:"novels_previewBox__jj_wD",settingsActions:"novels_settingsActions__9iDco",resetBtn:"novels_resetBtn__KERdO",readerContainer:"novels_readerContainer__Eytc9",readerHeader:"novels_readerHeader__hJkq0",readerHeaderTitle:"novels_readerHeaderTitle__WpqjZ",readerBackLink:"novels_readerBackLink__QEFYZ",readerHeaderRight:"novels_readerHeaderRight__toxrl",readerTitle:"novels_readerTitle__oDT2E",readerMeta:"novels_readerMeta__95gYw",readerContent:"novels_readerContent__QE0Pa",authorNoteBox:"novels_authorNoteBox__n9t2e",readerFooterNav:"novels_readerFooterNav__t0KSo",navBtn:"novels_navBtn__EEBTN",navBtnDisabled:"novels_navBtnDisabled__5t_7G",navBtnGhost:"novels_navBtnGhost__mmro_",readerLoading:"novels_readerLoading__4JcEm",readerError:"novels_readerError__E8EY_",readerNavButtons:"novels_readerNavButtons__Xkt_g",tocDrawer:"novels_tocDrawer__36mjB",tocDrawerOpen:"novels_tocDrawerOpen__6Ljbr",tocHeader:"novels_tocHeader__CaOi_",tocCount:"novels_tocCount__a1_8Y",tocList:"novels_tocList__b5cym",tocItem:"novels_tocItem__T2dV2",tocItemActive:"novels_tocItemActive__YLrzN",tocItemDate:"novels_tocItemDate__QNYtm",readerSettingsBtn:"novels_readerSettingsBtn__lkSA_",menuOverlay:"novels_menuOverlay__1K6_B",menuOverlayVisible:"novels_menuOverlayVisible__ht7Sv",readerMenu:"novels_readerMenu__Mnnh7",readerMenuOpen:"novels_readerMenuOpen__ppTwm",menuHandle:"novels_menuHandle__2yj9Y",menuHandleBar:"novels_menuHandleBar__M0wSQ",menuSection:"novels_menuSection__AaMn1",menuSectionLabel:"novels_menuSectionLabel__8nOnS",menuThemeRow:"novels_menuThemeRow__S8TAQ",menuThemeBtn:"novels_menuThemeBtn__MLmm7",menuThemeBtnActive:"novels_menuThemeBtnActive__uZEIE",menuFontSizeRow:"novels_menuFontSizeRow__HwGk7",menuStepBtn:"novels_menuStepBtn__nSBFT",menuFontSizeValue:"novels_menuFontSizeValue__FR_AW",menuFontFamilyRow:"novels_menuFontFamilyRow__WYfqF",menuFontFamilyBtn:"novels_menuFontFamilyBtn__JTSF8",menuFontFamilyBtnActive:"novels_menuFontFamilyBtnActive__L1YJ2",menuLineHeightRow:"novels_menuLineHeightRow__pwMed",menuLineHeightBtn:"novels_menuLineHeightBtn__mfVBH",menuLineHeightBtnActive:"novels_menuLineHeightBtnActive__fFD0G",chapterDivider:"novels_chapterDivider__MPUkD","slide-left":"novels_slide-left__ockIW",slideInFromRight:"novels_slideInFromRight__FFYN0","slide-right":"novels_slide-right__Es_OJ",slideInFromLeft:"novels_slideInFromLeft__RWBuJ",chapterSentinel:"novels_chapterSentinel__XSB5i",readerEndMessage:"novels_readerEndMessage__ZfcEs",ttsHighlight:"novels_ttsHighlight__HuUvW",ttsBtnPlaying:"novels_ttsBtnPlaying__g5Xgk",pulseColor:"novels_pulseColor__T0RD4",ttsDrawer:"novels_ttsDrawer__TptYK",ttsDrawerOpen:"novels_ttsDrawerOpen__7SCCM",ttsControls:"novels_ttsControls__bNr2B",ttsIconBtn:"novels_ttsIconBtn__eAcaN",ttsPlayBtn:"novels_ttsPlayBtn__Kru7F",ttsRateBtnPill:"novels_ttsRateBtnPill__CUgN_",ttsProgress:"novels_ttsProgress__5e3Yp",ttsVoiceSection:"novels_ttsVoiceSection__EnpyX",ttsVoiceLabel:"novels_ttsVoiceLabel__QDNq8",ttsVoiceSelect:"novels_ttsVoiceSelect__nJjHs"}},32588:(e,t,n)=>{"use strict";n.d(t,{L3:()=>s,hE:()=>_,wK:()=>a});var o=n(23464);let r="https://script.google.com/macros/s/AKfycbyXrD_ddpu_Z9w-DeUroC4mniQrwKsHdCQWbaE3o2dDlwSvHVB3fLapwepgA3dFaDfi4Q/exec",a=async()=>{try{let e=await o.A.get("".concat(r,"?action=getLibrary"));if(!e.data||"boolean"!=typeof e.data.success)throw Error("Unexpected response format: Expected success boolean");if(e.data.success&&!Array.isArray(e.data.data))throw Error("Unexpected response format: Expected data to be an array");return e.data}catch(e){throw console.error("Error fetching library data:",e),e}},_=async e=>{try{if(!e||"string"!=typeof e)throw Error("Book ID is required and must be a string");let t=await o.A.get("".concat(r,"?action=getChapters&bookId=").concat(e));if(!t.data||"boolean"!=typeof t.data.success)throw Error("Unexpected response format: Expected success boolean");if(t.data.success&&!Array.isArray(t.data.data))throw Error("Unexpected response format: Expected data to be an array");return t.data}catch(t){throw console.error("Error fetching chapters for book ".concat(e,":"),t),t}},s=async(e,t)=>{try{if(!e||"string"!=typeof e)throw Error("Book ID is required and must be a string");if(!Number.isInteger(t)||t<=0)throw Error("Chapter Index must be a positive integer");let n=await o.A.get("".concat(r,"?action=getChapterContent&bookId=").concat(e,"&chapterIndex=").concat(t));if(!n.data||"boolean"!=typeof n.data.success)throw Error("Unexpected response format: Expected success boolean");if(!n.data.success)throw Error(n.data.error||"Failed to fetch chapter content");return n.data}catch(n){throw console.error("Error fetching content for book ".concat(e,", chapter ").concat(t,":"),n),n}}},55663:(e,t,n)=>{"use strict";n.d(t,{c7:()=>r,cT:()=>a,e4:()=>_});let o={SETTINGS:"novel_reader_settings",COLLECTION:"novel_my_collection"},r=(e,t)=>{try{let n=localStorage.getItem(o[e]);return n?JSON.parse(n):t}catch(n){return console.error("Error reading ".concat(e," from localStorage"),n),t}},a=(e,t)=>{try{localStorage.setItem(o[e],JSON.stringify(t))}catch(t){console.error("Error saving ".concat(e," to localStorage"),t)}},_=e=>{if(!e)return e;let t=e.match(/drive\.google\.com\/uc\?.*id=([^&]+)/);if(null==t?void 0:t[1])return"https://lh3.googleusercontent.com/d/".concat(t[1]);let n=e.match(/drive\.google\.com\/file\/d\/([^/]+)/);return(null==n?void 0:n[1])?"https://lh3.googleusercontent.com/d/".concat(n[1]):e}},65453:(e,t,n)=>{"use strict";n.d(t,{v:()=>l});var o=n(12115);let r=e=>{let t,n=new Set,o=(e,o)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=o?o:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,a={setState:o,getState:r,getInitialState:()=>_,subscribe:e=>(n.add(e),()=>n.delete(e))},_=t=e(o,r,a);return a},a=e=>e?r(e):r,_=e=>e,s=e=>{let t=a(e),n=e=>(function(e,t=_){let n=o.useSyncExternalStore(e.subscribe,o.useCallback(()=>t(e.getState()),[e,t]),o.useCallback(()=>t(e.getInitialState()),[e,t]));return o.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},l=e=>e?s(e):s}}]);