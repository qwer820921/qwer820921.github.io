(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9699],{29699:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>et});var l=a(95155),i=a(12115),n=function(e){return e.GOLD="GOLD",e.CP="CP",e.DIAMOND="DIAMOND",e.AP="AP",e.LP="LP",e.EQUIPMENT_SHARD="EQUIPMENT_SHARD",e}({}),r=function(e){return e.OPTIMIZED="OPTIMIZED",e.LEGACY="LEGACY",e}({}),s=function(e){return e.COMMON="COMMON",e.RARE="RARE",e.BOSS="BOSS",e}({}),o=function(e){return e.GOLD="GOLD",e.LEVEL="LEVEL",e.CLICK="CLICK",e.ASCENSION="ASCENSION",e}({}),c=function(e){return e.ADD_BASE_DMG="ADD_BASE_DMG",e.ADD_AUTO_DMG="ADD_AUTO_DMG",e.ADD_BOSS_DMG="ADD_BOSS_DMG",e.ADD_CRIT_CHANCE="ADD_CRIT_CHANCE",e.ADD_CRIT_DMG="ADD_CRIT_DMG",e.EQUIP_DMG_MULT="EQUIP_DMG_MULT",e.ADD_GOLD="ADD_GOLD",e.ADD_GOLD_MULT="ADD_GOLD_MULT",e.ADD_XP_MULT="ADD_XP_MULT",e.ADD_AP_MULT="ADD_AP_MULT",e.ADD_INVENTORY="ADD_INVENTORY",e.ADD_ATK_P="ADD_ATK_P",e.AUTO_CLICK_V="AUTO_CLICK_V",e.RARE_CHANCE_P="RARE_CHANCE_P",e.REDUCE_GOAL_V="REDUCE_GOAL_V",e}({}),d=function(e){return e.MAIN_HAND="MAIN_HAND",e.HEAD="HEAD",e.BODY="BODY",e.HANDS="HANDS",e.LEGS="LEGS",e.RELIC="RELIC",e}({});let u="LETTER";function p(e){u=e,console.log("[NumberFormat] 數值單位已切換為: ".concat(e))}let x=[{unit:"",value:1},{unit:"萬",value:1e4},{unit:"億",value:1e8},{unit:"兆",value:1e12},{unit:"京",value:1e16},{unit:"垓",value:1e20},{unit:"秭",value:1e24},{unit:"穰",value:1e28},{unit:"溝",value:1e32},{unit:"澗",value:1e36},{unit:"正",value:1e40},{unit:"載",value:1e44},{unit:"極",value:1e48}];function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,l=arguments.length>3?arguments[3]:void 0;if(e<0)return"-"+m(-e,t,a,l);switch(l||u){case"SCIENTIFIC":if(e<a)return Math.floor(e).toLocaleString();let i=Math.floor(Math.log10(e)),n=e/Math.pow(10,i);return"".concat(n.toFixed(t),"e").concat(i);case"CHINESE":if(e<a)return Math.floor(e).toLocaleString();for(let l=x.length-1;l>=0;l--){let{unit:i,value:n}=x[l];if(e>=n&&n>=a){let a=e/n,l=t;return a>=100&&(l=Math.max(0,t-1)),a>=1e3&&(l=0),a.toFixed(l)+i}}return Math.floor(e).toLocaleString();default:if(e<a)return Math.floor(e).toLocaleString();let r=Math.floor(Math.floor(Math.log10(e))/3)-1;if(r<0)return Math.floor(e).toLocaleString();let s=e/Math.pow(10,(r+1)*3),o=function(e){if(e<0)return"";let t="",a=e;for(;a>=0;)t=String.fromCharCode(65+a%26)+t,a=Math.floor(a/26)-1;return t}(r),c=t;return s>=100&&(c=Math.max(0,t-1)),s>=1e3&&(c=0),s.toFixed(c)+o}}let g=(e,t,a)=>{let l={...e};switch(t){case c.ADD_BASE_DMG:l.baseDamage+=a;break;case c.ADD_AUTO_DMG:l.autoAttackDamage+=a;break;case c.ADD_BOSS_DMG:l.bossDamageMultiplier+=a/100;break;case c.ADD_CRIT_CHANCE:l.criticalChance+=a/100;break;case c.ADD_CRIT_DMG:l.criticalDamage+=a/100;break;case c.EQUIP_DMG_MULT:l.equipDamageMultiplier+=a;break;case c.ADD_GOLD:case c.ADD_GOLD_MULT:l.goldMultiplier+=a/100;break;case c.ADD_XP_MULT:l.xpMultiplier+=a/100;break;case c.ADD_AP_MULT:l.apMultiplier+=a/100;break;case c.ADD_ATK_P:l.atkPercentBonus+=a;break;case c.AUTO_CLICK_V:l.autoClickPerSec+=a;break;case c.RARE_CHANCE_P:l.rareMonsterChance+=a/100;break;case c.REDUCE_GOAL_V:l.monsterKillReduction+=a;break;case c.ADD_INVENTORY:break;default:console.warn("[EffectMapper] Unknown effect type: ".concat(t))}return l},h={[n.GOLD]:"gold",[n.CP]:"clickPoints",[n.DIAMOND]:"diamonds",[n.LP]:"levelPoints",[n.AP]:"ascensionPoints",[n.EQUIPMENT_SHARD]:"equipmentShards"},f=(e,t)=>{let a=h[t];return a?e[a]||0:(console.warn("[WalletManager] Unknown currency type: ".concat(t)),0)},b=(e,t,a)=>f(e,t)>=a,v=(e,t,a)=>{if(!b(e,t,a))return console.warn("[WalletManager] Insufficient funds for ".concat(t,": need ").concat(a,", have ").concat(f(e,t))),e;let l=h[t];return l?{...e,[l]:e[l]-a}:e},D=(e,t,a)=>{let l=h[t];return l?{...e,[l]:(e[l]||0)+a}:(console.warn("[WalletManager] Unknown currency type: ".concat(t)),e)},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[n.AP,n.CP,n.DIAMOND,n.EQUIPMENT_SHARD],a={gold:0,clickPoints:0,diamonds:0,levelPoints:0,ascensionPoints:0,equipmentShards:0};for(let l of t){let t=h[l];t&&(a[t]=e[t]||0)}return a},j=(e,t,a,l)=>l===c.ADD_INVENTORY?e:1===t||1===t?Math.floor(e+a):Math.floor(e*Math.pow(t,a));a(66997);let _=e=>m(e,2,1e3);function C(e){let{player:t,combatPower:a,stageId:i,userId:n,onAvatarClick:r,onAscension:s,potentialPoints:o}=e,{system:c,wallet:d}=t,u=c.currentXp/c.requiredXp*100;return(0,l.jsxs)("header",{className:"ca-header",children:[(0,l.jsxs)("div",{className:"ca-player-profile",children:[(0,l.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:r,children:[(0,l.jsx)("div",{className:"ca-avatar-ring",children:(0,l.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,l.jsx)("div",{className:"ca-level-badge",children:c.level})]}),(0,l.jsxs)("div",{className:"ca-profile-info",children:[(0,l.jsxs)("div",{className:"ca-profile-top",children:[(0,l.jsxs)("span",{className:"ca-level-text",children:["Lv.",c.level]}),(0,l.jsx)("span",{className:"ca-player-name",children:n||"冒險者"})]}),(0,l.jsxs)("div",{className:"ca-exp-container",children:[(0,l.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,l.jsx)("div",{className:"ca-exp-bar",children:(0,l.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,u),"%")}})}),(0,l.jsxs)("div",{className:"ca-exp-text",children:[_(c.currentXp),"/",_(c.requiredXp)]})]}),(0,l.jsxs)("div",{className:"ca-combat-power",style:{justifyContent:"space-between",width:"100%"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,l.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,l.jsx)("span",{className:"ca-cp-value",children:_(a)})]}),(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),s()},style:{display:"flex",alignItems:"center",gap:"4px",background:"linear-gradient(135deg, #a855f7 0%, #d946ef 100%)",color:"white",padding:"4px 10px",fontSize:"0.65rem",fontWeight:"bold",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:"0 0 10px rgba(168, 85, 247, 0.3)",flexShrink:0},children:["⚡ 渡劫飛升 (+",_(o),")"]})]})]})]}),(0,l.jsx)("div",{className:"ca-header-right",children:(0,l.jsxs)("div",{className:"ca-currency-stack",children:[(0,l.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,l.jsx)("span",{children:"\uD83D\uDCB0"}),(0,l.jsx)("span",{children:_(Math.floor(d.gold))})]}),(0,l.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:_(Math.floor(d.clickPoints))})]}),(0,l.jsxs)("div",{className:"ca-currency text-xs",style:{color:"#10b981"},children:[(0,l.jsx)("span",{children:"\uD83C\uDD99"}),(0,l.jsx)("span",{children:_(Math.floor(d.levelPoints))})]})]})})]})}function S(e){let{name:t,currentHp:a,maxHp:i,isBoss:n=!1}=e,r=Math.max(1,i),s=Math.min(Math.max(0,a),r);return(0,l.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,l.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,l.jsx)("span",{className:"text-slate-300 me-2",children:t})}),(0,l.jsx)("div",{className:"ca-hp-bar",children:(0,l.jsx)("div",{className:"ca-hp-bar-fill ".concat(n?"boss":"normal"),style:{width:"".concat(s/r*100,"%")}})}),(0,l.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[m(Math.ceil(s),2,1e3)," /"," ",m(Math.ceil(r),2,1e3)]})]})}let N=e=>{let{monster:t}=e,[a,n]=(0,i.useState)(!1),[r,s]=(0,i.useState)(null);return((0,i.useEffect)(()=>{n(!1),t.configId?s("/clickAscension/monsters/".concat(t.configId,".webp")):s(null)},[t.configId]),!a&&r)?(0,l.jsx)("img",{src:r,alt:t.name,className:"ca-monster-image",onError:()=>n(!0)}):(0,l.jsx)(l.Fragment,{children:t.emoji||(t.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")})},M={gold_shop_mercenary:"⚔️",gold_shop_partner:"\uD83E\uDDDA",gold_shop_archer:"\uD83C\uDFF9",gold_shop_knight:"\uD83D\uDEE1️",gold_shop_warlord:"\uD83D\uDD31",gold_shop_oracle:"\uD83D\uDD2E",gold_shop_void:"\uD83C\uDF0C",gold_shop_titan:"⛰️",gold_shop_dragon:"\uD83D\uDC09",gold_shop_creation:"✨"};function A(e){let{monster:t,stageId:a,onMonsterClick:n,baseDamage:r,criticalChance:s,criticalDamage:o,monstersKilled:d,monstersRequired:u,isBossActive:p,bossDamageMultiplier:x=1,goldShop:g={},gameConfig:h,potionCount:f=0,activeBuffs:b,onUsePotion:v,lastAutoAttack:D,lastAutoClickEvent:y,bossTimeLeft:j,bossTimeLimit:_=60,onChallengeBoss:C,autoUsePotion:A=!1,onToggleAutoPotion:E}=e,I=Object.entries(g).filter(e=>{var t;let[a,l]=e;if(!a.startsWith("gold_shop_")||l<=0)return!1;let i=null==h||null==(t=h.upgrades)?void 0:t.find(e=>e.ID===a);return String((null==i?void 0:i.Effect_Type)||"").toUpperCase().trim()===c.ADD_AUTO_DMG}).map(e=>{let[t,a]=e;return{id:t,level:a}}),k=(0,i.useCallback)(e=>{var t;let a=null==h||null==(t=h.upgrades)?void 0:t.find(t=>t.ID===e);return(null==a?void 0:a.Emoji)?a.Emoji:M[e]?M[e]:(null==a?void 0:a.Name)?a.Name.substring(0,2):e.replace("gold_shop_","").substring(0,2)},[h]),[w,L]=(0,i.useState)([]),[T,R]=(0,i.useState)(!1),[P,O]=(0,i.useState)(!1),[B,G]=(0,i.useState)({}),z=(0,i.useRef)(null),U=(0,i.useRef)({}),q=(0,i.useRef)(0),W=(0,i.useRef)(""),H=(null==b?void 0:b.ragePotionExpiresAt)&&b.ragePotionExpiresAt>Date.now(),K=(e,t,a,l)=>{var i;let n=null==(i=z.current)?void 0:i.getBoundingClientRect(),r=n?Math.max(50,Math.min(n.width-50,t)):t,s=crypto.randomUUID();L(t=>[...t,{id:s,text:e,x:r,y:a,type:l,createdAt:Date.now()}]),setTimeout(()=>{L(e=>e.filter(e=>e.id!==s))},1e3)};i.useEffect(()=>{var e;if(!y||y.id===W.current)return;W.current=y.id,O(!0),setTimeout(()=>O(!1),50);let t=null==(e=z.current)?void 0:e.getBoundingClientRect();if(t){if(y.burstHits&&y.burstHits.length>0)return void y.burstHits.forEach(e=>{let a=t.width/2+(80*Math.random()-40),l=t.height/2+(80*Math.random()-40),i=e.isCrit?"CRIT":"CLICK";K(m(e.damage,1,1e3),a,l,i)});let e=t.width/2+(60*Math.random()-30),a=t.height/2+(60*Math.random()-30),l=y.isCrit?"CRIT":"CLICK";K(m(y.damage,1,1e3),e,a,l)}},[y]),i.useEffect(()=>{var e;if(!D||D.time===q.current)return;q.current=D.time,O(!0),setTimeout(()=>O(!1),150);let t=null==(e=z.current)?void 0:e.getBoundingClientRect();D.breakdown&&t&&Object.entries(D.breakdown).forEach(e=>{let[a,l]=e;if("player"===a||l<=0)return;let i=k(a),n=U.current[a];if(n){let e=n.getBoundingClientRect(),r=e.left-t.left+e.width/2,s=e.top-t.top;K("".concat(i," ").concat(m(l,1,1e3)),r,s-20,"AUTO"),G(e=>({...e,[a]:!0})),setTimeout(()=>{G(e=>({...e,[a]:!1}))},300)}else{let e=t.width/2+(80*Math.random()-40),a=.3*t.height+(40*Math.random()-20);K("".concat(i," ").concat(m(l,1,1e3)),e,a,"AUTO")}})},[D,g,h,k]);let F=e=>{var a,l,i,c,d;let u,p;if(!t||t.currentHp<=0)return;let g=r;console.log("[Debug] Click:",{baseDamage:r,isRageActive:H,isBoss:t.isBoss,bossMult:x}),t.isBoss&&(g*=x);let h=Math.random()<s,f=Math.ceil(g*(h?o:1));console.log("[Debug] Damage Calc:",{clickDmg:g,isCrit:h,criticalDamage:o,finalDamage:f});let b=null==(a=z.current)?void 0:a.getBoundingClientRect();if(!b)return;"touches"in e?(u=null!=(c=null==(l=e.touches[0])?void 0:l.clientX)?c:b.left+b.width/2,p=null!=(d=null==(i=e.touches[0])?void 0:i.clientY)?d:b.top+b.height/2):(u=e.clientX,p=e.clientY);let v=u-b.left+(60*Math.random()-30),D=p-b.top+(60*Math.random()-30);K(m(f,1,1e3),v,D,h?"CRIT":"CLICK"),R(!0),O(!0),setTimeout(()=>R(!1),300),setTimeout(()=>O(!1),150),n(f,h)},V=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,l.jsxs)("div",{ref:z,className:"ca-battle-area ".concat(T?"ca-shake":""),style:{background:H?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:F,onTouchStart:F,children:[t&&(0,l.jsx)("div",{className:"ca-monster-sprite ".concat(t.isBoss?"boss":""," ").concat(P?"ca-hit-flash":""," ca-bounce-slow"),children:(0,l.jsx)(N,{monster:t})}),(0,l.jsx)("div",{className:"ca-monster-container",style:{position:"relative",zIndex:1,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:t?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",position:"relative"},children:[p&&(0,l.jsxs)("div",{style:{position:"absolute",top:"-120px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",width:"100%",maxWidth:"240px",zIndex:10},children:[(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#ef4444",fontWeight:"bold",background:"rgba(239, 68, 68, 0.2)",padding:"2px 10px",borderRadius:"10px",border:"1px solid rgba(239, 68, 68, 0.4)",letterSpacing:"1px",marginBottom:"4px"},children:"\uD83D\uDC79 BOSS 戰進行中"}),null!=j&&(0,l.jsxs)("div",{style:{width:"100%"},children:[(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:(0,l.jsxs)("span",{style:{fontSize:"1.2rem",fontWeight:"900",color:j<=10?"#ff4d4d":"#fbbf24",textShadow:"0 0 10px rgba(0,0,0,0.8)",fontFamily:"monospace"},children:["⏱️ ",j,"s"]})}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)",marginTop:"2px"},children:(0,l.jsx)("div",{style:{height:"100%",width:"".concat(j/_*100,"%"),background:j<=10?"linear-gradient(90deg, #ef4444, #b91c1c)":"linear-gradient(90deg, #fbbf24, #d97706)",transition:"width 1s linear, background 0.3s"}})})]})]}),t.note&&(0,l.jsxs)("div",{className:"ca-note-badge",style:{position:"relative",top:"0",left:"0",transform:"none",marginBottom:"8px"},children:[(0,l.jsx)("span",{children:"\uD83D\uDCCD"}),(0,l.jsx)("span",{children:t.note})]}),(0,l.jsxs)("div",{className:"ca-stage-display",children:["第 ",a," 關"]}),!p&&(d>=u?(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",onClick:e=>{e.stopPropagation(),null==C||C()},style:{pointerEvents:"auto",marginBottom:"16px",padding:"8px 20px",fontSize:"1rem",background:"linear-gradient(to right, #ef4444, #b91c1c)",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",border:"none"},children:"⚔️ 挑戰 BOSS"}):(0,l.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.5)",padding:"2px 8px",borderRadius:"12px"},children:[d," / ",u," \uD83D\uDC80"]})),(0,l.jsx)("div",{style:{height:"100px"}}),(0,l.jsx)("div",{className:"w-56",style:{marginTop:"auto"},children:(0,l.jsx)(S,{name:t.name,currentHp:t.currentHp,maxHp:t.maxHp,isBoss:t.isBoss})})]}):(0,l.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),I.length>0&&(()=>{let e=I.filter((e,t)=>t%2==0),t=I.filter((e,t)=>t%2==1),a=(e,t,a)=>a?e%2==0?t?"ca-attack-lunge-left":"ca-attack-lunge-right":t?"ca-attack-magic-left":"ca-attack-magic-right":"";return(0,l.jsxs)(l.Fragment,{children:[e.map((e,t)=>{let{id:i,level:n}=e;return(0,l.jsxs)("div",{ref:e=>{U.current[i]=e},className:a(t,!0,B[i]||!1),style:{position:"absolute",top:"".concat(80+70*t,"px"),left:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:[(0,l.jsx)("div",{style:{fontSize:"1.8rem"},children:k(i)}),(0,l.jsxs)("div",{style:{fontSize:"0.65rem",color:"#a78bfa"},children:["Lv.",n]})]},i)}),t.map((e,t)=>{let{id:i,level:n}=e;return(0,l.jsxs)("div",{ref:e=>{U.current[i]=e},className:a(t,!1,B[i]||!1),style:{position:"absolute",top:"".concat(80+70*t,"px"),right:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:[(0,l.jsx)("div",{style:{fontSize:"1.8rem"},children:k(i)}),(0,l.jsxs)("div",{style:{fontSize:"0.65rem",color:"#a78bfa"},children:["Lv.",n]})]},i)})]})})(),f>0&&(0,l.jsx)("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"row",alignItems:"center",gap:"16px",zIndex:20},children:(0,l.jsxs)("div",{onClick:e=>{e.stopPropagation(),!((null==b?void 0:b.ragePotionExpiresAt)&&b.ragePotionExpiresAt>Date.now())&&v&&v()},style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",gap:"2px"},children:[(0,l.jsx)("div",{style:{fontSize:"2rem",filter:(null==b?void 0:b.ragePotionExpiresAt)&&b.ragePotionExpiresAt>Date.now()?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:(null==b?void 0:b.ragePotionExpiresAt)&&b.ragePotionExpiresAt>Date.now()?"scale(0.9)":"scale(1)",transition:"all 0.3s"},children:"\uD83E\uDDEA"}),(0,l.jsxs)("div",{style:{fontSize:"0.65rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"8px",padding:"1px 5px",marginTop:"-8px"},children:["x",f]}),(0,l.jsxs)("div",{onClick:e=>{e.stopPropagation(),E&&E()},style:{display:"flex",alignItems:"center",gap:"3px",background:A?"rgba(34, 197, 94, 0.3)":"rgba(255, 255, 255, 0.1)",padding:"2px 6px",borderRadius:"10px",border:"1px solid ".concat(A?"rgba(34, 197, 94, 0.5)":"rgba(255, 255, 255, 0.2)"),cursor:"pointer",pointerEvents:"auto",transition:"all 0.3s",marginTop:"2px"},children:[(0,l.jsx)("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:A?"#22c55e":"#94a3b8",boxShadow:A?"0 0 4px #22c55e":"none"}}),(0,l.jsx)("span",{style:{fontSize:"0.5rem",color:A?"#4ade80":"#94a3b8",fontWeight:"bold",letterSpacing:"0.3px"},children:"AUTO"})]})]})}),(0,l.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",style:{zIndex:100},children:w.map(e=>(0,l.jsx)("div",{className:V(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function E(e){let{activeView:t,onSwitchView:a,onOpenModal:i}=e;return(0,l.jsx)("footer",{className:"ca-footer",children:(0,l.jsxs)("nav",{className:"ca-footer-nav",children:[(0,l.jsxs)("button",{className:"ca-tab-btn ".concat("CHARACTER"===t?"active":""),onClick:()=>{a("CHARACTER"),i(null)},children:[(0,l.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,l.jsx)("span",{className:"label",children:"角色"})]}),(0,l.jsxs)("button",{className:"ca-tab-btn ".concat("BATTLE"===t?"active":""),onClick:()=>{a("BATTLE"),i(null)},children:[(0,l.jsx)("span",{className:"icon",children:"⚔️"}),(0,l.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,l.jsxs)("button",{className:"ca-tab-btn",onClick:()=>i("SHOP"),children:[(0,l.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,l.jsx)("span",{className:"label",children:"商店"})]})]})})}function I(e){let{isOpen:t,onClose:a,title:i,headerContent:n,children:r}=e;return t?(0,l.jsx)("div",{className:"ca-modal-overlay",onClick:a,children:(0,l.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"ca-modal-header",children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,l.jsx)("h2",{className:"ca-modal-title",children:i}),n]}),(0,l.jsx)("button",{className:"ca-modal-close",onClick:a,children:"✕"})]}),(0,l.jsx)("div",{className:"ca-modal-content",children:r})]})}):null}let k=e=>e<=50?{name:"練氣期",color:"#a7f3d0"}:e<=150?{name:"築基期",color:"#6ee7b7"}:e<=300?{name:"金丹期",color:"#fbbf24"}:e<=500?{name:"元嬰期",color:"#f472b6"}:e<=800?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"},w=e=>m(e,2,1e3);function L(e){var t,a,r;let{player:s,onPurchase:d,onBulkPurchase:u,onResetLevelPoints:p,gameConfig:x,autoGachaBox:m,onToggleAutoGacha:g}=e,[h,f]=(0,i.useState)("DAILY"),[b,v]=(0,i.useState)("UPGRADE"),[D,y]=(0,i.useState)(null),[j,_]=(0,i.useState)("DIAMOND"),C=i.useMemo(()=>(null==x?void 0:x.upgrades)?x.upgrades.filter(e=>e.Shop_Type===o.CLICK).map(e=>e.ID).reduce((e,t)=>e+(s.clickShop[t]||0),0):0,[s.clickShop,x]),S=i.useMemo(()=>{let e=(null==x?void 0:x.settings)||{},t="DIAMOND"===j;return{basic:t?Number(e.GACHA_COST_BASIC_DIAMOND)||2:Number(e.GACHA_COST_BASIC_AP)||20,adv:t?Number(e.GACHA_COST_ADV_DIAMOND)||20:Number(e.GACHA_COST_ADV_AP)||200,prem:t?Number(e.GACHA_COST_PREM_DIAMOND)||100:Number(e.GACHA_COST_PREM_AP)||1e3}},[null==x?void 0:x.settings,j]),N="DIAMOND"===j?"diamond":"ap",M="DIAMOND"===j?"\uD83D\uDC8E":"\uD83D\uDD4A️",A=k(C),E=e=>"gold_potion_rage"===e?s.inventory.ragePotionCount||0:e.startsWith("gold_shop_")?s.goldShop[e]||0:e.startsWith("level_shop_")?s.levelShop[e]||0:e.startsWith("click_shop_")?s.clickShop[e]||0:(e.startsWith("ascension_shop_")||e.startsWith("asc_"))&&s.ascensionShop[e]||0,I=(e,t,a,l)=>l===c.ADD_INVENTORY?e:1===t||1===t?Math.floor(e+a):Math.floor(e*Math.pow(t,a)),L=e=>e===n.GOLD?"\uD83D\uDCB0":e===n.LP?"\uD83C\uDD99":e===n.CP?"⚡":e===n.DIAMOND?"\uD83D\uDC8E":e===n.AP?"\uD83D\uDD4A️":e,O=e=>e===n.GOLD?s.wallet.gold:e===n.LP?s.wallet.levelPoints:e===n.CP?s.wallet.clickPoints:e===n.DIAMOND?s.wallet.diamonds:e===n.AP?s.wallet.ascensionPoints:0,B=(e,t)=>0===e.length?(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"gray"},children:"無項目"}):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(e=>{let a=E(e.ID),i=I(e.Cost_Base,e.Cost_Mult,a,e.Effect_Type),n=L(e.Currency),r=O(e.Currency),s=Number(e.Max_Level||0),c=s>0&&a>=s,p=0,x=!1,m=t===o.GOLD||e.Shop_Type===o.GOLD;if(m&&!c){let t=s>0?Math.min(25,s-a):25;if(t>0){for(let l=0;l<t;l++)p+=I(e.Cost_Base,e.Cost_Mult,a+l,e.Effect_Type);x=r>=p&&25===t}}let g=Number(e.Milestone_Level||0),h=Number(e.Milestone_Mult||1),f=0,b=0;if(g>0&&h>1){let e=a+1;if(e>0&&e%g==0&&(f=h),m){let e=a+25;if(Math.floor(e/g)-Math.floor(a/g)>0){let t=Math.pow(h,Math.floor(a/g));b=Math.pow(h,Math.floor(e/g))/t}}}let v=e.Desc_Template||e.Name;return v.includes("{val}")&&(v=v.replace("{val}",String(e.Effect_Val))),(0,l.jsx)(R,{name:e.Name,desc:"".concat(v," [Lv.").concat(a,"]"),level:a,cost:i,currencyLabel:n,canAfford:!c&&r>=i,isMaxed:c,onClick:()=>d(e.ID),showBulkUpgrade:m,cost25:p,canAfford25:x,onBulkUpgrade:()=>{if(u)u(e.ID,25);else for(let t=0;t<25;t++)d(e.ID)},nextMilestone1:f,nextMilestone25:b},e.ID)})}),U=e=>x&&x.upgrades?B(x.upgrades.filter(t=>t.Shop_Type===e),e):null,q=(()=>{if(!s.lastDailyRewardClaimTime)return!0;let e=new Date(s.lastDailyRewardClaimTime),t=new Date;return e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()||e.getFullYear()!==t.getFullYear()})();return(0,l.jsxs)("div",{className:"ca-shop-container",children:[(0,l.jsxs)("div",{className:"ca-shop-tabs",children:[(0,l.jsxs)("button",{onClick:()=>f("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===h?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,l.jsx)("div",{className:"label",children:"每日商店"}),q&&(0,l.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,l.jsxs)("button",{onClick:()=>f("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===h?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,l.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,l.jsxs)("button",{onClick:()=>f("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===h?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,l.jsx)("div",{className:"label",children:"等級商店"})]}),(0,l.jsxs)("button",{onClick:()=>f("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===h?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"⚡"}),(0,l.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,l.jsxs)("button",{onClick:()=>f("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===h?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,l.jsx)("div",{className:"label",children:"飛昇商店"})]}),(0,l.jsxs)("button",{onClick:()=>f("EQUIPMENT"),className:"ca-shop-tab-btn equipment ".concat("EQUIPMENT"===h?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"⚔️"}),(0,l.jsx)("div",{className:"label",children:"裝備扭蛋"})]})]}),(0,l.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===h&&(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,l.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,l.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,l.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,l.jsx)("div",{style:{fontSize:"3rem",filter:q?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",fontWeight:"bold",fontSize:"1.1rem",color:"#fde047",marginTop:"8px"},children:[(0,l.jsxs)("div",{children:[Number(null==x||null==(t=x.settings)?void 0:t.DAILY_REWARD_GEM)||0," \uD83D\uDC8E 鑽石"]}),(0,l.jsxs)("div",{children:[w(Number(null==x||null==(a=x.settings)?void 0:a.DAILY_REWARD_GOLD)||0)," \uD83D\uDCB0 金幣"]}),(0,l.jsxs)("div",{children:[w(Number(null==x||null==(r=x.settings)?void 0:r.DAILY_REWARD_AP)||0)," \uD83D\uDD4A️ 飛昇點數"]})]})]}),(0,l.jsx)("button",{className:"ca-btn ".concat(q&&(null==x?void 0:x.settings)?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:q&&(null==x?void 0:x.settings)?1:.5,cursor:q&&(null==x?void 0:x.settings)?"pointer":"not-allowed",background:q&&(null==x?void 0:x.settings)?"":"#334155",color:q&&(null==x?void 0:x.settings)?"":"#64748b"},disabled:!q||!(null==x?void 0:x.settings),onClick:()=>d("daily_checkin"),children:(null==x?void 0:x.settings)?q?"領取獎勵":"明日再來":"讀取中..."})]})}),"GOLD"===h&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:w(Math.floor(s.wallet.gold))}),(0,l.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(0,l.jsxs)("div",{className:"ca-shop-subtabs",style:{display:"flex",gap:"10px",marginBottom:"8px"},children:[(0,l.jsx)("button",{className:"ca-btn ".concat("UPGRADE"===b?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"UPGRADE"===b?"":"rgba(255,255,255,0.1)"},onClick:()=>v("UPGRADE"),children:"\uD83D\uDEE0️ 金幣強化"}),(0,l.jsx)("button",{className:"ca-btn ".concat("RECRUIT"===b?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"RECRUIT"===b?"":"rgba(255,255,255,0.1)"},onClick:()=>v("RECRUIT"),children:"\uD83D\uDEA9 招兵買馬"})]}),(null==x?void 0:x.upgrades)?B(x.upgrades.filter(e=>e.Shop_Type===o.GOLD).filter(e=>"RECRUIT"===b?e.Effect_Type===c.ADD_AUTO_DMG:e.Effect_Type!==c.ADD_AUTO_DMG)):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,l.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config..."})}),(0,l.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,l.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,l.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,l.jsx)(T,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:s.wallet.diamonds>=10,onClick:()=>d("gold_pack_1")}),(0,l.jsx)(T,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:s.wallet.diamonds>=80,onClick:()=>d("gold_pack_2")})]})]}),"LEVEL"===h&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:s.wallet.levelPoints}),(0,l.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"}),p&&(0,l.jsx)("button",{onClick:p,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"\uD83D\uDD04 重製點數"})]}),(0,l.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,l.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==x?void 0:x.upgrades)?U("LEVEL"):(0,l.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===h&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:A.color},children:A.name}),(0,l.jsxs)("div",{className:"ca-realm-level",children:["修練總層數 ",C]})]}),(0,l.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,l.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==x?void 0:x.upgrades)?U("CLICK"):(0,l.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===h&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c084fc 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"飛昇商店 (Permanent)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff"},children:"永恆加成"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.7)",marginTop:"4px"},children:"飛昇後不會重置的永久強化"})]}),(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:U("ASCENSION")})]}),"EQUIPMENT"===h&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",position:"relative"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"裝備扭蛋 (Gacha)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.2rem"},children:"試試你的手氣！"}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",background:"rgba(0,0,0,0.3)",padding:"4px",borderRadius:"8px",marginBottom:"8px"},children:[(0,l.jsx)("button",{onClick:()=>_("DIAMOND"),style:{flex:1,padding:"8px 16px",borderRadius:"6px",background:"DIAMOND"===j?"linear-gradient(135deg, #3b82f6, #2563eb)":"transparent",color:"DIAMOND"===j?"#fff":"#94a3b8",border:"none",cursor:"pointer",fontWeight:"bold",transition:"all 0.2s"},children:"\uD83D\uDC8E 鑽石抽取"}),(0,l.jsx)("button",{onClick:()=>_("AP"),style:{flex:1,padding:"8px 16px",borderRadius:"6px",background:"AP"===j?"linear-gradient(135deg, #f59e0b, #d97706)":"transparent",color:"AP"===j?"#fff":"#94a3b8",border:"none",cursor:"pointer",fontWeight:"bold",transition:"all 0.2s"},children:"\uD83D\uDD4A️ 飛昇點數抽取"})]})]}),(0,l.jsxs)("div",{className:"ca-shop-item-grid",style:{width:"100%"},children:[(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #94a3b8"},children:[(0,l.jsx)("button",{onClick:()=>y("basic"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDCE6"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fff"},children:"基礎裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"隨機獲得裝備 (最高至 Epic)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:"含: Common, Uncommon, Rare, Epic"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(G,{label:"1 抽",cost:w(S.basic),currencyLabel:M,color:"#4ade80",onClick:()=>d("gacha_basic_".concat(N,"_1"))}),(0,l.jsx)(G,{label:"10 抽",cost:w(10*S.basic),currencyLabel:M,color:"#4ade80",onClick:()=>d("gacha_basic_".concat(N,"_10"))}),(0,l.jsx)(G,{label:"100 抽",cost:w(100*S.basic),currencyLabel:M,color:"#4ade80",onClick:()=>d("gacha_basic_".concat(N,"_100"))})]}),(0,l.jsx)("div",{style:{marginTop:"10px",width:"100%"},children:(0,l.jsx)(z,{isActive:m==="basic_".concat(N),onToggle:()=>g&&g(m==="basic_".concat(N)?null:"basic_".concat(N))})})]}),(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #eab308",background:"rgba(234, 179, 8, 0.05)"},children:[(0,l.jsx)("button",{onClick:()=>y("advanced"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83C\uDF81"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#facc15"},children:"高級裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"更高機率獲得稀有裝備 (最高至 Legendary)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#fef08a"},children:"含: Common ~ Legendary"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(G,{label:"1 抽",cost:w(S.adv),currencyLabel:M,color:"#facc15",onClick:()=>d("gacha_adv_".concat(N,"_1"))}),(0,l.jsx)(G,{label:"10 抽",cost:w(10*S.adv),currencyLabel:M,color:"#facc15",onClick:()=>d("gacha_adv_".concat(N,"_10"))}),(0,l.jsx)(G,{label:"100 抽",cost:w(100*S.adv),currencyLabel:M,color:"#facc15",onClick:()=>d("gacha_adv_".concat(N,"_100"))})]}),(0,l.jsx)("div",{style:{marginTop:"10px",width:"100%"},children:(0,l.jsx)(z,{isActive:m==="adv_".concat(N),onToggle:()=>g&&g(m==="adv_".concat(N)?null:"adv_".concat(N))})})]}),(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #a855f7",background:"rgba(168, 85, 247, 0.05)"},children:[(0,l.jsx)("button",{onClick:()=>y("premium"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDC8E"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#d8b4fe"},children:"豪華裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"最高機率獲得稀有裝備 (最高至 Mythic)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#e9d5ff"},children:"含: Common ~ Mythic (包含所有稀有度)"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(G,{label:"1 抽",cost:w(S.prem),currencyLabel:M,color:"#d8b4fe",onClick:()=>d("gacha_prem_".concat(N,"_1"))}),(0,l.jsx)(G,{label:"10 抽",cost:w(10*S.prem),currencyLabel:M,color:"#d8b4fe",onClick:()=>d("gacha_prem_".concat(N,"_10"))}),(0,l.jsx)(G,{label:"100 抽",cost:w(100*S.prem),currencyLabel:M,color:"#d8b4fe",onClick:()=>d("gacha_prem_".concat(N,"_100"))})]}),(0,l.jsx)("div",{style:{marginTop:"10px",width:"100%"},children:(0,l.jsx)(z,{isActive:m==="prem_".concat(N),onToggle:()=>g&&g(m==="prem_".concat(N)?null:"prem_".concat(N))})})]})]})]})]}),D&&(0,l.jsx)(P,{gameConfig:x,onClose:()=>y(null),boxType:D})]})}function T(e){let{name:t,desc:a,icon:i,cost:n,canAfford:r,onClick:s}=e;return(0,l.jsxs)("div",{className:"ca-glass-static ca-shop-item-card",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>r&&s(),children:[(0,l.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:i}),(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:t}),(0,l.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:a}),(0,l.jsx)("div",{className:"ca-btn ".concat(r?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:r?"":"#334155",color:r?"":"#64748b",cursor:r?"pointer":"not-allowed"},children:n})]})}function R(e){let{name:t,desc:a,level:i,cost:n,canAfford:r,onClick:s,currencyLabel:o="⚡",isMaxed:c,showBulkUpgrade:d,cost25:u,canAfford25:p,onBulkUpgrade:x,nextMilestone1:m,nextMilestone25:g}=e;return(0,l.jsxs)("div",{className:"ca-upgrade-row",children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px",flex:1,minWidth:0},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:t}),(0,l.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",i]})]}),(0,l.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:a})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"6px",flexShrink:0},children:[(0,l.jsxs)("button",{onClick:()=>!c&&r&&s(),disabled:c||!r,className:"ca-upgrade-btn",style:{opacity:c||!r?.5:1,cursor:c||!r?"not-allowed":"pointer",minWidth:d?"70px":"90px",padding:"6px 8px",background:m&&m>1?"linear-gradient(135deg, #ec4899, #be185d)":void 0},children:[(0,l.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:"bold"},children:c?"已滿級":m&&m>1?"\uD83D\uDD25 升級":"升級"}),!c&&(0,l.jsxs)("span",{style:{fontSize:"0.6rem"},children:[o," ",w(n)]}),(m||0)>1&&!c&&(0,l.jsxs)("span",{style:{fontSize:"0.5rem",color:"#fbbf24"},children:["x",m," 倍率"]})]}),d&&!c&&(0,l.jsxs)("button",{onClick:()=>p&&x&&x(),disabled:!p,className:"ca-upgrade-btn",style:{opacity:p?1:.5,cursor:p?"pointer":"not-allowed",minWidth:"85px",padding:"6px 8px",background:g&&g>1?"linear-gradient(135deg, #ec4899, #be185d)":p?"linear-gradient(135deg, #f59e0b, #d97706)":"rgba(255,255,255,0.1)"},children:[(0,l.jsx)("span",{style:{fontSize:"0.65rem",fontWeight:"bold"},children:g&&g>1?"\uD83D\uDD25 +25級":"+25級"}),(0,l.jsxs)("span",{style:{fontSize:"0.55rem"},children:[o," ",w(u||0)]}),(g||0)>1&&(0,l.jsxs)("span",{style:{fontSize:"0.5rem",color:"#fbbf24"},children:["x",(g||0).toFixed(1)," 倍率"]})]})]})]})}function P(e){let{gameConfig:t,onClose:a,boxType:n}=e,[r,s]=i.useState(null),o=t&&t.equipments&&t.equipments.length>0,c=i.useMemo(()=>o?t.equipments.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===n||"gacha_equipment_basic"===n?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==n&&"gacha_equipment_advanced"!==n||"MYTHIC"!==t}):[],[o,t,n]),d=c.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),u={};d>0&&c.forEach(e=>{let t=Number(e.Gacha_Weight)||0;u[t]||(u[t]=[]),u[t].push(e)});let p=e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}};return(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:a,children:[(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"500px",maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#1e293b",border:"1px solid #334155",borderRadius:"16px",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"white"},children:["basic"===n?"基礎":"advanced"===n?"高級":"豪華","裝備機率一覽"]}),(0,l.jsx)("button",{onClick:a,style:{background:"none",border:"none",color:"gray",fontSize:"1.5rem",cursor:"pointer"},children:"\xd7"})]}),(0,l.jsx)("div",{style:{padding:"16px",overflowY:"auto",flex:1},children:o?Object.entries(u).sort((e,t)=>Number(t[0])-Number(e[0])).map(e=>{let[t,a]=e,i=(Number(t)/d*100).toFixed(2);return(0,l.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,l.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px",fontSize:"0.9rem",color:"#93c5fd",fontWeight:"bold"},children:["機率: ",i,"% (權重: ",t,", 共 ",a.length," 種)"]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:a.map(e=>{var t;let a=p(e.Rarity);return(0,l.jsxs)("div",{onClick:()=>s(e),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:"pointer",transition:"transform 0.1s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[(0,l.jsx)("div",{style:{width:"56px",height:"56px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem",border:"1px solid ".concat(a,"44"),boxShadow:"inset 0 0 10px ".concat(a,"22")},children:B(e.Slot)}),(0,l.jsx)("div",{style:{fontSize:"0.65rem",color:a,textAlign:"center",lineHeight:"1.2",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",fontWeight:(null==(t=e.Rarity)?void 0:t.toLowerCase())==="common"?"normal":"bold"},children:e.Name})]},e.ID)})})]},t)}):(0,l.jsxs)("div",{style:{textAlign:"center",color:"var(--ca-text-muted)",padding:"20px"},children:["暫無裝備資料",(0,l.jsx)("br",{}),(0,l.jsx)("span",{style:{fontSize:"0.8rem"},children:"請檢查 Google Sheet 設定或重新載入"})]})})]}),r&&(0,l.jsx)(O,{item:r,onClose:()=>s(null)})]})}function O(e){let{item:t,onClose:a}=e,i=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(t.Rarity);return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:10001,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:a,children:(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(i,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(i,"22")},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(i,"44")},children:B(t.Slot)}),(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:i},children:t.Name}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:i,fontWeight:"bold"},children:t.Rarity}),(0,l.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:t.Slot})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,l.jsx)("div",{style:{color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:"裝備初始屬性:"}),(0,l.jsx)("div",{children:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=(Number(t.Base_Val)||0)+(a-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",w(l))}(t.Desc_Template,t,1)}),(0,l.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"單件提升戰力 (Est. CP)"}),(0,l.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",w(function(e,t){let a=(Number(e.Base_Val)||0)+0*(Number(e.Level_Mult)||0),l=String(e.Effect_Type||"").trim();return l===c.ADD_BASE_DMG?Math.floor(10*a):l===c.ADD_AUTO_DMG?Math.floor(20*a):l===c.ADD_CRIT_CHANCE?Math.floor(10*a):l===c.ADD_CRIT_DMG?Math.floor(5*a):l===c.ADD_GOLD||l===c.ADD_GOLD_MULT||l===c.ADD_XP_MULT?Math.floor(2*a):l===c.ADD_BOSS_DMG?Math.floor(8*a):0}(t,0))]})]})]}),(0,l.jsx)("button",{className:"ca-btn",onClick:a,style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"},children:"返回"})]})})}function B(e){switch(e){case"MAIN_HAND":return"⚔️";case"HEAD":return"\uD83E\uDE96";case"BODY":return"\uD83D\uDC55";case"HANDS":return"\uD83E\uDDE4";case"LEGS":return"\uD83D\uDC62";case"RELIC":return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function G(e){let{label:t,cost:a,onClick:i,color:n="#22d3ee",currencyLabel:r="\uD83D\uDCB0"}=e;return(0,l.jsxs)("button",{className:"ca-btn ca-btn-primary",style:{padding:"12px 16px",fontSize:"1rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flex:1,borderColor:n,background:"linear-gradient(to bottom, rgba(0,0,0,0) 0%, ".concat(n,"22 100%)")},onClick:i,children:[(0,l.jsx)("span",{children:t}),(0,l.jsxs)("span",{style:{background:"rgba(0,0,0,0.2)",padding:"2px 8px",borderRadius:"12px",fontSize:"0.8rem",color:n},children:[r," ",a]})]})}function z(e){let{isActive:t,onToggle:a}=e;return(0,l.jsxs)("button",{onClick:a,className:"ca-btn ".concat(t?"":"ca-btn-primary"),style:{padding:"8px 16px",fontSize:"0.9rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",background:t?"linear-gradient(to bottom, #ef4444, #991b1b)":"rgba(255, 255, 255, 0.1)",color:t?"#fff":"#cbd5e1",border:t?"1px solid #f87171":"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,l.jsx)("span",{children:t?"⏹️":"\uD83D\uDD04"}),(0,l.jsx)("span",{children:t?"停止自動抽取":"自動抽取 (固定100連)"})]})}function U(e){var t,a,n;let{player:r,effectiveStats:s,combatPower:o,userId:c,onLogin:d,onLogout:u,onManualSave:p,gameConfig:x}=e,{system:g,wallet:h,records:f}=r,[b,v]=i.useState(""),[D,y]=i.useState(!1),j=async()=>{if(!D){y(!0);try{await p()}finally{y(!1)}}},_=e=>m(Math.floor(e||0),2,1e3),C=e=>"".concat((100*e).toFixed(1),"%"),S=e=>{let t=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return t>0?"".concat(t,"h ").concat(a,"m ").concat(l,"s"):a>0?"".concat(a,"m ").concat(l,"s"):"".concat(l,"s")},N=(null==(t=r.activeBuffs)?void 0:t.ragePotionExpiresAt)>Date.now(),M=Math.max(0,Math.floor(((null==(a=r.activeBuffs)?void 0:a.ragePotionExpiresAt)-Date.now())/1e3));return(0,l.jsxs)("div",{className:"ca-profile-page",style:{paddingBottom:"20px"},children:[(0,l.jsx)("div",{className:"ca-profile-section",children:(0,l.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,l.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(c||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,l.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",g.level]})]}),(0,l.jsx)("div",{className:"ca-profile-summary",children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("span",{children:["勇者 ",c]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsx)("button",{onClick:j,className:"ca-profile-action-btn",style:{background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",cursor:D?"wait":"pointer",opacity:D?.7:1},children:D?"上傳中":"上傳"}),(0,l.jsx)("button",{onClick:u,className:"ca-profile-action-btn",style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5"},children:"登出"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-cp",children:[(0,l.jsx)("span",{className:"label",children:"戰鬥力"}),(0,l.jsx)("span",{className:"value",children:_(o)})]}),(0,l.jsxs)("div",{className:"ca-profile-exp",children:[(0,l.jsxs)("div",{className:"info",children:[(0,l.jsx)("span",{children:"EXP"}),(0,l.jsxs)("span",{children:[_(g.currentXp)," /"," ",_(g.requiredXp)]})]}),(0,l.jsx)("div",{className:"bar-bg",children:(0,l.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,g.currentXp/g.requiredXp*100),"%")}})})]})]}):(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",width:"100%",minWidth:0},children:[(0,l.jsx)("div",{style:{fontSize:"0.85rem",color:"var(--ca-text-secondary)",fontWeight:"600"},children:"輸入 ID 以讀取/建立存檔"}),(0,l.jsxs)("div",{style:{display:"flex",gap:"6px",width:"100%"},children:[(0,l.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,minWidth:0,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.15)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"0.9rem",outline:"none"},placeholder:"User ID...",value:b,onChange:e=>v(e.target.value)}),(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"0 16px",fontSize:"0.85rem",height:"auto",whiteSpace:"nowrap",flexShrink:0,borderRadius:"8px"},onClick:()=>b.trim()&&d(b.trim()),children:"讀取"})]})]})})]})}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"財富狀態"}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",background:"rgba(15, 23, 42, 0.4)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.05)"},children:[(0,l.jsx)(q,{icon:"\uD83D\uDCB0",label:"金幣",value:_(h.gold),color:"#fbbf24"}),(0,l.jsx)(q,{icon:"\uD83D\uDC8E",label:"鑽石",value:_(h.diamonds),color:"#38bdf8"}),(0,l.jsx)(q,{icon:"✨",label:"點擊點數",value:_(h.clickPoints),color:"#c084fc"}),(0,l.jsx)(q,{icon:"⚡",label:"飛昇點數",value:_(h.ascensionPoints),color:"#f472b6"}),(0,l.jsx)(q,{icon:"\uD83D\uDCDC",label:"等級積分",value:_(h.levelPoints),color:"#60a5fa"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"最終戰鬥屬性 (含裝備加成)"}),(0,l.jsxs)("div",{className:"ca-stats-grid",children:[(0,l.jsx)(W,{label:"點擊基礎傷害",value:_(s.baseDamage),icon:"⚔️"}),(0,l.jsx)(W,{label:"夥伴秒傷 (Ally DPS)",value:_(s.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,l.jsx)(W,{label:"爆擊機率",value:C(s.criticalChance),icon:"\uD83C\uDFAF"}),(0,l.jsx)(W,{label:"爆擊傷害",value:C(s.criticalDamage),icon:"\uD83D\uDCA5"}),(0,l.jsx)(W,{label:"金幣獲取倍率",value:"".concat(s.goldMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCB0"}),(0,l.jsx)(W,{label:"經驗獲取倍率",value:"".concat(s.xpMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCD6"}),(0,l.jsx)(W,{label:"BOSS 傷害加成",value:"".concat(s.bossDamageMultiplier.toFixed(2),"x"),icon:"\uD83D\uDC79"}),(0,l.jsx)(W,{label:"點擊點數倍率",value:"".concat(s.cpMultiplier.toFixed(2),"x"),icon:"✨"}),(0,l.jsx)(W,{label:"自動點擊 (每秒)",value:"".concat(s.autoClickPerSec.toFixed(1)," 次"),icon:"⚡"}),(0,l.jsx)(W,{label:"關卡目標減少",value:"-".concat(_(Math.floor(s.monsterKillReduction))," 隻"),icon:"\uD83D\uDCC9"}),(0,l.jsx)(W,{label:"稀有怪出現機率",value:C(s.rareMonsterChance),icon:"\uD83C\uDF1F"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"當前狀態 / 藥水"}),(0,l.jsx)("div",{className:"ca-glass-static",style:{padding:"12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:N?(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[(0,l.jsx)("span",{style:{fontSize:"1.4rem"},children:"\uD83E\uDDEA"}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.95rem"},children:"狂暴藥水 (Rage Potion)"}),(0,l.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:["剩餘時間:"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:S(M)})]})]}),(0,l.jsx)("div",{className:"ca-pulse",style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 10px #ef4444"}})]}):(0,l.jsx)("div",{style:{color:"var(--ca-text-muted)",fontSize:"0.85rem",textAlign:"center",padding:"10px"},children:"尚無啟用的增益效果"})})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"生涯冒險記錄"}),(0,l.jsxs)("div",{className:"ca-records-list ca-glass-static",style:{borderRadius:"12px"},children:[(0,l.jsx)(H,{label:"\uD83C\uDFAE 遊戲總點擊",value:_(f.totalClicks)}),(0,l.jsx)(H,{label:"⚔️ 累計總傷害",value:_(f.totalDamageDealt)}),(0,l.jsx)(H,{label:"\uD83D\uDC7E 擊敗怪物數",value:_(f.monstersKilled)}),(0,l.jsx)(H,{label:"\uD83D\uDE08 擊敗 BOSS 數",value:_(f.bossesKilled)}),(0,l.jsx)(H,{label:"\uD83D\uDCCD 歷史最高關卡",value:"第 ".concat(_(f.maxStageReached)," 關")}),(0,l.jsx)(H,{label:"\uD83D\uDC8E 累計儲蓄/金幣",value:_(f.totalGoldEarned)}),(0,l.jsx)(H,{label:"⏳ 生涯遊玩時間",value:S(f.playtimeSeconds)})]})]}),(0,l.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.7rem",opacity:.6},children:[(0,l.jsxs)("div",{children:["遊戲版本: ",String((null==x||null==(n=x.settings)?void 0:n.GAME_VERSION)||"1.0.0")]}),(0,l.jsx)("div",{style:{marginTop:"4px"},children:"Click Ascension Project \xa9 2026"})]})]})}function q(e){let{icon:t,label:a,value:i,color:n}=e;return(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("span",{style:{fontSize:"1rem"},children:t}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)("span",{style:{fontSize:"0.6rem",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:a}),(0,l.jsx)("span",{style:{fontSize:"0.85rem",color:n,fontWeight:"bold"},children:i})]})]})}function W(e){let{label:t,value:a,icon:i}=e;return(0,l.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,l.jsx)("div",{className:"ca-stat-icon",children:i}),(0,l.jsxs)("div",{className:"ca-stat-content",children:[(0,l.jsx)("div",{className:"ca-stat-label",children:t}),(0,l.jsx)("div",{className:"ca-stat-value",children:a})]})]})}function H(e){let{label:t,value:a}=e;return(0,l.jsxs)("div",{className:"ca-record-row",children:[(0,l.jsx)("span",{className:"ca-record-label",children:t}),(0,l.jsx)("span",{className:"ca-record-value",children:a})]})}function K(e){switch(null==e?void 0:e.toLowerCase()){case"common":default:return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b"}}function F(e){let{item:t,onClose:a,onEquip:i,onUnequip:n,isEquipped:r}=e,{config:s,level:o}=t,d=K(s.Rarity);return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(d,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(d,"22")},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(d,"44")},children:Y(s.Slot)}),(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:d},children:s.Name}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:d,fontWeight:"bold"},children:s.Rarity}),(0,l.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:s.Slot})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:[(0,l.jsxs)("span",{children:["當前屬性 (Lv.",o,"/",s.Max_Level||"??","):"]}),o>=(s.Max_Level||99)&&(0,l.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold"},children:"MAX"})]}),(0,l.jsx)("div",{children:function(e,t,a){let l=(Number(t.Base_Val)||0)+(a-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",m(l,2,1e3))}(s.Desc_Template,s,o)}),(0,l.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"戰力加成 (Est. CP)"}),(0,l.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",m(function(e,t){let a=(Number(e.Base_Val)||0)+(t-1)*(Number(e.Level_Mult)||0),l=String(e.Effect_Type||"").toUpperCase().trim();return l===c.ADD_BASE_DMG?Math.floor(10*a):l===c.ADD_AUTO_DMG?Math.floor(20*a):l===c.ADD_CRIT_CHANCE?Math.floor(10*a):l===c.ADD_CRIT_DMG?Math.floor(5*a):0}(s,o),2,1e3)]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"8px"},children:[r?(0,l.jsx)("button",{className:"ca-btn",onClick:()=>{n(s.Slot),a()},style:{flex:1,background:"#ef4444",color:"white",fontWeight:"bold"},children:"卸下"}):(0,l.jsx)("button",{className:"ca-btn",onClick:()=>{i(t.id,s.Slot),a()},style:{flex:1,background:"var(--ca-accent-gold)",color:"black",fontWeight:"bold"},children:"裝備"}),(0,l.jsx)("button",{className:"ca-btn",onClick:a,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"關閉"})]})]})})}function V(e){var t;let{player:a,effectiveStats:n,userId:r,gameConfig:s,onEquip:o,onUnequip:u}=e,[p,x]=i.useState(null),g=Object.entries((null==(t=a.equipment)?void 0:t.inventory)||{}).filter(e=>{let[,t]=e;return t>0}).map(e=>{var t;let[a,l]=e;return{id:a,level:l,config:null==s||null==(t=s.equipments)?void 0:t.find(e=>String(e.ID)===String(a))}}).filter(e=>!!e.config),h=i.useMemo(()=>{var e;let t={baseDamage:0,criticalChance:0,criticalDamage:0,goldMultiplier:0,xpMultiplier:0,autoAttackDamage:0};return(null==s?void 0:s.equipments)&&Object.values((null==(e=a.equipment)?void 0:e.equipped)||{}).forEach(e=>{var l,i;if(!e)return;let n=s.equipments.find(t=>String(t.ID)===String(e));if(!n)return;let r=Number((null==(i=a.equipment)||null==(l=i.inventory)?void 0:l[e])||1),o=Number(n.Base_Val||0)+(r-1)*Number(n.Level_Mult||0);switch(String(n.Effect_Type||"").toUpperCase().trim()){case c.ADD_BASE_DMG:t.baseDamage+=o;break;case c.ADD_AUTO_DMG:t.autoAttackDamage+=o;break;case c.ADD_CRIT_CHANCE:t.criticalChance+=o/100;break;case c.ADD_CRIT_DMG:t.criticalDamage+=o/100;break;case c.ADD_GOLD:case c.ADD_GOLD_MULT:t.goldMultiplier+=o/100;break;case c.ADD_XP_MULT:t.xpMultiplier+=o/100}}),t},[a.equipment,s]);return(0,l.jsxs)("div",{className:"ca-character-view",style:{flex:1,display:"flex",flexDirection:"column",width:"100%",height:"100%",padding:"12px",overflow:"hidden"},children:[(0,l.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"relative",paddingBottom:"12px"},children:[(0,l.jsxs)("div",{style:{width:"100%",maxWidth:"500px",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"8px",zIndex:10,padding:"0 4px"},children:[(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"⚔️"}),(0,l.jsx)("span",{className:"ca-stat-value",children:m(Math.floor(n.baseDamage),2,1e3)}),h.baseDamage>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",m(h.baseDamage,2,1e3),")"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83C\uDFAF"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*n.criticalChance).toFixed(1),"%"]}),h.criticalChance>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(100*h.criticalChance).toFixed(1),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83E\uDD16"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[Number(n.autoClickPerSec||0).toFixed(1),"/s"]}),n.autoClickPerSec>a.stats.autoClickPerSec&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(n.autoClickPerSec-a.stats.autoClickPerSec).toFixed(1),")"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCA5"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*n.criticalDamage).toFixed(0),"%"]}),h.criticalDamage>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(100*h.criticalDamage).toFixed(0),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCB0"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*n.goldMultiplier).toFixed(0),"%"]}),h.goldMultiplier>0&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(100*h.goldMultiplier).toFixed(0),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDC79"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*n.bossDamageMultiplier).toFixed(0),"%"]}),n.bossDamageMultiplier>a.stats.bossDamageMultiplier&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((n.bossDamageMultiplier-a.stats.bossDamageMultiplier)*100).toFixed(0),"%)"]})]})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr 60px",width:"100%",maxWidth:"500px",alignItems:"center",zIndex:2,padding:"0 4px",minHeight:"200px",margin:"0 auto"},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(X,{slot:d.MAIN_HAND,player:a,gameConfig:s,onClick:e=>{var t;let l=null==s||null==(t=s.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(X,{slot:d.HEAD,player:a,gameConfig:s,onClick:e=>{var t;let l=null==s||null==(t=s.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(X,{slot:d.BODY,player:a,gameConfig:s,onClick:e=>{var t;let l=null==s||null==(t=s.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}})]}),(0,l.jsxs)("div",{className:"ca-character-figure",style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(r||"Guest"),alt:"Character",style:{width:"110px",height:"110px",filter:"drop-shadow(0 10px 20px rgba(0,0,0,0.5))"}}),(0,l.jsxs)("div",{className:"ca-glass",style:{marginTop:"4px",padding:"2px 10px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(15, 23, 42, 0.6)"},children:[(0,l.jsxs)("span",{style:{fontSize:"0.9rem"},children:["Lv.",a.system.level]}),(0,l.jsx)("span",{style:{width:"1px",height:"10px",background:"rgba(255,255,255,0.2)"}}),(0,l.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold",fontSize:"0.8rem"},children:r||"Guest"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(X,{slot:d.HANDS,player:a,gameConfig:s,onClick:e=>{var t;let l=null==s||null==(t=s.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(X,{slot:d.LEGS,player:a,gameConfig:s,onClick:e=>{var t;let l=null==s||null==(t=s.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(X,{slot:d.RELIC,player:a,gameConfig:s,onClick:e=>{var t;let l=null==s||null==(t=s.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&x({id:e,level:a.equipment.inventory[e],config:l})}})]})]}),(0,l.jsx)("div",{style:{position:"absolute",top:"55%",left:"50%",transform:"translate(-50%, -50%)",width:"220px",height:"220px",background:"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",pointerEvents:"none",zIndex:0}})]}),(0,l.jsxs)("div",{style:{flex:"1 1 0px",width:"100%",background:"rgba(15, 23, 42, 0.4)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden",minHeight:"0"},children:[(0,l.jsxs)("div",{style:{padding:"8px 12px",background:"rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[(0,l.jsxs)("span",{style:{fontWeight:"bold",color:"#e2e8f0",fontSize:"0.9rem"},children:["\uD83C\uDF92 裝備倉庫 (",g.length,")"]}),(0,l.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--ca-text-muted)"},children:"點擊裝備以穿戴"})]}),(0,l.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px"},children:0===g.length?(0,l.jsx)("div",{style:{textAlign:"center",color:"gray",padding:"20px 0",fontSize:"0.8rem"},children:"倉庫空空如也..."}):(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(56px, 1fr))",gap:"8px"},children:g.map(e=>{var t;let i=Object.values((null==(t=a.equipment)?void 0:t.equipped)||{}).includes(e.id),n=K(e.config.Rarity);return(0,l.jsxs)("div",{onClick:()=>x(e),className:"ca-inventory-item",style:{width:"56px",height:"56px",background:"rgba(30, 41, 59, 0.6)",border:"2px solid ".concat(n),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",opacity:i?1:.8,boxShadow:i?"0 0 10px #22c55e, inset 0 0 5px #22c55e":"none"},title:"".concat(e.config.Name," (Lv.").concat(e.level,") - ").concat(e.config.Slot),children:[(0,l.jsx)("span",{style:{fontSize:"1.5rem"},children:Y(e.config.Slot)}),(0,l.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"4px",fontWeight:"bold"},children:["L.",e.level]}),i&&(0,l.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",background:"#22c55e",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"3px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"E"})]},e.id)})})})]}),p&&(0,l.jsx)(F,{item:p,onClose:()=>x(null),onEquip:o,onUnequip:u,isEquipped:Object.values(a.equipment.equipped).includes(p.id)})]})}function Y(e){switch(e){case d.MAIN_HAND:return"⚔️";case d.HEAD:return"\uD83E\uDE96";case d.BODY:return"\uD83D\uDC55";case d.HANDS:return"\uD83E\uDDE4";case d.LEGS:return"\uD83D\uDC62";case d.RELIC:return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function X(e){var t,a,i,n,r;let{slot:s,player:o,gameConfig:c,onClick:d}=e,u=null==(a=o.equipment)||null==(t=a.equipped)?void 0:t[s],p=u?null==c||null==(i=c.equipments)?void 0:i.find(e=>String(e.ID)===String(u)):null,x=u?(null==(r=o.equipment)||null==(n=r.inventory)?void 0:n[u])||1:0,m=p?K(p.Rarity):"rgba(255,255,255,0.1)";return(0,l.jsxs)("div",{className:"ca-equipment-slot",style:{width:"54px",height:"54px",background:"rgba(15, 23, 42, 0.6)",border:p?"2px solid ".concat(m):"1px dashed rgba(255,255,255,0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",transition:"all 0.2s",boxShadow:p?"0 0 15px ".concat(m,"44"):"none"},onClick:()=>u&&(null==d?void 0:d(u)),title:p?"".concat(p.Name," (Lv.").concat(x,")"):"Empty Slot",children:[(0,l.jsx)("div",{style:{fontSize:"1.6rem",opacity:p?1:.3},children:Y(s)}),p&&(0,l.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"6px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.2)"},children:["Lv.",x]})]})}var Q=a(23464);let J="https://script.google.com/macros/s/AKfycbxegFPp4kJZXDxUNqQopqiWVa2JLLM__rJbm700mUQsovg2nkE6wSJd2lFQyJQ4dg10/exec",Z={loadPlayerSave:async e=>{try{let t=await Q.A.get("".concat(J,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(t.data&&t.data.exists)return t.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,t)=>{try{if(!e)throw Error("User ID is required for saving");let a=await Q.A.post(J,{action:"save_progress",userId:e,saveData:t},{headers:{"Content-Type":"text/plain"}});if(a.data&&a.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await Q.A.get("".concat(J,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},$={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0,ascensionPoints:0,equipmentShards:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,apMultiplier:1,bossDamageMultiplier:1,autoClickPerSec:1,monsterKillReduction:0,rareMonsterChance:0,equipDamageMultiplier:0,atkPercentBonus:0},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{},levelShop:{},goldShop:{},ascensionShop:{},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0},equipment:{inventory:{},equipped:{}},lastDailyRewardClaimTime:0},ee={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,autoUsePotion:!1,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10,bossTimeLeft:null,bossTimeLimit:60};function et(){let[e,t]=(0,i.useState)(null),[a,d]=(0,i.useState)("BATTLE"),[u,x]=(0,i.useState)($),[h,f]=(0,i.useState)(ee),[_,S]=(0,i.useState)(null),[N,M]=(0,i.useState)(null),[k,w]=(0,i.useState)(null),[T,R]=(0,i.useState)(null),[P,O]=(0,i.useState)(null),[B,G]=(0,i.useState)(null),z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"系統提示",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return O({title:t,message:e,isAutoGacha:a,gachaResults:l})},q=i.useMemo(()=>{var e,t,a,l;let i={baseDamage:u.stats.baseDamage||1,autoAttackDamage:0,criticalChance:u.stats.criticalChance||.05,criticalDamage:u.stats.criticalDamage||1.5,goldMultiplier:u.stats.goldMultiplier||1,cpMultiplier:u.stats.cpMultiplier||1,xpMultiplier:u.stats.xpMultiplier||1,apMultiplier:u.stats.apMultiplier||1,bossDamageMultiplier:u.stats.bossDamageMultiplier||1,autoClickPerSec:u.stats.autoClickPerSec||1,monsterKillReduction:u.stats.monsterKillReduction||0,rareMonsterChance:u.stats.rareMonsterChance||0,equipDamageMultiplier:u.stats.equipDamageMultiplier||0,atkPercentBonus:u.stats.atkPercentBonus||0};return(null==N?void 0:N.equipments)&&(Object.values(u.equipment.equipped).forEach(e=>{if(!e)return;let t=N.equipments.find(t=>String(t.ID)===String(e));if(t){let a=Number(u.equipment.inventory[e]||1),l=Number(t.Base_Val||0)+(a-1)*Number(t.Level_Mult||0);switch(String(t.Effect_Type||"").toUpperCase().trim()){case c.ADD_BASE_DMG:i.baseDamage+=l;break;case c.ADD_AUTO_DMG:i.autoAttackDamage+=l;break;case c.ADD_CRIT_CHANCE:i.criticalChance+=l/100;break;case c.ADD_CRIT_DMG:i.criticalDamage+=l/100;break;case c.ADD_GOLD:case c.ADD_GOLD_MULT:i.goldMultiplier+=l/100;break;case c.ADD_XP_MULT:i.xpMultiplier+=l/100;break;case c.ADD_BOSS_DMG:i.bossDamageMultiplier+=l/100;break;case c.REDUCE_GOAL_V:i.monsterKillReduction+=l;break;case c.RARE_CHANCE_P:i.rareMonsterChance+=l/100;break;case c.AUTO_CLICK_V:i.autoClickPerSec+=l;break;case c.EQUIP_DMG_MULT:i.equipDamageMultiplier+=l}}}),((null==N||null==(e=N.upgrades)?void 0:e.filter(e=>e.Effect_Type===c.ADD_BASE_DMG||e.Effect_Type===c.ADD_AUTO_DMG))||[]).forEach(e=>{var t;let a=e.ID,l=String(e.Shop_Type||"").toUpperCase(),n=(null==(t=({GOLD:u.goldShop,LEVEL:u.levelShop,CLICK:u.clickShop,ASCENSION:u.ascensionShop})[l])?void 0:t[a])||0;if(n<=0)return;let r=e.Effect_Type,s=Number(e.Milestone_Level||0),o=Number(e.Milestone_Mult||1),d=s>0?Math.pow(o,Math.floor(n/s)):1,p=Number(e.Effect_Val||0)*n*d;r===c.ADD_BASE_DMG&&(i.baseDamage+=p),r===c.ADD_AUTO_DMG&&(i.autoAttackDamage+=p)}),((null==N||null==(t=N.upgrades)?void 0:t.filter(e=>e.Shop_Type===o.LEVEL))||[]).forEach(e=>{let t=e.ID,a=u.levelShop[t]||0;if(a<=0)return;let l=e.Effect_Type,n=Number(e.Effect_Val||0)*a;l===c.ADD_XP_MULT&&(i.xpMultiplier+=n/100),(l===c.ADD_GOLD_MULT||l===c.ADD_GOLD)&&(i.goldMultiplier+=n/100),l===c.ADD_BASE_DMG&&(i.baseDamage+=n),l===c.ADD_CRIT_CHANCE&&(i.criticalChance+=n/100),l===c.ADD_CRIT_DMG&&(i.criticalDamage+=n/100),l===c.ADD_BOSS_DMG&&(i.bossDamageMultiplier+=n/100),l===c.AUTO_CLICK_V&&(i.autoClickPerSec+=n)}),((null==N||null==(a=N.upgrades)?void 0:a.filter(e=>e.Shop_Type===o.CLICK))||[]).forEach(e=>{let t=e.ID,a=u.clickShop[t]||0;if(a<=0)return;let l=e.Effect_Type,n=Number(e.Effect_Val||0)*a;l===c.ADD_BASE_DMG&&(i.baseDamage+=n),l===c.ADD_CRIT_DMG&&(i.criticalDamage+=n/100),(l===c.ADD_GOLD_MULT||l===c.ADD_GOLD)&&(i.goldMultiplier+=n/100),l===c.ADD_XP_MULT&&(i.xpMultiplier+=n/100)}),null==N||null==(l=N.upgrades)||l.filter(e=>e.Shop_Type===o.ASCENSION),i.equipDamageMultiplier>0&&(i.baseDamage=Math.floor(i.baseDamage*(1+i.equipDamageMultiplier/100))),u.activeBuffs&&u.activeBuffs.ragePotionExpiresAt>Date.now()&&(i.baseDamage*=2)),i},[u.stats,u.equipment.equipped,u.equipment.inventory,u.goldShop,u.levelShop,u.clickShop,u.ascensionShop,N,u.activeBuffs.ragePotionExpiresAt]),W=(0,i.useCallback)((e,t)=>{var a,l,i,n;return{...e,...t,system:{...e.system,...t.system||{}},wallet:{...e.wallet,...t.wallet||{}},stats:{...e.stats,...t.stats||{}},records:{...e.records,...t.records||{}},clickShop:{...e.clickShop,...t.clickShop||{}},levelShop:{...e.levelShop,...t.levelShop||{}},goldShop:{...e.goldShop,...t.goldShop||{}},ascensionShop:{...e.ascensionShop,...t.ascensionShop||{}},inventory:{...e.inventory,...t.inventory||{}},activeBuffs:{...e.activeBuffs,...t.activeBuffs||{}},equipment:{...e.equipment,...t.equipment||{},inventory:{...(null==(a=e.equipment)?void 0:a.inventory)||{},...(null==(l=t.equipment)?void 0:l.inventory)||{}},equipped:{...(null==(i=e.equipment)?void 0:i.equipped)||{},...(null==(n=t.equipment)?void 0:n.equipped)||{}}}}},[]),H=q.autoAttackDamage,K=Math.floor(10*q.baseDamage+20*H+1e3*q.criticalChance+500*q.criticalDamage);(0,i.useEffect)(()=>{N&&x(e=>({...e,stats:eo(e)}))},[N]),(0,i.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await Z.getGameConfigs();e&&(console.log("[Config] Loaded:",e),M(e),function(e){if(!e)return console.log("[NumberFormat] 無設定資料，使用預設模式: LETTER");let t=String(e.NUMBER_FORMAT||"LETTER").toUpperCase().trim();"LETTER"===t||"SCIENTIFIC"===t||"CHINESE"===t?p(t):(console.warn("[NumberFormat] 未知的格式設定: ".concat(t,"，使用預設模式: LETTER")),p("LETTER"))}(e.settings))})();let e=localStorage.getItem("ca_last_user_id");e&&ea(e)},[]);let F=(0,i.useCallback)(()=>{var e,t;let a=h.isBossActive,l=Math.max(1,h.monstersRequiredForBoss-Math.floor(q.monsterKillReduction||0)),i=h.currentStageId<h.maxStageReached,n=h.autoChallengeBoss||i;!a&&n&&h.monstersKilledInStage>=l?(a=!0,f(e=>({...e,isBossActive:!0,bossTimeLeft:e.bossTimeLimit}))):a&&null===h.bossTimeLeft&&f(e=>({...e,bossTimeLeft:e.bossTimeLimit}));let r=ei(h.currentStageId,a,N),s=Math.ceil((20*Math.pow(1.18,h.currentStageId-1)+10*h.currentStageId)*r.hpMultiplier),o=(null==N?void 0:N.settings)||{},c=Number(null!=(e=o.GOLD_DROP_RATE)?e:.15),d=Number(null!=(t=o.XP_DROP_RATE)?t:.08),u=s*c*r.goldMultiplier,p=s*d*r.xpMultiplier;S({id:crypto.randomUUID(),configId:r.configId,name:"".concat(r.name," Lv.").concat(h.currentStageId),level:h.currentStageId,maxHp:s,currentHp:s,isBoss:"BOSS"===r.rarity,rewardGold:Math.max(1,Math.floor(u)),rewardXp:Math.max(1,Math.floor(p)),emoji:r.emoji,note:r.note})},[h,q.monsterKillReduction]),[Y,X]=(0,i.useState)(null);(0,i.useEffect)(()=>{_||F()},[_,F]),(0,i.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&ea(e)},[]);let Q=i.useRef(u),J=i.useRef(h),et=i.useRef(new Set);(0,i.useEffect)(()=>{Q.current=u,J.current=h},[u,h]),(0,i.useEffect)(()=>{let e;return h.isBossActive&&_&&_.isBoss&&(null===h.bossTimeLeft||void 0===h.bossTimeLeft?f(e=>({...e,bossTimeLeft:e.bossTimeLimit||60})):h.bossTimeLeft>0?e=setInterval(()=>{f(e=>{var t,a;return{...e,bossTimeLeft:(null!=(t=e.bossTimeLeft)?t:0)>0?(null!=(a=e.bossTimeLeft)?a:0)-1:0}})},1e3):0===h.bossTimeLeft&&(f(e=>({...e,isBossActive:!1,autoChallengeBoss:!1,bossTimeLeft:null})),S(null),z("挑戰失敗！Boss 挑戰時間超時，已回到關卡掛機模式並關閉自動挑戰。","挑戰失敗"))),()=>{e&&clearInterval(e)}},[h.isBossActive,h.bossTimeLeft,null==_?void 0:_.id,null==_?void 0:_.isBoss]),(0,i.useEffect)(()=>{if(!Y)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(Y," to Cloud..."));let e={player:Q.current,stage:J.current,timestamp:Date.now()};try{await Z.savePlayerProgress(Y,e),localStorage.setItem("ca_save_".concat(Y),JSON.stringify(e))}catch(t){console.warn("[AutoSave] Cloud save failed, using local backup",t),localStorage.setItem("ca_save_".concat(Y),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[Y]),(0,i.useEffect)(()=>{if(!h.autoUsePotion||u.inventory.ragePotionCount<=0)return;let e=setInterval(()=>{Date.now()>=(u.activeBuffs.ragePotionExpiresAt||0)&&u.inventory.ragePotionCount>0&&es("RAGE")},1e3);return()=>clearInterval(e)},[h.autoUsePotion,u.inventory.ragePotionCount,u.activeBuffs.ragePotionExpiresAt]),(0,i.useEffect)(()=>{if(u.activeBuffs.ragePotionExpiresAt>0){let e=setInterval(()=>{Date.now()>u.activeBuffs.ragePotionExpiresAt&&x(e=>({...e,activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:0}}))},1e3);return()=>clearInterval(e)}},[u.activeBuffs.ragePotionExpiresAt]),(0,i.useEffect)(()=>{if(!B)return;let e=setInterval(()=>{let e=B.split("_");if(e.length<2)return;let t=e[0],a=e[1],l="diamond"===a||"dia"===a;l?n.DIAMOND:n.AP;let i=(null==N?void 0:N.settings)||{},r=t.toUpperCase(),s=Number(i["GACHA_COST_".concat(r,"_").concat(l?"DIAMOND":"AP")])||({BASIC:l?2:20,ADV:l?20:200,PREM:l?100:1e3})[r]||999999;if((l?u.wallet.diamonds:u.wallet.ascensionPoints)<100*s){G(null),z("".concat(l?"\uD83D\uDC8E 鑽石":"\uD83D\uDD4A️ 飛昇點數"," 不足，已停止自動連續抽卡。"));return}er("gacha_".concat(t,"_").concat(a,"_100"))},1e3);return()=>clearInterval(e)},[B,u.wallet.diamonds,u.wallet.ascensionPoints,N]);let ea=async e=>{if(!e)return;X(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let t=await Z.loadPlayerSave(e);if(t){console.log("[Login] Cloud save found!"),t.player&&x(e=>W(e,t.player)),t.stage&&f(e=>({...e,...t.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let t=localStorage.getItem("ca_save_".concat(e));if(t){console.log("[Login] Found local backup.");try{let e=JSON.parse(t);x(t=>({...t,...e.player})),f(t=>({...t,...e.stage}))}catch(e){}}};(0,i.useEffect)(()=>{let e=setInterval(()=>{x(e=>({...e,records:{...e.records,playtimeSeconds:(e.records.playtimeSeconds||0)+1}}))},1e3);return()=>clearInterval(e)},[]);let el=async()=>{if(!Y)return;let e={player:u,stage:h,timestamp:Date.now()};try{await Z.savePlayerProgress(Y,e),z("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(Y),JSON.stringify(e))}catch(t){console.error("Save failed",t),z("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(Y),JSON.stringify(e))}};(0,i.useEffect)(()=>{if(!_||_.currentHp<=0||q.autoAttackDamage<=0)return;let e=setInterval(()=>{var e;let t=q.autoAttackDamage,a=_.isBoss&&q.bossDamageMultiplier||1,l=Math.ceil(t*a);S(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-l;return t<=0?(setTimeout(()=>en(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),x(e=>{let t=+q.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalDamageDealt:e.records.totalDamageDealt+l}}});let i={},n=0;((null==N||null==(e=N.upgrades)?void 0:e.filter(e=>e.Shop_Type===o.GOLD&&e.Effect_Type===c.ADD_AUTO_DMG))||[]).forEach(e=>{let t=e.ID,l=u.goldShop[t]||0;if(l<=0)return;let r=Number(e.Milestone_Level||0),s=Number(e.Milestone_Mult||1),o=r>0?Math.pow(s,Math.floor(l/r)):1,c=Number(e.Effect_Val||0)*l*o;i[t]=Math.ceil(c*a),n+=c}),i.player=Math.ceil(Math.max(0,q.autoAttackDamage-n)*a),w({time:Date.now(),damage:l,breakdown:i})},1e3);return()=>clearInterval(e)},[null==_?void 0:_.id,q.autoAttackDamage,q.bossDamageMultiplier,q.cpMultiplier,u.goldShop,N]),(0,i.useEffect)(()=>{let e=q.autoClickPerSec||0;if(e<=0||!_||_.currentHp<=0)return;let t=(((null==N?void 0:N.settings)||{}).HIT_MODE||r.OPTIMIZED)===r.OPTIMIZED&&e>=1,a=setInterval(()=>{let a=t?Math.floor(e):1,l=0,i=0,n=[];for(let e=0;e<a;e++){let e=Math.random()<q.criticalChance,t=e?Math.floor(q.baseDamage*q.criticalDamage):q.baseDamage,a=t;_.isBoss&&(a=Math.ceil(t*(q.bossDamageMultiplier||1))),l+=a,i+=+q.cpMultiplier,n.push({damage:a,isCrit:e})}if(!(l<=0))if(S(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-l;return t<=0?(setTimeout(()=>en(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),x(e=>({...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+i},records:{...e.records,totalClicks:e.records.totalClicks+a,totalDamageDealt:e.records.totalDamageDealt+l}})),t)R({id:crypto.randomUUID(),damage:l,isCrit:!1,burstHits:n});else{let e=n.length>0?n[0]:{damage:0,isCrit:!1};R({id:crypto.randomUUID(),damage:e.damage,isCrit:e.isCrit})}},t?1e3:Math.max(50,1e3/e));return()=>clearInterval(a)},[q.autoClickPerSec,q.baseDamage,q.criticalChance,q.criticalDamage,q.bossDamageMultiplier,q.cpMultiplier,null==_?void 0:_.id,N]);let ei=(0,i.useCallback)((e,t,a)=>{let l={configId:"fallback",name:"未知怪物",emoji:"❓",rarity:s.COMMON,hpMultiplier:1,goldMultiplier:1,xpMultiplier:1};if(!a||!a.monsters||0===a.monsters.length)return l;let i=a.monsters.filter(a=>{let l=Number(a.Stage_Min)||1,i=Number(a.Stage_Max)||9999;if(e<l||e>i)return!1;let n=(a.Rarity||"COMMON").toUpperCase();return t?"BOSS"===n:"BOSS"!==n});if(0===i.length)return l;let n=Math.random()*i.reduce((e,t)=>e+(Number(t.Weight)||0),0);for(let e of i){let t=Number(e.Weight)||0;if(n<t)return console.log("Selected Monster Config:",e),{configId:e.ID,name:e.Name,emoji:e.Emoji,rarity:e.Rarity||s.COMMON,hpMultiplier:Number(e.HP_Mult)||1,goldMultiplier:Number(e.Gold_Mult)||1,xpMultiplier:Number(e.XP_Mult)||1,dropDiamonds:Number(e.Drop_Diamonds)||0,note:e.Notes};n-=t}return l},[]),en=e=>{if(!e||et.current.has(e.id))return;et.current.add(e.id),et.current.size>50&&et.current.clear();let t=Math.ceil(e.rewardGold*q.goldMultiplier),a=Math.ceil(e.rewardXp*q.xpMultiplier);x(l=>{let{level:i,currentXp:r,requiredXp:s}=l.system,o=0;for(r+=a;r>=s;)r-=s,i+=1,o+=5,s=Math.floor(1.2*s);let c=D(l.wallet,n.GOLD,t);return o>0&&(c=D(c,n.LP,o)),{...l,wallet:c,system:{...l.system,level:i,currentXp:r,requiredXp:s},records:{...l.records,monstersKilled:l.records.monstersKilled+1,totalGoldEarned:l.records.totalGoldEarned+t,bossesKilled:e.isBoss?l.records.bossesKilled+1:l.records.bossesKilled,maxStageReached:e.isBoss?Math.max(l.records.maxStageReached,e.level+1):l.records.maxStageReached}}}),f(t=>{if(e.isBoss)return{...t,currentStageId:e.level+1,maxStageReached:Math.max(t.maxStageReached,e.level+1),isBossActive:!1,monstersKilledInStage:0,bossTimeLeft:null};let a=t.monstersKilledInStage+1;return{...t,monstersKilledInStage:a}}),S(null)},er=e=>{var t,a,l,i;if("daily_checkin"===e){let e=(null==N?void 0:N.settings)||{},t=Number(e.DAILY_REWARD_GEM)||1e3,a=Number(e.DAILY_REWARD_GOLD)||5e4,l=Number(e.DAILY_REWARD_AP)||0;x(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+t,gold:e.wallet.gold+a,ascensionPoints:(e.wallet.ascensionPoints||0)+l},lastDailyRewardClaimTime:Date.now()})),z("簽到成功！獲得 ".concat(t," \uD83D\uDC8E + ").concat(m(a,0)," \uD83D\uDCB0 + ").concat(l," \uD83D\uDD4A️"));return}if(e.startsWith("click_shop_")){let a=null==N||null==(t=N.upgrades)?void 0:t.find(t=>t.ID===e);if(!a)return;let l=u.clickShop[e]||0,i=Number(a.Max_Level||0);if(i>0&&l>=i)return void z("已達最大等級！");let r=j(Number(a.Cost_Base||0),Number(a.Cost_Mult||0),l,a.Effect_Type),s=a.Currency||n.CP;return void(b(u.wallet,s,r)?x(t=>{let a=v(t.wallet,s,r),i={...t.clickShop,[e]:l+1},n={...t,wallet:a,clickShop:i};return n.stats=eo(n),n}):z("".concat(s," 不足！")))}if(e.startsWith("level_shop_")){let t=null==N||null==(a=N.upgrades)?void 0:a.find(t=>t.ID===e);if(!t)return;let l=u.levelShop[e]||0,i=Number(t.Max_Level||0);if(i>0&&l>=i)return void z("已達最大等級！");let r=j(Number(t.Cost_Base||0),Number(t.Cost_Mult||0),l,t.Effect_Type),s=t.Currency||n.LP;return void(b(u.wallet,s,r)?x(t=>{let a=v(t.wallet,s,r),i={...t.levelShop,[e]:l+1},n={...t,wallet:a,levelShop:i};return n.stats=eo(n),n}):z("".concat(s," 不足！")))}let r=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:n.DIAMOND},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:n.DIAMOND}].find(t=>t.id===e);if(r&&(b(u.wallet,r.currency,r.cost)?x(e=>{let t=v(e.wallet,r.currency,r.cost);return t={...t,gold:t.gold+r.reward},{...e,wallet:t}}):z("鑽石不足！")),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:t}=u,a=null==N||null==(l=N.upgrades)?void 0:l.find(t=>t.ID===e);if(a){let l=t[e]||0,i=Number(a.Max_Level||0);if(i>0&&l>=i)return void z("已達最大等級！");let r=j(Number(a.Cost_Base||0),Number(a.Cost_Mult||1),l,a.Effect_Type);return void(b(u.wallet,n.GOLD,r)?x(t=>{let l=v(t.wallet,n.GOLD,r),i={...t.goldShop};i[e]=(t.goldShop[e]||0)+1;let s={...t.inventory};a.Effect_Type===c.ADD_INVENTORY&&"gold_potion_rage"===e&&(s.ragePotionCount=(s.ragePotionCount||0)+1);let o={...t,wallet:l,goldShop:i,inventory:s};return o.stats=eo(o),o}):z("金幣不足！"))}console.warn("[handleShopPurchase] Gold shop item not found in config: ".concat(e))}if(e.startsWith("gacha_")){if(e.includes("equipment"))return;let t=e.split("_");if(t.length<4)return;let a=t[1],l=t[2],i=Number(t[3])||1,r="basic";"adv"===a&&(r="advanced"),"prem"===a&&(r="premium");let s=n.AP;("diamond"===l||"dia"===l)&&(s=n.DIAMOND);let o=(null==N?void 0:N.settings)||{},c="GACHA_COST_".concat(a.toUpperCase(),"_").concat(s===n.DIAMOND?"DIAMOND":"AP"),d="basic"===a?s===n.DIAMOND?2:20:"adv"===a?s===n.DIAMOND?20:200:s===n.DIAMOND?100:1e3,p=(Number(o[c])||d)*i;if(b(u.wallet,s,p)){let e=(null==N?void 0:N.equipments)||[];if(e.length>0){let t=e.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===r?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==r||"MYTHIC"!==t});if(0===t.length)return void z("此箱子目前沒有可抽取的裝備設定。");let a=t.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),l={...u.equipment.inventory},n=[],o=[],c=0;for(let e=0;e<i;e++){let e=Math.random()*a,i=t[0];for(let a of t){let t=Number(a.Gacha_Weight)||0;if(e<t){i=a;break}e-=t}n.push(i);let r=l[i.ID]||0;if(r>=(Number(i.Max_Level)||10)){let e=(i.Rarity||"COMMON").toUpperCase(),t=1;switch(e){case"COMMON":default:t=1;break;case"UNCOMMON":t=3;break;case"RARE":t=10;break;case"EPIC":t=50;break;case"LEGENDARY":t=200;break;case"MYTHIC":t=1e3}c+=t,o.push({item:i,shards:t})}else l[i.ID]=r+1}if(x(e=>{let t=v(e.wallet,s,p);return t={...t,equipmentShards:(t.equipmentShards||0)+c},{...e,wallet:t,equipment:{...e.equipment,inventory:l}}}),1===i)if(o.length>0){let e=o[0];z("獲得裝備：".concat(e.item.Name," (已滿級)\n自動轉換為：\uD83E\uDDE9 裝備碎片 x").concat(e.shards),"獲得裝備")}else z("獲得裝備：".concat(n[0].Name," (Rarity: ").concat(n[0].Rarity,")"),"獲得裝備");else{let e={};n.forEach(t=>{e[t.Name]=(e[t.Name]||0)+1});let t=Object.entries(e).map(e=>{let[t,a]=e;return"".concat(t," x").concat(a)}).join("\n");c>0&&(t+="\n\n\uD83E\uDDE9 獲得碎片: ".concat(c," (滿級轉化)")),z("獲得 ".concat(i," 件裝備").concat("premium"===r?"(頂級)":"advanced"===r?"(高級)":"","：\n").concat(t),"獲得裝備",!!B,{summary:e,gainedShards:c,boxType:r,drawCount:i})}}else z("暫無裝備可抽取")}else z("".concat(s===n.DIAMOND?"鑽石":"飛昇點數 (AP)","不足！")),B&&G(null)}if(e.startsWith("ascension_shop_")||e.startsWith("asc_")){let t=null==N||null==(i=N.upgrades)?void 0:i.find(t=>t.ID===e);if(!t)return;let a=u.ascensionShop[e]||0,l=Number(t.Max_Level||0);if(l>0&&a>=l)return void z("已達最大等級！");let r=j(Number(t.Cost_Base||0),Number(t.Cost_Mult||0),a,t.Effect_Type),s=t.Currency||n.AP;b(u.wallet,s,r)?x(t=>{let l=v(t.wallet,s,r),i={...t.ascensionShop,[e]:a+1},n={...t,wallet:l,ascensionShop:i};return n.stats=eo(n),n}):z("".concat(s," 不足！"))}},es=e=>{"RAGE"===e&&u.inventory.ragePotionCount>0&&x(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))},eo=e=>{let t={...$.stats};return[{id:"gold_shop_weapon",levelKey:"weaponLevel"},{id:"gold_shop_mercenary",levelKey:"mercenaryLevel"},{id:"gold_shop_partner",levelKey:"partnerLevel"},{id:"gold_shop_archer",levelKey:"archerLevel"},{id:"gold_shop_knight",levelKey:"knightLevel"},{id:"gold_shop_warlord",levelKey:"warlordLevel"},{id:"gold_shop_oracle",levelKey:"oracleLevel"},{id:"gold_shop_void",levelKey:"voidLevel"},{id:"gold_shop_titan",levelKey:"titanLevel"},{id:"gold_shop_amulet",levelKey:"amuletLevel"}].forEach(a=>{var l;let{id:i,levelKey:n}=a,r=e.goldShop[n]||0;if(r<=0)return;let s=null==N||null==(l=N.upgrades)?void 0:l.find(e=>e.ID===i);if(s){let e=s.Effect_Type,a=Number(s.Effect_Val||0)*r;t=g(t,e,a)}}),["clickShop","levelShop","ascensionShop"].forEach(a=>{Object.entries(e[a]).forEach(e=>{var a;let[l,i]=e,n=null==N||null==(a=N.upgrades)?void 0:a.find(e=>e.ID===l);if(n&&i>0){let e=n.Effect_Type,a=Number(n.Effect_Val||0)*i;t=g(t,e,a)}})}),t.atkPercentBonus>0&&(t.baseDamage=Math.floor(t.baseDamage*(1+t.atkPercentBonus/100))),t},ec=()=>{ed<=0||(x(e=>{let t=y(e.wallet,[n.AP,n.CP,n.DIAMOND,n.EQUIPMENT_SHARD]);t=D(t,n.AP,ed);let a={...e,system:{level:1,currentXp:0,requiredXp:100},wallet:t,goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,warlordLevel:0,oracleLevel:0,voidLevel:0,titanLevel:0,amuletLevel:0},levelShop:{},activeBuffs:{ragePotionExpiresAt:0}};return a.stats=eo(a),a}),f(e=>({...e,currentStageId:1,monstersKilledInStage:0,isBossActive:!1,maxStageReached:1,bossTimeLeft:null})),S(null),z("⚡ 渡劫成功！獲得 ".concat(ed.toLocaleString()," 點飛昇點數！\n等級與等級點數已重製，裝備與點擊加成已保留。"),"渡劫成功"),d("BATTLE"))},ed=i.useMemo(()=>{var e,t,a,l;let i=(null==N?void 0:N.settings)||{},n=String(null!=(e=i.ASCENSION_FORMULA)?e:"SOFT_EXP"),r=Number(null!=(t=i.ASCENSION_BASE)?t:10),s=Number(null!=(a=i.ASCENSION_MULT)?a:1.5),o=Number(null!=(l=i.ASCENSION_MIN_STAGE)?l:1),c=u.stats.apMultiplier||1,d=Math.max(1,h.maxStageReached);if(d<o)return 0;let p=0;switch(n){case"LINEAR":p=r+d*s;break;case"SQRT":p=r*Math.sqrt(d);break;case"LOG":p=r*Math.log10(d+1)*s;break;default:p=r*Math.pow(s,Math.sqrt(d))}return Math.floor(p*c)},[h.maxStageReached,null==N?void 0:N.settings,u.stats.apMultiplier]);return(0,l.jsxs)("div",{className:"ca-game-container",children:[(0,l.jsx)(C,{player:u,combatPower:K,stageId:h.currentStageId,userId:Y,onAvatarClick:()=>t("PROFILE"),onAscension:()=>{if(ed<=0)return void z("尚未達到飛升條件！");window.confirm("確定要渡劫飛升嗎？\n\n將重置關卡與金幣，並獲得 ".concat(ed.toLocaleString()," 點飛升點數！"))&&ec()},potentialPoints:ed}),"BATTLE"===a?(0,l.jsx)(A,{monster:_,stageId:h.currentStageId,onMonsterClick:(e,t)=>{_&&!(_.currentHp<=0)&&(S(t=>{if(!t||t.currentHp<=0)return t;let a=Math.max(0,t.currentHp-e);return a<=0&&setTimeout(()=>en(t),0),{...t,currentHp:a}}),x(t=>({...t,records:{...t.records,totalClicks:t.records.totalClicks+1,totalDamageDealt:t.records.totalDamageDealt+e},wallet:{...t.wallet,clickPoints:t.wallet.clickPoints+ +q.cpMultiplier}})))},baseDamage:q.baseDamage,criticalChance:q.criticalChance,criticalDamage:q.criticalDamage,bossDamageMultiplier:q.bossDamageMultiplier||1,monstersKilled:h.monstersKilledInStage,monstersRequired:Math.max(1,h.monstersRequiredForBoss-Math.floor(q.monsterKillReduction||0)),isBossActive:h.isBossActive,goldShop:u.goldShop,gameConfig:N,potionCount:u.inventory.ragePotionCount,activeBuffs:u.activeBuffs,onUsePotion:()=>es("RAGE"),lastAutoAttack:k,lastAutoClickEvent:T,bossTimeLeft:h.bossTimeLeft,bossTimeLimit:h.bossTimeLimit,onChallengeBoss:()=>{f(e=>({...e,isBossActive:!0,autoChallengeBoss:!0,bossTimeLeft:e.bossTimeLimit||60})),S(null)},autoUsePotion:h.autoUsePotion,onToggleAutoPotion:()=>f(e=>({...e,autoUsePotion:!e.autoUsePotion}))}):(0,l.jsx)(V,{player:u,effectiveStats:q,userId:Y,gameConfig:N,onEquip:(e,t)=>{x(a=>({...a,equipment:{...a.equipment,equipped:{...a.equipment.equipped,[t]:e}}}))},onUnequip:e=>{x(t=>{let a={...t.equipment.equipped};return delete a[e],{...t,equipment:{...t.equipment,equipped:a}}})}}),(0,l.jsx)(E,{activeView:a,onSwitchView:d,onOpenModal:t}),(0,l.jsx)(I,{isOpen:"PROFILE"===e,onClose:()=>t(null),title:"玩家資料",children:(0,l.jsx)(U,{player:u,effectiveStats:q,combatPower:K,userId:Y,onLogin:ea,onLogout:()=>{X(null),localStorage.removeItem("ca_last_user_id"),x($),f(ee)},onManualSave:el,gameConfig:N})}),(0,l.jsx)(I,{isOpen:"SHOP"===e,onClose:()=>t(null),title:"商店",headerContent:(0,l.jsxs)("div",{className:"ca-shop-currency-bar",style:{display:"flex",flexWrap:"wrap",border:"none",background:"transparent",padding:"0 8px",gap:"12px"},children:[(0,l.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},title:"金幣",children:[(0,l.jsx)("span",{children:"\uD83D\uDCB0"}),(0,l.jsx)("span",{children:m(Math.floor(u.wallet.gold),2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},title:"鑽石",children:[(0,l.jsx)("span",{children:"\uD83D\uDC8E"}),(0,l.jsx)("span",{children:m(u.wallet.diamonds,2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"var(--ca-accent-cyan, #22d3ee)"},title:"點擊點數",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:m(Math.floor(u.wallet.clickPoints),2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#4ade80"},title:"等級積分",children:[(0,l.jsx)("span",{children:"\uD83C\uDD99"}),(0,l.jsx)("span",{children:m(u.wallet.levelPoints,2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#d8b4fe"},title:"飛昇點數",children:[(0,l.jsx)("span",{children:"\uD83D\uDD4A️"}),(0,l.jsx)("span",{children:m(u.wallet.ascensionPoints,2,1e3)})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#fca5a5"},title:"裝備碎片",children:[(0,l.jsx)("span",{children:"\uD83E\uDDE9"}),(0,l.jsx)("span",{children:m(u.wallet.equipmentShards||0,2,1e3)})]})]}),children:(0,l.jsx)(L,{player:u,onPurchase:er,onBulkPurchase:(e,t)=>{if(!(null==N?void 0:N.upgrades)||!e.startsWith("gold_shop_")&&!e.startsWith("gold_potion_"))return;let a=N.upgrades.find(t=>t.ID===e);if(!a)return;let l=a.Effect_Type===c.ADD_INVENTORY,i=l?0:u.goldShop[e]||0,r=Number(a.Max_Level||0),s=l?t:r>0?Math.min(t,r-i):t;if(s<=0)return void z("已達最大等級！");let o=0;for(let e=0;e<s;e++)o+=j(Number(a.Cost_Base||0),Number(a.Cost_Mult||1),l?0:i+e,a.Effect_Type);if(!b(u.wallet,n.GOLD,o))return void z("金幣不足！");x(t=>{let a=v(t.wallet,n.GOLD,o);if(l){let l={...t.inventory};return"gold_potion_rage"===e&&(l.ragePotionCount=(l.ragePotionCount||0)+s),{...t,wallet:a,inventory:l}}let i={...t.goldShop};i[e]=(t.goldShop[e]||0)+s;let r={...t,wallet:a,goldShop:i};return r.stats=eo(r),r})},onResetLevelPoints:()=>{window.confirm("確定要重製等級積分嗎？\n所有已分配的點數將會返還，您可以重新分配天賦。")&&(x(e=>{let t=0;Object.entries(e.levelShop).forEach(e=>{var a;let[l,i]=e,n=null==N||null==(a=N.upgrades)?void 0:a.find(e=>e.ID===l);if(n)for(let e=0;e<i;e++){let a=j(Number(n.Cost_Base||0),Number(n.Cost_Mult||1),e,n.Effect_Type);t+=a}});let a=D(e.wallet,n.LP,t),l={...e,wallet:a,levelShop:{}};return l.stats=eo(l),l}),z("✅ 等級積分已重製！"))},gameConfig:N,autoGachaBox:B,onToggleAutoGacha:e=>G(e)})}),(0,l.jsx)(I,{isOpen:!!P,onClose:()=>O(null),title:(null==P?void 0:P.title)||"系統提示",children:(0,l.jsxs)("div",{style:{textAlign:(null==P?void 0:P.gachaResults)?"left":"center",padding:"20px",fontSize:"1rem",color:"#e2e8f0",maxHeight:"60vh",overflowY:"auto"},children:[(null==P?void 0:P.gachaResults)?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fbbf24",marginBottom:"16px",textAlign:"center"},children:["\uD83C\uDF8A 連抽結果摘要 (",P.gachaResults.drawCount," 抽)"]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"10px",marginBottom:"20px"},children:Object.entries(P.gachaResults.summary).map(e=>{let[t,a]=e;return(0,l.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.9rem"},children:t}),(0,l.jsxs)("span",{style:{color:"#10b981",fontWeight:"bold",fontSize:"0.8rem"},children:["x",a]})]},t)})}),P.gachaResults.gainedShards>0&&(0,l.jsxs)("div",{style:{background:"rgba(16, 185, 129, 0.1)",padding:"12px",borderRadius:"8px",border:"1px solid rgba(16, 185, 129, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",fontWeight:"bold"},children:[(0,l.jsx)("span",{style:{fontSize:"1.2rem"},children:"\uD83E\uDDE9"}),(0,l.jsxs)("span",{style:{color:"#34d399"},children:["轉化獲得碎片: ",P.gachaResults.gainedShards]})]})]}):(0,l.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:null==P?void 0:P.message}),(0,l.jsxs)("div",{style:{marginTop:"24px",display:"flex",justifyContent:"center",gap:"12px",position:"sticky",bottom:0,background:"var(--ca-bg-modal, #1e293b)",paddingTop:"12px"},children:[(null==P?void 0:P.isAutoGacha)&&(0,l.jsxs)("button",{className:"ca-btn",style:{padding:"10px 24px",background:"linear-gradient(to bottom, #ef4444, #b91c1c)",color:"white",border:"none",fontWeight:"bold",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",gap:"8px"},onClick:()=>{G(null),O(null)},children:[(0,l.jsx)("span",{children:"⏹️"})," 停止自動抽取"]}),(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"10px 32px",minWidth:"120px",fontWeight:"bold"},onClick:()=>O(null),children:"確定"})]})]})})]})}},66997:()=>{}}]);