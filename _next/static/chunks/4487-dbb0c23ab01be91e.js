(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4487],{54487:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var l=a(95155),s=a(12115),i=function(e){return e.COMMON="COMMON",e.RARE="RARE",e.BOSS="BOSS",e}({}),n=function(e){return e.MAIN_HAND="MAIN_HAND",e.HEAD="HEAD",e.BODY="BODY",e.HANDS="HANDS",e.LEGS="LEGS",e.RELIC="RELIC",e}({});function r(e){let{player:t,combatPower:a,stageId:s,onAvatarClick:i,onAscension:n,potentialPoints:r}=e,{system:o,wallet:c}=t,d=o.currentXp/o.requiredXp*100;return(0,l.jsxs)("header",{className:"ca-header",children:[(0,l.jsxs)("div",{className:"ca-player-profile",children:[(0,l.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:i,children:[(0,l.jsx)("div",{className:"ca-avatar-ring",children:(0,l.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,l.jsx)("div",{className:"ca-level-badge",children:o.level})]}),(0,l.jsxs)("div",{className:"ca-profile-info",children:[(0,l.jsxs)("div",{className:"ca-profile-top",children:[(0,l.jsxs)("span",{className:"ca-level-text",children:["Lv.",o.level]}),(0,l.jsx)("span",{className:"ca-player-name",children:"冒險者"})]}),(0,l.jsxs)("div",{className:"ca-exp-container",children:[(0,l.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,l.jsx)("div",{className:"ca-exp-bar",children:(0,l.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,d),"%")}})}),(0,l.jsxs)("div",{className:"ca-exp-text",children:[o.currentXp.toLocaleString(),"/",o.requiredXp.toLocaleString()]})]}),(0,l.jsxs)("div",{className:"ca-combat-power",style:{justifyContent:"space-between",width:"100%"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,l.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,l.jsx)("span",{className:"ca-cp-value",children:a.toLocaleString()})]}),(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),n()},style:{display:"flex",alignItems:"center",gap:"4px",background:"linear-gradient(135deg, #a855f7 0%, #d946ef 100%)",color:"white",padding:"4px 10px",fontSize:"0.65rem",fontWeight:"bold",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:"0 0 10px rgba(168, 85, 247, 0.3)",flexShrink:0},children:["⚡ 渡劫飛升 (+",r.toLocaleString(),")"]})]})]})]}),(0,l.jsx)("div",{className:"ca-header-right",children:(0,l.jsxs)("div",{className:"ca-currency-stack",children:[(0,l.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,l.jsx)("span",{children:"\uD83D\uDCB0"}),(0,l.jsx)("span",{children:Math.floor(c.gold).toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:Math.floor(c.clickPoints).toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency text-xs",style:{color:"#10b981"},children:[(0,l.jsx)("span",{children:"\uD83C\uDD99"}),(0,l.jsx)("span",{children:Math.floor(c.levelPoints).toLocaleString()})]})]})})]})}function o(e){let{name:t,currentHp:a,maxHp:s,isBoss:i=!1}=e,n=Math.max(1,s),r=Math.min(Math.max(0,a),n);return(0,l.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,l.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,l.jsx)("span",{className:"text-slate-300 me-2",children:t})}),(0,l.jsx)("div",{className:"ca-hp-bar",children:(0,l.jsx)("div",{className:"ca-hp-bar-fill ".concat(i?"boss":"normal"),style:{width:"".concat(r/n*100,"%")}})}),(0,l.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[Math.ceil(r).toLocaleString()," /"," ",Math.ceil(n).toLocaleString()]})]})}function c(e){let{monster:t,stageId:a,onMonsterClick:i,baseDamage:n,criticalChance:r,criticalDamage:c,monstersKilled:d,monstersRequired:p,isBossActive:u,bossDamageMultiplier:m=1,mercenaryLevel:x=0,partnerLevel:g=0,archerLevel:h=0,knightLevel:f=0,potionCount:v=0,activeBuffs:b,onUsePotion:D,lastAutoAttack:y,lastAutoClickEvent:j,bossTimeLeft:C,bossTimeLimit:S=60,onChallengeBoss:_}=e,[N,M]=(0,s.useState)([]),[A,w]=(0,s.useState)(!1),[L,k]=(0,s.useState)(!1),[I,E]=(0,s.useState)(!1),[T,R]=(0,s.useState)(!1),[P,O]=(0,s.useState)(!1),[G,z]=(0,s.useState)(!1),B=(0,s.useRef)(null),q=(0,s.useRef)(null),U=(0,s.useRef)(null),W=(0,s.useRef)(null),H=(0,s.useRef)(null),K=(0,s.useRef)(0),F=(0,s.useRef)(""),X=(null==b?void 0:b.ragePotionExpiresAt)&&b.ragePotionExpiresAt>Date.now(),V=(e,t,a,l)=>{let s=crypto.randomUUID();M(i=>[...i,{id:s,text:e,x:t,y:a,type:l,createdAt:Date.now()}]),setTimeout(()=>{M(e=>e.filter(e=>e.id!==s))},1e3)};s.useEffect(()=>{var e;if(!j||j.id===F.current)return;F.current=j.id,k(!0),setTimeout(()=>k(!1),50);let t=null==(e=B.current)?void 0:e.getBoundingClientRect();if(t){let e=t.width/2+(60*Math.random()-30),a=t.height/2+(60*Math.random()-30),l=j.isCrit?"CRIT":"CLICK";V(j.damage.toLocaleString(),e,a,l)}},[j]),s.useEffect(()=>{var e;if(!y||y.time===K.current)return;K.current=y.time,k(!0),setTimeout(()=>k(!1),150);let t=null==(e=B.current)?void 0:e.getBoundingClientRect();if(y.breakdown&&t){let{mercenary:e,partner:a,archer:l,knight:s,player:i}=y.breakdown;if(e>0&&q.current){let a=q.current.getBoundingClientRect(),l=a.left-t.left+a.width/2,s=a.top-t.top;V("⚔️ ".concat(e.toLocaleString()),l,s-20,"AUTO"),E(!0),setTimeout(()=>E(!1),300)}if(a>0&&U.current){let e=U.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,s=e.top-t.top;V("\uD83E\uDDDA ".concat(a.toLocaleString()),l,s-20,"AUTO"),R(!0),setTimeout(()=>R(!1),400)}if(l>0&&W.current){let e=W.current.getBoundingClientRect(),a=e.left-t.left+e.width/2,s=e.top-t.top;V("\uD83C\uDFF9 ".concat(l.toLocaleString()),a,s-20,"AUTO"),O(!0),setTimeout(()=>O(!1),300)}if(s>0&&H.current){let e=H.current.getBoundingClientRect(),a=e.left-t.left+e.width/2,l=e.top-t.top;V("\uD83D\uDEE1️ ".concat(s.toLocaleString()),a,l-20,"AUTO"),z(!0),setTimeout(()=>z(!1),300)}if(i>0){let e=t.width/2+(40*Math.random()-20),a=t.height/2+(40*Math.random()-20)-50;V(i.toLocaleString(),e,a,"AUTO")}}else if(t){let e=t.width/2+(40*Math.random()-20),a=t.height/2+(40*Math.random()-20)-50;V(y.damage.toLocaleString(),e,a,"AUTO"),x>0&&(E(!0),setTimeout(()=>E(!1),300))}},[y,x,g,h,f]);let Y=e=>{var a,l,s,o,d;let p,u;if(!t||t.currentHp<=0)return;let x=n;X&&(x*=2),t.isBoss&&(x*=m);let g=Math.random()<r,h=Math.ceil(x*(g?c:1)),f=null==(a=B.current)?void 0:a.getBoundingClientRect();if(!f)return;"touches"in e?(p=null!=(o=null==(l=e.touches[0])?void 0:l.clientX)?o:f.left+f.width/2,u=null!=(d=null==(s=e.touches[0])?void 0:s.clientY)?d:f.top+f.height/2):(p=e.clientX,u=e.clientY);let v=p-f.left+(60*Math.random()-30),b=u-f.top+(60*Math.random()-30);V(h.toLocaleString(),v,b,g?"CRIT":"CLICK"),w(!0),k(!0),setTimeout(()=>w(!1),300),setTimeout(()=>k(!1),150),i(h,g)},J=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,l.jsxs)("div",{ref:B,className:"ca-battle-area ".concat(A?"ca-shake":""),style:{background:X?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:Y,onTouchStart:Y,children:[(0,l.jsx)("div",{className:"ca-monster-container",children:t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"ca-stage-display",children:["第 ",a," 關"]}),!u&&(d>=p?(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",onClick:e=>{e.stopPropagation(),null==_||_()},style:{marginBottom:"16px",padding:"8px 20px",fontSize:"1rem",background:"linear-gradient(to right, #ef4444, #b91c1c)",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",border:"none"},children:"⚔️ 挑戰 BOSS"}):(0,l.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.3)",padding:"2px 8px",borderRadius:"12px"},children:[d," / ",p," \uD83D\uDC80"]})),u&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"6px",marginBottom:"16px",width:"100%"},children:[(0,l.jsx)("div",{style:{fontSize:"0.85rem",color:"#ef4444",fontWeight:"bold",background:"rgba(239, 68, 68, 0.15)",padding:"4px 12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.4)",letterSpacing:"1px"},children:"\uD83D\uDC79 BOSS 戰進行中"}),null!=C&&(0,l.jsxs)("div",{style:{width:"100%",maxWidth:"200px"},children:[(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginBottom:"4px"},children:(0,l.jsxs)("span",{style:{fontSize:"1.4rem",fontWeight:"900",color:C<=10?"#ff4d4d":"#fbbf24",textShadow:"0 0 10px rgba(0,0,0,0.8)",fontFamily:"monospace"},children:["⏱️ ",C,"s"]})}),(0,l.jsx)("div",{style:{width:"100%",height:"6px",background:"rgba(255,255,255,0.1)",borderRadius:"3px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.05)"},children:(0,l.jsx)("div",{style:{height:"100%",width:"".concat(C/S*100,"%"),background:C<=10?"linear-gradient(90deg, #ef4444, #b91c1c)":"linear-gradient(90deg, #fbbf24, #d97706)",transition:"width 1s linear, background 0.3s"}})})]})]}),t.note&&(0,l.jsxs)("div",{className:"ca-note-badge",children:[(0,l.jsx)("span",{children:"\uD83D\uDCCD"}),(0,l.jsx)("span",{children:t.note})]}),(0,l.jsx)("div",{className:"ca-monster-sprite ".concat(t.isBoss?"boss":""," ").concat(L?"ca-hit-flash":""," ca-bounce-slow"),children:t.emoji||(t.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")}),(0,l.jsx)("div",{className:"mt-6 w-56",children:(0,l.jsx)(o,{name:t.name,currentHp:t.currentHp,maxHp:t.maxHp,isBoss:t.isBoss})})]}):(0,l.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),(0,l.jsx)("div",{ref:q,className:I?"ca-attack-lunge":"",style:{position:"absolute",bottom:"20px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:x>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{fontSize:"2rem"},children:"⚔️"}),(0,l.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",x]})]})}),(0,l.jsx)("div",{ref:U,className:T?"ca-attack-magic":"",style:{position:"absolute",bottom:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:g>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83E\uDDDA"}),(0,l.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",g]})]})}),v>0&&(0,l.jsxs)("div",{onClick:e=>{e.stopPropagation(),!X&&D&&D()},style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",cursor:X?"default":"pointer",opacity:X?.5:1,zIndex:20},children:[(0,l.jsx)("div",{style:{fontSize:"2rem",filter:X?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:X?"scale(0.9)":"scale(1)"},children:"\uD83E\uDDEA"}),(0,l.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"10px",padding:"2px 6px",marginTop:"-10px"},children:["x",v]})]}),(0,l.jsx)("div",{ref:W,className:P?"ca-attack-lunge":"",style:{position:"absolute",top:"80px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:h>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83C\uDFF9"}),(0,l.jsxs)("div",{style:{fontSize:"0.7rem",color:"#a5b4fc"},children:["Lv.",h]})]})}),(0,l.jsx)("div",{ref:H,className:G?"ca-attack-lunge":"",style:{position:"absolute",top:"140px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:f>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDEE1️"}),(0,l.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fca5a5"},children:["Lv.",f]})]})}),(0,l.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",children:N.map(e=>(0,l.jsx)("div",{className:J(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function d(e){let{activeView:t,onSwitchView:a,onOpenModal:s}=e;return(0,l.jsx)("footer",{className:"ca-footer",children:(0,l.jsxs)("nav",{className:"ca-footer-nav",children:[(0,l.jsxs)("button",{className:"ca-tab-btn ".concat("CHARACTER"===t?"active":""),onClick:()=>{a("CHARACTER"),s(null)},children:[(0,l.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,l.jsx)("span",{className:"label",children:"角色"})]}),(0,l.jsxs)("button",{className:"ca-tab-btn ".concat("BATTLE"===t?"active":""),onClick:()=>{a("BATTLE"),s(null)},children:[(0,l.jsx)("span",{className:"icon",children:"⚔️"}),(0,l.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,l.jsxs)("button",{className:"ca-tab-btn",onClick:()=>s("SHOP"),children:[(0,l.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,l.jsx)("span",{className:"label",children:"商店"})]})]})})}function p(e){let{isOpen:t,onClose:a,title:s,headerContent:i,children:n}=e;return t?(0,l.jsx)("div",{className:"ca-modal-overlay",onClick:a,children:(0,l.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"ca-modal-header",children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,l.jsx)("h2",{className:"ca-modal-title",children:s}),i]}),(0,l.jsx)("button",{className:"ca-modal-close",onClick:a,children:"✕"})]}),(0,l.jsx)("div",{className:"ca-modal-content",children:n})]})}):null}a(66997);let u=e=>e<=50?{name:"練氣期",color:"#a7f3d0"}:e<=150?{name:"築基期",color:"#6ee7b7"}:e<=300?{name:"金丹期",color:"#fbbf24"}:e<=500?{name:"元嬰期",color:"#f472b6"}:e<=800?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"};function m(e){let{player:t,onPurchase:a,onResetLevelPoints:i,gameConfig:n}=e,[r,o]=(0,s.useState)("DAILY"),[c,d]=(0,s.useState)("UPGRADE"),[p,m]=(0,s.useState)(null),f=s.useMemo(()=>(null==n?void 0:n.upgrades)?n.upgrades.filter(e=>"CLICK"===e.Shop_Type).map(e=>e.ID).reduce((e,a)=>e+(t.clickShop[a]||0),0):0,[t.clickShop,n]),v=u(f);console.log("[ShopPage] Rendering. ActiveTab:",r,"isProbModalOpen:",p);let D=e=>"gold_shop_weapon"===e?t.goldShop.weaponLevel||0:"gold_shop_mercenary"===e?t.goldShop.mercenaryLevel||0:"gold_shop_partner"===e?t.goldShop.partnerLevel||0:"gold_shop_archer"===e?t.goldShop.archerLevel||0:"gold_shop_knight"===e?t.goldShop.knightLevel||0:"gold_shop_amulet"===e?t.goldShop.amuletLevel||0:"gold_potion_rage"===e?t.inventory.ragePotionCount||0:e.startsWith("level_shop_")?t.levelShop[e]||0:e.startsWith("click_shop_")?t.clickShop[e]||0:(e.startsWith("ascension_shop_")||e.startsWith("asc_"))&&t.ascensionShop[e]||0,y=(e,t,a,l)=>"ADD_INVENTORY"===l?e:1===t||1===t?Math.floor(e+a):Math.floor(e*Math.pow(t,a)),j=e=>"GOLD"===e?"\uD83D\uDCB0":"LP"===e?"\uD83C\uDD99":"CP"===e?"⚡":"DIAMOND"===e?"\uD83D\uDC8E":"AP"===e?"\uD83D\uDD4A️":e,C=e=>"GOLD"===e?t.wallet.gold:"LP"===e?t.wallet.levelPoints:"CP"===e?t.wallet.clickPoints:"DIAMOND"===e?t.wallet.diamonds:"AP"===e?t.wallet.ascensionPoints:0,S=e=>0===e.length?(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"gray"},children:"無項目"}):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(e=>{let t=D(e.ID),s=y(e.Cost_Base,e.Cost_Mult,t,e.Effect_Type),i=j(e.Currency),n=C(e.Currency),r=Number(e.Max_Level||0),o=r>0&&t>=r,c=e.Desc_Template||e.Name;return c.includes("{val}")&&(c=c.replace("{val}",String(e.Effect_Val))),(0,l.jsx)(g,{name:e.Name,desc:"".concat(c," [Lv.").concat(t,"]"),level:t,cost:s,currencyLabel:i,canAfford:!o&&n>=s,isMaxed:o,onClick:()=>a(e.ID)},e.ID)})}),_=e=>n&&n.upgrades?S(n.upgrades.filter(t=>t.Shop_Type===e)):null,N=(()=>{if(!t.lastDailyRewardClaimTime)return!0;let e=new Date(t.lastDailyRewardClaimTime),a=new Date;return e.getDate()!==a.getDate()||e.getMonth()!==a.getMonth()||e.getFullYear()!==a.getFullYear()})();return(0,l.jsxs)("div",{className:"ca-shop-container",children:[(0,l.jsxs)("div",{className:"ca-shop-tabs",children:[(0,l.jsxs)("button",{onClick:()=>o("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===r?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,l.jsx)("div",{className:"label",children:"每日商店"}),N&&(0,l.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,l.jsxs)("button",{onClick:()=>o("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===r?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,l.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,l.jsxs)("button",{onClick:()=>o("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===r?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,l.jsx)("div",{className:"label",children:"等級商店"})]}),(0,l.jsxs)("button",{onClick:()=>o("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===r?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"⚡"}),(0,l.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,l.jsxs)("button",{onClick:()=>o("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===r?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,l.jsx)("div",{className:"label",children:"飛昇商店"})]}),(0,l.jsxs)("button",{onClick:()=>o("EQUIPMENT"),className:"ca-shop-tab-btn equipment ".concat("EQUIPMENT"===r?"active":""),children:[(0,l.jsx)("div",{className:"icon",children:"⚔️"}),(0,l.jsx)("div",{className:"label",children:"裝備扭蛋"})]})]}),(0,l.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===r&&(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,l.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,l.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,l.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,l.jsx)("div",{style:{fontSize:"3rem",filter:N?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#fde047"},children:"10 \uD83D\uDC8E + 500 \uD83D\uDCB0"})]}),(0,l.jsx)("button",{className:"ca-btn ".concat(N?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:N?1:.5,cursor:N?"pointer":"not-allowed",background:N?"":"#334155",color:N?"":"#64748b"},disabled:!N,onClick:()=>a("daily_checkin"),children:N?"領取獎勵":"明日再來"})]})}),"GOLD"===r&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:Math.floor(t.wallet.gold).toLocaleString()}),(0,l.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(0,l.jsxs)("div",{className:"ca-shop-subtabs",style:{display:"flex",gap:"10px",marginBottom:"8px"},children:[(0,l.jsx)("button",{className:"ca-btn ".concat("UPGRADE"===c?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"UPGRADE"===c?"":"rgba(255,255,255,0.1)"},onClick:()=>d("UPGRADE"),children:"\uD83D\uDEE0️ 金幣強化"}),(0,l.jsx)("button",{className:"ca-btn ".concat("RECRUIT"===c?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"RECRUIT"===c?"":"rgba(255,255,255,0.1)"},onClick:()=>d("RECRUIT"),children:"\uD83D\uDEA9 招兵買馬"})]}),(null==n?void 0:n.upgrades)?S(n.upgrades.filter(e=>"GOLD"===e.Shop_Type).filter(e=>"RECRUIT"===c?"ADD_AUTO_DMG"===e.Effect_Type:"ADD_AUTO_DMG"!==e.Effect_Type)):(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,l.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config..."})}),(0,l.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,l.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,l.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,l.jsx)(x,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:t.wallet.diamonds>=10,onClick:()=>a("gold_pack_1")}),(0,l.jsx)(x,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:t.wallet.diamonds>=80,onClick:()=>a("gold_pack_2")})]})]}),"LEVEL"===r&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:t.wallet.levelPoints}),(0,l.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"}),i&&(0,l.jsx)("button",{onClick:i,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"\uD83D\uDD04 重製點數"})]}),(0,l.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,l.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==n?void 0:n.upgrades)?_("LEVEL"):(0,l.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===r&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:v.color},children:v.name}),(0,l.jsxs)("div",{className:"ca-realm-level",children:["修練總層數 ",f]})]}),(0,l.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,l.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==n?void 0:n.upgrades)?_("CLICK"):(0,l.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===r&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c084fc 100%)"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"飛昇商店 (Permanent)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff"},children:"永恆加成"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.7)",marginTop:"4px"},children:"飛昇後不會重置的永久強化"})]}),(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:_("ASCENSION")})]}),"EQUIPMENT"===r&&(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,l.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",position:"relative"},children:[(0,l.jsx)("div",{className:"ca-realm-title",children:"裝備扭蛋 (Gacha)"}),(0,l.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.2rem"},children:"試試你的手氣！"})]}),(0,l.jsxs)("div",{className:"ca-shop-item-grid",style:{width:"100%"},children:[(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #94a3b8"},children:[(0,l.jsx)("button",{onClick:()=>m("basic"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDCE6"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fff"},children:"基礎裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"隨機獲得裝備 (最高至 Epic)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:"含: Common, Uncommon, Rare, Epic"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(b,{label:"1 抽",cost:"1,000",onClick:()=>a("gacha_equipment_basic")}),(0,l.jsx)(b,{label:"10 抽",cost:"10,000",onClick:()=>a("gacha_equipment_basic_10")}),(0,l.jsx)(b,{label:"100 抽",cost:"100,000",onClick:()=>a("gacha_equipment_basic_100")})]})]}),(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #eab308",background:"rgba(234, 179, 8, 0.05)"},children:[(0,l.jsx)("button",{onClick:()=>m("advanced"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83C\uDF81"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#facc15"},children:"高級裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"更高機率獲得稀有裝備 (最高至 Legendary)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#fef08a"},children:"含: Common ~ Legendary"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(b,{label:"1 抽",cost:"10,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced")}),(0,l.jsx)(b,{label:"10 抽",cost:"100,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced_10")}),(0,l.jsx)(b,{label:"100 抽",cost:"1,000,000",color:"#facc15",onClick:()=>a("gacha_equipment_advanced_100")})]})]}),(0,l.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #a855f7",background:"rgba(168, 85, 247, 0.05)"},children:[(0,l.jsx)("button",{onClick:()=>m("premium"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,l.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDC8E"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#d8b4fe"},children:"頂級裝備箱"}),(0,l.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"最高機率獲得稀有裝備 (最高至 Mythic)"}),(0,l.jsx)("div",{style:{fontSize:"0.75rem",color:"#e9d5ff"},children:"含: Common ~ Mythic (包含所有稀有度)"})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,l.jsx)(b,{label:"1 抽",cost:"100,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium")}),(0,l.jsx)(b,{label:"10 抽",cost:"1,000,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium_10")}),(0,l.jsx)(b,{label:"100 抽",cost:"10,000,000",color:"#d8b4fe",onClick:()=>a("gacha_equipment_premium_100")})]})]})]})]})]}),p&&(0,l.jsx)(h,{gameConfig:n,onClose:()=>m(null),boxType:p})]})}function x(e){let{name:t,desc:a,icon:s,cost:i,canAfford:n,onClick:r}=e;return(0,l.jsxs)("div",{className:"ca-glass-static ca-shop-item-card",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>n&&r(),children:[(0,l.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:s}),(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:t}),(0,l.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:a}),(0,l.jsx)("div",{className:"ca-btn ".concat(n?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:n?"":"#334155",color:n?"":"#64748b",cursor:n?"pointer":"not-allowed"},children:i})]})}function g(e){let{name:t,desc:a,level:s,cost:i,canAfford:n,onClick:r,currencyLabel:o="⚡",isMaxed:c}=e;return(0,l.jsxs)("div",{className:"ca-upgrade-row",children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:t}),(0,l.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",s]})]}),(0,l.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:a})]}),(0,l.jsxs)("button",{onClick:()=>!c&&n&&r(),disabled:c||!n,className:"ca-upgrade-btn",style:{opacity:c||!n?.5:1,cursor:c||!n?"not-allowed":"pointer"},children:[(0,l.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:"bold"},children:c?"已滿級":"升級"}),!c&&(0,l.jsxs)("span",{style:{fontSize:"0.7rem"},children:[o," ",i.toLocaleString()]})]})]})}function h(e){let{gameConfig:t,onClose:a,boxType:i}=e,[n,r]=s.useState(null),o=t&&t.equipments&&t.equipments.length>0,c=s.useMemo(()=>o?t.equipments.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===i||"gacha_equipment_basic"===i?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==i&&"gacha_equipment_advanced"!==i||"MYTHIC"!==t}):[],[o,t,i]),d=c.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),p={};d>0&&c.forEach(e=>{let t=Number(e.Gacha_Weight)||0;p[t]||(p[t]=[]),p[t].push(e)});let u=e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}};return(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:a,children:[(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"500px",maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#1e293b",border:"1px solid #334155",borderRadius:"16px",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"white"},children:["basic"===i?"基礎":"advanced"===i?"高級":"頂級","裝備機率一覽"]}),(0,l.jsx)("button",{onClick:a,style:{background:"none",border:"none",color:"gray",fontSize:"1.5rem",cursor:"pointer"},children:"\xd7"})]}),(0,l.jsx)("div",{style:{padding:"16px",overflowY:"auto",flex:1},children:o?Object.entries(p).sort((e,t)=>Number(t[0])-Number(e[0])).map(e=>{let[t,a]=e,s=(Number(t)/d*100).toFixed(2);return(0,l.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,l.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px",fontSize:"0.9rem",color:"#93c5fd",fontWeight:"bold"},children:["機率: ",s,"% (權重: ",t,", 共 ",a.length," 種)"]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:a.map(e=>{var t;let a=u(e.Rarity);return(0,l.jsxs)("div",{onClick:()=>r(e),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:"pointer",transition:"transform 0.1s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[(0,l.jsx)("div",{style:{width:"56px",height:"56px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem",border:"1px solid ".concat(a,"44"),boxShadow:"inset 0 0 10px ".concat(a,"22")},children:v(e.Slot)}),(0,l.jsx)("div",{style:{fontSize:"0.65rem",color:a,textAlign:"center",lineHeight:"1.2",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",fontWeight:(null==(t=e.Rarity)?void 0:t.toLowerCase())==="common"?"normal":"bold"},children:e.Name})]},e.ID)})})]},t)}):(0,l.jsxs)("div",{style:{textAlign:"center",color:"var(--ca-text-muted)",padding:"20px"},children:["暫無裝備資料",(0,l.jsx)("br",{}),(0,l.jsx)("span",{style:{fontSize:"0.8rem"},children:"請檢查 Google Sheet 設定或重新載入"})]})})]}),n&&(0,l.jsx)(f,{item:n,onClose:()=>r(null)})]})}function f(e){let{item:t,onClose:a}=e,s=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(t.Rarity);return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:10001,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:a,children:(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(s,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(s,"22")},onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(s,"44")},children:v(t.Slot)}),(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:s},children:t.Name}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:s,fontWeight:"bold"},children:t.Rarity}),(0,l.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:t.Slot})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,l.jsx)("div",{style:{color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:"裝備初始屬性:"}),(0,l.jsx)("div",{children:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=(Number(t.Base_Val)||0)+(a-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",l.toLocaleString())}(t.Desc_Template,t,1)}),(0,l.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"單件提升戰力 (Est. CP)"}),(0,l.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",(function(e,t){let a=(Number(e.Base_Val)||0)+0*(Number(e.Level_Mult)||0),l=String(e.Effect_Type||"").toUpperCase().trim();return["ADD_BASE_DMG","CLICK_DMG","ADD_DAMAGE","CLICK_DAMAGE","ADD_CLICK_DMG"].includes(l)?Math.floor(10*a):["ADD_AUTO_DMG","AUTO_DMG","AUTO_DAMAGE","ADD_AUTO"].includes(l)?Math.floor(20*a):["ADD_CRIT_CHANCE","CRIT_RATE","ADD_CRIT_RATE","LUCK","ADD_CRIT"].includes(l)?Math.floor(10*a):["ADD_CRIT_DMG","CRIT_DMG","CRIT_DAMAGE","ADD_CRIT_DMG"].includes(l)?Math.floor(5*a):0})(t,0).toLocaleString()]})]})]}),(0,l.jsx)("button",{className:"ca-btn",onClick:a,style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"},children:"返回"})]})})}function v(e){switch(e){case"MAIN_HAND":return"⚔️";case"HEAD":return"\uD83E\uDE96";case"BODY":return"\uD83D\uDC55";case"HANDS":return"\uD83E\uDDE4";case"LEGS":return"\uD83D\uDC62";case"RELIC":return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function b(e){let{label:t,cost:a,onClick:s,color:i="#22d3ee"}=e;return(0,l.jsxs)("button",{className:"ca-btn ca-btn-primary",style:{padding:"12px 16px",fontSize:"1rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flex:1,borderColor:i,background:"linear-gradient(to bottom, rgba(0,0,0,0) 0%, ".concat(i,"22 100%)")},onClick:s,children:[(0,l.jsx)("span",{children:t}),(0,l.jsxs)("span",{style:{background:"rgba(0,0,0,0.2)",padding:"2px 8px",borderRadius:"12px",fontSize:"0.8rem",color:i},children:["\uD83D\uDCB0 ",a]})]})}function D(e){var t,a,i;let{player:n,effectiveStats:r,combatPower:o,userId:c,onLogin:d,onLogout:p,onManualSave:u,gameConfig:m}=e,{system:x,wallet:g,records:h}=n,[f,v]=s.useState(""),[b,D]=s.useState(!1),S=async()=>{if(!b){D(!0);try{await u()}finally{D(!1)}}},_=e=>Math.floor(e||0).toLocaleString(),N=e=>"".concat((100*e).toFixed(1),"%"),M=e=>{let t=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return t>0?"".concat(t,"h ").concat(a,"m ").concat(l,"s"):a>0?"".concat(a,"m ").concat(l,"s"):"".concat(l,"s")},A=(null==(t=n.activeBuffs)?void 0:t.ragePotionExpiresAt)>Date.now(),w=Math.max(0,Math.floor(((null==(a=n.activeBuffs)?void 0:a.ragePotionExpiresAt)-Date.now())/1e3));return(0,l.jsxs)("div",{className:"ca-profile-page",style:{paddingBottom:"20px"},children:[(0,l.jsx)("div",{className:"ca-profile-section",children:(0,l.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,l.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(c||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,l.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",x.level]})]}),(0,l.jsx)("div",{className:"ca-profile-summary",children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("span",{children:["勇者 ",c]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsx)("button",{onClick:S,className:"ca-profile-action-btn",style:{background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",cursor:b?"wait":"pointer",opacity:b?.7:1},children:b?"上傳中":"上傳"}),(0,l.jsx)("button",{onClick:p,className:"ca-profile-action-btn",style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5"},children:"登出"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-cp",children:[(0,l.jsx)("span",{className:"label",children:"戰鬥力"}),(0,l.jsx)("span",{className:"value",children:_(o)})]}),(0,l.jsxs)("div",{className:"ca-profile-exp",children:[(0,l.jsxs)("div",{className:"info",children:[(0,l.jsx)("span",{children:"EXP"}),(0,l.jsxs)("span",{children:[_(x.currentXp)," /"," ",_(x.requiredXp)]})]}),(0,l.jsx)("div",{className:"bar-bg",children:(0,l.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,x.currentXp/x.requiredXp*100),"%")}})})]})]}):(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",width:"100%",minWidth:0},children:[(0,l.jsx)("div",{style:{fontSize:"0.85rem",color:"var(--ca-text-secondary)",fontWeight:"600"},children:"輸入 ID 以讀取/建立存檔"}),(0,l.jsxs)("div",{style:{display:"flex",gap:"6px",width:"100%"},children:[(0,l.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,minWidth:0,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.15)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"0.9rem",outline:"none"},placeholder:"User ID...",value:f,onChange:e=>v(e.target.value)}),(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"0 16px",fontSize:"0.85rem",height:"auto",whiteSpace:"nowrap",flexShrink:0,borderRadius:"8px"},onClick:()=>f.trim()&&d(f.trim()),children:"讀取"})]})]})})]})}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"財富狀態"}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",background:"rgba(15, 23, 42, 0.4)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.05)"},children:[(0,l.jsx)(y,{icon:"\uD83D\uDCB0",label:"金幣",value:_(g.gold),color:"#fbbf24"}),(0,l.jsx)(y,{icon:"\uD83D\uDC8E",label:"鑽石",value:_(g.diamonds),color:"#38bdf8"}),(0,l.jsx)(y,{icon:"✨",label:"點擊點數",value:_(g.clickPoints),color:"#c084fc"}),(0,l.jsx)(y,{icon:"⚡",label:"飛昇點數",value:_(g.ascensionPoints),color:"#f472b6"}),(0,l.jsx)(y,{icon:"\uD83D\uDCDC",label:"等級積分",value:_(g.levelPoints),color:"#60a5fa"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"最終戰鬥屬性 (含裝備加成)"}),(0,l.jsxs)("div",{className:"ca-stats-grid",children:[(0,l.jsx)(j,{label:"點擊基礎傷害",value:_(r.baseDamage),icon:"⚔️"}),(0,l.jsx)(j,{label:"夥伴秒傷 (Ally DPS)",value:_(r.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,l.jsx)(j,{label:"爆擊機率",value:N(r.criticalChance),icon:"\uD83C\uDFAF"}),(0,l.jsx)(j,{label:"爆擊傷害",value:N(r.criticalDamage),icon:"\uD83D\uDCA5"}),(0,l.jsx)(j,{label:"金幣獲取倍率",value:"".concat(r.goldMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCB0"}),(0,l.jsx)(j,{label:"經驗獲取倍率",value:"".concat(r.xpMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCD6"}),(0,l.jsx)(j,{label:"BOSS 傷害加成",value:"".concat(r.bossDamageMultiplier.toFixed(2),"x"),icon:"\uD83D\uDC79"}),(0,l.jsx)(j,{label:"點擊點數倍率",value:"".concat(r.cpMultiplier.toFixed(2),"x"),icon:"✨"}),(0,l.jsx)(j,{label:"自動點擊 (每秒)",value:"".concat(r.autoClickPerSec.toFixed(1)," 次"),icon:"⚡"}),(0,l.jsx)(j,{label:"關卡目標減少",value:"-".concat(_(r.monsterKillReduction)," 隻"),icon:"\uD83D\uDCC9"}),(0,l.jsx)(j,{label:"稀有怪出現機率",value:N(r.rareMonsterChance),icon:"\uD83C\uDF1F"})]})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"當前狀態 / 藥水"}),(0,l.jsx)("div",{className:"ca-glass-static",style:{padding:"12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:A?(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[(0,l.jsx)("span",{style:{fontSize:"1.4rem"},children:"\uD83E\uDDEA"}),(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.95rem"},children:"狂暴藥水 (Rage Potion)"}),(0,l.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:["剩餘時間:"," ",(0,l.jsx)("span",{style:{fontFamily:"monospace"},children:M(w)})]})]}),(0,l.jsx)("div",{className:"ca-pulse",style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 10px #ef4444"}})]}):(0,l.jsx)("div",{style:{color:"var(--ca-text-muted)",fontSize:"0.85rem",textAlign:"center",padding:"10px"},children:"尚無啟用的增益效果"})})]}),(0,l.jsxs)("div",{className:"ca-profile-section",children:[(0,l.jsx)("h3",{className:"ca-section-title",children:"生涯冒險記錄"}),(0,l.jsxs)("div",{className:"ca-records-list ca-glass-static",style:{borderRadius:"12px"},children:[(0,l.jsx)(C,{label:"\uD83C\uDFAE 遊戲總點擊",value:_(h.totalClicks)}),(0,l.jsx)(C,{label:"⚔️ 累計總傷害",value:_(h.totalDamageDealt)}),(0,l.jsx)(C,{label:"\uD83D\uDC7E 擊敗怪物數",value:_(h.monstersKilled)}),(0,l.jsx)(C,{label:"\uD83D\uDE08 擊敗 BOSS 數",value:_(h.bossesKilled)}),(0,l.jsx)(C,{label:"\uD83D\uDCCD 歷史最高關卡",value:"第 ".concat(_(h.maxStageReached)," 關")}),(0,l.jsx)(C,{label:"\uD83D\uDC8E 累計儲蓄/金幣",value:_(h.totalGoldEarned)}),(0,l.jsx)(C,{label:"⏳ 生涯遊玩時間",value:M(h.playtimeSeconds)})]})]}),(0,l.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.7rem",opacity:.6},children:[(0,l.jsxs)("div",{children:["遊戲版本: ",String((null==m||null==(i=m.settings)?void 0:i.GAME_VERSION)||"1.0.0")]}),(0,l.jsx)("div",{style:{marginTop:"4px"},children:"Click Ascension Project \xa9 2026"})]})]})}function y(e){let{icon:t,label:a,value:s,color:i}=e;return(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("span",{style:{fontSize:"1rem"},children:t}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)("span",{style:{fontSize:"0.6rem",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:a}),(0,l.jsx)("span",{style:{fontSize:"0.85rem",color:i,fontWeight:"bold"},children:s})]})]})}function j(e){let{label:t,value:a,icon:s}=e;return(0,l.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,l.jsx)("div",{className:"ca-stat-icon",children:s}),(0,l.jsxs)("div",{className:"ca-stat-content",children:[(0,l.jsx)("div",{className:"ca-stat-label",children:t}),(0,l.jsx)("div",{className:"ca-stat-value",children:a})]})]})}function C(e){let{label:t,value:a}=e;return(0,l.jsxs)("div",{className:"ca-record-row",children:[(0,l.jsx)("span",{className:"ca-record-label",children:t}),(0,l.jsx)("span",{className:"ca-record-value",children:a})]})}function S(e){switch(null==e?void 0:e.toLowerCase()){case"common":default:return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b"}}function _(e){let{item:t,onClose:a,onEquip:s,onUnequip:i,isEquipped:n}=e,{config:r,level:o}=t,c=S(r.Rarity);return(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,l.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(c,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(c,"22")},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,l.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(c,"44")},children:M(r.Slot)}),(0,l.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:c},children:r.Name}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:c,fontWeight:"bold"},children:r.Rarity}),(0,l.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:r.Slot})]})]}),(0,l.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:[(0,l.jsxs)("span",{children:["當前屬性 (Lv.",o,"/",r.Max_Level||"??","):"]}),o>=(r.Max_Level||99)&&(0,l.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold"},children:"MAX"})]}),(0,l.jsx)("div",{children:function(e,t,a){let l=(Number(t.Base_Val)||0)+(a-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",l.toLocaleString())}(r.Desc_Template,r,o)}),(0,l.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"戰力加成 (Est. CP)"}),(0,l.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",(function(e,t){let a=(Number(e.Base_Val)||0)+(t-1)*(Number(e.Level_Mult)||0),l=String(e.Effect_Type||"").toUpperCase().trim();return["ADD_BASE_DMG","CLICK_DMG","ADD_DAMAGE","CLICK_DAMAGE","ADD_CLICK_DMG"].includes(l)?Math.floor(10*a):["ADD_AUTO_DMG","AUTO_DMG","AUTO_DAMAGE","ADD_AUTO"].includes(l)?Math.floor(20*a):["ADD_CRIT_CHANCE","CRIT_RATE","ADD_CRIT_RATE","LUCK","ADD_CRIT"].includes(l)?Math.floor(10*a):["ADD_CRIT_DMG","CRIT_DMG","CRIT_DAMAGE","ADD_CRIT_DMG"].includes(l)?Math.floor(5*a):0})(r,o).toLocaleString()]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"8px"},children:[n?(0,l.jsx)("button",{className:"ca-btn",onClick:()=>{i(r.Slot),a()},style:{flex:1,background:"#ef4444",color:"white",fontWeight:"bold"},children:"卸下"}):(0,l.jsx)("button",{className:"ca-btn",onClick:()=>{s(t.id,r.Slot),a()},style:{flex:1,background:"var(--ca-accent-gold)",color:"black",fontWeight:"bold"},children:"裝備"}),(0,l.jsx)("button",{className:"ca-btn",onClick:a,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"關閉"})]})]})})}function N(e){var t;let{player:a,effectiveStats:i,userId:r,gameConfig:o,onEquip:c,onUnequip:d}=e,[p,u]=s.useState(null),m=Object.entries((null==(t=a.equipment)?void 0:t.inventory)||{}).filter(e=>{let[,t]=e;return t>0}).map(e=>{var t;let[a,l]=e;return{id:a,level:l,config:null==o||null==(t=o.equipments)?void 0:t.find(e=>String(e.ID)===String(a))}}).filter(e=>!!e.config);return(0,l.jsxs)("div",{className:"ca-character-view",style:{flex:1,display:"flex",flexDirection:"column",width:"100%",height:"100%",padding:"12px",overflow:"hidden"},children:[(0,l.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"relative",paddingBottom:"12px"},children:[(0,l.jsxs)("div",{style:{width:"100%",maxWidth:"500px",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"8px",zIndex:10,padding:"0 4px"},children:[(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"⚔️"}),(0,l.jsx)("span",{className:"ca-stat-value",children:Math.floor(i.baseDamage).toLocaleString()}),i.baseDamage>a.stats.baseDamage&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(i.baseDamage-a.stats.baseDamage).toLocaleString(),")"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83C\uDFAF"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*i.criticalChance).toFixed(1),"%"]}),i.criticalChance>a.stats.criticalChance&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((i.criticalChance-a.stats.criticalChance)*100).toFixed(1),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83E\uDD16"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[Number(i.autoClickPerSec||0).toFixed(1),"/s"]}),i.autoClickPerSec>a.stats.autoClickPerSec&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(i.autoClickPerSec-a.stats.autoClickPerSec).toFixed(1),")"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCA5"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*i.criticalDamage).toFixed(0),"%"]}),i.criticalDamage>a.stats.criticalDamage&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((i.criticalDamage-a.stats.criticalDamage)*100).toFixed(0),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCB0"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*i.goldMultiplier).toFixed(0),"%"]}),i.goldMultiplier>a.stats.goldMultiplier&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((i.goldMultiplier-a.stats.goldMultiplier)*100).toFixed(0),"%)"]})]}),(0,l.jsxs)("div",{className:"ca-stat-pill",children:[(0,l.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDC79"}),(0,l.jsxs)("span",{className:"ca-stat-value",children:[(100*i.bossDamageMultiplier).toFixed(0),"%"]}),i.bossDamageMultiplier>a.stats.bossDamageMultiplier&&(0,l.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((i.bossDamageMultiplier-a.stats.bossDamageMultiplier)*100).toFixed(0),"%)"]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",width:"100%",maxWidth:"500px",justifyContent:"space-between",alignItems:"center",zIndex:2,padding:"0 4px"},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,l.jsx)(A,{slot:n.MAIN_HAND,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&u({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(A,{slot:n.HEAD,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&u({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(A,{slot:n.BODY,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&u({id:e,level:a.equipment.inventory[e],config:l})}})]}),(0,l.jsxs)("div",{className:"ca-character-figure ca-bounce-slow",style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(r||"Guest"),alt:"Character",style:{width:"110px",height:"110px",filter:"drop-shadow(0 10px 20px rgba(0,0,0,0.5))"}}),(0,l.jsxs)("div",{className:"ca-glass",style:{marginTop:"4px",padding:"2px 10px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(15, 23, 42, 0.6)"},children:[(0,l.jsxs)("span",{style:{fontSize:"0.9rem"},children:["Lv.",a.system.level]}),(0,l.jsx)("span",{style:{width:"1px",height:"10px",background:"rgba(255,255,255,0.2)"}}),(0,l.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold",fontSize:"0.8rem"},children:r||"Guest"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,l.jsx)(A,{slot:n.HANDS,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&u({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(A,{slot:n.LEGS,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&u({id:e,level:a.equipment.inventory[e],config:l})}}),(0,l.jsx)(A,{slot:n.RELIC,player:a,gameConfig:o,onClick:e=>{var t;let l=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));l&&u({id:e,level:a.equipment.inventory[e],config:l})}})]})]}),(0,l.jsx)("div",{style:{position:"absolute",top:"55%",left:"50%",transform:"translate(-50%, -50%)",width:"220px",height:"220px",background:"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",pointerEvents:"none",zIndex:0}})]}),(0,l.jsxs)("div",{style:{flex:"1 1 0px",width:"100%",background:"rgba(15, 23, 42, 0.4)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden",minHeight:"0"},children:[(0,l.jsxs)("div",{style:{padding:"8px 12px",background:"rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[(0,l.jsxs)("span",{style:{fontWeight:"bold",color:"#e2e8f0",fontSize:"0.9rem"},children:["\uD83C\uDF92 裝備倉庫 (",m.length,")"]}),(0,l.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--ca-text-muted)"},children:"點擊裝備以穿戴"})]}),(0,l.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px"},children:0===m.length?(0,l.jsx)("div",{style:{textAlign:"center",color:"gray",padding:"20px 0",fontSize:"0.8rem"},children:"倉庫空空如也..."}):(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(56px, 1fr))",gap:"8px"},children:m.map(e=>{var t;let s=Object.values((null==(t=a.equipment)?void 0:t.equipped)||{}).includes(e.id),i=S(e.config.Rarity);return(0,l.jsxs)("div",{onClick:()=>u(e),className:"ca-inventory-item",style:{width:"56px",height:"56px",background:"rgba(30, 41, 59, 0.6)",border:"2px solid ".concat(i),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",opacity:s?1:.8,boxShadow:s?"0 0 10px #22c55e, inset 0 0 5px #22c55e":"none"},title:"".concat(e.config.Name," (Lv.").concat(e.level,") - ").concat(e.config.Slot),children:[(0,l.jsx)("span",{style:{fontSize:"1.5rem"},children:M(e.config.Slot)}),(0,l.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"4px",fontWeight:"bold"},children:["L.",e.level]}),s&&(0,l.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",background:"#22c55e",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"3px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"E"})]},e.id)})})})]}),p&&(0,l.jsx)(_,{item:p,onClose:()=>u(null),onEquip:c,onUnequip:d,isEquipped:Object.values(a.equipment.equipped).includes(p.id)})]})}function M(e){switch(e){case n.MAIN_HAND:return"⚔️";case n.HEAD:return"\uD83E\uDE96";case n.BODY:return"\uD83D\uDC55";case n.HANDS:return"\uD83E\uDDE4";case n.LEGS:return"\uD83D\uDC62";case n.RELIC:return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function A(e){var t,a,s,i,n;let{slot:r,player:o,gameConfig:c,onClick:d}=e,p=null==(a=o.equipment)||null==(t=a.equipped)?void 0:t[r],u=p?null==c||null==(s=c.equipments)?void 0:s.find(e=>String(e.ID)===String(p)):null,m=p?(null==(n=o.equipment)||null==(i=n.inventory)?void 0:i[p])||1:0,x=u?S(u.Rarity):"rgba(255,255,255,0.1)";return(0,l.jsxs)("div",{className:"ca-equipment-slot",style:{width:"54px",height:"54px",background:"rgba(15, 23, 42, 0.6)",border:u?"2px solid ".concat(x):"1px dashed rgba(255,255,255,0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",transition:"all 0.2s",boxShadow:u?"0 0 15px ".concat(x,"44"):"none"},onClick:()=>p&&(null==d?void 0:d(p)),title:u?"".concat(u.Name," (Lv.").concat(m,")"):"Empty Slot",children:[(0,l.jsx)("div",{style:{fontSize:"1.6rem",opacity:u?1:.3},children:M(r)}),u&&(0,l.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"6px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.2)"},children:["Lv.",m]})]})}var w=a(23464);let L="https://script.google.com/macros/s/AKfycbxegFPp4kJZXDxUNqQopqiWVa2JLLM__rJbm700mUQsovg2nkE6wSJd2lFQyJQ4dg10/exec",k={loadPlayerSave:async e=>{try{let t=await w.A.get("".concat(L,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(t.data&&t.data.exists)return t.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,t)=>{try{if(!e)throw Error("User ID is required for saving");let a=await w.A.post(L,{action:"save_progress",userId:e,saveData:t},{headers:{"Content-Type":"text/plain"}});if(a.data&&a.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await w.A.get("".concat(L,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},I={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0,ascensionPoints:0,equipmentShards:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,bossDamageMultiplier:1,autoClickPerSec:1,monsterKillReduction:0,rareMonsterChance:0},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{},levelShop:{},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,amuletLevel:0},ascensionShop:{},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0},equipment:{inventory:{},equipped:{}},lastDailyRewardClaimTime:0},E={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10,bossTimeLeft:null,bossTimeLimit:60};function T(){let[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)("BATTLE"),[o,u]=(0,s.useState)(I),[x,g]=(0,s.useState)(E),[h,f]=(0,s.useState)(null),[v,b]=(0,s.useState)(null),[y,j]=(0,s.useState)(null),[C,S]=(0,s.useState)(null),[_,M]=(0,s.useState)(null),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"系統提示";return M({title:t,message:e})},w=s.useMemo(()=>{let e={baseDamage:o.stats.baseDamage||1,autoAttackDamage:o.stats.autoAttackDamage||0,criticalChance:o.stats.criticalChance||.05,criticalDamage:o.stats.criticalDamage||1.5,goldMultiplier:o.stats.goldMultiplier||1,cpMultiplier:o.stats.cpMultiplier||1,xpMultiplier:o.stats.xpMultiplier||1,bossDamageMultiplier:o.stats.bossDamageMultiplier||1,autoClickPerSec:o.stats.autoClickPerSec||1,monsterKillReduction:o.stats.monsterKillReduction||0,rareMonsterChance:o.stats.rareMonsterChance||0};return(null==v?void 0:v.equipments)&&Object.values(o.equipment.equipped).forEach(t=>{if(!t)return;let a=v.equipments.find(e=>String(e.ID)===String(t));if(a){let l=Number(o.equipment.inventory[t]||1),s=Number(a.Base_Val||0)+(l-1)*Number(a.Level_Mult||0);switch(String(a.Effect_Type||"").toUpperCase().trim()){case"ADD_BASE_DMG":case"CLICK_DMG":case"CLICK_DAMAGE":case"ADD_DAMAGE":case"ADD_CLICK_DMG":e.baseDamage+=s;break;case"ADD_AUTO_DMG":case"AUTO_DMG":case"AUTO_DAMAGE":case"ADD_AUTO":e.autoAttackDamage+=s;break;case"ADD_CRIT_CHANCE":case"CRIT_RATE":case"ADD_CRIT_RATE":case"LUCK":e.criticalChance+=s/100;break;case"ADD_CRIT_DMG":case"CRIT_DMG":case"CRIT_DAMAGE":case"ADD_CRIT_DMG":e.criticalDamage+=s/100;break;case"ADD_GOLD_MULT":case"GOLD_MULT":case"ADD_GOLD":case"GOLD_BONUS":case"ADD_GOLD_MULT":e.goldMultiplier+=s/100;break;case"ADD_XP_MULT":case"XP_MULT":case"ADD_XP":case"XP_BONUS":case"ADD_XP_MULT":e.xpMultiplier+=s/100;break;case"ADD_BOSS_DMG":case"BOSS_DMG":case"BOSS_DAMAGE":e.bossDamageMultiplier+=s/100;break;case"CP_MULT":case"CP_BONUS":case"ADD_CP_MULT":e.cpMultiplier+=s/100;break;case"REDUCE_GOAL_V":case"REDUCE_STAGE_GOAL":e.monsterKillReduction+=s;break;case"RARE_CHANCE_P":case"RARE_SPAWN_CHANCE":case"RARE_CHANCE":e.rareMonsterChance+=s/100;break;case"AUTO_CLICK_V":case"AUTO_CLICK_CPS":e.autoClickPerSec+=s}}}),e},[o.stats,o.equipment.equipped,o.equipment.inventory,v]),L=(0,s.useCallback)((e,t)=>{var a,l,s,i;return{...e,...t,system:{...e.system,...t.system||{}},wallet:{...e.wallet,...t.wallet||{}},stats:{...e.stats,...t.stats||{}},records:{...e.records,...t.records||{}},clickShop:{...e.clickShop,...t.clickShop||{}},levelShop:{...e.levelShop,...t.levelShop||{}},goldShop:{...e.goldShop,...t.goldShop||{}},ascensionShop:{...e.ascensionShop,...t.ascensionShop||{}},inventory:{...e.inventory,...t.inventory||{}},activeBuffs:{...e.activeBuffs,...t.activeBuffs||{}},equipment:{...e.equipment,...t.equipment||{},inventory:{...(null==(a=e.equipment)?void 0:a.inventory)||{},...(null==(l=t.equipment)?void 0:l.inventory)||{}},equipped:{...(null==(s=e.equipment)?void 0:s.equipped)||{},...(null==(i=t.equipment)?void 0:i.equipped)||{}}}}},[]),T=w.autoAttackDamage,R=Math.floor(10*w.baseDamage+20*T+1e3*w.criticalChance+500*w.criticalDamage);(0,s.useEffect)(()=>{v&&(console.log("[Recalc] GameConfig loaded, refreshing stats..."),u(e=>({...e,stats:X(e)})))},[v]),(0,s.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await k.getGameConfigs();e&&(console.log("[Config] Loaded:",e),b(e))})();let e=localStorage.getItem("ca_last_user_id");e&&U(e)},[]);let P=(0,s.useCallback)(()=>{let e=x.isBossActive,t=Math.max(1,x.monstersRequiredForBoss-(w.monsterKillReduction||0));!e&&x.autoChallengeBoss&&x.monstersKilledInStage>=t?(e=!0,g(e=>({...e,isBossActive:!0,bossTimeLeft:e.bossTimeLimit}))):e&&null===x.bossTimeLeft&&g(e=>({...e,bossTimeLeft:e.bossTimeLimit}));let a=H(x.currentStageId,e,v),l=Math.ceil((20*Math.pow(1.18,x.currentStageId-1)+10*x.currentStageId)*a.hpMultiplier),s=.15*l*a.goldMultiplier,i=.08*l*a.xpMultiplier;f({id:crypto.randomUUID(),name:"".concat(a.name," Lv.").concat(x.currentStageId),level:x.currentStageId,maxHp:l,currentHp:l,isBoss:"BOSS"===a.rarity,rewardGold:Math.max(1,Math.floor(s)),rewardXp:Math.max(1,Math.floor(i)),emoji:a.emoji,note:a.note})},[x,w.monsterKillReduction]),[O,G]=(0,s.useState)(null);(0,s.useEffect)(()=>{h||P()},[h,P]),(0,s.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&U(e)},[]);let z=s.useRef(o),B=s.useRef(x),q=s.useRef(new Set);(0,s.useEffect)(()=>{z.current=o,B.current=x},[o,x]),(0,s.useEffect)(()=>{let e;return x.isBossActive&&h&&h.isBoss&&(null===x.bossTimeLeft?g(e=>({...e,bossTimeLeft:e.bossTimeLimit})):void 0!==x.bossTimeLeft&&null!==x.bossTimeLeft&&x.bossTimeLeft>0?e=setInterval(()=>{g(e=>({...e,bossTimeLeft:void 0!==e.bossTimeLeft&&null!==e.bossTimeLeft&&e.bossTimeLeft>0?e.bossTimeLeft-1:0}))},1e3):0===x.bossTimeLeft&&(g(e=>({...e,isBossActive:!1,autoChallengeBoss:!1,bossTimeLeft:null})),f(null),A("挑戰失敗！Boss 挑戰時間超時，已回到關卡掛機模式並關閉自動挑戰。","挑戰失敗"))),()=>{e&&clearInterval(e)}},[x.isBossActive,x.bossTimeLeft,h]),(0,s.useEffect)(()=>{if(!O)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(O," to Cloud..."));let e={player:z.current,stage:B.current,timestamp:Date.now()};try{await k.savePlayerProgress(O,e),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}catch(t){console.warn("[AutoSave] Cloud save failed, using local backup",t),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[O]);let U=async e=>{if(!e)return;G(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let t=await k.loadPlayerSave(e);if(t){console.log("[Login] Cloud save found!"),t.player&&u(e=>L(e,t.player)),t.stage&&g(e=>({...e,...t.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let t=localStorage.getItem("ca_save_".concat(e));if(t){console.log("[Login] Found local backup.");try{let e=JSON.parse(t);u(t=>({...t,...e.player})),g(t=>({...t,...e.stage}))}catch(e){}}};(0,s.useEffect)(()=>{let e=setInterval(()=>{u(e=>({...e,records:{...e.records,playtimeSeconds:(e.records.playtimeSeconds||0)+1}}))},1e3);return()=>clearInterval(e)},[]);let W=async()=>{if(!O)return;let e={player:o,stage:x,timestamp:Date.now()};try{await k.savePlayerProgress(O,e),A("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}catch(t){console.error("Save failed",t),A("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(O),JSON.stringify(e))}};(0,s.useEffect)(()=>{if(!h||h.currentHp<=0||w.autoAttackDamage<=0)return;let e=setInterval(()=>{let e=w.autoAttackDamage,t=h.isBoss&&w.bossDamageMultiplier||1,a=Math.ceil(e*t);f(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-a;return t<=0?(setTimeout(()=>K(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),u(e=>{let t=+w.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalDamageDealt:e.records.totalDamageDealt+a}}});let l=2*(o.goldShop.mercenaryLevel||0),s=5*(o.goldShop.partnerLevel||0),i=20*(o.goldShop.archerLevel||0),n=100*(o.goldShop.knightLevel||0),r=Math.max(0,w.autoAttackDamage-(l+s+i+n));j({time:Date.now(),damage:a,breakdown:{mercenary:Math.ceil(l*t),partner:Math.ceil(s*t),archer:Math.ceil(i*t),knight:Math.ceil(n*t),player:Math.ceil(r*t)}})},1e3);return()=>clearInterval(e)},[null==h?void 0:h.id,w.autoAttackDamage,w.bossDamageMultiplier,w.cpMultiplier,o.goldShop.mercenaryLevel,o.goldShop.partnerLevel,o.goldShop.archerLevel,o.goldShop.knightLevel]),(0,s.useEffect)(()=>{let e=w.autoClickPerSec||0;if(e<=0||!h||h.currentHp<=0)return;let t=setInterval(()=>{var e,t;let a=Math.random()<w.criticalChance,l=((null==(t=z.current)||null==(e=t.activeBuffs)?void 0:e.ragePotionExpiresAt)||0)>Date.now(),s=a?Math.floor(w.baseDamage*w.criticalDamage):w.baseDamage;l&&(s*=2);let i=s;h.isBoss&&(i=Math.ceil(s*(w.bossDamageMultiplier||1))),f(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-i;return t<=0?(setTimeout(()=>K(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),u(e=>{let t=+w.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+i}}}),S({id:crypto.randomUUID(),damage:i,isCrit:a})},Math.max(50,1e3/e));return()=>clearInterval(t)},[w.autoClickPerSec,w.baseDamage,w.criticalChance,w.criticalDamage,w.bossDamageMultiplier,w.cpMultiplier,null==h?void 0:h.id]);let H=(0,s.useCallback)((e,t,a)=>{let l={name:"未知怪物",emoji:"❓",rarity:i.COMMON,hpMultiplier:1,goldMultiplier:1,xpMultiplier:1};if(!a||!a.monsters||0===a.monsters.length)return l;let s=a.monsters.filter(a=>{let l=Number(a.Stage_Min)||1,s=Number(a.Stage_Max)||9999;if(e<l||e>s)return!1;let i=(a.Rarity||"COMMON").toUpperCase();return t?"BOSS"===i:"BOSS"!==i});if(0===s.length)return l;let n=Math.random()*s.reduce((e,t)=>e+(Number(t.Weight)||0),0);for(let e of s){let t=Number(e.Weight)||0;if(n<t)return console.log("Selected Monster Config:",e),{name:e.Name,emoji:e.Emoji,rarity:e.Rarity||i.COMMON,hpMultiplier:Number(e.HP_Mult)||1,goldMultiplier:Number(e.Gold_Mult)||1,xpMultiplier:Number(e.XP_Mult)||1,dropDiamonds:Number(e.Drop_Diamonds)||0,note:e.Notes};n-=t}return l},[]),K=e=>{if(!e||q.current.has(e.id))return;q.current.add(e.id),q.current.size>50&&q.current.clear();let t=Math.ceil(e.rewardGold*w.goldMultiplier),a=Math.ceil(e.rewardXp*w.xpMultiplier);u(l=>{let{level:s,currentXp:i,requiredXp:n}=l.system,{levelPoints:r}=l.wallet;for(i+=a;i>=n;)i-=n,s+=1,r+=5,n=Math.floor(1.2*n);return{...l,wallet:{...l.wallet,gold:l.wallet.gold+t,levelPoints:r},system:{...l.system,level:s,currentXp:i,requiredXp:n},records:{...l.records,monstersKilled:l.records.monstersKilled+1,totalGoldEarned:l.records.totalGoldEarned+t,bossesKilled:e.isBoss?l.records.bossesKilled+1:l.records.bossesKilled,maxStageReached:e.isBoss?Math.max(l.records.maxStageReached,e.level+1):l.records.maxStageReached}}}),g(t=>{if(e.isBoss)return{...t,currentStageId:e.level+1,maxStageReached:Math.max(t.maxStageReached,e.level+1),isBossActive:!1,monstersKilledInStage:0,bossTimeLeft:null};let a=t.monstersKilledInStage+1;return{...t,monstersKilledInStage:a}}),f(null)},F=e=>{"RAGE"===e&&o.inventory.ragePotionCount>0&&u(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))},X=e=>{let t={...I.stats};return t.baseDamage+=+(e.goldShop.weaponLevel||0),t.autoAttackDamage+=2*(e.goldShop.mercenaryLevel||0)+5*(e.goldShop.partnerLevel||0)+20*(e.goldShop.archerLevel||0)+100*(e.goldShop.knightLevel||0),t.goldMultiplier+=.05*(e.goldShop.amuletLevel||0),["clickShop","levelShop","ascensionShop"].forEach(a=>{Object.entries(e[a]).forEach(e=>{var a;let[l,s]=e,i=null==v||null==(a=v.upgrades)?void 0:a.find(e=>e.ID===l);if(i&&s>0){let e=i.Effect_Type,a=Number(i.Effect_Val||0)*s;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(t.baseDamage+=a),("ADD_CRIT"===e||"CRIT_RATE"===e)&&(t.criticalChance+=a/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(t.criticalDamage+=a/100),("ADD_GOLD"===e||"GOLD_MULT"===e)&&(t.goldMultiplier+=a/100),("ADD_XP"===e||"XP_MULT"===e)&&(t.xpMultiplier+=a/100),("ADD_AUTO"===e||"AUTO_DMG"===e)&&(t.autoAttackDamage+=a),("ADD_BOSS_DMG"===e||"BOSS_DMG"===e)&&(t.bossDamageMultiplier+=a/100),"REDUCE_GOAL_V"===e&&(t.monsterKillReduction+=a),"RARE_CHANCE_P"===e&&(t.rareMonsterChance+=a/100),"AUTO_CLICK_V"===e&&(t.autoClickPerSec+=a)}})}),t},V=()=>{Y<=0||(u(e=>{let t={...e,system:{level:1,currentXp:0,requiredXp:100},wallet:{...e.wallet,gold:0,levelPoints:0,ascensionPoints:(e.wallet.ascensionPoints||0)+Y,equipmentShards:e.wallet.equipmentShards||0},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,amuletLevel:0},levelShop:{},activeBuffs:{ragePotionExpiresAt:0}};return t.stats=X(t),t}),g(e=>({...e,currentStageId:1,monstersKilledInStage:0,isBossActive:!1,maxStageReached:1})),f(null),A("⚡ 渡劫成功！獲得 ".concat(Y.toLocaleString()," 點飛昇點數！\n等級與等級點數已重製，裝備與點擊加成已保留。"),"渡劫成功"),n("BATTLE"))},Y=s.useMemo(()=>Math.floor(10*Math.pow(1.2,Math.max(0,x.maxStageReached-0))),[x.maxStageReached]);return(0,l.jsxs)("div",{className:"ca-game-container",children:[(0,l.jsx)(r,{player:o,combatPower:R,stageId:x.currentStageId,onAvatarClick:()=>t("PROFILE"),onAscension:()=>{if(Y<=0)return void A("尚未達到飛升條件！");window.confirm("確定要渡劫飛升嗎？\n\n將重置關卡與金幣，並獲得 ".concat(Y.toLocaleString()," 點飛升點數！"))&&V()},potentialPoints:Y}),"BATTLE"===a?(0,l.jsx)(c,{monster:h,stageId:x.currentStageId,onMonsterClick:(e,t)=>{h&&!(h.currentHp<=0)&&(f(t=>{if(!t||t.currentHp<=0)return t;let a=Math.max(0,t.currentHp-e);return a<=0&&setTimeout(()=>K(t),0),{...t,currentHp:a}}),u(t=>({...t,records:{...t.records,totalClicks:t.records.totalClicks+1,totalDamageDealt:t.records.totalDamageDealt+e},wallet:{...t.wallet,clickPoints:t.wallet.clickPoints+ +w.cpMultiplier}})))},baseDamage:w.baseDamage,criticalChance:w.criticalChance,criticalDamage:w.criticalDamage,bossDamageMultiplier:w.bossDamageMultiplier||1,monstersKilled:x.monstersKilledInStage,monstersRequired:Math.max(1,x.monstersRequiredForBoss-(w.monsterKillReduction||0)),isBossActive:x.isBossActive,mercenaryLevel:o.goldShop.mercenaryLevel,partnerLevel:o.goldShop.partnerLevel,archerLevel:o.goldShop.archerLevel,knightLevel:o.goldShop.knightLevel,potionCount:o.inventory.ragePotionCount,activeBuffs:o.activeBuffs,onUsePotion:()=>F("RAGE"),lastAutoAttack:y,lastAutoClickEvent:C,bossTimeLeft:x.bossTimeLeft,bossTimeLimit:x.bossTimeLimit,onChallengeBoss:()=>{g(e=>({...e,isBossActive:!0,bossTimeLeft:e.bossTimeLimit||60})),f(null)}}):(0,l.jsx)(N,{player:o,effectiveStats:w,userId:O,gameConfig:v,onEquip:(e,t)=>{u(a=>({...a,equipment:{...a.equipment,equipped:{...a.equipment.equipped,[t]:e}}}))},onUnequip:e=>{u(t=>{let a={...t.equipment.equipped};return delete a[e],{...t,equipment:{...t.equipment,equipped:a}}})}}),(0,l.jsx)(d,{activeView:a,onSwitchView:n,onOpenModal:t}),(0,l.jsx)(p,{isOpen:"PROFILE"===e,onClose:()=>t(null),title:"玩家資料",children:(0,l.jsx)(D,{player:o,effectiveStats:w,combatPower:R,userId:O,onLogin:U,onLogout:()=>{G(null),localStorage.removeItem("ca_last_user_id"),u(I),g(E)},onManualSave:W,gameConfig:v})}),(0,l.jsx)(p,{isOpen:"SHOP"===e,onClose:()=>t(null),title:"商店",headerContent:(0,l.jsxs)("div",{className:"ca-shop-currency-bar",style:{display:"flex",flexWrap:"wrap",border:"none",background:"transparent",padding:"0 8px",gap:"12px"},children:[(0,l.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},title:"金幣",children:[(0,l.jsx)("span",{children:"\uD83D\uDCB0"}),(0,l.jsx)("span",{children:Math.floor(o.wallet.gold).toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},title:"鑽石",children:[(0,l.jsx)("span",{children:"\uD83D\uDC8E"}),(0,l.jsx)("span",{children:o.wallet.diamonds.toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"var(--ca-accent-cyan, #22d3ee)"},title:"點擊點數",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:Math.floor(o.wallet.clickPoints).toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#4ade80"},title:"等級積分",children:[(0,l.jsx)("span",{children:"\uD83C\uDD99"}),(0,l.jsx)("span",{children:o.wallet.levelPoints.toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#d8b4fe"},title:"飛昇點數",children:[(0,l.jsx)("span",{children:"\uD83D\uDD4A️"}),(0,l.jsx)("span",{children:o.wallet.ascensionPoints.toLocaleString()})]}),(0,l.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#fca5a5"},title:"裝備碎片",children:[(0,l.jsx)("span",{children:"\uD83E\uDDE9"}),(0,l.jsx)("span",{children:(o.wallet.equipmentShards||0).toLocaleString()})]})]}),children:(0,l.jsx)(m,{player:o,onPurchase:e=>{var t,a,l,s,i,n;if("daily_checkin"===e)return void u(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+10,gold:e.wallet.gold+500},lastDailyRewardClaimTime:Date.now()}));if(e.startsWith("click_shop_")){let a=null==v||null==(t=v.upgrades)?void 0:t.find(t=>t.ID===e);if(!a)return;let l=o.clickShop[e]||0,i=Number(a.Max_Level||0);if(i>0&&l>=i)return void A("已達最大等級！");let n=Number(a.Cost_Base||0),r=Number(a.Cost_Mult||0),c=0;c=1===r||1===r?Math.floor(n+l):Math.floor(n*Math.pow(r,l));let d=a.Currency||"CP";return(s=o.wallet,("GOLD"===d?s.gold:"LP"===d?s.levelPoints:"DIAMOND"===d?s.diamonds:"AP"===d?s.ascensionPoints:s.clickPoints)>=c)?u(t=>{let s={...t.stats},i=a.Effect_Type,n=Number(a.Effect_Val||0);("ADD_DAMAGE"===i||"CLICK_DMG"===i)&&(s.baseDamage+=n),("ADD_CRIT_DMG"===i||"CRIT_DMG"===i)&&(s.criticalDamage+=n/100),("ADD_GOLD"===i||"GOLD_MULT"===i)&&(s.goldMultiplier+=n/100),"AUTO_CLICK_V"===i&&(s.autoClickPerSec+=n),"REDUCE_GOAL_V"===i&&(s.monsterKillReduction+=n),"RARE_CHANCE_P"===i&&(s.rareMonsterChance+=n/100);let r={...t.wallet};return"GOLD"===d?r.gold-=c:"LP"===d?r.levelPoints-=c:"DIAMOND"===d?r.diamonds-=c:"AP"===d?r.ascensionPoints-=c:r.clickPoints-=c,{...t,wallet:r,clickShop:{...t.clickShop,[e]:l+1},stats:s}}):A("".concat(d," 不足！")),void 0}if(e.startsWith("level_shop_")){let t=null==v||null==(a=v.upgrades)?void 0:a.find(t=>t.ID===e);if(!t)return;let l=o.levelShop[e]||0,s=Number(t.Max_Level||0);if(s>0&&l>=s)return void A("已達最大等級！");let n=Number(t.Cost_Base||0),r=Number(t.Cost_Mult||0),c=0;c=1===r||1===r?Math.floor(n+l):Math.floor(n*Math.pow(r,l));let d=t.Currency||"LP";return(i=o.wallet,("GOLD"===d?i.gold:"CP"===d?i.clickPoints:"DIAMOND"===d?i.diamonds:"AP"===d?i.ascensionPoints:i.levelPoints)>=c)?u(a=>{let s={...a.stats},i=t.Effect_Type,n=Number(t.Effect_Val||0);("ADD_XP"===i||"XP_MULT"===i)&&(s.xpMultiplier+=n/100),("ADD_GOLD"===i||"GOLD_MULT"===i)&&(s.goldMultiplier+=n/100),("ADD_AUTO"===i||"AUTO_DMG"===i)&&(s.autoAttackDamage+=n),("ADD_BOSS_DMG"===i||"BOSS_DMG"===i)&&(s.bossDamageMultiplier+=n/100),("ADD_CRIT"===i||"CRIT_RATE"===i)&&(s.criticalChance+=n/100),"AUTO_CLICK_V"===i&&(s.autoClickPerSec+=n),"REDUCE_GOAL_V"===i&&(s.monsterKillReduction+=n),"RARE_CHANCE_P"===i&&(s.rareMonsterChance+=n/100);let r={...a.wallet};return"GOLD"===d?r.gold-=c:"CP"===d?r.clickPoints-=c:"DIAMOND"===d?r.diamonds-=c:"AP"===d?r.ascensionPoints-=c:r.levelPoints-=c,{...a,wallet:r,levelShop:{...a.levelShop,[e]:l+1},stats:s}}):A("".concat(d," 不足！")),void 0}let r=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:"DIAMOND"},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:"DIAMOND"}].find(t=>t.id===e);if(r&&"DIAMOND"===r.currency&&o.wallet.diamonds>=r.cost&&u(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds-r.cost,gold:e.wallet.gold+r.reward}})),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:t}=o,a=0;switch(e){case"gold_shop_weapon":a=Math.floor(10*Math.pow(1.2,t.weaponLevel)),o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},goldShop:{...e.goldShop,weaponLevel:e.goldShop.weaponLevel+1},stats:{...e.stats,baseDamage:e.stats.baseDamage+1}}));break;case"gold_shop_mercenary":a=Math.floor(100*Math.pow(1.3,t.mercenaryLevel)),o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},goldShop:{...e.goldShop,mercenaryLevel:e.goldShop.mercenaryLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+2}}));break;case"gold_shop_partner":a=Math.floor(500*Math.pow(1.3,t.partnerLevel)),o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},goldShop:{...e.goldShop,partnerLevel:e.goldShop.partnerLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+5}}));break;case"gold_shop_archer":a=Math.floor(2e3*Math.pow(1.4,t.archerLevel||0)),o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},goldShop:{...e.goldShop,archerLevel:(e.goldShop.archerLevel||0)+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+20}}));break;case"gold_shop_knight":a=Math.floor(1e4*Math.pow(1.5,t.knightLevel||0)),o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},goldShop:{...e.goldShop,knightLevel:(e.goldShop.knightLevel||0)+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+100}}));break;case"gold_shop_amulet":a=Math.floor(5e3*Math.pow(1.5,t.amuletLevel||0)),o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},goldShop:{...e.goldShop,amuletLevel:(e.goldShop.amuletLevel||0)+1},stats:{...e.stats,goldMultiplier:e.stats.goldMultiplier+.05}}));break;case"gold_potion_rage":a=500,o.wallet.gold>=a&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-a},inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount+1}}))}}if(e.startsWith("gacha_equipment_")){let t=1;e.endsWith("_10")&&(t=10),e.endsWith("_100")&&(t=100);let a="basic";e.includes("advanced")&&(a="advanced"),e.includes("premium")&&(a="premium");let l=1e3;"advanced"===a&&(l=1e4),"premium"===a&&(l=1e5);let s=l*t;if(o.wallet.gold>=s){let e=(null==v?void 0:v.equipments)||[];if(e.length>0){let l=e.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===a?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==a||"MYTHIC"!==t});if(0===l.length)return void A("此箱子目前沒有可抽取的裝備設定。");let i=l.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),n={...o.equipment.inventory},r=[],c=[],d=0;for(let e=0;e<t;e++){let e=Math.random()*i,t=l[0];for(let a of l){let l=Number(a.Gacha_Weight)||0;if(e<l){t=a;break}e-=l}r.push(t);let a=n[t.ID]||0;if(a>=(Number(t.Max_Level)||10)){let e=(t.Rarity||"COMMON").toUpperCase(),a=1;switch(e){case"COMMON":default:a=1;break;case"UNCOMMON":a=3;break;case"RARE":a=10;break;case"EPIC":a=50;break;case"LEGENDARY":a=200;break;case"MYTHIC":a=1e3}d+=a,c.push({item:t,shards:a})}else n[t.ID]=a+1}if(u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-s,equipmentShards:(e.wallet.equipmentShards||0)+d},equipment:{...e.equipment,inventory:n}})),1===t)if(c.length>0){let e=c[0];A("獲得裝備：".concat(e.item.Name," (已滿級)\n自動轉換為：\uD83E\uDDE9 裝備碎片 x").concat(e.shards),"獲得裝備")}else A("獲得裝備：".concat(r[0].Name," (Rarity: ").concat(r[0].Rarity,")"),"獲得裝備");else{let e={};r.forEach(t=>{e[t.Name]=(e[t.Name]||0)+1});let l=Object.entries(e).map(e=>{let[t,a]=e;return"".concat(t," x").concat(a)}).join("\n");d>0&&(l+="\n\n\uD83E\uDDE9 獲得碎片: ".concat(d," (滿級轉化)")),A("獲得 ".concat(t," 件裝備").concat("premium"===a?"(頂級)":"advanced"===a?"(高級)":"","：\n").concat(l),"獲得裝備")}}else A("暫無裝備可抽取")}else A("金幣不足！")}if(e.startsWith("ascension_shop_")||e.startsWith("asc_")){let t=null==v||null==(l=v.upgrades)?void 0:l.find(t=>t.ID===e);if(!t)return;let a=o.ascensionShop[e]||0,s=Number(t.Max_Level||0);if(s>0&&a>=s)return void A("已達最大等級！");let i=Number(t.Cost_Base||0),r=Number(t.Cost_Mult||0),c=0;c=1===r||1===r?Math.floor(i+a):Math.floor(i*Math.pow(r,a));let d=t.Currency||"AP";(n=o.wallet,("GOLD"===d?n.gold:"CP"===d?n.clickPoints:"LP"===d?n.levelPoints:"DIAMOND"===d?n.diamonds:n.ascensionPoints)>=c)?u(l=>{let s={...l.stats},i=t.Effect_Type,n=Number(t.Effect_Val||0);("ADD_CRIT"===i||"CRIT_RATE"===i)&&(s.criticalChance+=n/100),("ADD_DAMAGE"===i||"CLICK_DMG"===i)&&(s.baseDamage+=n),("ADD_GOLD"===i||"GOLD_MULT"===i)&&(s.goldMultiplier+=n/100),("ADD_XP"===i||"XP_MULT"===i)&&(s.xpMultiplier+=n/100),"REDUCE_GOAL_V"===i&&(s.monsterKillReduction+=n),"RARE_CHANCE_P"===i&&(s.rareMonsterChance+=n/100),"AUTO_CLICK_V"===i&&(s.autoClickPerSec+=n);let r={...l.wallet};return"GOLD"===d?r.gold-=c:"CP"===d?r.clickPoints-=c:"LP"===d?r.levelPoints-=c:"DIAMOND"===d?r.diamonds-=c:r.ascensionPoints-=c,{...l,wallet:r,ascensionShop:{...l.ascensionShop,[e]:a+1},stats:s}}):A("".concat(d," 不足！"))}},onResetLevelPoints:()=>{window.confirm("確定要重製等級積分嗎？\n所有已分配的點數將會返還，您可以重新分配天賦。")&&(u(e=>{let t=0;Object.entries(e.levelShop).forEach(e=>{var a;let[l,s]=e,i=null==v||null==(a=v.upgrades)?void 0:a.find(e=>e.ID===l);if(i)for(let e=0;e<s;e++){let a=Math.floor(i.Cost_Base*Math.pow(i.Cost_Mult,e));t+=a}});let a={...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints+t},levelShop:{}};return a.stats=X(a),a}),A("✅ 等級積分已重製！"))},gameConfig:v})}),(0,l.jsx)(p,{isOpen:!!_,onClose:()=>M(null),title:(null==_?void 0:_.title)||"系統提示",children:(0,l.jsxs)("div",{style:{textAlign:"center",padding:"20px",fontSize:"1.1rem",color:"#e2e8f0",whiteSpace:"pre-wrap"},children:[null==_?void 0:_.message,(0,l.jsx)("div",{style:{marginTop:"24px"},children:(0,l.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"8px 32px"},onClick:()=>M(null),children:"確定"})})]})})]})}},66997:()=>{}}]);