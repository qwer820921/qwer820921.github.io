(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{6476:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});var r=n(95155);let l=(0,n(55028).default)(()=>n.e(2990).then(n.bind(n,12990)),{loadableGenerated:{webpack:()=>[12990]}});function a(e){let{children:t}=e;return(0,r.jsx)(l,{children:t})}},10255:(e,t,n)=>{"use strict";function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),n(95155),n(47650),n(85744),n(20589)},15685:()=>{},17828:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,n(64054).createAsyncLocalStorage)()},30347:()=>{},36645:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let r=n(88229)._(n(67357));function l(e,t){var n;let l={};"function"==typeof e&&(l.loader=e);let a={...l,...t};return(0,r.default)({...a,modules:null==(n=a.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},39543:(e,t,n)=>{"use strict";n.d(t,{default:()=>i});var r=n(95155);let l=n(49509).env.NEXT_PUBLIC_CHATANYWHERE_API_KEY||"";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gpt-4o-mini",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;if(!l)throw Error("API Key 未設定，請在環境變數 NEXT_PUBLIC_CHATANYWHERE_API_KEY 設定");let r=new AbortController,a=setTimeout(()=>r.abort(),n);try{var o,i,s,u;let n=await fetch("https://api.chatanywhere.tech/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({model:t,messages:e}),signal:r.signal});if(clearTimeout(a),!n.ok){let e=await n.json().catch(()=>null),t=(null==e||null==(u=e.error)?void 0:u.message)||n.statusText||"API 呼叫失敗";throw Error(t)}let c=await n.json(),d=null==c||null==(s=c.choices)||null==(i=s[0])||null==(o=i.message)?void 0:o.content;if(!d)throw Error("API 回傳格式錯誤或無回覆內容");return{reply:d}}catch(e){if(e instanceof Error)throw Error(e.message);throw e}}var o=n(12115);let i=()=>{let[e,t]=(0,o.useState)(!1),[n,l]=(0,o.useState)([{text:"哈囉！有什麼我可以幫你的嗎？",sender:"bot"}]),[i,s]=(0,o.useState)(""),[u,c]=(0,o.useState)(!0),[d,f]=(0,o.useState)(!1),b=()=>{t(!e),c(!1)},p=async e=>{if(e.preventDefault(),!i.trim()||d)return;let t=[...n,{text:i,sender:"user"}];l(t),s(""),c(!1),f(!0);let r=t.map(e=>({role:"user"===e.sender?"user":"assistant",content:e.text}));try{l(e=>[...e,{text:"...",sender:"bot"}]);let{reply:e}=await a(r);l(t=>{let n=[...t];return n[n.length-1]={text:e,sender:"bot"},n})}catch(e){l(t=>{let n=[...t];return n[n.length-1]={text:(null==e?void 0:e.toString())||"發生錯誤，請稍後再試。",sender:"bot"},n})}finally{f(!1)}};return(0,r.jsxs)("div",{className:"position-fixed bottom-0 end-0 mb-3 me-3",style:{zIndex:1050,maxWidth:"320px"},children:[(0,r.jsxs)("div",{className:"position-relative",children:[(0,r.jsx)("button",{onClick:b,className:"btn btn-primary rounded-circle d-flex align-items-center justify-content-center shadow",style:{width:"56px",height:"56px"},"aria-label":"切換聊天視窗",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{width:"24px",height:"24px"},children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),u&&!e&&(0,r.jsx)("span",{className:"position-absolute bg-danger rounded-circle",style:{width:"12px",height:"12px",top:"0",right:"0",border:"2px solid white"}})]}),e&&(0,r.jsxs)("div",{className:"card mt-2 me-2",style:{height:"400px"},children:[(0,r.jsxs)("div",{className:"card-header bg-primary text-white d-flex justify-content-between align-items-center",children:[(0,r.jsx)("span",{className:"fw-bold",children:"聊天助手"}),(0,r.jsx)("button",{onClick:b,className:"btn-close btn-close-white","aria-label":"關閉聊天視窗"})]}),(0,r.jsx)("div",{className:"card-body overflow-auto d-flex flex-column",style:{maxHeight:"calc(100% - 110px)"},children:n.map((e,t)=>(0,r.jsx)("div",{className:"mb-2 d-flex ".concat("user"===e.sender?"justify-content-end":"justify-content-start"),children:(0,r.jsx)("div",{className:"p-2 rounded ".concat("user"===e.sender?"bg-primary-subtle":"bg-secondary-subtle"),style:{maxWidth:"75%"},children:e.text})},t))}),(0,r.jsx)("div",{className:"card-footer border-top",children:(0,r.jsxs)("form",{onSubmit:p,className:"d-flex gap-2",children:[(0,r.jsx)("textarea",{value:i,onChange:e=>s(e.target.value),placeholder:"輸入消息...",className:"form-control","aria-label":"聊天輸入",disabled:d,rows:2,style:{resize:"vertical",minHeight:"38px"}}),(0,r.jsx)("button",{type:"submit",className:"btn btn-primary text-nowrap",disabled:d||!i.trim(),"aria-label":"發送消息",children:"發送"})]})})]})]})}},42714:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"setAttributesFromProps",{enumerable:!0,get:function(){return a}});let n={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},r=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function l(e){return["async","defer","noModule"].includes(e)}function a(e,t){for(let[a,o]of Object.entries(t)){if(!t.hasOwnProperty(a)||r.includes(a)||void 0===o)continue;let i=n[a]||a.toLowerCase();"SCRIPT"===e.tagName&&l(i)?e[i]=!!o:e.setAttribute(i,String(o)),(!1===o||"SCRIPT"===e.tagName&&l(i)&&(!o||"false"===o))&&(e.setAttribute(i,""),e.removeAttribute(i))}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},47709:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,15685,23)),Promise.resolve().then(n.t.bind(n,69243,23)),Promise.resolve().then(n.bind(n,13568)),Promise.resolve().then(n.bind(n,6476)),Promise.resolve().then(n.t.bind(n,30347,23)),Promise.resolve().then(n.bind(n,39543))},55028:(e,t,n)=>{"use strict";n.d(t,{default:()=>l.a});var r=n(36645),l=n.n(r)},62146:(e,t,n)=>{"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(45262)},64054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return o},createAsyncLocalStorage:function(){return a},createSnapshot:function(){return i}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let l="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function a(){return l?new l:new r}function o(e){return l?l.bind(e):r.bind(e)}function i(){return l?l.snapshot():function(e,...t){return e(...t)}}},67357:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});let r=n(95155),l=n(12115),a=n(62146);function o(e){return{default:e&&"default"in e?e.default:e}}n(10255);let i={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},s=function(e){let t={...i,...e},n=(0,l.lazy)(()=>t.loader().then(o)),s=t.loading;function u(e){let o=s?(0,r.jsx)(s,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,u=i?l.Suspense:l.Fragment,c=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(u,{...i?{fallback:o}:{},children:c})}return u.displayName="LoadableComponent",u}},69243:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return g},handleClientScriptLoad:function(){return h},initScriptLoader:function(){return y}});let r=n(88229),l=n(6966),a=n(95155),o=r._(n(47650)),i=l._(n(12115)),s=n(82830),u=n(42714),c=n(92374),d=new Map,f=new Set,b=e=>{if(o.default.preinit)return void e.forEach(e=>{o.default.preinit(e,{as:"style"})});{let t=document.head;e.forEach(e=>{let n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.appendChild(n)})}},p=e=>{let{src:t,id:n,onLoad:r=()=>{},onReady:l=null,dangerouslySetInnerHTML:a,children:o="",strategy:i="afterInteractive",onError:s,stylesheets:c}=e,p=n||t;if(p&&f.has(p))return;if(d.has(t)){f.add(p),d.get(t).then(r,s);return}let h=()=>{l&&l(),f.add(p)},y=document.createElement("script"),m=new Promise((e,t)=>{y.addEventListener("load",function(t){e(),r&&r.call(this,t),h()}),y.addEventListener("error",function(e){t(e)})}).catch(function(e){s&&s(e)});a?(y.innerHTML=a.__html||"",h()):o?(y.textContent="string"==typeof o?o:Array.isArray(o)?o.join(""):"",h()):t&&(y.src=t,d.set(t,m)),(0,u.setAttributesFromProps)(y,e),"worker"===i&&y.setAttribute("type","text/partytown"),y.setAttribute("data-nscript",i),c&&b(c),document.body.appendChild(y)};function h(e){let{strategy:t="afterInteractive"}=e;"lazyOnload"===t?window.addEventListener("load",()=>{(0,c.requestIdleCallback)(()=>p(e))}):p(e)}function y(e){e.forEach(h),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(e=>{let t=e.id||e.getAttribute("src");f.add(t)})}function m(e){let{id:t,src:n="",onLoad:r=()=>{},onReady:l=null,strategy:u="afterInteractive",onError:d,stylesheets:b,...h}=e,{updateScripts:y,scripts:m,getIsSsr:g,appDir:v,nonce:_}=(0,i.useContext)(s.HeadManagerContext),x=(0,i.useRef)(!1);(0,i.useEffect)(()=>{let e=t||n;x.current||(l&&e&&f.has(e)&&l(),x.current=!0)},[l,t,n]);let j=(0,i.useRef)(!1);if((0,i.useEffect)(()=>{if(!j.current){if("afterInteractive"===u)p(e);else"lazyOnload"===u&&("complete"===document.readyState?(0,c.requestIdleCallback)(()=>p(e)):window.addEventListener("load",()=>{(0,c.requestIdleCallback)(()=>p(e))}));j.current=!0}},[e,u]),("beforeInteractive"===u||"worker"===u)&&(y?(m[u]=(m[u]||[]).concat([{id:t,src:n,onLoad:r,onReady:l,onError:d,...h}]),y(m)):g&&g()?f.add(t||n):g&&!g()&&p(e)),v){if(b&&b.forEach(e=>{o.default.preinit(e,{as:"style"})}),"beforeInteractive"===u)if(!n)return h.dangerouslySetInnerHTML&&(h.children=h.dangerouslySetInnerHTML.__html,delete h.dangerouslySetInnerHTML),(0,a.jsx)("script",{nonce:_,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([0,{...h,id:t}])+")"}});else return o.default.preload(n,h.integrity?{as:"script",integrity:h.integrity,nonce:_,crossOrigin:h.crossOrigin}:{as:"script",nonce:_,crossOrigin:h.crossOrigin}),(0,a.jsx)("script",{nonce:_,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([n,{...h,id:t}])+")"}});"afterInteractive"===u&&n&&o.default.preload(n,h.integrity?{as:"script",integrity:h.integrity,nonce:_,crossOrigin:h.crossOrigin}:{as:"script",nonce:_,crossOrigin:h.crossOrigin})}return null}Object.defineProperty(m,"__nextScript",{value:!0});let g=m;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},85744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=n(17828)},92374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{cancelIdleCallback:function(){return r},requestIdleCallback:function(){return n}});let n="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(e){let t=Date.now();return self.setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},r="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(e){return clearTimeout(e)};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{var t=t=>e(e.s=t);e.O(0,[740,7690,3568,8441,1684,7358],()=>t(47709)),_N_E=e.O()}]);