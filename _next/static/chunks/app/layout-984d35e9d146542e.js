(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{6476:(e,t,a)=>{"use strict";a.d(t,{default:()=>i});var r=a(95155),n=a(55028),o=a(77719);let s=(0,n.default)(()=>a.e(2990).then(a.bind(a,12990)),{loadableGenerated:{webpack:()=>[12990]}});function i(e){let{children:t}=e;return(0,r.jsxs)(o.tE,{children:[(0,r.jsx)(s,{children:t}),(0,r.jsx)(o.N9,{})]})}},17351:e=>{e.exports={container:"Toast_container__mG37V",toast:"Toast_toast__5rLqi",slideIn:"Toast_slideIn__t_S7d",icon:"Toast_icon__mPfnn",message:"Toast_message__9z4O2",closeButton:"Toast_closeButton__I_x04",success:"Toast_success__S4BuP",error:"Toast_error__xqcXB",warning:"Toast_warning__NW1GO",info:"Toast_info___BcG7"}},30347:()=>{},39543:(e,t,a)=>{"use strict";a.d(t,{default:()=>x});var r=a(95155),n=a(11518),o=a.n(n),s=a(49509);let i="gpt-4o-mini",l=s.env.NEXT_PUBLIC_CHATANYWHERE_API_KEY||"",d="gemini-flash-latest";async function c(e,t){var a,r,n,o;if(!l)throw Error("ChatAnywhere API Key 未設定");let s=await fetch("https://api.chatanywhere.tech/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({model:i,messages:e}),signal:t});if(!s.ok){let e=await s.json().catch(()=>null);throw Error((null==e||null==(o=e.error)?void 0:o.message)||s.statusText||"ChatAnywhere 呼叫失敗")}let d=await s.json();return(null==d||null==(n=d.choices)||null==(r=n[0])||null==(a=r.message)?void 0:a.content)||"無回覆內容"}async function u(e,t){let a=await fetch("https://script.google.com/macros/s/AKfycbyX8Gb41K9uCBDOsZgufvC_G4OiDY5wX181SHb5Gykki4BmXMG3nlhfnY888r8jUbLM/exec",{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({messages:e}),signal:t});if(!a.ok)throw Error("無法連線至 Gemini 代理伺服器 (GAS)");let r=await a.json();if(r.error)throw Error(r.error);return r.reply}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"chatanywhere",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4,r=new AbortController,n=setTimeout(()=>r.abort(),a);try{let a="";return{reply:"gemini"===t?await u(e,r.signal):await c(e,r.signal)}}catch(e){if(e instanceof Error){if("AbortError"===e.name)throw Error("請求超時（".concat(a/1e3,"秒），請再試一次。"));throw Error(e.message)}throw e}finally{clearTimeout(n)}}var m=a(12115);let g=()=>(0,r.jsxs)("div",{className:"jsx-901b2c0a82d99d2d d-flex align-items-center gap-1",children:[(0,r.jsx)(o(),{id:"901b2c0a82d99d2d",children:"@-webkit-keyframes bounce{0%,60%,100%{-webkit-transform:translatey(0);transform:translatey(0)}30%{-webkit-transform:translatey(-8px);transform:translatey(-8px)}}@-moz-keyframes bounce{0%,60%,100%{-moz-transform:translatey(0);transform:translatey(0)}30%{-moz-transform:translatey(-8px);transform:translatey(-8px)}}@-o-keyframes bounce{0%,60%,100%{-o-transform:translatey(0);transform:translatey(0)}30%{-o-transform:translatey(-8px);transform:translatey(-8px)}}@keyframes bounce{0%,60%,100%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}30%{-webkit-transform:translatey(-8px);-moz-transform:translatey(-8px);-o-transform:translatey(-8px);transform:translatey(-8px)}}.typing-dot.jsx-901b2c0a82d99d2d{width:8px;height:8px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:bounce 1.4s infinite ease-in-out;-moz-animation:bounce 1.4s infinite ease-in-out;-o-animation:bounce 1.4s infinite ease-in-out;animation:bounce 1.4s infinite ease-in-out}.typing-dot.jsx-901b2c0a82d99d2d:nth-child(1){background:#10b981;-webkit-animation-delay:0s;-moz-animation-delay:0s;-o-animation-delay:0s;animation-delay:0s}.typing-dot.jsx-901b2c0a82d99d2d:nth-child(2){background:#3b82f6;-webkit-animation-delay:.2s;-moz-animation-delay:.2s;-o-animation-delay:.2s;animation-delay:.2s}.typing-dot.jsx-901b2c0a82d99d2d:nth-child(3){background:#8b5cf6;-webkit-animation-delay:.4s;-moz-animation-delay:.4s;-o-animation-delay:.4s;animation-delay:.4s}"}),(0,r.jsx)("div",{className:"jsx-901b2c0a82d99d2d typing-dot"}),(0,r.jsx)("div",{className:"jsx-901b2c0a82d99d2d typing-dot"}),(0,r.jsx)("div",{className:"jsx-901b2c0a82d99d2d typing-dot"})]}),x=()=>{let[e,t]=(0,m.useState)(!1),[a,n]=(0,m.useState)({chatanywhere:[{text:"哈囉！有什麼我可以幫你的嗎？",sender:"bot"}],gemini:[{text:"哈囉！有什麼我可以幫你的嗎？",sender:"bot"}]}),[o,s]=(0,m.useState)(""),[l,c]=(0,m.useState)(!0),[u,x]=(0,m.useState)(!1),[p,b]=(0,m.useState)("chatanywhere"),f=a[p],w={chatanywhere:"\uD83E\uDD16 ChatAnywhere (無聯網) \xb7 ".concat(i),gemini:"✨ Gemini (聯網) \xb7 ".concat(d)},[y,v]=(0,m.useState)({x:0,y:0}),[j,k]=(0,m.useState)(!1),T=(0,m.useRef)(null),N=(0,m.useRef)(null),_=(0,m.useRef)(!1),[E,C]=(0,m.useState)({width:350,height:500}),[S,M]=(0,m.useState)(!1),[P,z]=(0,m.useState)(null),A=(0,m.useRef)(null),L=(e,t)=>{k(!0),_.current=!1,T.current={x:e-y.x,y:t-y.y}},R=(e,t)=>{e.stopPropagation(),e.preventDefault();let a="touches"in e?e.touches[0].clientX:e.clientX,r="touches"in e?e.touches[0].clientY:e.clientY;M(!0),z(t),A.current={x:a,y:r,w:E.width,h:E.height,posX:y.x,posY:y.y}},B=(e,t)=>{if(!j||!T.current)return;let a=e-T.current.x,r=t-T.current.y;(Math.abs(a-y.x)>5||Math.abs(r-y.y)>5)&&(_.current=!0),v({x:a,y:r})},D=(e,t)=>{if(!S||!A.current)return;let a=e-A.current.x,r=t-A.current.y,n=Math.max(280,A.current.w-a),o=A.current.h;C({width:n,height:"tl"===P?Math.max(200,A.current.h-r):Math.max(200,A.current.h+r)})},X=()=>{k(!1),M(!1),z(null),T.current=null,A.current=null};(0,m.useEffect)(()=>{let e=e=>{let t="touches"in e?e.touches[0].clientX:e.clientX,a="touches"in e?e.touches[0].clientY:e.clientY;j&&B(t,a),S&&D(t,a)};return(j||S)&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",X),window.addEventListener("touchmove",e,{passive:!1}),window.addEventListener("touchend",X)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",e),window.removeEventListener("touchend",X)}},[j,S]);let I=async e=>{if(e.preventDefault(),!o.trim()||u)return;let t=[...f,{text:o,sender:"user"}];n(e=>({...e,[p]:t})),s(""),c(!1),x(!0);let a=t.map(e=>({role:"user"===e.sender?"user":"assistant",content:e.text}));try{n(e=>({...e,[p]:[...e[p],{text:"typing",sender:"bot"}]}));let{reply:e}=await h(a,p);n(t=>{let a=[...t[p]];return a[a.length-1]={text:e,sender:"bot"},{...t,[p]:a}})}catch(e){n(t=>{let a=[...t[p]];return a[a.length-1]={text:e instanceof Error?e.message:"發生錯誤，請稍後再試。",sender:"bot"},{...t,[p]:a}})}finally{x(!1)}};return(0,r.jsxs)("div",{ref:N,className:"position-fixed",style:{zIndex:1050,bottom:"20px",right:"20px",transform:"translate(".concat(y.x,"px, ").concat(y.y,"px)"),touchAction:"none",cursor:j?"grabbing":"default",display:"flex",flexDirection:"column",alignItems:"flex-end",transition:j||S?"none":"transform 0.3s ease"},onTouchEnd:X,children:[!e&&(0,r.jsxs)("div",{className:"position-relative",children:[(0,r.jsx)("button",{onClick:()=>{if(!_.current){let a=!e;a&&v({x:0,y:0}),t(a),c(!1)}},onMouseDown:e=>{"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&"SELECT"!==e.target.tagName&&L(e.clientX,e.clientY)},onTouchStart:e=>{if("TEXTAREA"===e.target.tagName||"INPUT"===e.target.tagName||"SELECT"===e.target.tagName)return;let t=e.touches[0];L(t.clientX,t.clientY)},className:"btn rounded-circle d-flex align-items-center justify-content-center shadow-lg",style:{width:"60px",height:"60px",cursor:"grab",background:"linear-gradient(135deg, #0d6efd, #0a58ca)",border:"2px solid rgba(255,255,255,0.2)",transition:"transform 0.2s ease"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)","aria-label":"切換聊天視窗",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"white",style:{width:"28px",height:"28px",pointerEvents:"none"},children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),l&&(0,r.jsx)("span",{className:"position-absolute bg-danger rounded-circle",style:{width:"12px",height:"12px",top:"0",right:"0",border:"2px solid white"}})]}),e&&(0,r.jsxs)("div",{className:"card shadow-lg border-0",style:{width:"".concat(E.width,"px"),maxWidth:"calc(100vw - 40px)",height:"".concat(E.height,"px"),maxHeight:"calc(100vh - 120px)",display:"flex",flexDirection:"column",borderRadius:"16px",overflow:"visible",backgroundColor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",position:"relative"},children:[(0,r.jsx)("div",{onMouseDown:e=>R(e,"tl"),onTouchStart:e=>R(e,"tl"),style:{position:"absolute",top:"-5px",left:"-5px",width:"25px",height:"25px",cursor:"nw-resize",zIndex:1060,backgroundColor:"transparent"}}),(0,r.jsx)("div",{onMouseDown:e=>R(e,"bl"),onTouchStart:e=>R(e,"bl"),style:{position:"absolute",bottom:"-5px",left:"-5px",width:"25px",height:"25px",cursor:"sw-resize",zIndex:1060,backgroundColor:"transparent"}}),(0,r.jsxs)("div",{className:"card-header text-white d-flex justify-content-between align-items-center py-2 px-3",style:{background:"linear-gradient(135deg, #0d6efd, #0a58ca)",borderBottom:"none",borderTopLeftRadius:"16px",borderTopRightRadius:"16px"},children:[(0,r.jsxs)("div",{className:"d-flex align-items-center gap-2 flex-grow-1",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"currentColor",className:"bi bi-robot",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5ZM3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.58 26.58 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.933.933 0 0 1-.765.935c-.845.147-2.34.346-4.235.346-1.895 0-3.39-.2-4.235-.346A.933.933 0 0 1 3 9.219V8.062Zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a24.767 24.767 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25.286 25.286 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135Z"}),(0,r.jsx)("path",{d:"M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2V1.866ZM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5Z"})]}),(0,r.jsxs)("div",{className:"dropdown",onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{className:"btn dropdown-toggle text-white fw-bold shadow-none",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",style:{cursor:"pointer",paddingRight:"0.75rem",paddingLeft:"0.75rem",paddingTop:"0.4rem",paddingBottom:"0.4rem",background:"linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1))",backdropFilter:"blur(10px)",border:"1.5px solid rgba(255,255,255,0.3)",borderRadius:"20px",fontSize:"0.85rem",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.2)",maxWidth:"250px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onMouseEnter:e=>{e.currentTarget.style.background="linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2))",e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.borderColor="rgba(255,255,255,0.5)"},onMouseLeave:e=>{e.currentTarget.style.background="linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1))",e.currentTarget.style.transform="scale(1)",e.currentTarget.style.borderColor="rgba(255,255,255,0.3)"},children:w[p]}),(0,r.jsxs)("ul",{className:"dropdown-menu",style:{background:"rgba(26, 26, 46, 0.98)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"12px",padding:"0.5rem",minWidth:"220px",boxShadow:"0 8px 24px rgba(0,0,0,0.3)"},children:[(0,r.jsx)("li",{children:(0,r.jsx)("button",{className:"dropdown-item",onClick:()=>b("chatanywhere"),style:{color:"#eee",padding:"0.75rem 1rem",borderRadius:"8px",fontSize:"0.9rem",fontWeight:"500",background:"chatanywhere"===p?"rgba(255,255,255,0.1)":"transparent",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.background="chatanywhere"===p?"rgba(255,255,255,0.1)":"transparent"},children:w.chatanywhere})}),(0,r.jsx)("li",{children:(0,r.jsx)("button",{className:"dropdown-item",onClick:()=>b("gemini"),style:{color:"#eee",padding:"0.75rem 1rem",borderRadius:"8px",fontSize:"0.9rem",fontWeight:"500",background:"gemini"===p?"rgba(255,255,255,0.1)":"transparent",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255,255,255,0.15)"},onMouseLeave:e=>{e.currentTarget.style.background="gemini"===p?"rgba(255,255,255,0.1)":"transparent"},children:w.gemini})})]})]})]}),(0,r.jsx)("button",{onClick:()=>t(!1),className:"btn-close btn-close-white","aria-label":"關閉聊天視窗",onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation()})]}),(0,r.jsx)("div",{className:"card-body overflow-auto d-flex flex-column flex-grow-1 p-3",style:{backgroundColor:"rgba(248, 249, 250, 0.8)",scrollbarWidth:"thin"},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:f.map((e,t)=>(0,r.jsx)("div",{className:"mb-3 d-flex ".concat("user"===e.sender?"justify-content-end":"justify-content-start"),children:(0,r.jsx)("div",{className:"p-3 rounded-4 ".concat("user"===e.sender?"text-white ms-4":"text-dark shadow-sm me-4"),style:{maxWidth:"85%",wordBreak:"break-word",background:"user"===e.sender?"linear-gradient(135deg, #0d6efd, #0b5ed7)":"#fff",borderBottomRightRadius:"user"===e.sender?"4px":"16px",borderBottomLeftRadius:"user"===e.sender?"16px":"4px"},children:"typing"===e.text?(0,r.jsx)(g,{}):e.text})},t))}),(0,r.jsx)("div",{className:"card-footer border-top p-2 bg-white",onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:(0,r.jsxs)("form",{onSubmit:I,className:"d-flex gap-2",children:[(0,r.jsx)("textarea",{value:o,onChange:e=>s(e.target.value),placeholder:"gemini"===p?"問問 ".concat(d):"問問 ".concat(i),className:"form-control","aria-label":"聊天輸入",disabled:u,rows:1,style:{resize:"none",minHeight:"38px",maxHeight:"80px"}}),(0,r.jsx)("button",{type:"submit",className:"btn btn-primary text-nowrap align-self-end",disabled:u||!o.trim(),"aria-label":"發送消息",children:"發送"})]})})]})]})}},77719:(e,t,a)=>{"use strict";a.d(t,{N9:()=>m,tE:()=>i,dj:()=>l});var r=a(95155),n=a(12115);let o=(0,n.createContext)(void 0),s=0,i=e=>{let{children:t}=e,[a,i]=(0,n.useState)([]),l=(0,n.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),d=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r="toast-".concat(++s),n={id:r,message:e,type:t,duration:a};i(e=>[...e,n]),a>0&&setTimeout(()=>{l(r)},a)},[l]),c=(0,n.useCallback)((e,t)=>d(e,"success",t),[d]),u=(0,n.useCallback)((e,t)=>d(e,"error",t),[d]),h=(0,n.useCallback)((e,t)=>d(e,"warning",t),[d]),m=(0,n.useCallback)((e,t)=>d(e,"info",t),[d]);return(0,r.jsx)(o.Provider,{value:{toasts:a,showToast:d,removeToast:l,success:c,error:u,warning:h,info:m},children:t})},l=()=>{let e=(0,n.useContext)(o);if(!e)throw Error("useToast must be used within a ToastProvider");return e};var d=a(17351),c=a.n(d);let u=e=>{switch(e){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}},h=e=>{let{toast:t,onClose:a}=e;return(0,r.jsxs)("div",{className:"".concat(c().toast," ").concat(c()[t.type]),children:[(0,r.jsx)("span",{className:c().icon,children:u(t.type)}),(0,r.jsx)("span",{className:c().message,children:t.message}),(0,r.jsx)("button",{className:c().closeButton,onClick:a,children:"✕"})]})},m=()=>{let{toasts:e,removeToast:t}=l();return 0===e.length?null:(0,r.jsx)("div",{className:c().container,children:e.map(e=>(0,r.jsx)(h,{toast:e,onClose:()=>t(e.id)},e.id))})}},93018:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,69243,23)),Promise.resolve().then(a.bind(a,6476)),Promise.resolve().then(a.t.bind(a,30347,23)),Promise.resolve().then(a.t.bind(a,15685,23)),Promise.resolve().then(a.bind(a,39543))}},e=>{var t=t=>e(e.s=t);e.O(0,[1698,7690,740,6283,8441,1684,7358],()=>t(93018)),_N_E=e.O()}]);