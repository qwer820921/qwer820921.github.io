(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[861],{723:(e,t,a)=>{"use strict";a.d(t,{default:()=>T});var n=a(95155),s=a(11518),l=a.n(s),i=a(12115),r=a(66444);a(15685);var c=a(23464);let o="https://script.google.com/macros/s/AKfycbzsuuu3BCArDw4Z_YjetPxEocch_b6-wBFNQrBxgR3gQACASyqxZ1_q41yXytgO-1VS/exec",d=async()=>{let e=await c.A.get(o);if(!Array.isArray(e.data))throw Error("Unexpected response format");return e.data},m=async e=>(await c.A.post(o,{action:"create",...e},{headers:{"Content-Type":"text/plain"},withCredentials:!1})).data,u=async e=>(await c.A.post(o,{action:"delete",id:e},{headers:{"Content-Type":"text/plain"},withCredentials:!1})).data;var h=a(20625);let b=e=>{let{value:t,onChange:a,onSearch:s,isSearching:l}=e;return(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{className:"form-label",children:"搜尋 YouTube 標題"}),(0,n.jsxs)("div",{className:"input-group",children:[(0,n.jsx)("input",{type:"text",className:"form-control",value:t,onChange:e=>a(e.target.value),placeholder:"請輸入影片標題"}),(0,n.jsx)("button",{className:"btn btn-primary",type:"button",onClick:s,disabled:l,children:l?"查詢中…":"查詢"})]}),l&&(0,n.jsx)("div",{className:"small text-muted",children:"搜尋中…"})]})},x=e=>{let{results:t,playlist:a,onAddTrack:s}=e;return t.length>0?(0,n.jsx)("ul",{className:"list-group mt-1",children:t.map(e=>{let t=a.some(t=>t.id===e.id.videoId);return(0,n.jsxs)("li",{className:"list-group-item d-flex align-items-center",children:[(0,n.jsx)("img",{src:e.snippet.thumbnails.default.url,alt:"thumb",className:"me-2"}),(0,n.jsx)("span",{className:"flex-grow-1",children:e.snippet.title}),(0,n.jsx)("button",{className:"btn btn-sm btn-success",disabled:t,onClick:()=>s(e),children:t?"已存在":"加入"})]},e.id.videoId)})}):null},p=e=>{let{playlist:t,selectedIndex:a,onDeleteTrack:s,onSelectTrack:l}=e;return(0,n.jsx)("ul",{className:"list-group",children:t.map((e,t)=>(0,n.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center"+(t===a?" active":""),onClick:()=>l(t),style:{cursor:"pointer"},children:[(0,n.jsx)("span",{children:e.title}),(0,n.jsx)("span",{className:"text-muted ms-2",children:e.artist}),(0,n.jsx)("button",{className:"btn btn-sm btn-danger ms-2",onClick:t=>{t.stopPropagation(),s(e.id)},children:"刪除"})]},e.id))})},y=e=>{let{show:t,onClose:a,searchInput:s,onSearchInputChange:l,onSearch:i,isSearching:r,searchResults:c,playlist:o,onAddTrack:d,onDeleteTrack:m,selectedIndex:u,onSelectTrack:h}=e;return t?(0,n.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,children:(0,n.jsx)("div",{className:"modal-dialog",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h5",{className:"modal-title",children:"編輯播放清單"}),(0,n.jsx)("button",{type:"button",className:"btn-close",onClick:a})]}),(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsx)(b,{value:s,onChange:l,onSearch:i,isSearching:r}),(0,n.jsx)(x,{results:c,playlist:o,onAddTrack:d}),(0,n.jsx)("hr",{}),(0,n.jsx)("label",{className:"form-label",children:"目前播放清單"}),(0,n.jsx)(p,{playlist:o,selectedIndex:u,onDeleteTrack:m,onSelectTrack:h})]}),(0,n.jsx)("div",{className:"modal-footer",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"關閉"})})]})})}):null};var g=a(16660),f=a(9932),j=a(62012),w=a(78327),v=a(81265),N=a(18725),k=a(41173),S=a(75460),C=a(21502),A=a(94505);let z=()=>(0,n.jsx)(l(),{id:"e7cba49d1805e6f7",children:".btn-circle{display:-webkit-box!important;display:-webkit-flex!important;display:-moz-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:0 8px!important;height:44px;min-width:0;width:auto;-webkit-border-radius:50%!important;-moz-border-radius:50%!important;border-radius:50%!important;font-size:1.35rem;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition:background.2s;-moz-transition:background.2s;-o-transition:background.2s;transition:background.2s}.btn-circle svg{display:block;margin:0;font-size:1.35rem}"}),I=(0,i.createContext)(null);async function R(e,t){try{let a=await fetch("https://api.lyrics.ovh/v1/".concat(encodeURIComponent(e),"/").concat(encodeURIComponent(t)));if(!a.ok)return"";return(await a.json()).lyrics||""}catch(e){return""}}function T(){let e=(0,i.useRef)(null),[t,a]=(0,i.useState)(!1),[s,l]=(0,i.useState)(0),[c,o]=(0,i.useState)(0),[b,x]=(0,i.useState)(50),[p,T]=(0,i.useState)(""),[P,E]=(0,i.useState)("載入中…"),[_,V]=(0,i.useState)(!1),[D,M]=(0,i.useState)(5),[O,W]=(0,i.useState)([]),[B,F]=(0,i.useState)(0),[U,q]=(0,i.useState)(!1),[Y,J]=(0,i.useState)("off"),K=(0,i.useCallback)(async()=>{try{let e=await d();W(e)}catch(e){console.error("取得清單失敗",e)}},[]);(0,i.useEffect)(()=>{K()},[K]);let[Q,X]=(0,i.useState)(!1);(0,i.useEffect)(()=>{!Q&&O.length>0&&0===B&&(H(0),X(!0))},[Q,O,B]);let Z=(e,t)=>{fetch("/api/scrobble",{method:"POST",body:JSON.stringify({event:e,vid:t,ts:Date.now()})}).catch(()=>{})},G=async e=>{let t=e.target;x(await t.getVolume()),T((await t.getVideoData()).title),a(!0),l(await t.getDuration())},H=async t=>{var a;if(0===O.length||!O[t])return;F(t),E("載入中…"),null==(a=e.current)||a.internalPlayer.loadVideoById(O[t].id);let n=O[t];n&&n.artist&&n.title?E(await R(n.artist,n.title)||"（查無歌詞）"):E("（查無歌詞）")},L=(0,i.useCallback)(()=>{F(e=>{if(0===O.length)return e;if("one"===Y)return H(e),e;let t=U?Math.floor(Math.random()*O.length):e+1<O.length?e+1:"all"===Y?0:e;return t!==e&&O[e]&&(Z("skip",O[e].id),H(t)),t})},[O,U,Y]),$=()=>{0!==O.length&&H(0===B?O.length-1:B-1)},ee=async()=>{var t;let a=null==(t=e.current)?void 0:t.internalPlayer;a&&(1===await a.getPlayerState()?a.pauseVideo():a.playVideo())};(0,i.useEffect)(()=>{if(!t)return;let a=setInterval(async()=>{var t;let a=null==(t=e.current)?void 0:t.internalPlayer;a&&(o(await a.getCurrentTime()),l(await a.getDuration()))},500);return()=>clearInterval(a)},[t]),(0,i.useEffect)(()=>{(async()=>{E("載入中…");let e=O[B];e&&e.artist&&e.title?E(await R(e.artist,e.title)||"（查無歌詞）"):E("（查無歌詞）")})()},[B,O]);let et=e=>"".concat(String(Math.floor(e/60)).padStart(2,"0"),":").concat(String(Math.floor(e%60)).padStart(2,"0")),[ea,en]=(0,i.useState)(!1),[es,el]=(0,i.useState)(""),[ei,er]=(0,i.useState)([]),[ec,eo]=(0,i.useState)(!1),ed=(0,i.useCallback)(async e=>{if(e){eo(!0);try{let t=await fetch("https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=".concat(encodeURIComponent(e),"&key=").concat(h.n)),a=await t.json();er(a.items||[])}catch(e){er([])}finally{eo(!1)}}},[]),em=async e=>{let t={id:e.id.videoId,artist:e.snippet.channelTitle,title:e.snippet.title};try{await m(t),await K()}catch(e){alert("加入失敗")}},eu=async e=>{try{await u(e),await K()}catch(e){alert("刪除失敗")}};return(0,n.jsxs)(I.Provider,{value:{list:O,index:B,shuffle:U,repeatMode:Y,next:L,prev:$,setShuffle:q,setRepeatMode:J,setIndex:H},children:[(0,n.jsx)(z,{}),(0,n.jsx)(y,{show:ea,onClose:()=>en(!1),searchInput:es,onSearchInputChange:el,onSearch:()=>{es?ed(es):er([])},isSearching:ec,searchResults:ei,playlist:O,onAddTrack:em,onDeleteTrack:eu,selectedIndex:B,onSelectTrack:F}),(0,n.jsxs)("main",{className:"container py-4",children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,n.jsx)("h1",{className:"h5 fw-bold mb-0",children:"YouTube Player"}),(0,n.jsx)("button",{className:"btn btn-sm btn-outline-primary ms-2",onClick:()=>en(!0),children:"編輯清單"})]}),O.length>0&&O[B]&&(0,n.jsx)(r.A,{ref:e,videoId:O[B].id,opts:{height:"0",width:"0",playerVars:{controls:0,autoplay:1}},onReady:G,onStateChange:e=>{var t,a;0!==O.length&&(0===e.data&&(Z("complete",null==(t=O[B])?void 0:t.id),"one"===Y?H(B):B<O.length-1?L():"all"===Y?H(0):V(!1)),1===e.data&&(Z("play",null==(a=O[B])?void 0:a.id),V(!0)),2===e.data&&V(!1))}}),(0,n.jsxs)("div",{className:"d-flex flex-column align-items-center mb-2",children:[O.length>0&&O[B]&&(0,n.jsx)("img",{src:"https://i.ytimg.com/vi/".concat(O[B].id,"/hqdefault.jpg"),className:"rounded-4 shadow w-75",alt:p}),(0,n.jsx)("p",{className:"fw-medium mt-2 text-center px-2",children:p||"載入中…"})]}),(0,n.jsxs)("div",{className:"d-flex align-items-center gap-2 mb-2",children:[(0,n.jsx)("span",{className:"small",style:{width:40},children:et(c)}),(0,n.jsx)("input",{type:"range",className:"form-range flex-grow-1",min:0,max:Number.isFinite(s)&&s>0?s:1,value:Number.isFinite(c)?c:0,onChange:t=>{var a;return null==(a=e.current)?void 0:a.internalPlayer.seekTo(Number(t.target.value),!0)}}),(0,n.jsx)("span",{className:"small",style:{width:40},children:et(s)})]}),(0,n.jsx)("div",{className:"border rounded p-3 mb-2",style:{maxHeight:150,overflowY:"auto",whiteSpace:"pre-wrap"},children:P}),(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-3",children:[(0,n.jsxs)("button",{className:"btn btn-circle btn-outline-secondary".concat("off"!==Y?" active":""),title:"all"===Y?"全部循環":"one"===Y?"單曲循環":"無循環",style:{width:40,height:40,borderRadius:"50%"},onClick:()=>{J(e=>"off"===e?"all":"all"===e?"one":"off")},children:["all"===Y&&(0,n.jsx)(g.A,{style:{color:"#0d6efd"}}),"one"===Y&&(0,n.jsxs)("span",{style:{position:"relative",display:"inline-block"},children:[(0,n.jsx)(g.A,{style:{color:"#0d6efd"}}),(0,n.jsx)("span",{style:{position:"absolute",top:"45%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7em",color:"#0d6efd",fontWeight:"bold"},children:"1"})]}),"off"===Y&&(0,n.jsx)(g.A,{style:{color:"#aaa"}})]}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-secondary px-2",style:{minWidth:40,height:44,borderRadius:"50%",padding:"0 6px",fontSize:"1rem"},onClick:()=>{var t;return null==(t=e.current)?void 0:t.internalPlayer.seekTo(Math.max(0,c-D),!0)},title:"快退".concat(D,"秒"),children:(0,n.jsxs)("div",{className:"d-flex align-items-center justify-content-center gap-1",style:{width:"100%"},children:[(0,n.jsx)(f.A,{style:{fontSize:"1.2em",flexShrink:0}}),(0,n.jsxs)("span",{className:"fw-bold text-muted",style:{fontSize:"1em",minWidth:"1.5em",textAlign:"center"},children:[D,"s"]})]})}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-primary",style:{width:40,height:40,borderRadius:"50%"},onClick:$,title:"上一首",children:(0,n.jsx)(j.A,{})}),(0,n.jsx)("button",{className:"btn btn-circle btn-primary",style:{width:50,height:50,borderRadius:"50%",fontSize:"1.5rem"},onClick:ee,title:_?"暫停":"播放",children:_?(0,n.jsx)(w.A,{}):(0,n.jsx)(v.A,{})}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-primary",style:{width:40,height:40,borderRadius:"50%"},onClick:L,title:"下一首",children:(0,n.jsx)(N.A,{})}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-secondary px-2",style:{minWidth:40,height:44,borderRadius:"50%",padding:"0 6px",fontSize:"1rem"},onClick:()=>{var t;return null==(t=e.current)?void 0:t.internalPlayer.seekTo(Math.min(s,c+D),!0)},title:"快進".concat(D,"秒"),children:(0,n.jsxs)("div",{className:"d-flex align-items-center justify-content-center gap-1",style:{width:"100%"},children:[(0,n.jsxs)("span",{className:"fw-bold text-muted",style:{fontSize:"1em",minWidth:"1.5em",textAlign:"center"},children:[D,"s"]}),(0,n.jsx)(k.A,{style:{fontSize:"1.2em",flexShrink:0}})]})}),(0,n.jsx)("button",{className:"btn btn-circle ".concat(U?"btn-info":"btn-outline-info"),style:{width:40,height:40,borderRadius:"50%"},onClick:()=>q(!U),title:"隨機播放",children:(0,n.jsx)(S.A,{})})]}),(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-3",children:[(0,n.jsx)("label",{className:"form-label mb-0 me-2",children:"快進/快退秒數"}),(0,n.jsx)("input",{type:"number",min:1,max:30,value:D,onChange:e=>M(Number(e.target.value)),style:{width:60},className:"form-control form-control-sm"}),(0,n.jsx)("span",{className:"small text-muted",children:"秒"})]}),(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-4",children:[(0,n.jsx)(C.A,{}),(0,n.jsx)("input",{type:"range",className:"form-range",style:{maxWidth:120},min:0,max:100,value:b,onChange:t=>{var a;let n=Number(t.target.value);x(n),null==(a=e.current)||a.internalPlayer.setVolume(n)}}),(0,n.jsx)(A.A,{})]})]})]})}},20625:(e,t,a)=>{"use strict";a.d(t,{n:()=>n});let n="AIzaSyBKbIMRi9OlFguXPliWtrltRvGJfTFUOy8"},56178:(e,t,a)=>{Promise.resolve().then(a.bind(a,723))}},e=>{var t=t=>e(e.s=t);e.O(0,[740,464,646,441,684,358],()=>t(56178)),_N_E=e.O()}]);