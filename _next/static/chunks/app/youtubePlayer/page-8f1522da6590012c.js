(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[861],{7305:(e,t,a)=>{"use strict";a.d(t,{default:()=>R});var n=a(95155),s=a(11518),l=a.n(s),i=a(12115),r=a(66444);a(15685);var c=a(23464);let o="https://script.google.com/macros/s/AKfycbzsuuu3BCArDw4Z_YjetPxEocch_b6-wBFNQrBxgR3gQACASyqxZ1_q41yXytgO-1VS/exec",d=async()=>{let e=await c.A.get(o);if(!Array.isArray(e.data))throw Error("Unexpected response format");return e.data},m=async e=>(await c.A.post(o,{action:"create",...e},{headers:{"Content-Type":"text/plain"},withCredentials:!1})).data,u=async e=>(await c.A.post(o,{action:"delete",id:e},{headers:{"Content-Type":"text/plain"},withCredentials:!1})).data,h=e=>{let{value:t,onChange:a,onSearch:s,isSearching:l}=e;return(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{className:"form-label",children:"搜尋 YouTube 標題"}),(0,n.jsxs)("div",{className:"input-group",children:[(0,n.jsx)("input",{type:"text",className:"form-control",value:t,onChange:e=>a(e.target.value),placeholder:"請輸入影片標題"}),(0,n.jsx)("button",{className:"btn btn-primary",type:"button",onClick:s,disabled:l,children:l?"查詢中…":"查詢"})]}),l&&(0,n.jsx)("div",{className:"small text-muted",children:"搜尋中…"})]})},b=e=>{let{results:t,playlist:a,onAddTrack:s}=e;return t.length>0?(0,n.jsx)("ul",{className:"list-group mt-1",children:t.map(e=>{let t=a.some(t=>t.id===e.id.videoId);return(0,n.jsxs)("li",{className:"list-group-item d-flex align-items-center",children:[(0,n.jsx)("img",{src:e.snippet.thumbnails.default.url,alt:"thumb",className:"me-2"}),(0,n.jsx)("span",{className:"flex-grow-1",children:e.snippet.title}),(0,n.jsx)("button",{className:"btn btn-sm btn-success",disabled:t,onClick:()=>s(e),children:t?"已存在":"加入"})]},e.id.videoId)})}):null},x=e=>{let{playlist:t,selectedIndex:a,onDeleteTrack:s,onSelectTrack:l}=e;return(0,n.jsx)("ul",{className:"list-group",children:t.map((e,t)=>(0,n.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-center"+(t===a?" active":""),onClick:()=>l(t),style:{cursor:"pointer"},children:[(0,n.jsx)("span",{children:e.title}),(0,n.jsx)("span",{className:"text-muted ms-2",children:e.artist}),(0,n.jsx)("button",{className:"btn btn-sm btn-danger ms-2",onClick:t=>{t.stopPropagation(),s(e.id)},children:"刪除"})]},e.id))})},p=e=>{let{show:t,onClose:a,searchInput:s,onSearchInputChange:l,onSearch:i,isSearching:r,searchResults:c,playlist:o,onAddTrack:d,onDeleteTrack:m,selectedIndex:u,onSelectTrack:p}=e;return t?(0,n.jsx)("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,children:(0,n.jsx)("div",{className:"modal-dialog",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h5",{className:"modal-title",children:"編輯播放清單"}),(0,n.jsx)("button",{type:"button",className:"btn-close",onClick:a})]}),(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsx)(h,{value:s,onChange:l,onSearch:i,isSearching:r}),(0,n.jsx)(b,{results:c,playlist:o,onAddTrack:d}),(0,n.jsx)("hr",{}),(0,n.jsx)("label",{className:"form-label",children:"目前播放清單"}),(0,n.jsx)(x,{playlist:o,selectedIndex:u,onDeleteTrack:m,onSelectTrack:p})]}),(0,n.jsx)("div",{className:"modal-footer",children:(0,n.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"關閉"})})]})})}):null};var y=a(16660),g=a(9932),f=a(62012),j=a(78327),w=a(81265),v=a(18725),N=a(41173),k=a(75460),S=a(21502),C=a(94505);let A=()=>(0,n.jsx)(l(),{id:"e7cba49d1805e6f7",children:".btn-circle{display:-webkit-box!important;display:-webkit-flex!important;display:-moz-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:0 8px!important;height:44px;min-width:0;width:auto;-webkit-border-radius:50%!important;-moz-border-radius:50%!important;border-radius:50%!important;font-size:1.35rem;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition:background.2s;-moz-transition:background.2s;-o-transition:background.2s;transition:background.2s}.btn-circle svg{display:block;margin:0;font-size:1.35rem}"}),z=(0,i.createContext)(null);async function I(e,t){try{let a=await fetch("https://api.lyrics.ovh/v1/".concat(encodeURIComponent(e),"/").concat(encodeURIComponent(t)));if(!a.ok)return"";return(await a.json()).lyrics||""}catch(e){return""}}function R(){let e=(0,i.useRef)(null),[t,a]=(0,i.useState)(!1),[s,l]=(0,i.useState)(0),[c,o]=(0,i.useState)(0),[h,b]=(0,i.useState)(50),[x,R]=(0,i.useState)(""),[T,P]=(0,i.useState)("載入中…"),[E,_]=(0,i.useState)(!1),[V,D]=(0,i.useState)(5),[M,O]=(0,i.useState)([]),[W,B]=(0,i.useState)(0),[F,U]=(0,i.useState)(!1),[q,Y]=(0,i.useState)("off"),J=(0,i.useCallback)(async()=>{try{let e=await d();O(e)}catch(e){console.error("取得清單失敗",e)}},[]);(0,i.useEffect)(()=>{J()},[J]);let[K,Q]=(0,i.useState)(!1);(0,i.useEffect)(()=>{!K&&M.length>0&&0===W&&(G(0),Q(!0))},[K,M,W]);let X=(e,t)=>{fetch("/api/scrobble",{method:"POST",body:JSON.stringify({event:e,vid:t,ts:Date.now()})}).catch(()=>{})},Z=async e=>{let t=e.target;b(await t.getVolume()),R((await t.getVideoData()).title),a(!0),l(await t.getDuration())},G=async t=>{var a;if(0===M.length||!M[t])return;B(t),P("載入中…"),null==(a=e.current)||a.internalPlayer.loadVideoById(M[t].id);let n=M[t];n&&n.artist&&n.title?P(await I(n.artist,n.title)||"（查無歌詞）"):P("（查無歌詞）")},H=(0,i.useCallback)(()=>{B(e=>{if(0===M.length)return e;if("one"===q)return G(e),e;let t=F?Math.floor(Math.random()*M.length):e+1<M.length?e+1:"all"===q?0:e;return t!==e&&M[e]&&(X("skip",M[e].id),G(t)),t})},[M,F,q]),L=()=>{0!==M.length&&G(0===W?M.length-1:W-1)},$=async()=>{var t;let a=null==(t=e.current)?void 0:t.internalPlayer;a&&(1===await a.getPlayerState()?a.pauseVideo():a.playVideo())};(0,i.useEffect)(()=>{if(!t)return;let a=setInterval(async()=>{var t;let a=null==(t=e.current)?void 0:t.internalPlayer;a&&(o(await a.getCurrentTime()),l(await a.getDuration()))},500);return()=>clearInterval(a)},[t]),(0,i.useEffect)(()=>{(async()=>{P("載入中…");let e=M[W];e&&e.artist&&e.title?P(await I(e.artist,e.title)||"（查無歌詞）"):P("（查無歌詞）")})()},[W,M]);let ee=e=>"".concat(String(Math.floor(e/60)).padStart(2,"0"),":").concat(String(Math.floor(e%60)).padStart(2,"0")),[et,ea]=(0,i.useState)(!1),[en,es]=(0,i.useState)(""),[el,ei]=(0,i.useState)([]),[er,ec]=(0,i.useState)(!1),eo=(0,i.useCallback)(async e=>{if(e){ec(!0);try{let t=await fetch("https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=".concat(encodeURIComponent(e),"&key=").concat("AIzaSyBKbIMRi9OlFguXPliWtrltRvGJfTFUOy8")),a=await t.json();ei(a.items||[])}catch(e){ei([])}finally{ec(!1)}}},[]),ed=async e=>{let t={id:e.id.videoId,artist:e.snippet.channelTitle,title:e.snippet.title};try{await m(t),await J()}catch(e){alert("加入失敗")}},em=async e=>{try{await u(e),await J()}catch(e){alert("刪除失敗")}};return(0,n.jsxs)(z.Provider,{value:{list:M,index:W,shuffle:F,repeatMode:q,next:H,prev:L,setShuffle:U,setRepeatMode:Y,setIndex:G},children:[(0,n.jsx)(A,{}),(0,n.jsx)(p,{show:et,onClose:()=>ea(!1),searchInput:en,onSearchInputChange:es,onSearch:()=>{en?eo(en):ei([])},isSearching:er,searchResults:el,playlist:M,onAddTrack:ed,onDeleteTrack:em,selectedIndex:W,onSelectTrack:B}),(0,n.jsxs)("main",{className:"container py-4",children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,n.jsx)("h1",{className:"h5 fw-bold mb-0",children:"YouTube Player"}),(0,n.jsx)("button",{className:"btn btn-sm btn-outline-primary ms-2",onClick:()=>ea(!0),children:"編輯清單"})]}),M.length>0&&M[W]&&(0,n.jsx)(r.A,{ref:e,videoId:M[W].id,opts:{height:"0",width:"0",playerVars:{controls:0,autoplay:1}},onReady:Z,onStateChange:e=>{var t,a;0!==M.length&&(0===e.data&&(X("complete",null==(t=M[W])?void 0:t.id),"one"===q?G(W):W<M.length-1?H():"all"===q?G(0):_(!1)),1===e.data&&(X("play",null==(a=M[W])?void 0:a.id),_(!0)),2===e.data&&_(!1))}}),(0,n.jsxs)("div",{className:"d-flex flex-column align-items-center mb-2",children:[M.length>0&&M[W]&&(0,n.jsx)("img",{src:"https://i.ytimg.com/vi/".concat(M[W].id,"/hqdefault.jpg"),className:"rounded-4 shadow w-75",alt:x}),(0,n.jsx)("p",{className:"fw-medium mt-2 text-center px-2",children:x||"載入中…"})]}),(0,n.jsxs)("div",{className:"d-flex align-items-center gap-2 mb-2",children:[(0,n.jsx)("span",{className:"small",style:{width:40},children:ee(c)}),(0,n.jsx)("input",{type:"range",className:"form-range flex-grow-1",min:0,max:Number.isFinite(s)&&s>0?s:1,value:Number.isFinite(c)?c:0,onChange:t=>{var a;return null==(a=e.current)?void 0:a.internalPlayer.seekTo(Number(t.target.value),!0)}}),(0,n.jsx)("span",{className:"small",style:{width:40},children:ee(s)})]}),(0,n.jsx)("div",{className:"border rounded p-3 mb-2",style:{maxHeight:150,overflowY:"auto",whiteSpace:"pre-wrap"},children:T}),(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-3",children:[(0,n.jsxs)("button",{className:"btn btn-circle btn-outline-secondary".concat("off"!==q?" active":""),title:"all"===q?"全部循環":"one"===q?"單曲循環":"無循環",style:{width:40,height:40,borderRadius:"50%"},onClick:()=>{Y(e=>"off"===e?"all":"all"===e?"one":"off")},children:["all"===q&&(0,n.jsx)(y.A,{style:{color:"#0d6efd"}}),"one"===q&&(0,n.jsxs)("span",{style:{position:"relative",display:"inline-block"},children:[(0,n.jsx)(y.A,{style:{color:"#0d6efd"}}),(0,n.jsx)("span",{style:{position:"absolute",top:"45%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.7em",color:"#0d6efd",fontWeight:"bold"},children:"1"})]}),"off"===q&&(0,n.jsx)(y.A,{style:{color:"#aaa"}})]}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-secondary px-2",style:{minWidth:40,height:44,borderRadius:"50%",padding:"0 6px",fontSize:"1rem"},onClick:()=>{var t;return null==(t=e.current)?void 0:t.internalPlayer.seekTo(Math.max(0,c-V),!0)},title:"快退".concat(V,"秒"),children:(0,n.jsxs)("div",{className:"d-flex align-items-center justify-content-center gap-1",style:{width:"100%"},children:[(0,n.jsx)(g.A,{style:{fontSize:"1.2em",flexShrink:0}}),(0,n.jsxs)("span",{className:"fw-bold text-muted",style:{fontSize:"1em",minWidth:"1.5em",textAlign:"center"},children:[V,"s"]})]})}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-primary",style:{width:40,height:40,borderRadius:"50%"},onClick:L,title:"上一首",children:(0,n.jsx)(f.A,{})}),(0,n.jsx)("button",{className:"btn btn-circle btn-primary",style:{width:50,height:50,borderRadius:"50%",fontSize:"1.5rem"},onClick:$,title:E?"暫停":"播放",children:E?(0,n.jsx)(j.A,{}):(0,n.jsx)(w.A,{})}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-primary",style:{width:40,height:40,borderRadius:"50%"},onClick:H,title:"下一首",children:(0,n.jsx)(v.A,{})}),(0,n.jsx)("button",{className:"btn btn-circle btn-outline-secondary px-2",style:{minWidth:40,height:44,borderRadius:"50%",padding:"0 6px",fontSize:"1rem"},onClick:()=>{var t;return null==(t=e.current)?void 0:t.internalPlayer.seekTo(Math.min(s,c+V),!0)},title:"快進".concat(V,"秒"),children:(0,n.jsxs)("div",{className:"d-flex align-items-center justify-content-center gap-1",style:{width:"100%"},children:[(0,n.jsxs)("span",{className:"fw-bold text-muted",style:{fontSize:"1em",minWidth:"1.5em",textAlign:"center"},children:[V,"s"]}),(0,n.jsx)(N.A,{style:{fontSize:"1.2em",flexShrink:0}})]})}),(0,n.jsx)("button",{className:"btn btn-circle ".concat(F?"btn-info":"btn-outline-info"),style:{width:40,height:40,borderRadius:"50%"},onClick:()=>U(!F),title:"隨機播放",children:(0,n.jsx)(k.A,{})})]}),(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-3",children:[(0,n.jsx)("label",{className:"form-label mb-0 me-2",children:"快進/快退秒數"}),(0,n.jsx)("input",{type:"number",min:1,max:30,value:V,onChange:e=>D(Number(e.target.value)),style:{width:60},className:"form-control form-control-sm"}),(0,n.jsx)("span",{className:"small text-muted",children:"秒"})]}),(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-4",children:[(0,n.jsx)(S.A,{}),(0,n.jsx)("input",{type:"range",className:"form-range",style:{maxWidth:120},min:0,max:100,value:h,onChange:t=>{var a;let n=Number(t.target.value);b(n),null==(a=e.current)||a.internalPlayer.setVolume(n)}}),(0,n.jsx)(C.A,{})]})]})]})}},95829:(e,t,a)=>{Promise.resolve().then(a.bind(a,7305))}},e=>{var t=t=>e(e.s=t);e.O(0,[740,464,646,441,684,358],()=>t(95829)),_N_E=e.O()}]);