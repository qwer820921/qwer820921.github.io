(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{51997:(e,t,n)=>{"use strict";n.d(t,{default:()=>m});var l=n(95155),i=n(12115);n(95185);let r={primary:"btn btn-primary",secondary:"btn btn-secondary",danger:"btn btn-danger",success:"btn btn-success",info:"btn btn-info",warning:"btn btn-warning"},s=(0,i.memo)(e=>{let{onClick:t=()=>{},text:n="",type:i="button",style:s="primary",disabled:a=!1,styleClass:c}=e;return(0,l.jsx)("button",{type:i,className:r[s],onClick:t,disabled:a,style:c,children:n})});n(84925);let a=e=>{let{children:t}=e;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"newBackdrop"}),(0,l.jsx)("div",{className:"newModal",children:t})]})},c=e=>{let{isOpen:t,onConfirm:n,confirmText:i="確定",onClose:r,closeText:c="返回",buttonType:o="button",children:d,hasWidth:h=!1,isShowClose:u=!0,isConfirmDisabled:f=!1}=e;return t?(0,l.jsx)(a,{children:(0,l.jsxs)("div",{className:"modalContent ".concat(h?"w-75":""),children:[d,(0,l.jsxs)("div",{className:"modalContainer",children:[(0,l.jsx)(s,{text:i,style:"primary",onClick:n,type:o,disabled:f}),u&&(0,l.jsx)(s,{text:c,style:"secondary",onClick:r})]})]})}):null},o=e=>{let{isOpen:t,onClose:n,onConfirm:r,pixelSizeInput:s}=e,[a,o]=(0,i.useState)(null),[d,h]=(0,i.useState)(null),[u,f]=(0,i.useState)({x:0,y:0}),[m,x]=(0,i.useState)(!1),[g,p]=(0,i.useState)(null),[b,v]=(0,i.useState)(100),[j,w]=(0,i.useState)(20),y=j/100*b,M=(0,i.useRef)(null),C=(0,i.useRef)(null),N=(0,i.useRef)(null),S=(0,i.useRef)(null),k=(0,i.useRef)(null),R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=N.current;if(!t||!C.current)return;let n=t.naturalWidth,l=t.naturalHeight,i=t.clientWidth,r=t.clientHeight,a=n/i,c=e.x*a,o=e.y*(l/r),d=y*a,f=document.createElement("canvas"),m=f.getContext("2d");f.width=s,f.height=s,null==m||m.drawImage(t,c,o,d,d,0,0,s,s),h(f.toDataURL())};return(0,i.useEffect)(()=>{g?v(Math.min(g.width,g.height)):v(100)},[g]),(0,i.useEffect)(()=>{a&&(x(!0),setTimeout(()=>{R(u)},0),x(!1))},[j]),(0,l.jsxs)(c,{isOpen:t,onConfirm:()=>{let e=N.current,t=C.current;if(!e||!t)return;let n=t.getContext("2d");if(!n)return;let l=e.naturalWidth/e.clientWidth,i=e.naturalHeight/e.clientHeight,a=u.x*l,c=u.y*i,o=y*l;t.width=s,t.height=s,n.clearRect(0,0,t.width,t.height),n.drawImage(e,a,c,o,o,0,0,t.width,t.height);let d=n.getImageData(0,0,t.width,t.height).data,h=new Map;for(let e=0;e<d.length;e+=4){let t=d[e],n=d[e+1],l=d[e+2],i=d[e+3];if(255===t&&255===n&&255===l&&255===i)continue;let r="#".concat(t.toString(16).padStart(2,"0")).concat(n.toString(16).padStart(2,"0")).concat(l.toString(16).padStart(2,"0")),s=e/4;h.set(s,r)}r(h)},onClose:()=>{o(null),h(null),n()},isShowClose:!0,hasWidth:!0,children:[(0,l.jsxs)("div",{className:"p-3 bg-info bg-opacity-10 border border-info rounded",children:[(0,l.jsx)("div",{className:"text-start",children:(0,l.jsx)("label",{className:"form-label",children:"上傳檔案"})}),(0,l.jsx)("input",{id:"file",type:"file",ref:M,accept:"image/*",onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];if(n&&n.type.startsWith("image/")){let e=new Image;e.onload=()=>{var t,n;let l=e.naturalWidth,i=e.naturalHeight,r=(null==(t=S.current)?void 0:t.getBoundingClientRect().width)||window.innerWidth,s=Math.min((r-40)/l,(((null==(n=S.current)?void 0:n.getBoundingClientRect().height)||window.innerHeight)-80)/i,1);p({width:Math.round(l*s),height:Math.round(i*s)})},e.src=URL.createObjectURL(n),o(n),M.current&&(M.current.value="")}else alert("請上傳有效的圖片檔案（例如 PNG、JPG）")},className:"form-control",style:{display:"block"}})]}),(0,l.jsxs)("div",{ref:S,style:{position:"relative",width:g?"".concat(Math.min(g.width,400),"px"):"auto",height:g?"".concat(Math.min(g.height,400),"px"):"auto",overflow:"hidden"},onMouseDown:()=>x(!0),onMouseMove:e=>{if(!m||!S.current)return;let t=S.current.getBoundingClientRect(),n=j/100*b,l=n/2,i=e.clientX-t.left-l,r=e.clientY-t.top-l,s={x:Math.max(0,Math.min(i,t.width-n)),y:Math.max(0,Math.min(r,t.height-n))};f(s),R(s)},onMouseUp:()=>x(!1),onTouchStart:e=>{e.preventDefault(),x(!0)},onTouchMove:e=>{if(!m||!S.current)return;let t=S.current.getBoundingClientRect(),n=j/100*b,l=n/2,i=e.touches[0],r=i.clientX-t.left-l,s=i.clientY-t.top-l,a={x:Math.max(0,Math.min(r,t.width-n)),y:Math.max(0,Math.min(s,t.height-n))};f(a),R(a)},onTouchEnd:()=>{x(!1)},children:[a&&(0,l.jsx)("img",{ref:N,src:URL.createObjectURL(a),alt:"preview",style:{display:"block",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",margin:"0 auto"}}),a&&(0,l.jsx)("div",{style:{position:"absolute",top:u.y,left:u.x,width:y,height:y,border:"2px dashed red",boxSizing:"border-box",pointerEvents:"none",zIndex:10}}),a&&(0,l.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"transparent",zIndex:5}}),(0,l.jsx)("canvas",{ref:C,style:{display:"none"}})]}),a&&(0,l.jsx)("div",{ref:k,className:"progress mt-3",style:{width:"100%",height:"20px",cursor:"pointer"},onClick:e=>{if(!k.current)return;let t=k.current.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*100;w(Math.round(n=Math.max(0,Math.min(100,n))))},children:(0,l.jsxs)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(j,"%")},"aria-valuenow":j,"aria-valuemin":0,"aria-valuemax":100,children:[j,"%"]})}),d&&(0,l.jsxs)("div",{style:{width:"100%",height:"100%",marginTop:"20px"},children:[(0,l.jsx)("h4",{children:"即時預覽"}),(0,l.jsx)("img",{src:d,alt:"crop-preview",style:{width:"100%",height:"100%",objectFit:"contain",margin:"0 auto",imageRendering:"pixelated",border:"1px solid #ccc"}})]})]})},d=e=>{let{canvasList:t,pixelSizeInput:n}=e,[r,s]=(0,i.useState)(0),[a,c]=(0,i.useState)(!0),o=(0,i.useRef)(null),d=120/n;return(0,i.useEffect)(()=>{if(!a)return;let e=setInterval(()=>{s(e=>(e+1)%t.length)},500);return()=>clearInterval(e)},[t.length,a]),(0,i.useEffect)(()=>{let e=o.current;if(!e)return;let l=e.getContext("2d");if(!l)return;let i=t[r];if(i)for(let[t,r]of(l.clearRect(0,0,e.width,e.height),i.entries())){let e=t%n*d,i=Math.floor(t/n)*d;l.fillStyle=r,l.fillRect(e,i,d,d)}},[t,r,n]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h5",{children:"預覽"}),(0,l.jsx)("canvas",{ref:o,width:120,height:120,style:{border:"1px solid black",backgroundColor:"#fff"}}),(0,l.jsx)("button",{className:"btn btn-primary mt-2",onClick:()=>c(!a),children:a?"暫停":"播放"})]})};var h=n(70808);let u=e=>{let{value:t,onChange:n}=e;return(0,l.jsxs)("div",{className:"d-flex flex-column align-items-center",children:[(0,l.jsx)("h5",{children:"顏色選擇"}),(0,l.jsx)(h.xk,{color:t,onChange:e=>{n(e.hex)}})]})},f=e=>{let{canvasRef:t,handleCanvasClick:n,handleMouseDown:i,handleMouseMove:r,handleMouseUp:s,handleTouchStart:a,handleTouchMove:c,handleTouchEnd:o}=e;return(0,l.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,l.jsx)("canvas",{ref:t,width:400,height:400,style:{border:"1px solid #000",cursor:"pointer"},onClick:n,onMouseDown:i,onMouseMove:r,onMouseUp:s,onTouchStart:a,onTouchMove:c,onTouchEnd:o})})},m=()=>{let[e,t]=(0,i.useState)("#000000"),[n,r]=(0,i.useState)(100),[s,a]=(0,i.useState)(100),c=400/n,[h,m]=(0,i.useState)(!1),[x,g]=(0,i.useState)([new Map]),[p,b]=(0,i.useState)(0),[v,j]=(0,i.useState)(null),[w,y]=(0,i.useState)(!1),[M,C]=(0,i.useState)(new Map),N=(0,i.useRef)(null),S=function(){let e=(0,i.useRef)([]);return{refs:e.current,get:t=>{var n;return null!=(n=e.current[t])?n:null},set:(t,n)=>{e.current[t]=n},insert:t=>{e.current.splice(t,0,null)},remove:t=>{e.current.splice(t,1)},reset:t=>{e.current=Array(t).fill(null)},move:(t,n)=>{if(t===n||t<0||n<0||t>=e.current.length||n>=e.current.length)return;let[l]=e.current.splice(t,1);e.current.splice(n,0,l)}}}(),[k,R]=(0,i.useState)(!1),E=()=>{g([new Map]),b(0),S.reset(x.length),I(new Map)},I=e=>{let t=N.current;if(!t)return;let l=t.getContext("2d");if(l)for(let[i,r]of(l.clearRect(0,0,t.width,t.height),e.entries())){let e=i%n*c,t=Math.floor(i/n)*c;l.fillStyle=r,l.fillRect(e,t,c,c),l.strokeStyle="#ffffff",l.strokeRect(e,t,c,c)}},T=e=>{let t=N.current;if(!t)return;let l=t.getContext("2d");if(l&&0!==e.size)for(let[t,i]of e.entries()){let e=t%n*c,r=Math.floor(t/n)*c;l.clearRect(e,r,c,c),l.fillStyle=i,l.fillRect(e,r,c,c),l.strokeStyle="#ffffff",l.strokeRect(e,r,c,c)}},z=()=>{requestAnimationFrame(()=>{x.forEach((e,t)=>{let l=S.get(t);if(!l)return;let i=l.getContext("2d");if(!i)return;let r=85/n;for(let[t,s]of(i.clearRect(0,0,l.width,l.height),e.entries())){let e=t%n*r,l=Math.floor(t/n)*r;i.fillStyle=s,i.fillRect(e,l,r,r)}})})};(0,i.useEffect)(()=>{E()},[n]),(0,i.useEffect)(()=>{z()},[x]);let W=(t,l)=>{let i=l*n+t,r=[...x],s=new Map(r[p]);s.get(i)!==e&&(s.set(i,e),r[p]=s,w?C(t=>new Map(t).set(i,e)):g(r),T(new Map().set(i,e)))},D=(e,t)=>{let l=N.current;if(!l||c<=0)return null;let i=l.getBoundingClientRect(),r=Math.floor((e-i.left)/c),s=Math.floor((t-i.top)/c);return r>=0&&r<n&&s>=0&&s<n?{x:r,y:s}:null},U=e=>{let t=D(e.clientX,e.clientY);t&&W(t.x,t.y)},B=e=>{if(0===e.touches.length)return;e.preventDefault();let t=D(e.touches[0].clientX,e.touches[0].clientY);t&&W(t.x,t.y)},F=()=>{if(M.size>0){let e=[...x],t=new Map(e[p]);for(let[e,n]of M.entries())t.set(e,n);e[p]=t,g(e),C(new Map)}},H=e=>{M.size>0&&F(),b(e),x[e]?I(x[e]):console.warn("Invalid canvas index: ".concat(e))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"container-fluid p-3",children:[(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{style:{position:"absolute",width:1,height:1,overflow:"hidden",opacity:0},children:[(0,l.jsx)("h1",{children:"微動畫展示"}),(0,l.jsx)("p",{children:"動手畫畫看吧..."})]})}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsx)("div",{className:"col-md-3 col-sm-12 d-flex flex-column align-items-center my-3",children:(0,l.jsx)(u,{value:e,onChange:t})}),(0,l.jsx)("div",{className:"col-md-6 col-sm-12 d-flex justify-content-center my-3",children:(0,l.jsxs)("div",{className:"row d-flex",children:[(0,l.jsx)("div",{className:"col-12 my-2 d-flex justify-content-center align-items-center",children:(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>R(!0),children:"匯入圖片"})}),(0,l.jsx)("div",{className:"col-12 my-2",children:(0,l.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-3",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:E,children:"重置"}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>{g([...x,new Map]),b(x.length),S.insert(x.length),I(new Map)},children:"新增"}),(0,l.jsx)("button",{className:"btn btn-danger",onClick:()=>{if(x.length>1){let e=null==x?void 0:x.filter((e,t)=>t!==p);g(e);let t=Math.max(0,p-1);b(t),S.remove(p),I(e[t])}},disabled:x.length<=1,children:"刪除"}),(0,l.jsx)("button",{className:"btn btn-warning",onClick:()=>{j(new Map(x[p]))},children:"複製"}),(0,l.jsx)("button",{className:"btn btn-success",onClick:()=>{if(v){let e=[...x];e[p]=new Map(v),g(e),I(e[p])}},disabled:!v,children:"貼上"}),(0,l.jsxs)("div",{className:"position-relative",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-primary dropdown-toggle",onClick:()=>{a(n),m(!h)},children:"像素"}),h&&(0,l.jsxs)("form",{className:"p-3 shadow border position-absolute bg-white",style:{zIndex:1e3,width:"200px",top:"100%",left:0},onSubmit:e=>{e.preventDefault(),s<=0||s>100?alert("請輸入有效的數字（1 - 100）"):(r(s),m(!1))},children:[(0,l.jsxs)("div",{className:"mb-3 text-start",children:[(0,l.jsx)("label",{className:"form-check-label",htmlFor:"dropdownCheck2",children:"像素程度"}),(0,l.jsx)("input",{type:"number",className:"form-control",id:"dropdownCheck2",value:s,onChange:e=>a(parseInt(e.target.value,10)||1)})]}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary",children:"確定"})]})]})]})}),(0,l.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,l.jsx)(f,{canvasRef:N,handleCanvasClick:U,handleMouseDown:e=>{y(!0),U(e)},handleMouseMove:e=>{w&&U(e)},handleMouseUp:()=>{y(!1),F()},handleTouchStart:e=>{y(!0),B(e)},handleTouchMove:e=>{w&&B(e)},handleTouchEnd:()=>{y(!1),F()}})}),(0,l.jsx)("div",{className:"row d-flex justify-content-center align-items-center mt-3",children:null==x?void 0:x.map((e,t)=>(0,l.jsx)("div",{className:"col-auto",style:{border:p===t?"3px solid #007bff":"1px solid #ccc",padding:"2px",width:"auto",height:"auto",backgroundColor:"#ffffff",cursor:"pointer",display:"grid"},onClick:()=>H(t),children:(0,l.jsx)("canvas",{ref:e=>S.set(t,e),width:85,height:85,style:{display:"block"}})},t))})]})}),(0,l.jsx)("div",{className:"col-md-3 col-sm-12 d-flex flex-column align-items-center my-3",children:(0,l.jsx)(d,{canvasList:x,pixelSizeInput:n})})]})]}),(0,l.jsx)(o,{isOpen:k,onClose:()=>R(!1),onConfirm:e=>{g(t=>[...t,e]),b(x.length),S.insert(x.length),R(!1),I(e)},pixelSizeInput:n})]})}},64894:(e,t,n)=>{Promise.resolve().then(n.bind(n,51997))},84925:()=>{},95185:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[151,808,441,684,358],()=>t(64894)),_N_E=e.O()}]);