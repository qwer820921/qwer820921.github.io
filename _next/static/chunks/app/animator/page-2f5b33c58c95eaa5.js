(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{9134:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var l=n(95155);n(12115);var r=n(70808);let i=e=>{let{value:t,onChange:n}=e;return(0,l.jsxs)("div",{className:"d-flex flex-column align-items-center",children:[(0,l.jsx)("h5",{children:"顏色選擇"}),(0,l.jsx)(r.xk,{color:t,onChange:e=>{n(e.hex)}})]})}},33979:(e,t,n)=>{"use strict";n.d(t,{default:()=>f});var l=n(95155),r=n(12115);n(95185);let i={primary:"btn btn-primary",secondary:"btn btn-secondary",danger:"btn btn-danger",success:"btn btn-success",info:"btn btn-info",warning:"btn btn-warning"},s=(0,r.memo)(e=>{let{onClick:t=()=>{},text:n="",type:r="button",style:s="primary",disabled:a=!1,styleClass:o}=e;return(0,l.jsx)("button",{type:r,className:i[s],onClick:t,disabled:a,style:o,children:n})});n(84925);let a=e=>{let{children:t}=e;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"newBackdrop"}),(0,l.jsx)("div",{className:"newModal",children:t})]})},o=e=>{let{isOpen:t,onConfirm:n,confirmText:r="確定",onClose:i,closeText:o="返回",buttonType:c="button",children:d,hasWidth:u=!1,isShowClose:h=!0,isConfirmDisabled:f=!1}=e;return t?(0,l.jsx)(a,{children:(0,l.jsxs)("div",{className:"modalContent ".concat(u?"w-75":""),children:[d,(0,l.jsxs)("div",{className:"modalContainer",children:[(0,l.jsx)(s,{text:r,style:"primary",onClick:n,type:c,disabled:f}),h&&(0,l.jsx)(s,{text:o,style:"secondary",onClick:i})]})]})}):null},c=e=>{let{isOpen:t,onClose:n,onConfirm:i,pixelSizeInput:s}=e,[a,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[h,f]=(0,r.useState)({x:0,y:0}),[m,p]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),[b,v]=(0,r.useState)(100),[y,j]=(0,r.useState)(20),w=y/100*b,M=(0,r.useRef)(null),C=(0,r.useRef)(null),N=(0,r.useRef)(null),S=(0,r.useRef)(null),k=(0,r.useRef)(null),R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=N.current;if(!t||!C.current)return;let n=t.naturalWidth,l=t.naturalHeight,r=t.clientWidth,i=t.clientHeight,a=n/r,o=e.x*a,c=e.y*(l/i),d=w*a,f=document.createElement("canvas"),m=f.getContext("2d");f.width=s,f.height=s,null==m||m.drawImage(t,o,c,d,d,0,0,s,s),u(f.toDataURL())};return(0,r.useEffect)(()=>{x?v(Math.min(x.width,x.height)):v(100)},[x]),(0,r.useEffect)(()=>{a&&(p(!0),setTimeout(()=>{R(h)},0),p(!1))},[y]),(0,l.jsxs)(o,{isOpen:t,onConfirm:()=>{let e=N.current,t=C.current;if(!e||!t)return;let n=t.getContext("2d");if(!n)return;let l=e.naturalWidth/e.clientWidth,r=e.naturalHeight/e.clientHeight,a=h.x*l,o=h.y*r,c=w*l;t.width=s,t.height=s,n.clearRect(0,0,t.width,t.height),n.drawImage(e,a,o,c,c,0,0,t.width,t.height);let d=n.getImageData(0,0,t.width,t.height).data,u=new Map;for(let e=0;e<d.length;e+=4){let t=d[e],n=d[e+1],l=d[e+2],r=d[e+3];if(255===t&&255===n&&255===l&&255===r)continue;let i="#".concat(t.toString(16).padStart(2,"0")).concat(n.toString(16).padStart(2,"0")).concat(l.toString(16).padStart(2,"0")),s=e/4;u.set(s,i)}i(u)},onClose:()=>{c(null),u(null),n()},isShowClose:!0,hasWidth:!0,children:[(0,l.jsxs)("div",{className:"p-3 bg-info bg-opacity-10 border border-info rounded",children:[(0,l.jsx)("div",{className:"text-start",children:(0,l.jsx)("label",{className:"form-label",children:"上傳檔案"})}),(0,l.jsx)("input",{id:"file",type:"file",ref:M,accept:"image/*",onChange:e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];if(n&&n.type.startsWith("image/")){let e=new Image;e.onload=()=>{var t,n;let l=e.naturalWidth,r=e.naturalHeight,i=(null==(t=S.current)?void 0:t.getBoundingClientRect().width)||window.innerWidth,s=Math.min((i-40)/l,(((null==(n=S.current)?void 0:n.getBoundingClientRect().height)||window.innerHeight)-80)/r,1);g({width:Math.round(l*s),height:Math.round(r*s)})},e.src=URL.createObjectURL(n),c(n),M.current&&(M.current.value="")}else alert("請上傳有效的圖片檔案（例如 PNG、JPG）")},className:"form-control",style:{display:"block"}})]}),(0,l.jsxs)("div",{ref:S,style:{position:"relative",width:x?"".concat(Math.min(x.width,400),"px"):"auto",height:x?"".concat(Math.min(x.height,400),"px"):"auto",overflow:"hidden"},onMouseDown:()=>p(!0),onMouseMove:e=>{if(!m||!S.current)return;let t=S.current.getBoundingClientRect(),n=y/100*b,l=n/2,r=e.clientX-t.left-l,i=e.clientY-t.top-l,s={x:Math.max(0,Math.min(r,t.width-n)),y:Math.max(0,Math.min(i,t.height-n))};f(s),R(s)},onMouseUp:()=>p(!1),onTouchStart:e=>{e.preventDefault(),p(!0)},onTouchMove:e=>{if(!m||!S.current)return;let t=S.current.getBoundingClientRect(),n=y/100*b,l=n/2,r=e.touches[0],i=r.clientX-t.left-l,s=r.clientY-t.top-l,a={x:Math.max(0,Math.min(i,t.width-n)),y:Math.max(0,Math.min(s,t.height-n))};f(a),R(a)},onTouchEnd:()=>{p(!1)},children:[a&&(0,l.jsx)("img",{ref:N,src:URL.createObjectURL(a),alt:"preview",style:{display:"block",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",margin:"0 auto"}}),a&&(0,l.jsx)("div",{style:{position:"absolute",top:h.y,left:h.x,width:w,height:w,border:"2px dashed red",boxSizing:"border-box",pointerEvents:"none",zIndex:10}}),a&&(0,l.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"transparent",zIndex:5}}),(0,l.jsx)("canvas",{ref:C,style:{display:"none"}})]}),a&&(0,l.jsx)("div",{ref:k,className:"progress mt-3",style:{width:"100%",height:"20px",cursor:"pointer"},onClick:e=>{if(!k.current)return;let t=k.current.getBoundingClientRect(),n=(e.clientX-t.left)/t.width*100;j(Math.round(n=Math.max(0,Math.min(100,n))))},children:(0,l.jsxs)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(y,"%")},"aria-valuenow":y,"aria-valuemin":0,"aria-valuemax":100,children:[y,"%"]})}),d&&(0,l.jsxs)("div",{style:{width:"100%",height:"100%",marginTop:"20px"},children:[(0,l.jsx)("h4",{children:"即時預覽"}),(0,l.jsx)("img",{src:d,alt:"crop-preview",style:{width:"100%",height:"100%",objectFit:"contain",margin:"0 auto",imageRendering:"pixelated",border:"1px solid #ccc"}})]})]})},d=e=>{let{canvasList:t,pixelSizeInput:n}=e,[i,s]=(0,r.useState)(0),[a,o]=(0,r.useState)(!0),c=(0,r.useRef)(null),d=120/n;return(0,r.useEffect)(()=>{if(!a)return;let e=setInterval(()=>{s(e=>(e+1)%t.length)},500);return()=>clearInterval(e)},[t.length,a]),(0,r.useEffect)(()=>{let e=c.current;if(!e)return;let l=e.getContext("2d");if(!l)return;let r=t[i];if(r)for(let[t,i]of(l.clearRect(0,0,e.width,e.height),r.entries())){let e=t%n*d,r=Math.floor(t/n)*d;l.fillStyle=i,l.fillRect(e,r,d,d)}},[t,i,n]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h5",{children:"預覽"}),(0,l.jsx)("canvas",{ref:c,width:120,height:120,style:{border:"1px solid black",backgroundColor:"#fff"}}),(0,l.jsx)("button",{className:"btn btn-primary mt-2",onClick:()=>o(!a),children:a?"暫停":"播放"})]})};var u=n(9134);let h=e=>{let{canvasRef:t,handleCanvasClick:n,handleMouseDown:r,handleMouseMove:i,handleMouseUp:s,handleTouchStart:a,handleTouchMove:o,handleTouchEnd:c}=e;return(0,l.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,l.jsx)("canvas",{ref:t,width:400,height:400,style:{border:"1px solid #000",cursor:"pointer"},onClick:n,onMouseDown:r,onMouseMove:i,onMouseUp:s,onTouchStart:a,onTouchMove:o,onTouchEnd:c})})},f=()=>{let[e,t]=(0,r.useState)("#000000"),[n,i]=(0,r.useState)(100),[s,a]=(0,r.useState)(100),o=400/n,[f,m]=(0,r.useState)(!1),[p,x]=(0,r.useState)([new Map]),[g,b]=(0,r.useState)(0),[v,y]=(0,r.useState)(null),[j,w]=(0,r.useState)(!1),[M,C]=(0,r.useState)(new Map),N=(0,r.useRef)(null),S=function(){let e=(0,r.useRef)([]);return{refs:e.current,get:t=>{var n;return null!=(n=e.current[t])?n:null},set:(t,n)=>{e.current[t]=n},insert:t=>{e.current.splice(t,0,null)},remove:t=>{e.current.splice(t,1)},reset:t=>{e.current=Array(t).fill(null)},move:(t,n)=>{if(t===n||t<0||n<0||t>=e.current.length||n>=e.current.length)return;let[l]=e.current.splice(t,1);e.current.splice(n,0,l)}}}(),[k,R]=(0,r.useState)(!1),T=()=>{x([new Map]),b(0),S.reset(p.length),E(new Map)},E=e=>{let t=N.current;if(!t)return;let l=t.getContext("2d");if(l)for(let[r,i]of(l.clearRect(0,0,t.width,t.height),e.entries())){let e=r%n*o,t=Math.floor(r/n)*o;l.fillStyle=i,l.fillRect(e,t,o,o),l.strokeStyle="#ffffff",l.strokeRect(e,t,o,o)}},I=e=>{let t=N.current;if(!t)return;let l=t.getContext("2d");if(l&&0!==e.size)for(let[t,r]of e.entries()){let e=t%n*o,i=Math.floor(t/n)*o;l.clearRect(e,i,o,o),l.fillStyle=r,l.fillRect(e,i,o,o),l.strokeStyle="#ffffff",l.strokeRect(e,i,o,o)}},O=()=>{requestAnimationFrame(()=>{p.forEach((e,t)=>{let l=S.get(t);if(!l)return;let r=l.getContext("2d");if(!r)return;let i=85/n;for(let[t,s]of(r.clearRect(0,0,l.width,l.height),e.entries())){let e=t%n*i,l=Math.floor(t/n)*i;r.fillStyle=s,r.fillRect(e,l,i,i)}})})};(0,r.useEffect)(()=>{T()},[n]),(0,r.useEffect)(()=>{O()},[p]);let _=(t,l)=>{let r=l*n+t,i=[...p],s=new Map(i[g]);s.get(r)!==e&&(s.set(r,e),i[g]=s,j?C(t=>new Map(t).set(r,e)):x(i),I(new Map().set(r,e)))},W=(e,t)=>{let l=N.current;if(!l||o<=0)return null;let r=l.getBoundingClientRect(),i=Math.floor((e-r.left)/o),s=Math.floor((t-r.top)/o);return i>=0&&i<n&&s>=0&&s<n?{x:i,y:s}:null},D=e=>{let t=W(e.clientX,e.clientY);t&&_(t.x,t.y)},U=e=>{if(0===e.touches.length)return;e.preventDefault();let t=W(e.touches[0].clientX,e.touches[0].clientY);t&&_(t.x,t.y)},z=()=>{if(M.size>0){let e=[...p],t=new Map(e[g]);for(let[e,n]of M.entries())t.set(e,n);e[g]=t,x(e),C(new Map)}},P=e=>{M.size>0&&z(),b(e),p[e]?E(p[e]):console.warn("Invalid canvas index: ".concat(e))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"container-fluid p-3",children:[(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{style:{position:"absolute",width:1,height:1,overflow:"hidden",opacity:0},children:[(0,l.jsx)("h1",{children:"微動畫展示"}),(0,l.jsx)("p",{children:"動手畫畫看吧..."})]})}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsx)("div",{className:"col-md-3 col-sm-12 d-flex flex-column align-items-center my-3",children:(0,l.jsx)(u.A,{value:e,onChange:t})}),(0,l.jsx)("div",{className:"col-md-6 col-sm-12 d-flex justify-content-center my-3",children:(0,l.jsxs)("div",{className:"row d-flex",children:[(0,l.jsx)("div",{className:"col-12 my-2 d-flex justify-content-center align-items-center",children:(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>R(!0),children:"匯入圖片"})}),(0,l.jsx)("div",{className:"col-12 my-2",children:(0,l.jsxs)("div",{className:"d-flex justify-content-center align-items-center gap-2 mb-3",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:T,children:"重置"}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>{x([...p,new Map]),b(p.length),S.insert(p.length),E(new Map)},children:"新增"}),(0,l.jsx)("button",{className:"btn btn-danger",onClick:()=>{if(p.length>1){let e=null==p?void 0:p.filter((e,t)=>t!==g);x(e);let t=Math.max(0,g-1);b(t),S.remove(g),E(e[t])}},disabled:p.length<=1,children:"刪除"}),(0,l.jsx)("button",{className:"btn btn-warning",onClick:()=>{y(new Map(p[g]))},children:"複製"}),(0,l.jsx)("button",{className:"btn btn-success",onClick:()=>{if(v){let e=[...p];e[g]=new Map(v),x(e),E(e[g])}},disabled:!v,children:"貼上"}),(0,l.jsxs)("div",{className:"position-relative",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-primary dropdown-toggle",onClick:()=>{a(n),m(!f)},children:"像素"}),f&&(0,l.jsxs)("form",{className:"p-3 shadow border position-absolute bg-white",style:{zIndex:1e3,width:"200px",top:"100%",left:0},onSubmit:e=>{e.preventDefault(),s<=0||s>100?alert("請輸入有效的數字（1 - 100）"):(i(s),m(!1))},children:[(0,l.jsxs)("div",{className:"mb-3 text-start",children:[(0,l.jsx)("label",{className:"form-check-label",htmlFor:"dropdownCheck2",children:"像素程度"}),(0,l.jsx)("input",{type:"number",className:"form-control",id:"dropdownCheck2",value:s,onChange:e=>a(parseInt(e.target.value,10)||1)})]}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary",children:"確定"})]})]})]})}),(0,l.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,l.jsx)(h,{canvasRef:N,handleCanvasClick:D,handleMouseDown:e=>{w(!0),D(e)},handleMouseMove:e=>{j&&D(e)},handleMouseUp:()=>{w(!1),z()},handleTouchStart:e=>{w(!0),U(e)},handleTouchMove:e=>{j&&U(e)},handleTouchEnd:()=>{w(!1),z()}})}),(0,l.jsx)("div",{className:"row d-flex justify-content-center align-items-center mt-3",children:null==p?void 0:p.map((e,t)=>(0,l.jsx)("div",{className:"col-auto",style:{border:g===t?"3px solid #007bff":"1px solid #ccc",padding:"2px",width:"auto",height:"auto",backgroundColor:"#ffffff",cursor:"pointer",display:"grid"},onClick:()=>P(t),children:(0,l.jsx)("canvas",{ref:e=>S.set(t,e),width:85,height:85,style:{display:"block"}})},t))})]})}),(0,l.jsx)("div",{className:"col-md-3 col-sm-12 d-flex flex-column align-items-center my-3",children:(0,l.jsx)(d,{canvasList:p,pixelSizeInput:n})})]})]}),(0,l.jsx)(c,{isOpen:k,onClose:()=>R(!1),onConfirm:e=>{x(t=>[...t,e]),b(p.length),S.insert(p.length),R(!1),E(e)},pixelSizeInput:n})]})}},38637:(e,t,n)=>{e.exports=n(79399)()},64894:(e,t,n)=>{Promise.resolve().then(n.bind(n,33979))},72948:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},79399:(e,t,n)=>{"use strict";var l=n(72948);function r(){}function i(){}i.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,i,s){if(s!==l){var a=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:r};return n.PropTypes=n,n}},84925:()=>{},95185:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[4151,808,8441,1684,7358],()=>t(64894)),_N_E=e.O()}]);