(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4782],{64956:(e,n,t)=>{"use strict";t.d(n,{A:()=>i});let r=t(12115).createContext(null);r.displayName="InputGroupContext";let i=r},74582:(e,n,t)=>{Promise.resolve().then(t.bind(t,94658))},94658:(e,n,t)=>{"use strict";t.d(n,{default:()=>W});var r=t(95155),i=t(12115),l=t(62012),a=t(18725),s=t(29878),o=t(47832),d=t(18943),c=t(69056),p=t(60902);let x=e=>{let{playlist:n,currentTrackId:t,onPlay:i,onDelete:l,onEdit:a}=e;return(0,r.jsx)(c.A,{children:n.map(e=>(0,r.jsxs)(c.A.Item,{active:t===e.id,className:"d-flex align-items-center justify-content-between",children:[(0,r.jsxs)("div",{style:{flex:1,cursor:"pointer"},onClick:()=>i(e.id),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:e.title}),(0,r.jsxs)("span",{style:{color:"#888"},children:[" by ",e.artist]})]}),(0,r.jsx)("div",{style:{fontSize:12,color:"#bbb"},children:e.url})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(p.A,{size:"sm",variant:"outline-primary",className:"me-2",onClick:()=>a(e),children:"編輯"}),(0,r.jsx)(p.A,{size:"sm",variant:"outline-danger",onClick:()=>l(e.id),children:"刪除"})]})]},e.id))})},u=e=>{let{playlist:n,currentTrackId:t,onPlay:i,onDelete:l,onEdit:a}=e;return(0,r.jsx)("div",{children:(0,r.jsx)(x,{playlist:n,currentTrackId:t,onPlay:i,onDelete:l,onEdit:a})})};var h=t(23464);let b="https://script.google.com/macros/s/AKfycbxRVvA4PknDe8qHM8-ObBrE3_iWhGFdpJegZgk72-pR8WzY5GyZIsqRxE1bbcQEPW-arw/exec";async function m(e){return(await h.A.get(b,{params:{action:"search",q:e}})).data}async function f(){return(await h.A.get(b,{params:{action:"get_playlist"}})).data}async function g(e){return(await h.A.post(b,{action:"create",...e},{headers:{"Content-Type":"text/plain"},withCredentials:!1})).data}var y=t(29300),w=t.n(y),j=t(97390),v=t(55560),k=t(64956);let N=i.forwardRef((e,n)=>{let{className:t,bsPrefix:i,as:l="span",...a}=e;return i=(0,j.oU)(i,"input-group-text"),(0,r.jsx)(l,{ref:n,className:w()(t,i),...a})});N.displayName="InputGroupText";let S=i.forwardRef((e,n)=>{let{bsPrefix:t,size:l,hasValidation:a,className:s,as:o="div",...d}=e;t=(0,j.oU)(t,"input-group");let c=(0,i.useMemo)(()=>({}),[]);return(0,r.jsx)(k.A.Provider,{value:c,children:(0,r.jsx)(o,{ref:n,...d,className:w()(s,t,l&&"".concat(t,"-").concat(l),a&&"has-validation")})})});S.displayName="InputGroup";let A=Object.assign(S,{Text:N,Radio:e=>(0,r.jsx)(N,{children:(0,r.jsx)(v.A,{type:"radio",...e})}),Checkbox:e=>(0,r.jsx)(N,{children:(0,r.jsx)(v.A,{type:"checkbox",...e})})});var C=t(63005),z=t(91867);let I=e=>{let{onSearch:n,loading:t}=e,[l,a]=(0,i.useState)("");return(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault(),l.trim()&&n(l.trim())},className:"mb-3",children:(0,r.jsxs)(A,{children:[(0,r.jsx)(C.A,{type:"text",placeholder:"搜尋 SoundCloud 曲目...",value:l,onChange:e=>a(e.target.value),disabled:t}),(0,r.jsx)(p.A,{type:"submit",disabled:t||!l.trim(),children:t?(0,r.jsx)(z.A,{animation:"border",size:"sm"}):"搜尋"})]})})},_=e=>{let{results:n,playlist:t,onAddTrack:i,loading:l}=e,a=e=>t.some(n=>n.id===e);return l?(0,r.jsx)("div",{className:"text-center my-3",children:(0,r.jsx)(z.A,{animation:"border"})}):n.length?(0,r.jsx)(c.A,{children:n.map(e=>(0,r.jsx)(c.A.Item,{children:(0,r.jsxs)("div",{className:"d-flex align-items-center",children:[(0,r.jsxs)("div",{className:"flex-grow-1 d-flex align-items-center",style:{minWidth:0},children:[(0,r.jsx)("img",{src:e.artwork_url?e.artwork_url.replace("-large","-t300x300"):"/images/img14.jpg",alt:e.title,style:{width:48,height:48,objectFit:"cover",borderRadius:6,marginRight:12}}),(0,r.jsxs)("div",{style:{overflow:"hidden"},children:[(0,r.jsxs)("div",{style:{fontWeight:600,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal",maxWidth:"100%",lineHeight:"1.3"},children:[e.title," ",(0,r.jsxs)("span",{style:{color:"#888"},children:["by ",e.user.username]})]}),(0,r.jsx)("div",{style:{fontSize:12,color:"#bbb",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"},children:e.permalink_url})]})]}),(0,r.jsx)(p.A,{size:"sm",variant:"success",disabled:a(e.id),onClick:()=>i(e,""),style:{marginLeft:16,fontWeight:500,whiteSpace:"nowrap",flexShrink:0},children:a(e.id)?"已在清單":(0,r.jsx)("span",{children:"加入清單"})})]})},e.id))}):(0,r.jsx)("div",{className:"text-muted text-center my-3",children:"請輸入關鍵字搜尋"})},E=e=>{let{playlist:n,onAddTrack:t}=e,[l,a]=(0,i.useState)([]),[s,o]=(0,i.useState)(!1),d=async e=>{o(!0),a([]);try{let n=await m(e);a(n.collection||[])}catch(e){console.error(e)}o(!1)},c=async(e,n)=>{await g({title:e.title,artist:e.user.username,url:e.permalink_url,embed_html:n,artwork_url:e.artwork_url||""}),setTimeout(async()=>{t(e,n)},1e3)};return(0,r.jsxs)("div",{children:[(0,r.jsx)(I,{onSearch:d,loading:s}),(0,r.jsx)(_,{results:l,playlist:n,onAddTrack:c,loading:s})]})},T=e=>{let{show:n,onClose:t,playlist:l,currentTrackId:a,onPlay:s,onDelete:c,onEdit:p,onAddTrack:x}=e,[h,b]=(0,i.useState)("playlist");return(0,r.jsxs)(o.A,{show:n,onHide:t,size:"xl",centered:!0,scrollable:!0,children:[(0,r.jsx)(o.A.Header,{closeButton:!0,children:(0,r.jsxs)(d.A,{variant:"tabs",activeKey:h,onSelect:e=>{("playlist"===e||"search"===e)&&b(e)},children:[(0,r.jsx)(d.A.Item,{children:(0,r.jsx)(d.A.Link,{eventKey:"playlist",children:"播放清單"})}),(0,r.jsx)(d.A.Item,{children:(0,r.jsx)(d.A.Link,{eventKey:"search",children:"搜尋"})})]})}),(0,r.jsx)(o.A.Body,{style:{minHeight:400},children:"playlist"===h?(0,r.jsx)(u,{playlist:l,currentTrackId:a,onPlay:s,onDelete:c,onEdit:p}):(0,r.jsx)(E,{onAddTrack:x,playlist:l})})]})};function R(e){if(!e||isNaN(e))return"00:00";let n=Math.floor(e/1e3),t=Math.floor(n/60).toString().padStart(2,"0"),r=(n%60).toString().padStart(2,"0");return"".concat(t,":").concat(r)}let W=()=>{var e;let[n,t]=(0,i.useState)([]),[o,d]=(0,i.useState)(0),[c,p]=(0,i.useState)(!1),[x,u]=(0,i.useState)(!1),[h,b]=(0,i.useState)(0),[m,g]=(0,i.useState)(0),[y,w]=(0,i.useState)(!1),j=(0,i.useRef)(null),v=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(f().then(e=>{t(e.map(e=>({title:e.title,url:e.url,embedHtml:e.embed_html||"",artworkUrl:e.artwork_url||"/images/music-default.png",artist:e.artist||""})))}),!window.SC){let e=document.createElement("script");e.src="https://w.soundcloud.com/player/api.js",e.async=!0,document.body.appendChild(e)}},[]),(0,i.useEffect)(()=>{d(e=>0===n.length?0:n[e]?e:0)},[n]);let k=e=>d(e),N=n[o];return(0,i.useEffect)(()=>{j.current&&window.SC&&(v.current=window.SC.Widget(j.current),v.current.load(null==N?void 0:N.url,{auto_play:x}),v.current.unbind&&v.current.unbind(window.SC.Widget.Events.FINISH),v.current.bind(window.SC.Widget.Events.FINISH,()=>{0!==n.length&&(o<n.length-1?k(o+1):k(0))}),b(0),g(0))},[N]),(0,i.useEffect)(()=>{v.current&&(x?v.current.play():v.current.pause())},[x]),(0,i.useEffect)(()=>{let e;return v.current&&x&&(e=setInterval(()=>{var e,n;null==(e=v.current)||e.getPosition(e=>{y||b(e)}),null==(n=v.current)||n.getDuration(e=>{g(e)})},500)),()=>clearInterval(e)},[x,y]),(0,r.jsxs)("main",{style:{padding:32},children:[N?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"player-card",children:[(0,r.jsx)("div",{className:"player-album-art",children:(0,r.jsx)("img",{src:N.artworkUrl||"/images/img14.jpg",alt:N.title,className:"player-album-img",onError:e=>e.currentTarget.src="/images/img14.jpg"})}),(0,r.jsxs)("div",{className:"player-controls-row",children:[(0,r.jsxs)("div",{className:"player-controls-left",children:[(0,r.jsxs)("div",{className:"player-chevron-group",children:[(0,r.jsx)("button",{className:"chevron-btn chevron-left",onClick:()=>k((o-1+n.length)%n.length),disabled:n.length<=1,title:"上一首",children:(0,r.jsx)(l.A,{size:28})}),(0,r.jsx)("button",{className:"chevron-btn chevron-right",onClick:()=>k((o+1)%n.length),disabled:n.length<=1,title:"下一首",children:(0,r.jsx)(a.A,{size:28})})]}),(0,r.jsxs)("div",{className:"player-title-group",children:[(0,r.jsx)("div",{className:"player-title player-title-multiline",children:N.title}),(0,r.jsx)("div",{className:"player-artist",children:N.artist||""})]})]}),(0,r.jsx)("div",{className:"player-controls-play",children:(0,r.jsx)("button",{style:{border:x?"8px solid #ffb300":"8px solid #00e5ff",width:80,height:80,borderRadius:"50%",background:"#f0f2f5",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 12px rgba(60,80,120,0.10)",padding:0,outline:"none",cursor:"pointer"},onClick:()=>u(e=>!e),title:x?"暫停":"播放",children:x?(0,r.jsx)(e=>{let{size:n=48}=e;return(0,r.jsxs)("svg",{width:n,height:n,viewBox:"0 0 48 48",fill:"none",children:[(0,r.jsx)("circle",{cx:"24",cy:"24",r:"22",fill:"url(#pauseGrad)"}),(0,r.jsx)("rect",{x:"18",y:"16",width:"5",height:"16",rx:"2.5",fill:"#fff"}),(0,r.jsx)("rect",{x:"27",y:"16",width:"5",height:"16",rx:"2.5",fill:"#fff"}),(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"pauseGrad",x1:"0",y1:"0",x2:"48",y2:"48",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#ff5500"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#ffcc00"})]})})]})},{size:48}):(0,r.jsx)(e=>{let{size:n=48}=e;return(0,r.jsxs)("svg",{width:n,height:n,viewBox:"0 0 48 48",fill:"none",children:[(0,r.jsx)("circle",{cx:"24",cy:"24",r:"22",fill:"url(#playGrad)"}),(0,r.jsx)("polygon",{points:"20,16 36,24 20,32",fill:"#fff"}),(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"playGrad",x1:"0",y1:"0",x2:"48",y2:"48",gradientUnits:"userSpaceOnUse",children:[(0,r.jsx)("stop",{stopColor:"#1976d2"}),(0,r.jsx)("stop",{offset:"1",stopColor:"#00e5ff"})]})})]})},{size:48})})})]}),(0,r.jsxs)("div",{className:"player-progress-row",children:[(0,r.jsx)("span",{className:"player-time",children:R(h)}),(0,r.jsx)("input",{type:"range",min:0,max:m||1,value:Math.min(h,m),step:1e3,className:"player-progress-bar",onChange:e=>{w(!0),b(Number(e.target.value))},onMouseUp:e=>{var n;w(!1),null==(n=v.current)||n.seekTo(Number(e.currentTarget.value))},onTouchEnd:e=>{var n;w(!1),null==(n=v.current)||n.seekTo(Number(e.target.value))}}),(0,r.jsx)("span",{className:"player-time",children:R(m)})]})]})}):(0,r.jsx)("div",{children:"無播放清單"}),N&&(0,r.jsx)("iframe",{ref:j,title:"soundcloud-widget",style:{display:"none"},width:"100%",height:"80",allow:"autoplay",src:"https://w.soundcloud.com/player/?url=".concat(encodeURIComponent(N.url),"&color=%23ff5500&auto_play=").concat(x?"true":"false")}),(0,r.jsx)("button",{style:{position:"fixed",bottom:32,right:32,zIndex:999,borderRadius:"50%",width:60,height:60,fontSize:32,background:"#ff5500",color:"#fff",border:"none",boxShadow:"0 2px 8px rgba(0,0,0,.2)",display:"flex",alignItems:"center",justifyContent:"center",padding:0},onClick:()=>p(!0),title:"管理播放清單與查詢",children:(0,r.jsx)(s.A,{size:32})}),(0,r.jsx)(T,{show:c,onClose:()=>p(!1),playlist:n.map(e=>({id:e.url,title:e.title,artist:"",url:e.url,added_at:"",embed_html:e.embedHtml})),currentTrackId:(null==(e=n[o])?void 0:e.url)||null,onPlay:e=>{let t=n.findIndex(n=>n.url===e);t>=0&&k(t)},onDelete:e=>t(n.filter(n=>n.url!==e)),onEdit:()=>{},onAddTrack:async()=>{t((await f()).map(e=>({title:e.title,url:e.url,embedHtml:e.embed_html||""})))}}),(0,r.jsx)("style",{children:"\n.player-card {\n  width: 100%;\n  max-width: 340px;\n  background: linear-gradient(145deg, #e6ecf4 0%, #f7fafd 100%);\n  border-radius: 24px;\n  box-shadow: 0 8px 32px rgba(60,80,120,0.10);\n  padding: 7.5vw 5vw 6vw 5vw;\n  /* 上右下左，隨螢幕縮放 */\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  box-sizing: border-box;\n}\n@media (min-width: 400px) {\n  .player-card {\n    padding: 32px 24px 24px 24px;\n  }\n}\n.player-album-art {\n  margin-top: -80px;\n  margin-bottom: 24px;\n  background: #fff;\n  border-radius: 20px;\n  box-shadow: 0 8px 32px rgba(60,80,120,0.18);\n  padding: 8px;\n  display: inline-block;\n  width: 85%;\n  box-sizing: border-box;\n  max-width: 272px;\n}\n.player-progress-row {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  margin-top: 12px;\n}\n.player-progress-bar {\n  flex: 1 1 0%;\n  appearance: none;\n  height: 5px;\n  border-radius: 3px;\n  background: #e0e3ea;\n  outline: none;\n  transition: background 0.2s;\n  margin: 0 8px;\n}\n.player-progress-bar::-webkit-slider-thumb {\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: #ff5500;\n  border: 2px solid #fff;\n  box-shadow: 0 1px 4px rgba(60,80,120,0.10);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.player-progress-bar:active::-webkit-slider-thumb {\n  background: #1976d2;\n}\n.player-progress-bar::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: #ff5500;\n  border: 2px solid #fff;\n  box-shadow: 0 1px 4px rgba(60,80,120,0.10);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.player-progress-bar:active::-moz-range-thumb {\n  background: #1976d2;\n}\n.player-progress-bar::-ms-thumb {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: #ff5500;\n  border: 2px solid #fff;\n  box-shadow: 0 1px 4px rgba(60,80,120,0.10);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.player-progress-bar:active::-ms-thumb {\n  background: #1976d2;\n}\n.player-progress-bar:focus {\n  background: #bbdefb;\n}\n.player-time {\n  width: 44px;\n  text-align: center;\n  font-size: 14px;\n  color: #b5bdd3;\n  font-weight: 700;\n}\n\n.player-album-img {\n  width: 100%;\n  aspect-ratio: 1/1;\n  border-radius: 16px;\n  object-fit: cover;\n  display: block;\n}\n\n.player-controls-row {\n  display: flex;\n  align-items: stretch;\n  width: 100%;\n  margin-bottom: 18px;\n  flex-wrap: nowrap;\n}\n.player-controls-left {\n  flex: 1 1 0%;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: flex-start;\n  gap: 4px;\n}\n.player-chevron-group {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 8px;\n}\n.player-title-group {\n  display: flex;\n  flex-direction: column;\n}\n.player-title {\n  font-weight: 700;\n  font-size: 18px;\n  color: #6b7a99;\n  margin-bottom: 2px;\n  max-width: 100%;\n  padding-right: 8px;\n}\n.player-title-multiline {\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  word-break: break-all;\n  white-space: normal;\n}\n.player-artist {\n  font-weight: 400;\n  font-size: 15px;\n  color: #b5bdd3;\n  margin-bottom: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  max-width: 100%;\n}\n.player-controls-play {\n  flex: 0 0 72px;\n  min-width: 72px;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n}\n.player-btn.player-btn-large {\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  border: 8px solid #fff;\n  background: #f0f2f5;\n  box-shadow: 0 2px 12px rgba(60,80,120,0.10);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40px;\n  color: #fff;\n  position: relative;\n  outline: none;\n  cursor: pointer;\n  transition: background 0.2s, box-shadow 0.2s;\n}\n.player-btn.player-btn-large:hover {\n  background: #e0e3ea;\n  box-shadow: 0 4px 16px rgba(60,80,120,0.16);\n}\n.chevron-btn {\n  font-size: 26px;\n  border: none;\n  background: none;\n  cursor: pointer;\n  color: #b0b8c9;\n  margin: 0 4px;\n  border-radius: 8px;\n  transition: color 0.18s;\n  padding: 3px 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.chevron-btn:disabled {\n  color: #e0e3ea;\n  cursor: not-allowed;\n}\n.chevron-btn:hover:not(:disabled) {\n  color: #1976d2;\n}\n"})]})}}},e=>{var n=n=>e(e.s=n);e.O(0,[3464,2601,5075,669,1969,8441,1684,7358],()=>n(74582)),_N_E=e.O()}]);