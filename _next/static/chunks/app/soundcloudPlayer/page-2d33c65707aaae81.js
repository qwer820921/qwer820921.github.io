(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[782],{46661:(e,n,r)=>{Promise.resolve().then(r.bind(r,60228))},60228:(e,n,r)=>{"use strict";r.d(n,{default:()=>z});var t=r(95155),a=r(12115),i=r(62012),l=r(18725),s=r(78327),o=r(31345),d=r(47832),c=r(70717),p=r(69056),x=r(60902);let u=e=>{let{playlist:n,currentTrackId:r,onPlay:a,onDelete:i,onEdit:l}=e;return(0,t.jsx)(p.A,{children:n.map(e=>(0,t.jsxs)(p.A.Item,{active:r===e.id,className:"d-flex align-items-center justify-content-between",children:[(0,t.jsxs)("div",{style:{flex:1,cursor:"pointer"},onClick:()=>a(e.id),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:e.title}),(0,t.jsxs)("span",{style:{color:"#888"},children:[" by ",e.artist]})]}),(0,t.jsx)("div",{style:{fontSize:12,color:"#bbb"},children:e.url})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x.A,{size:"sm",variant:"outline-primary",className:"me-2",onClick:()=>l(e),children:"編輯"}),(0,t.jsx)(x.A,{size:"sm",variant:"outline-danger",onClick:()=>i(e.id),children:"刪除"})]})]},e.id))})},h=e=>{let{playlist:n,currentTrackId:r,onPlay:a,onDelete:i,onEdit:l}=e;return(0,t.jsx)("div",{children:(0,t.jsx)(u,{playlist:n,currentTrackId:r,onPlay:a,onDelete:i,onEdit:l})})};var b=r(23464);let m="https://script.google.com/macros/s/AKfycbxRVvA4PknDe8qHM8-ObBrE3_iWhGFdpJegZgk72-pR8WzY5GyZIsqRxE1bbcQEPW-arw/exec";async function g(e){return(await b.A.get(m,{params:{action:"search",q:e}})).data}async function f(){return(await b.A.get(m,{params:{action:"get_playlist"}})).data}async function y(e){return(await b.A.post(m,{action:"create",...e},{headers:{"Content-Type":"text/plain"},withCredentials:!1})).data}var w=r(74523),v=r(88617),j=r(91867);let k=e=>{let{onSearch:n,loading:r}=e,[i,l]=(0,a.useState)("");return(0,t.jsx)("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&n(i.trim())},className:"mb-3",children:(0,t.jsxs)(w.A,{children:[(0,t.jsx)(v.A,{type:"text",placeholder:"搜尋 SoundCloud 曲目...",value:i,onChange:e=>l(e.target.value),disabled:r}),(0,t.jsx)(x.A,{type:"submit",disabled:r||!i.trim(),children:r?(0,t.jsx)(j.A,{animation:"border",size:"sm"}):"搜尋"})]})})},S=e=>{let{results:n,playlist:r,onAddTrack:a,loading:i}=e,l=e=>r.some(n=>n.id===e);return i?(0,t.jsx)("div",{className:"text-center my-3",children:(0,t.jsx)(j.A,{animation:"border"})}):n.length?(0,t.jsx)(p.A,{children:n.map(e=>(0,t.jsx)(p.A.Item,{children:(0,t.jsxs)("div",{className:"d-flex align-items-center",children:[(0,t.jsxs)("div",{className:"flex-grow-1 d-flex align-items-center",style:{minWidth:0},children:[(0,t.jsx)("img",{src:e.artwork_url?e.artwork_url.replace("-large","-t300x300"):"/images/img14.jpg",alt:e.title,style:{width:48,height:48,objectFit:"cover",borderRadius:6,marginRight:12}}),(0,t.jsxs)("div",{style:{overflow:"hidden"},children:[(0,t.jsxs)("div",{style:{fontWeight:600,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal",maxWidth:"100%",lineHeight:"1.3"},children:[e.title," ",(0,t.jsxs)("span",{style:{color:"#888"},children:["by ",e.user.username]})]}),(0,t.jsx)("div",{style:{fontSize:12,color:"#bbb",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"},children:e.permalink_url})]})]}),(0,t.jsx)(x.A,{size:"sm",variant:"success",disabled:l(e.id),onClick:()=>a(e,""),style:{marginLeft:16,fontWeight:500,whiteSpace:"nowrap",flexShrink:0},children:l(e.id)?"已在清單":(0,t.jsx)("span",{children:"加入清單"})})]})},e.id))}):(0,t.jsx)("div",{className:"text-muted text-center my-3",children:"請輸入關鍵字搜尋"})},N=e=>{let{playlist:n,onAddTrack:r}=e,[i,l]=(0,a.useState)([]),[s,o]=(0,a.useState)(!1),d=async e=>{o(!0),l([]);try{let n=await g(e);l(n.collection||[])}catch(e){console.error(e)}o(!1)},c=async(e,n)=>{await y({title:e.title,artist:e.user.username,url:e.permalink_url,embed_html:n,artwork_url:e.artwork_url||""}),setTimeout(async()=>{await f(),r(e,n)},1e3)};return(0,t.jsxs)("div",{children:[(0,t.jsx)(k,{onSearch:d,loading:s}),(0,t.jsx)(S,{results:i,playlist:n,onAddTrack:c,loading:s})]})},A=e=>{let{show:n,onClose:r,playlist:i,currentTrackId:l,onPlay:s,onDelete:o,onEdit:p,onAddTrack:x}=e,[u,b]=(0,a.useState)("playlist");return(0,t.jsxs)(d.A,{show:n,onHide:r,size:"xl",centered:!0,scrollable:!0,children:[(0,t.jsx)(d.A.Header,{closeButton:!0,children:(0,t.jsxs)(c.A,{variant:"tabs",activeKey:u,onSelect:e=>{("playlist"===e||"search"===e)&&b(e)},children:[(0,t.jsx)(c.A.Item,{children:(0,t.jsx)(c.A.Link,{eventKey:"playlist",children:"播放清單"})}),(0,t.jsx)(c.A.Item,{children:(0,t.jsx)(c.A.Link,{eventKey:"search",children:"搜尋"})})]})}),(0,t.jsx)(d.A.Body,{style:{minHeight:400},children:"playlist"===u?(0,t.jsx)(h,{playlist:i,currentTrackId:l,onPlay:s,onDelete:o,onEdit:p}):(0,t.jsx)(N,{onAddTrack:x,playlist:i})})]})};function C(e){if(!e||isNaN(e))return"00:00";let n=Math.floor(e/1e3),r=Math.floor(n/60).toString().padStart(2,"0"),t=(n%60).toString().padStart(2,"0");return"".concat(r,":").concat(t)}let z=()=>{var e;let[n,r]=(0,a.useState)([]),[d,c]=(0,a.useState)(0),[p,x]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),[b,m]=(0,a.useState)(0),[g,y]=(0,a.useState)(0),[w,v]=(0,a.useState)(!1),j=(0,a.useRef)(null),k=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(f().then(e=>{r(e.map(e=>({title:e.title,url:e.url,embedHtml:e.embed_html||"",artworkUrl:e.artwork_url||"/images/music-default.png",artist:e.artist||""})))}),!window.SC){let e=document.createElement("script");e.src="https://w.soundcloud.com/player/api.js",e.async=!0,document.body.appendChild(e)}},[]),(0,a.useEffect)(()=>{c(e=>0===n.length?0:n[e]?e:0)},[n]);let S=e=>c(e),N=n[d];return(0,a.useEffect)(()=>{j.current&&window.SC&&(k.current=window.SC.Widget(j.current),k.current.load(null==N?void 0:N.url,{auto_play:u}),k.current.unbind&&k.current.unbind(window.SC.Widget.Events.FINISH),k.current.bind(window.SC.Widget.Events.FINISH,()=>{0!==n.length&&(d<n.length-1?S(d+1):S(0))}),m(0),y(0))},[N]),(0,a.useEffect)(()=>{k.current&&(u?k.current.play():k.current.pause())},[u]),(0,a.useEffect)(()=>{let e;return k.current&&u&&(e=setInterval(()=>{var e,n;null==(e=k.current)||e.getPosition(e=>{w||m(e)}),null==(n=k.current)||n.getDuration(e=>{y(e)})},500)),()=>clearInterval(e)},[u,w]),(0,t.jsxs)("main",{style:{padding:32},children:[N?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"player-card",children:[(0,t.jsx)("div",{className:"player-album-art",children:(0,t.jsx)("img",{src:N.artworkUrl||"/images/img14.jpg",alt:N.title,className:"player-album-img",onError:e=>e.currentTarget.src="/images/img14.jpg"})}),(0,t.jsxs)("div",{className:"player-controls-row",children:[(0,t.jsxs)("div",{className:"player-controls-left",children:[(0,t.jsxs)("div",{className:"player-chevron-group",children:[(0,t.jsx)("button",{className:"chevron-btn chevron-left",onClick:()=>S((d-1+n.length)%n.length),disabled:n.length<=1,title:"上一首",children:(0,t.jsx)(i.A,{size:28})}),(0,t.jsx)("button",{className:"chevron-btn chevron-right",onClick:()=>S((d+1)%n.length),disabled:n.length<=1,title:"下一首",children:(0,t.jsx)(l.A,{size:28})})]}),(0,t.jsxs)("div",{className:"player-title-group",children:[(0,t.jsx)("div",{className:"player-title player-title-multiline",children:N.title}),(0,t.jsx)("div",{className:"player-artist",children:N.artist||""})]})]}),(0,t.jsx)("div",{className:"player-controls-play",children:(0,t.jsx)("button",{className:"player-btn player-btn-large",style:{border:u?"8px solid #ffb300":"8px solid #00e5ff"},onClick:()=>h(e=>!e),title:u?"暫停":"播放",children:u?(0,t.jsx)(s.A,{size:48,style:{color:"#fff",background:"linear-gradient(135deg, #ff5500 60%, #ffcc00 100%)",borderRadius:"12px",boxShadow:"0 2px 8px rgba(255,85,0,0.18)",padding:"6px"}}):(0,t.jsx)(o.A,{size:48,style:{color:"#fff",background:"linear-gradient(135deg, #1976d2 60%, #00e5ff 100%)",borderRadius:"12px",boxShadow:"0 2px 8px rgba(25,118,210,0.18)",padding:"6px"}})})})]}),(0,t.jsxs)("div",{className:"player-progress-row",children:[(0,t.jsx)("span",{className:"player-time",children:C(b)}),(0,t.jsx)("input",{type:"range",min:0,max:g||1,value:Math.min(b,g),step:1e3,className:"player-progress-bar",onChange:e=>{v(!0),m(Number(e.target.value))},onMouseUp:e=>{var n;v(!1),null==(n=k.current)||n.seekTo(Number(e.currentTarget.value))},onTouchEnd:e=>{var n;v(!1),null==(n=k.current)||n.seekTo(Number(e.target.value))}}),(0,t.jsx)("span",{className:"player-time",children:C(g)})]})]})}):(0,t.jsx)("div",{children:"無播放清單"}),N&&(0,t.jsx)("iframe",{ref:j,title:"soundcloud-widget",style:{display:"none"},width:"100%",height:"80",allow:"autoplay",src:"https://w.soundcloud.com/player/?url=".concat(encodeURIComponent(N.url),"&color=%23ff5500&auto_play=").concat(u?"true":"false")}),(0,t.jsx)("button",{style:{position:"fixed",bottom:32,right:32,zIndex:999,borderRadius:"50%",width:60,height:60,fontSize:28,background:"#ff5500",color:"#fff",border:"none",boxShadow:"0 2px 8px rgba(0,0,0,.2)"},onClick:()=>x(!0),title:"管理播放清單與查詢",children:(0,t.jsx)("span",{role:"img","aria-label":"playlist",children:"\uD83C\uDFB5"})}),(0,t.jsx)(A,{show:p,onClose:()=>x(!1),playlist:n.map(e=>({id:e.url,title:e.title,artist:"",url:e.url,added_at:"",embed_html:e.embedHtml})),currentTrackId:(null==(e=n[d])?void 0:e.url)||null,onPlay:e=>{let r=n.findIndex(n=>n.url===e);r>=0&&S(r)},onDelete:e=>r(n.filter(n=>n.url!==e)),onEdit:()=>{},onAddTrack:async()=>{r((await f()).map(e=>({title:e.title,url:e.url,embedHtml:e.embed_html||""})))}}),(0,t.jsx)("style",{children:"\n.player-card {\n  width: 100%;\n  max-width: 340px;\n  background: linear-gradient(145deg, #e6ecf4 0%, #f7fafd 100%);\n  border-radius: 24px;\n  box-shadow: 0 8px 32px rgba(60,80,120,0.10);\n  padding: 7.5vw 5vw 6vw 5vw;\n  /* 上右下左，隨螢幕縮放 */\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  box-sizing: border-box;\n}\n@media (min-width: 400px) {\n  .player-card {\n    padding: 32px 24px 24px 24px;\n  }\n}\n.player-album-art {\n  margin-top: -80px;\n  margin-bottom: 24px;\n  background: #fff;\n  border-radius: 20px;\n  box-shadow: 0 8px 32px rgba(60,80,120,0.18);\n  padding: 8px;\n  display: inline-block;\n  width: 85%;\n  box-sizing: border-box;\n  max-width: 272px;\n}\n.player-progress-row {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  margin-top: 12px;\n}\n.player-progress-bar {\n  flex: 1 1 0%;\n  appearance: none;\n  height: 5px;\n  border-radius: 3px;\n  background: #e0e3ea;\n  outline: none;\n  transition: background 0.2s;\n  margin: 0 8px;\n}\n.player-progress-bar::-webkit-slider-thumb {\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: #ff5500;\n  border: 2px solid #fff;\n  box-shadow: 0 1px 4px rgba(60,80,120,0.10);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.player-progress-bar:active::-webkit-slider-thumb {\n  background: #1976d2;\n}\n.player-progress-bar::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: #ff5500;\n  border: 2px solid #fff;\n  box-shadow: 0 1px 4px rgba(60,80,120,0.10);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.player-progress-bar:active::-moz-range-thumb {\n  background: #1976d2;\n}\n.player-progress-bar::-ms-thumb {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background: #ff5500;\n  border: 2px solid #fff;\n  box-shadow: 0 1px 4px rgba(60,80,120,0.10);\n  cursor: pointer;\n  transition: background 0.2s;\n}\n.player-progress-bar:active::-ms-thumb {\n  background: #1976d2;\n}\n.player-progress-bar:focus {\n  background: #bbdefb;\n}\n.player-time {\n  width: 44px;\n  text-align: center;\n  font-size: 14px;\n  color: #b5bdd3;\n  font-weight: 700;\n}\n\n.player-album-img {\n  width: 100%;\n  aspect-ratio: 1/1;\n  border-radius: 16px;\n  object-fit: cover;\n  display: block;\n}\n\n.player-controls-row {\n  display: flex;\n  align-items: stretch;\n  width: 100%;\n  margin-bottom: 18px;\n  flex-wrap: nowrap;\n}\n.player-controls-left {\n  flex: 1 1 0%;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: flex-start;\n  gap: 4px;\n}\n.player-chevron-group {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 8px;\n}\n.player-title-group {\n  display: flex;\n  flex-direction: column;\n}\n.player-title {\n  font-weight: 700;\n  font-size: 18px;\n  color: #6b7a99;\n  margin-bottom: 2px;\n  max-width: 100%;\n  padding-right: 8px;\n}\n.player-title-multiline {\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  word-break: break-all;\n  white-space: normal;\n}\n.player-artist {\n  font-weight: 400;\n  font-size: 15px;\n  color: #b5bdd3;\n  margin-bottom: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  max-width: 100%;\n}\n.player-controls-play {\n  flex: 0 0 72px;\n  min-width: 72px;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n}\n.player-btn.player-btn-large {\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  border: 8px solid #fff;\n  background: #f0f2f5;\n  box-shadow: 0 2px 12px rgba(60,80,120,0.10);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40px;\n  color: #fff;\n  position: relative;\n  outline: none;\n  cursor: pointer;\n  transition: background 0.2s, box-shadow 0.2s;\n}\n.player-btn.player-btn-large:hover {\n  background: #e0e3ea;\n  box-shadow: 0 4px 16px rgba(60,80,120,0.16);\n}\n.chevron-btn {\n  font-size: 26px;\n  border: none;\n  background: none;\n  cursor: pointer;\n  color: #b0b8c9;\n  margin: 0 4px;\n  border-radius: 8px;\n  transition: color 0.18s;\n  padding: 3px 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.chevron-btn:disabled {\n  color: #e0e3ea;\n  cursor: not-allowed;\n}\n.chevron-btn:hover:not(:disabled) {\n  color: #1976d2;\n}\n"})]})}}},e=>{var n=n=>e(e.s=n);e.O(0,[464,102,75,605,259,441,684,358],()=>n(46661)),_N_E=e.O()}]);