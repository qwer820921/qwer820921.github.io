(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6299],{10409:(e,t,a)=>{Promise.resolve().then(a.bind(a,53775))},39170:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(95155);a(12115);let s=e=>{let{isLoading:t}=e;return t?(0,l.jsx)("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050},children:(0,l.jsx)("div",{className:"spinner-border text-light",role:"status",children:(0,l.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):null}},53775:(e,t,a)=>{"use strict";a.d(t,{default:()=>j});var l=a(95155),s=a(12115),n=a(23464),c=a(61884);let r="https://script.google.com/macros/s/AKfycbxu5MVPUWIXFzxOM6lFjp3MpeyxMjg2rnjpZlxoFYGBHvnOFqrjJdYv1ZBMllVXAM51/exec",i=async()=>{try{return(await n.A.get("".concat(r,"?action=read"))).data.stockCodes.map(e=>({id:e.id,code:e.code}))}catch(e){throw Error("無法獲取股票代號清單")}},d=async e=>{try{let t=(await n.A.get("".concat(r,"?action=twse&ex_ch=").concat(encodeURIComponent(e),"&json=1&delay=0"))).data;if(!t.msgArray||0===t.msgArray.length)throw Error("API 回傳數據為空");return t.msgArray.map(e=>{var t,a,l,s,n;let r,i,d,o=(null==(t=e.a)?void 0:t.split("_").filter(Boolean))||[],h=(null==(a=e.b)?void 0:a.split("_").filter(Boolean))||[],x=(null==(l=e.f)?void 0:l.split("_").filter(Boolean))||[],m=(null==(s=e.g)?void 0:s.split("_").filter(Boolean))||[],u=o.map((e,t)=>{var a;return"".concat((0,c.M)(e)," (").concat(null!=(a=x[t])?a:"-",")")}),j=h.map((e,t)=>{var a;return"".concat((0,c.M)(e)," (").concat(null!=(a=m[t])?a:"-",")")}),v=parseFloat(null!=(n=e.y)?n:"");for(let t of[e.z,h[0],o[0],e.o]){let e=parseFloat(null!=t?t:"");if(!isNaN(e)&&e>0){r=e;break}}return!isNaN(v)&&void 0!==r&&v>0?(i=parseFloat(((r-v)/v*100).toFixed(2)),d=parseFloat((r-v).toFixed(2))):console.warn("No valid price found for stock ".concat(e.c," (").concat(e.n,"), using undefined for change calculations")),{...e,askPrices:o,askVolumes:x,askCombined:u,bidPrices:h,bidVolumes:m,bidCombined:j,changePercent:i,changePoints:d,currentPrice:r}})}catch(e){console.error("Error fetchStockData:",e)}},o=async e=>{try{await n.A.post(r,null,{params:{action:"create",stockCode:e}})}catch(e){throw Error("無法新增股票代號")}},h=async e=>{try{await n.A.post(r,null,{params:{action:"delete",id:e}})}catch(e){throw Error("無法刪除股票代號")}};var x=a(47832),m=a(60902),u=a(39170);let j=()=>{let[e,t]=(0,s.useState)(0),[a,n]=(0,s.useState)([]),[r,j]=(0,s.useState)(!1),[v,b]=(0,s.useState)(null),[p,f]=(0,s.useState)(!1),[N,g]=(0,s.useState)(0),[w,y]=(0,s.useState)([]),[k,A]=(0,s.useState)(""),[C,F]=(0,s.useState)(!1),[M,S]=(0,s.useState)(void 0),[E,P]=(0,s.useState)(!1),[_,B]=(0,s.useState)(!1),I=async()=>{j(!0);try{let e=await i();if(Array.isArray(e)){y(e);let t=e.map(e=>"tse_".concat(e.code,".tw")).join("|"),a=await d(t),l=null==a?void 0:a.map(t=>{let a=t.ch.replace(".tw",""),l=e.find(e=>e.code===a);return{...t,id:l?l.id:void 0}});n(null!=l?l:[]),b(null)}else throw Error("stockCodes 不是陣列")}catch(e){console.error("錯誤:",e.message),b("資料載入失敗："+e.message)}finally{j(!1)}},z=async()=>{if(w)try{j(!0);let e=w.map(e=>"tse_".concat(e.code,".tw")).join("|"),t=await d(e),a=null==t?void 0:t.map(e=>{let t=e.ch.replace(".tw",""),a=w.find(e=>e.code===t);return{...e,id:a?a.id:void 0}});n(null!=a?a:[]),b(null),j(!1)}catch(e){console.error("Error fetching stock data:",e.message),b("無法獲取股票數據：".concat(e.message)),j(!1)}},L=async()=>{if(!k)return;let e=k.trim();/^\d{4}$/.test(e)&&(e="".concat(e)),B(!0);try{await o(e),A(""),await I(),b(null)}catch(e){console.error("Error adding stock code:",e),b("無法新增股票代號")}finally{B(!1)}},O=async()=>{if(M){P(!0);try{await h(M),I()}catch(e){console.error("Error deleting stock code:",e),b("無法刪除股票代號")}finally{P(!1)}}},H=!0;return(0,s.useEffect)(()=>{H&&I(),H=!1},[]),(0,s.useEffect)(()=>{if(p){let e=setInterval(()=>{g(e=>e>=100?(z(),0):e+20)},1e3);return()=>clearInterval(e)}},[p,w]),(0,s.useEffect)(()=>{let e=()=>t(window.innerWidth);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,l.jsxs)("div",{className:"container py-4 h-100",children:[(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{style:{position:"absolute",width:1,height:1,overflow:"hidden",opacity:0},children:[(0,l.jsx)("h1",{children:"台股資訊"}),(0,l.jsx)("p",{children:"查看最新的台股數據..."})]})}),(0,l.jsx)(u.A,{isLoading:r}),(0,l.jsx)("h1",{className:"mb-4 text-center",children:"台股資訊"}),(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,l.jsxs)("div",{className:"form-check form-switch",children:[(0,l.jsx)("input",{className:"form-check-input",type:"checkbox",id:"refreshModeSwitch",checked:p,onChange:()=>{f(!p),g(0)}}),(0,l.jsx)("label",{className:"form-check-label",htmlFor:"refreshModeSwitch",children:p?"自動刷新開啟":"手動刷新"})]}),!p&&(0,l.jsx)("button",{className:"btn btn-primary",onClick:I,disabled:r,children:r?"正在刷新...":"刷新"})]}),v&&(0,l.jsxs)("div",{className:"alert alert-danger d-flex justify-content-between align-items-center mb-4",children:[(0,l.jsx)("span",{children:v}),(0,l.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:I,children:"重試"})]}),(0,l.jsxs)("div",{className:"input-group mb-3",children:[(0,l.jsx)("input",{type:"text",className:"form-control",placeholder:"輸入股票代號 (如 2330)",value:k,onChange:e=>A(e.target.value)}),(0,l.jsx)("button",{className:"btn btn-outline-secondary",onClick:L,disabled:!k||_,children:_?"新增中...":"新增"})]}),!v&&(0,l.jsx)(l.Fragment,{children:e>=992?(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-bordered table-hover align-middle",children:[(0,l.jsx)("thead",{className:"table-light",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"股票名稱"}),(0,l.jsx)("th",{children:"最新價"}),(0,l.jsx)("th",{children:"漲跌"}),(0,l.jsx)("th",{className:"text-nowrap",children:"幅度"}),(0,l.jsx)("th",{children:"開盤"}),(0,l.jsx)("th",{children:"最高"}),(0,l.jsx)("th",{children:"最低"}),(0,l.jsx)("th",{className:"text-nowrap",children:"成交量(張)"}),(0,l.jsx)("th",{className:"text-nowrap",children:"五檔買價 (數量)"}),(0,l.jsx)("th",{className:"text-nowrap",children:"五檔賣價 (數量)"}),(0,l.jsx)("th",{children:"操作"})]})}),(0,l.jsx)("tbody",{children:a.length>0?a.map((e,t)=>{var a;return(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{children:[e.n," (",e.c,")"]}),(0,l.jsx)("td",{children:(0,c.M)(null==(a=e.currentPrice)?void 0:a.toString())||"-"}),(0,l.jsx)("td",{children:void 0!==e.changePoints?(0,l.jsx)("span",{className:e.changePoints>0?"text-danger":e.changePoints<0?"text-success":"",children:0===e.changePoints?"-":e.changePoints.toFixed(2)}):"N/A"}),(0,l.jsx)("td",{children:void 0!==e.changePercent?(0,l.jsxs)("span",{className:e.changePercent>0?"text-danger":e.changePercent<0?"text-success":"",children:[e.changePercent>0?"+":"",e.changePercent.toFixed(2),"%"]}):"-"}),(0,l.jsx)("td",{children:(0,c.M)(e.o)||"-"}),(0,l.jsx)("td",{children:(0,c.M)(e.h)||"-"}),(0,l.jsx)("td",{children:(0,c.M)(e.l)||"-"}),(0,l.jsx)("td",{className:"text-nowrap",children:e.v||"-"}),(0,l.jsx)("td",{className:"text-nowrap",children:e.bidCombined&&e.bidCombined.length>0?(0,l.jsx)("div",{className:"d-flex flex-column gap-1",children:e.bidCombined.map((e,t)=>(0,l.jsx)("div",{children:e},t))}):"-"}),(0,l.jsx)("td",{className:"text-nowrap",children:e.askCombined&&e.askCombined.length>0?(0,l.jsx)("div",{className:"d-flex flex-column gap-1",children:e.askCombined.map((e,t)=>(0,l.jsx)("div",{children:e},t))}):"-"}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn btn-sm btn-outline-danger text-nowrap",onClick:()=>{F(!0),S(e.id)},disabled:!e.id||E,children:E?"正在刪除...":"刪除股票"})})]},t)}):(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:10,className:"text-center text-muted",children:"無數據可顯示"})})})]})}):(0,l.jsx)("div",{className:"row",children:a.map((e,t)=>{var a;return(0,l.jsx)("div",{className:"col-12 mb-3",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-top mb-3",children:[(0,l.jsx)("div",{className:"m-2",children:(0,l.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>{F(!0),S(e.id)},disabled:!e.id||E,children:E?"正在刪除...":"刪除股票"})}),(0,l.jsx)("div",{className:"accordion",id:"accordion-".concat(t),style:{flex:1},children:(0,l.jsxs)("div",{className:"accordion-item",children:[(0,l.jsx)("h2",{className:"accordion-header",id:"heading-".concat(t),children:(0,l.jsxs)("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse-".concat(t),"aria-expanded":"false","aria-controls":"collapse-".concat(t),children:[e.n," (",e.c,")"]})}),(0,l.jsx)("div",{id:"collapse-".concat(t),className:"accordion-collapse collapse","aria-labelledby":"heading-".concat(t),children:(0,l.jsxs)("div",{className:"accordion-body",children:[[{label:"最新價",value:(0,c.M)(null==(a=e.currentPrice)?void 0:a.toString())},{label:"漲跌",value:e.changePoints},{label:"幅度",value:e.changePercent},{label:"開盤價",value:(0,c.M)(e.o)},{label:"最高價",value:(0,c.M)(e.h)},{label:"最低價",value:(0,c.M)(e.l)},{label:"成交量 (張)",value:e.v?"".concat(e.v):"N/A"}].map((e,t)=>(0,l.jsx)(s.Fragment,{children:"漲跌"===e.label&&"number"==typeof e.value?(0,l.jsxs)("div",{className:"d-flex border-bottom py-2",children:[(0,l.jsx)("div",{className:"fw-bold text-start",style:{width:"50%"},children:e.label}),(0,l.jsx)("div",{className:"text-start",style:{width:"50%",color:e.value>0?"red":e.value<0?"green":"inherit"},children:void 0!==e.value?"".concat(e.value.toFixed(2)):"N/A"})]},t):"幅度"===e.label&&"number"==typeof e.value?(0,l.jsxs)("div",{className:"d-flex border-bottom py-2",children:[(0,l.jsx)("div",{className:"fw-bold text-start",style:{width:"50%"},children:e.label}),(0,l.jsx)("div",{className:"text-start",style:{width:"50%",color:e.value>0?"red":e.value<0?"green":"inherit"},children:void 0!==e.value?"".concat(e.value.toFixed(2),"%"):"N/A"})]},t):(0,l.jsxs)("div",{className:"d-flex border-bottom py-2",children:[(0,l.jsx)("div",{className:"fw-bold text-start",style:{width:"50%"},children:e.label}),(0,l.jsx)("div",{className:"text-start",style:{width:"50%"},children:void 0!==e.value?e.value:"N/A"})]},t)},t)),(0,l.jsxs)("div",{className:"d-flex border-bottom py-2",children:[(0,l.jsx)("div",{className:"fw-bold text-start",style:{width:"50%"},children:"五檔買價（數量）"}),(0,l.jsx)("div",{className:"text-start",style:{width:"50%"},children:e.bidCombined&&e.bidCombined.length>0?(0,l.jsx)("div",{children:e.bidCombined.map((e,t)=>(0,l.jsx)("div",{className:"text-nowrap",children:e},t))}):"N/A"})]}),(0,l.jsxs)("div",{className:"d-flex py-2",children:[(0,l.jsx)("div",{className:"fw-bold text-start",style:{width:"50%"},children:"五檔賣價（數量）"}),(0,l.jsx)("div",{className:"text-start",style:{width:"50%"},children:e.askCombined&&e.askCombined.length>0?(0,l.jsx)("div",{children:e.askCombined.map((e,t)=>(0,l.jsx)("div",{className:"text-nowrap",children:e},t))}):"N/A"})]})]})})]})})]})},t)})})}),(0,l.jsxs)(x.A,{show:C,onHide:()=>{S(void 0),F(!1)},children:[(0,l.jsx)(x.A.Header,{closeButton:!0,children:(0,l.jsx)(x.A.Title,{children:"確認刪除"})}),(0,l.jsx)(x.A.Body,{children:"您確定要刪除這隻股票嗎？這將無法復原。"}),(0,l.jsxs)(x.A.Footer,{children:[(0,l.jsx)(m.A,{variant:"secondary",onClick:()=>{S(void 0),F(!1)},children:"取消"}),(0,l.jsx)(m.A,{variant:"danger",onClick:()=>{M&&(O(),F(!1))},children:"確定刪除"})]})]})]})}},61884:(e,t,a)=>{"use strict";function l(e){if(!e)return"-";let t=parseFloat(e);return isNaN(t)?"-":t.toFixed(2)}function s(e){let t=Math.floor(e/60),a=Math.floor(e%60);return"".concat(t,":").concat(a.toString().padStart(2,"0"))}a.d(t,{M:()=>l,f:()=>s})}},e=>{var t=t=>e(e.s=t);e.O(0,[3464,7102,5075,8441,1684,7358],()=>t(10409)),_N_E=e.O()}]);