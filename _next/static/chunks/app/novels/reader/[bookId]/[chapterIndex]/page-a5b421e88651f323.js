(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5073],{30908:e=>{e.exports={pageContainer:"novels_pageContainer__ahS0I",pageHeader:"novels_pageHeader___b4E7",novelGrid:"novels_novelGrid__vbCIi",card:"novels_card__7t6VH",coverWrapper:"novels_coverWrapper__kiuSJ",coverImage:"novels_coverImage__gHLR8",noCover:"novels_noCover__Zc8Xb",statusBadge:"novels_statusBadge__bA6WA",cardContent:"novels_cardContent__TGtTu",bookTitle:"novels_bookTitle__KRDP1",authorName:"novels_authorName__CrtPO",tagsContainer:"novels_tagsContainer__a0Uve",tag:"novels_tag__c0iRx",metaData:"novels_metaData__Y9E_w",loadingState:"novels_loadingState__uQeq0",errorState:"novels_errorState__beznA",emptyState:"novels_emptyState__otVM1",retryBtn:"novels_retryBtn__dHS2x",backNav:"novels_backNav__JlxT_",detailHeader:"novels_detailHeader__8SOUZ",detailCover:"novels_detailCover__xafPD",detailInfo:"novels_detailInfo__gCSVy",favoriteBtn:"novels_favoriteBtn__oPZqB",favorited:"novels_favorited__loLkz",summarySection:"novels_summarySection__m_reN",chaptersSection:"novels_chaptersSection__NAUJf",chaptersHeader:"novels_chaptersHeader__Kbt_I",chapterCount:"novels_chapterCount__JQLYi",chapterList:"novels_chapterList__ncPhF",chapterItem:"novels_chapterItem___0Bkf",chapterTitle:"novels_chapterTitle__uAPX_",chapterDate:"novels_chapterDate__SqCQQ",bottomTabs:"novels_bottomTabs__d3aUY",tabItem:"novels_tabItem__6fIX5",tabIcon:"novels_tabIcon__AoED4",tabLabel:"novels_tabLabel__PIZoB",tabActive:"novels_tabActive__Hs_A2",settingsSection:"novels_settingsSection__l699M",settingsSectionTitle:"novels_settingsSectionTitle__NVHab",themeSelector:"novels_themeSelector__6SYJw",themeOption:"novels_themeOption__sDRch",themeCircle:"novels_themeCircle__rzvZA",themeOptionActive:"novels_themeOptionActive__tkjyo",themeLabel:"novels_themeLabel__nM_uf",settingsRow:"novels_settingsRow__DOgd0",settingsRowLabel:"novels_settingsRowLabel__AIImX",fontFamilySelector:"novels_fontFamilySelector__771g8",fontFamilyOption:"novels_fontFamilyOption__Wea3K",fontFamilyActive:"novels_fontFamilyActive___lvqQ",fontSizeControl:"novels_fontSizeControl__xmRbq",fontSizeBtn:"novels_fontSizeBtn__KwMeL",fontSizeValue:"novels_fontSizeValue__5GaLY",lineHeightSelector:"novels_lineHeightSelector__4Sj39",lineHeightOption:"novels_lineHeightOption__tZVfF",lineHeightActive:"novels_lineHeightActive__R_mMj",previewBox:"novels_previewBox__jj_wD",settingsActions:"novels_settingsActions__9iDco",resetBtn:"novels_resetBtn__KERdO",readerContainer:"novels_readerContainer__Eytc9",readerHeader:"novels_readerHeader__hJkq0",readerBackLink:"novels_readerBackLink__QEFYZ",readerHeaderRight:"novels_readerHeaderRight__toxrl",readerTitle:"novels_readerTitle__oDT2E",readerMeta:"novels_readerMeta__95gYw",readerContent:"novels_readerContent__QE0Pa",authorNoteBox:"novels_authorNoteBox__n9t2e",readerFooterNav:"novels_readerFooterNav__t0KSo",navBtn:"novels_navBtn__EEBTN",navBtnDisabled:"novels_navBtnDisabled__5t_7G",navBtnGhost:"novels_navBtnGhost__mmro_",readerLoading:"novels_readerLoading__4JcEm",readerError:"novels_readerError__E8EY_",readerNavButtons:"novels_readerNavButtons__Xkt_g",tocDrawer:"novels_tocDrawer__36mjB",tocDrawerOpen:"novels_tocDrawerOpen__6Ljbr",tocHeader:"novels_tocHeader__CaOi_",tocCount:"novels_tocCount__a1_8Y",tocList:"novels_tocList__b5cym",tocItem:"novels_tocItem__T2dV2",tocItemActive:"novels_tocItemActive__YLrzN",tocItemDate:"novels_tocItemDate__QNYtm",readerSettingsBtn:"novels_readerSettingsBtn__lkSA_",menuOverlay:"novels_menuOverlay__1K6_B",menuOverlayVisible:"novels_menuOverlayVisible__ht7Sv",readerMenu:"novels_readerMenu__Mnnh7",readerMenuOpen:"novels_readerMenuOpen__ppTwm",menuHandle:"novels_menuHandle__2yj9Y",menuHandleBar:"novels_menuHandleBar__M0wSQ",menuSection:"novels_menuSection__AaMn1",menuSectionLabel:"novels_menuSectionLabel__8nOnS",menuThemeRow:"novels_menuThemeRow__S8TAQ",menuThemeBtn:"novels_menuThemeBtn__MLmm7",menuThemeBtnActive:"novels_menuThemeBtnActive__uZEIE",menuFontSizeRow:"novels_menuFontSizeRow__HwGk7",menuStepBtn:"novels_menuStepBtn__nSBFT",menuFontSizeValue:"novels_menuFontSizeValue__FR_AW",menuFontFamilyRow:"novels_menuFontFamilyRow__WYfqF",menuFontFamilyBtn:"novels_menuFontFamilyBtn__JTSF8",menuFontFamilyBtnActive:"novels_menuFontFamilyBtnActive__L1YJ2",menuLineHeightRow:"novels_menuLineHeightRow__pwMed",menuLineHeightBtn:"novels_menuLineHeightBtn__mfVBH",menuLineHeightBtnActive:"novels_menuLineHeightBtnActive__fFD0G"}},32588:(e,t,n)=>{"use strict";n.d(t,{L3:()=>l,hE:()=>r,wK:()=>s});var a=n(23464);let o="https://script.google.com/macros/s/AKfycbyXrD_ddpu_Z9w-DeUroC4mniQrwKsHdCQWbaE3o2dDlwSvHVB3fLapwepgA3dFaDfi4Q/exec",s=async()=>{try{let e=await a.A.get("".concat(o,"?action=getLibrary"));if(!e.data||"boolean"!=typeof e.data.success)throw Error("Unexpected response format: Expected success boolean");if(e.data.success&&!Array.isArray(e.data.data))throw Error("Unexpected response format: Expected data to be an array");return e.data}catch(e){throw console.error("Error fetching library data:",e),e}},r=async e=>{try{if(!e||"string"!=typeof e)throw Error("Book ID is required and must be a string");let t=await a.A.get("".concat(o,"?action=getChapters&bookId=").concat(e));if(!t.data||"boolean"!=typeof t.data.success)throw Error("Unexpected response format: Expected success boolean");if(t.data.success&&!Array.isArray(t.data.data))throw Error("Unexpected response format: Expected data to be an array");return t.data}catch(t){throw console.error("Error fetching chapters for book ".concat(e,":"),t),t}},l=async(e,t)=>{try{if(!e||"string"!=typeof e)throw Error("Book ID is required and must be a string");if(!Number.isInteger(t)||t<=0)throw Error("Chapter Index must be a positive integer");let n=await a.A.get("".concat(o,"?action=getChapterContent&bookId=").concat(e,"&chapterIndex=").concat(t));if(!n.data||"boolean"!=typeof n.data.success)throw Error("Unexpected response format: Expected success boolean");if(!n.data.success)throw Error(n.data.error||"Failed to fetch chapter content");return n.data}catch(n){throw console.error("Error fetching content for book ".concat(e,", chapter ").concat(t,":"),n),n}}},34033:(e,t,n)=>{Promise.resolve().then(n.bind(n,72705))},35695:(e,t,n)=>{"use strict";var a=n(18999);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}})},55663:(e,t,n)=>{"use strict";n.d(t,{c7:()=>o,cT:()=>s,e4:()=>r});let a={SETTINGS:"novel_reader_settings",COLLECTION:"novel_my_collection"},o=(e,t)=>{try{let n=localStorage.getItem(a[e]);return n?JSON.parse(n):t}catch(n){return console.error("Error reading ".concat(e," from localStorage"),n),t}},s=(e,t)=>{try{localStorage.setItem(a[e],JSON.stringify(t))}catch(t){console.error("Error saving ".concat(e," to localStorage"),t)}},r=e=>{if(!e)return e;let t=e.match(/drive\.google\.com\/uc\?.*id=([^&]+)/);if(null==t?void 0:t[1])return"https://lh3.googleusercontent.com/d/".concat(t[1]);let n=e.match(/drive\.google\.com\/file\/d\/([^/]+)/);return(null==n?void 0:n[1])?"https://lh3.googleusercontent.com/d/".concat(n[1]):e}},72705:(e,t,n)=>{"use strict";n.d(t,{default:()=>h});var a=n(95155),o=n(12115),s=n(6874),r=n.n(s),l=n(35695),c=n(32588),i=n(55663),_=n(99512),d=n(30908),m=n.n(d);function v(e){let{isOpen:t,settings:n,onSettingsChange:o,onClose:s}=e,r=e=>{let t={...n,...e};o(t),(0,i.cT)("SETTINGS",t)},l=_.LC.fontSizes,c=l.indexOf(n.fontSize);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"".concat(m().menuOverlay," ").concat(t?m().menuOverlayVisible:""),onClick:s}),(0,a.jsxs)("div",{className:"".concat(m().readerMenu," ").concat(t?m().readerMenuOpen:""),children:[(0,a.jsx)("div",{className:m().menuHandle,onClick:s,children:(0,a.jsx)("span",{className:m().menuHandleBar})}),(0,a.jsxs)("div",{className:m().menuSection,children:[(0,a.jsx)("span",{className:m().menuSectionLabel,children:"主題"}),(0,a.jsx)("div",{className:m().menuThemeRow,children:_.LC.themes.map(e=>{let t=_.lt[e.id],o=n.theme===e.id;return(0,a.jsx)("button",{className:"".concat(m().menuThemeBtn," ").concat(o?m().menuThemeBtnActive:""),onClick:()=>r({theme:e.id}),style:{backgroundColor:t.background,color:t.text},"aria-label":"切換至".concat(e.label,"主題"),children:e.label},e.id)})})]}),(0,a.jsxs)("div",{className:m().menuSection,children:[(0,a.jsx)("span",{className:m().menuSectionLabel,children:"字級"}),(0,a.jsxs)("div",{className:m().menuFontSizeRow,children:[(0,a.jsx)("button",{className:m().menuStepBtn,onClick:()=>{c>0&&r({fontSize:l[c-1]})},disabled:c<=0,children:"A−"}),(0,a.jsxs)("span",{className:m().menuFontSizeValue,children:[n.fontSize,"px"]}),(0,a.jsx)("button",{className:m().menuStepBtn,onClick:()=>{c<l.length-1&&r({fontSize:l[c+1]})},disabled:c>=l.length-1,children:"A+"})]})]}),(0,a.jsxs)("div",{className:m().menuSection,children:[(0,a.jsx)("span",{className:m().menuSectionLabel,children:"字體"}),(0,a.jsx)("div",{className:m().menuFontFamilyRow,children:_.LC.fontFamilies.map(e=>(0,a.jsx)("button",{className:"".concat(m().menuFontFamilyBtn," ").concat(n.fontFamily===e.id?m().menuFontFamilyBtnActive:""),onClick:()=>r({fontFamily:e.id}),style:{fontFamily:e.id},children:e.label},e.id))})]}),(0,a.jsxs)("div",{className:m().menuSection,children:[(0,a.jsx)("span",{className:m().menuSectionLabel,children:"行距"}),(0,a.jsx)("div",{className:m().menuLineHeightRow,children:_.LC.lineHeights.map(e=>(0,a.jsxs)("button",{className:"".concat(m().menuLineHeightBtn," ").concat(n.lineHeight===e?m().menuLineHeightBtnActive:""),onClick:()=>r({lineHeight:e}),children:[e,"x"]},e))})]})]})]})}function h(e){let{bookId:t,chapterIndex:n}=e,s=(0,l.useRouter)(),[d,h]=(0,o.useState)(null),[u,g]=(0,o.useState)([]),[p,f]=(0,o.useState)(_.kR),[b,S]=(0,o.useState)(!0),[x,N]=(0,o.useState)(null),[y,B]=(0,o.useState)(!1),[j,C]=(0,o.useState)(!1);(0,o.useEffect)(()=>{f((0,i.c7)("SETTINGS",_.kR))},[]);let w=_.lt[p.theme];(0,o.useEffect)(()=>{(async()=>{try{S(!0),N(null);let e=await (0,c.L3)(t,n);e.success&&e.data?(h(e.data),window.scrollTo(0,0)):N("無法取得章節內容，可能是作者還沒發布喔！")}catch(e){N(e instanceof Error?e.message:"章節載入失敗"),console.error(e)}finally{S(!1)}})()},[t,n]),(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,c.hE)(t);e.success&&e.data&&g(e.data)}catch(e){console.error("載入章節目錄失敗:",e)}})()},[t]);let k=(0,o.useCallback)(e=>{let t=e.target;if(t.closest("a")||t.closest("button"))return;let n=e.currentTarget.getBoundingClientRect(),a=e.clientY-n.top,o=n.height/3;a>o&&a<2*o&&B(e=>!e)},[]);return((0,o.useEffect)(()=>(y||j?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[y,j]),b)?(0,a.jsx)("div",{className:m().readerLoading,children:"靈力運轉中，正在載入章節..."}):x||!d?(0,a.jsxs)("div",{className:m().readerError,children:[(0,a.jsx)("h2",{children:"前方沒有路了"}),(0,a.jsx)("p",{children:x}),(0,a.jsxs)("div",{className:m().readerNavButtons,children:[(0,a.jsx)("button",{onClick:()=>s.push("/novels/".concat(t)),className:m().navBtn,children:"返回目錄"}),n>1&&(0,a.jsx)("button",{onClick:()=>s.push("/novels/reader/".concat(t,"/").concat(n-1)),className:m().navBtn,children:"回上一章"})]})]}):(0,a.jsxs)("div",{className:m().readerContainer,style:{backgroundColor:w.background,color:w.text,fontSize:"".concat(p.fontSize,"px"),fontFamily:p.fontFamily,lineHeight:p.lineHeight},onClick:k,children:[(0,a.jsxs)("div",{className:m().readerHeader,children:[(0,a.jsx)(r(),{href:"/novels/".concat(t),className:m().readerBackLink,children:"← 返回"}),(0,a.jsxs)("div",{className:m().readerHeaderRight,children:[(0,a.jsx)("button",{className:m().readerSettingsBtn,onClick:()=>C(!0),"aria-label":"開啟目錄",children:"☰"}),(0,a.jsx)("button",{className:m().readerSettingsBtn,onClick:()=>B(!0),"aria-label":"開啟閱讀設定",children:"Aa"})]})]}),(0,a.jsx)("h1",{className:m().readerTitle,children:d.chapter_title}),(0,a.jsxs)("p",{className:m().readerMeta,children:["字數：",d.word_count.toLocaleString()," 字 | 發布於：",d.publish_date]}),(0,a.jsx)("div",{className:m().readerContent,children:d.content}),d.author_note&&(0,a.jsxs)("div",{className:m().authorNoteBox,children:[(0,a.jsx)("strong",{children:"作者有話說："}),(0,a.jsx)("p",{children:d.author_note})]}),(0,a.jsxs)("div",{className:m().readerFooterNav,children:[n>1?(0,a.jsx)(r(),{href:"/novels/reader/".concat(t,"/").concat(n-1),className:m().navBtn,children:"上一章"}):(0,a.jsx)("div",{className:m().navBtnDisabled,children:"已是第一章"}),(0,a.jsx)("button",{className:m().navBtnGhost,onClick:()=>C(!0),children:"目錄"}),(0,a.jsx)(r(),{href:"/novels/reader/".concat(t,"/").concat(n+1),className:m().navBtn,children:"下一章"})]}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"".concat(m().menuOverlay," ").concat(j?m().menuOverlayVisible:""),onClick:()=>C(!1)}),(0,a.jsxs)("div",{className:"".concat(m().tocDrawer," ").concat(j?m().tocDrawerOpen:""),children:[(0,a.jsx)("div",{className:m().menuHandle,onClick:()=>C(!1),children:(0,a.jsx)("span",{className:m().menuHandleBar})}),(0,a.jsxs)("div",{className:m().tocHeader,children:[(0,a.jsx)("h3",{children:"章節目錄"}),(0,a.jsxs)("span",{className:m().tocCount,children:["共 ",u.length," 章"]})]}),(0,a.jsx)("div",{className:m().tocList,children:u.map(e=>(0,a.jsxs)(r(),{href:"/novels/reader/".concat(t,"/").concat(e.chapter_index),className:"".concat(m().tocItem," ").concat(e.chapter_index===n?m().tocItemActive:""),onClick:()=>C(!1),children:[(0,a.jsxs)("span",{children:["第 ",e.chapter_index," 章　",e.chapter_title]}),(0,a.jsx)("span",{className:m().tocItemDate,children:e.publish_date})]},e.chapter_index))})]})]}),(0,a.jsx)(v,{isOpen:y,settings:p,onSettingsChange:f,onClose:()=>B(!1)})]})}},99512:(e,t,n)=>{"use strict";n.d(t,{LC:()=>s,kR:()=>a,lt:()=>o});let a={theme:"sepia",fontSize:18,fontFamily:"sans-serif",lineHeight:1.8},o={light:{background:"#ffffff",text:"#333333"},sepia:{background:"#f4ecd8",text:"#5b4636"},dark:{background:"#1a1a1a",text:"#cccccc"}},s={fontSizes:[14,16,18,20,22,24,28,32],lineHeights:[1.5,1.8,2,2.2],themes:[{id:"light",label:"明亮"},{id:"sepia",label:"護眼"},{id:"dark",label:"深色"}],fontFamilies:[{id:"sans-serif",label:"黑體"},{id:"serif",label:"明體"}]}}},e=>{var t=t=>e(e.s=t);e.O(0,[5095,3464,6874,8441,1684,7358],()=>t(34033)),_N_E=e.O()}]);