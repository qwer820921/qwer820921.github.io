(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5073],{13742:(e,n,a)=>{"use strict";a.d(n,{A:()=>r});var s=a(95155),t=a(55663),c=a(99512),l=a(30908),i=a.n(l);function r(e){let{isOpen:n,settings:a,onSettingsChange:l,onClose:r}=e,o=e=>{let n={...a,...e};l(n),(0,t.cT)("SETTINGS",n)},d=c.LC.fontSizes,h=d.indexOf(a.fontSize);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(i().menuOverlay," ").concat(n?i().menuOverlayVisible:""),onClick:r}),(0,s.jsxs)("div",{className:"".concat(i().readerMenu," ").concat(n?i().readerMenuOpen:""),children:[(0,s.jsx)("div",{className:i().menuHandle,onClick:r,children:(0,s.jsx)("span",{className:i().menuHandleBar})}),(0,s.jsxs)("div",{className:i().menuSection,children:[(0,s.jsx)("span",{className:i().menuSectionLabel,children:"主題"}),(0,s.jsx)("div",{className:i().menuThemeRow,children:c.LC.themes.map(e=>{let n=c.lt[e.id],t=a.theme===e.id;return(0,s.jsx)("button",{className:"".concat(i().menuThemeBtn," ").concat(t?i().menuThemeBtnActive:""),onClick:()=>o({theme:e.id}),style:{backgroundColor:n.background,color:n.text},"aria-label":"切換至".concat(e.label,"主題"),children:e.label},e.id)})})]}),(0,s.jsxs)("div",{className:i().menuSection,children:[(0,s.jsx)("span",{className:i().menuSectionLabel,children:"字級"}),(0,s.jsxs)("div",{className:i().menuFontSizeRow,children:[(0,s.jsx)("button",{className:i().menuStepBtn,onClick:()=>{h>0&&o({fontSize:d[h-1]})},disabled:h<=0,children:"A−"}),(0,s.jsxs)("span",{className:i().menuFontSizeValue,children:[a.fontSize,"px"]}),(0,s.jsx)("button",{className:i().menuStepBtn,onClick:()=>{h<d.length-1&&o({fontSize:d[h+1]})},disabled:h>=d.length-1,children:"A+"})]})]}),(0,s.jsxs)("div",{className:i().menuSection,children:[(0,s.jsx)("span",{className:i().menuSectionLabel,children:"字體"}),(0,s.jsx)("div",{className:i().menuFontFamilyRow,children:c.LC.fontFamilies.map(e=>(0,s.jsx)("button",{className:"".concat(i().menuFontFamilyBtn," ").concat(a.fontFamily===e.id?i().menuFontFamilyBtnActive:""),onClick:()=>o({fontFamily:e.id}),style:{fontFamily:e.id},children:e.label},e.id))})]}),(0,s.jsxs)("div",{className:i().menuSection,children:[(0,s.jsx)("span",{className:i().menuSectionLabel,children:"行距"}),(0,s.jsx)("div",{className:i().menuLineHeightRow,children:c.LC.lineHeights.map(e=>(0,s.jsxs)("button",{className:"".concat(i().menuLineHeightBtn," ").concat(a.lineHeight===e?i().menuLineHeightBtnActive:""),onClick:()=>o({lineHeight:e}),children:[e,"x"]},e))})]})]})]})}},24785:(e,n,a)=>{"use strict";a.d(n,{default:()=>j});var s=a(95155),t=a(12115),c=a(6874),l=a.n(c),i=a(35695),r=a(32588),o=a(26682),d=a(55663),h=a(13742),m=a(30908),u=a.n(m),x=a(99512);function j(e){var n,a;let{bookId:c,chapterIndex:m}=e,j=(0,i.useRouter)(),{chaptersMap:N,fetchChapters:v}=(0,o.z)(),f=null!=(a=null==(n=N[c])?void 0:n.data)?a:[],[p,b]=(0,t.useState)(null),[g,S]=(0,t.useState)(x.kR),[k,C]=(0,t.useState)(!0),[y,B]=(0,t.useState)(null),[F,w]=(0,t.useState)(!1),[H,L]=(0,t.useState)(!1),[_,R]=(0,t.useState)(m);(0,t.useEffect)(()=>{try{let e=sessionStorage.getItem("spa-redirect-chapter");if(!e)return;sessionStorage.removeItem("spa-redirect-chapter");let n=JSON.parse(e);n.bookId===c&&n.chapterIndex!==m&&(R(n.chapterIndex),window.history.replaceState(null,"",n.originalPath))}catch(e){}},[c,m]),(0,t.useEffect)(()=>{S((0,d.c7)("SETTINGS",x.kR))},[]);let z=x.lt[g.theme];(0,t.useEffect)(()=>{(async()=>{try{C(!0),B(null);let e=await (0,r.L3)(c,_);e.success&&e.data?(b(e.data),window.scrollTo(0,0)):B("無法取得章節內容，可能是作者還沒發布喔！")}catch(e){B(e instanceof Error?e.message:"章節載入失敗"),console.error(e)}finally{C(!1)}})()},[c,_]),(0,t.useEffect)(()=>{v(c)},[c,v]);let E=(0,t.useCallback)(e=>{let n=e.target;if(n.closest("a")||n.closest("button"))return;let a=e.currentTarget.getBoundingClientRect(),s=e.clientY-a.top,t=a.height/3;s>t&&s<2*t&&w(e=>!e)},[]);return((0,t.useEffect)(()=>(F||H?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[F,H]),k)?(0,s.jsx)("div",{className:u().readerLoading,children:"靈力運轉中，正在載入章節..."}):y||!p?(0,s.jsxs)("div",{className:u().readerError,children:[(0,s.jsx)("h2",{children:"前方沒有路了"}),(0,s.jsx)("p",{children:y}),(0,s.jsxs)("div",{className:u().readerNavButtons,children:[(0,s.jsx)("button",{onClick:()=>j.push("/novels/".concat(c)),className:u().navBtn,children:"返回目錄"}),_>1&&(0,s.jsx)("button",{onClick:()=>j.push("/novels/reader/".concat(c,"/").concat(_-1)),className:u().navBtn,children:"回上一章"})]})]}):(0,s.jsxs)("div",{className:u().readerContainer,style:{backgroundColor:z.background,color:z.text,fontSize:"".concat(g.fontSize,"px"),fontFamily:g.fontFamily,lineHeight:g.lineHeight},onClick:E,children:[(0,s.jsxs)("div",{className:u().readerHeader,children:[(0,s.jsx)(l(),{href:"/novels/".concat(c),className:u().readerBackLink,children:"← 返回"}),(0,s.jsxs)("div",{className:u().readerHeaderRight,children:[(0,s.jsx)("button",{className:u().readerSettingsBtn,onClick:()=>L(!0),"aria-label":"開啟目錄",children:"☰"}),(0,s.jsx)("button",{className:u().readerSettingsBtn,onClick:()=>w(!0),"aria-label":"開啟閱讀設定",children:"Aa"})]})]}),(0,s.jsx)("h1",{className:u().readerTitle,children:p.chapter_title}),(0,s.jsxs)("p",{className:u().readerMeta,children:["字數：",p.word_count.toLocaleString()," 字 | 發布於：",p.publish_date]}),(0,s.jsx)("div",{className:u().readerContent,children:p.content}),p.author_note&&(0,s.jsxs)("div",{className:u().authorNoteBox,children:[(0,s.jsx)("strong",{children:"作者有話說："}),(0,s.jsx)("p",{children:p.author_note})]}),(0,s.jsxs)("div",{className:u().readerFooterNav,children:[_>1?(0,s.jsx)(l(),{href:"/novels/reader/".concat(c,"/").concat(_-1),className:u().navBtn,children:"上一章"}):(0,s.jsx)("div",{className:u().navBtnDisabled,children:"已是第一章"}),(0,s.jsx)("button",{className:u().navBtnGhost,onClick:()=>L(!0),children:"目錄"}),(0,s.jsx)(l(),{href:"/novels/reader/".concat(c,"/").concat(_+1),className:u().navBtn,children:"下一章"})]}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(u().menuOverlay," ").concat(H?u().menuOverlayVisible:""),onClick:()=>L(!1)}),(0,s.jsxs)("div",{className:"".concat(u().tocDrawer," ").concat(H?u().tocDrawerOpen:""),children:[(0,s.jsx)("div",{className:u().menuHandle,onClick:()=>L(!1),children:(0,s.jsx)("span",{className:u().menuHandleBar})}),(0,s.jsxs)("div",{className:u().tocHeader,children:[(0,s.jsx)("h3",{children:"章節目錄"}),(0,s.jsxs)("span",{className:u().tocCount,children:["共 ",f.length," 章"]})]}),(0,s.jsx)("div",{className:u().tocList,children:f.map(e=>(0,s.jsxs)(l(),{href:"/novels/reader/".concat(c,"/").concat(e.chapter_index),className:"".concat(u().tocItem," ").concat(e.chapter_index===_?u().tocItemActive:""),onClick:()=>L(!1),children:[(0,s.jsxs)("span",{children:["第 ",e.chapter_index," 章　",e.chapter_title]}),(0,s.jsx)("span",{className:u().tocItemDate,children:e.publish_date})]},e.chapter_index))})]})]}),(0,s.jsx)(h.A,{isOpen:F,settings:g,onSettingsChange:S,onClose:()=>w(!1)})]})}},34033:(e,n,a)=>{Promise.resolve().then(a.bind(a,24785))},35695:(e,n,a)=>{"use strict";var s=a(18999);a.o(s,"usePathname")&&a.d(n,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(n,{useRouter:function(){return s.useRouter}})},99512:(e,n,a)=>{"use strict";a.d(n,{LC:()=>c,kR:()=>s,lt:()=>t});let s={theme:"sepia",fontSize:18,fontFamily:"sans-serif",lineHeight:1.8},t={light:{background:"#ffffff",text:"#333333"},sepia:{background:"#f4ecd8",text:"#5b4636"},dark:{background:"#1a1a1a",text:"#cccccc"}},c={fontSizes:[14,16,18,20,22,24,28,32],lineHeights:[1.5,1.8,2,2.2],themes:[{id:"light",label:"明亮"},{id:"sepia",label:"護眼"},{id:"dark",label:"深色"}],fontFamilies:[{id:"sans-serif",label:"黑體"},{id:"serif",label:"明體"}]}}},e=>{var n=n=>e(e.s=n);e.O(0,[5095,3464,6874,7031,8441,1684,7358],()=>n(34033)),_N_E=e.O()}]);