(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7130],{2164:(e,t,n)=>{Promise.resolve().then(n.bind(n,89996))},30908:e=>{e.exports={pageContainer:"novels_pageContainer__ahS0I",pageHeader:"novels_pageHeader___b4E7",novelGrid:"novels_novelGrid__vbCIi",card:"novels_card__7t6VH",coverWrapper:"novels_coverWrapper__kiuSJ",coverImage:"novels_coverImage__gHLR8",noCover:"novels_noCover__Zc8Xb",statusBadge:"novels_statusBadge__bA6WA",cardContent:"novels_cardContent__TGtTu",bookTitle:"novels_bookTitle__KRDP1",authorName:"novels_authorName__CrtPO",tagsContainer:"novels_tagsContainer__a0Uve",tag:"novels_tag__c0iRx",metaData:"novels_metaData__Y9E_w",loadingState:"novels_loadingState__uQeq0",errorState:"novels_errorState__beznA",emptyState:"novels_emptyState__otVM1",retryBtn:"novels_retryBtn__dHS2x",backNav:"novels_backNav__JlxT_",detailHeader:"novels_detailHeader__8SOUZ",detailCover:"novels_detailCover__xafPD",detailInfo:"novels_detailInfo__gCSVy",favoriteBtn:"novels_favoriteBtn__oPZqB",favorited:"novels_favorited__loLkz",summarySection:"novels_summarySection__m_reN",chaptersSection:"novels_chaptersSection__NAUJf",chaptersHeader:"novels_chaptersHeader__Kbt_I",chapterCount:"novels_chapterCount__JQLYi",chapterList:"novels_chapterList__ncPhF",chapterItem:"novels_chapterItem___0Bkf",chapterTitle:"novels_chapterTitle__uAPX_",chapterDate:"novels_chapterDate__SqCQQ",bottomTabs:"novels_bottomTabs__d3aUY",tabItem:"novels_tabItem__6fIX5",tabIcon:"novels_tabIcon__AoED4",tabLabel:"novels_tabLabel__PIZoB",tabActive:"novels_tabActive__Hs_A2",settingsSection:"novels_settingsSection__l699M",settingsSectionTitle:"novels_settingsSectionTitle__NVHab",themeSelector:"novels_themeSelector__6SYJw",themeOption:"novels_themeOption__sDRch",themeCircle:"novels_themeCircle__rzvZA",themeOptionActive:"novels_themeOptionActive__tkjyo",themeLabel:"novels_themeLabel__nM_uf",settingsRow:"novels_settingsRow__DOgd0",settingsRowLabel:"novels_settingsRowLabel__AIImX",fontFamilySelector:"novels_fontFamilySelector__771g8",fontFamilyOption:"novels_fontFamilyOption__Wea3K",fontFamilyActive:"novels_fontFamilyActive___lvqQ",fontSizeControl:"novels_fontSizeControl__xmRbq",fontSizeBtn:"novels_fontSizeBtn__KwMeL",fontSizeValue:"novels_fontSizeValue__5GaLY",lineHeightSelector:"novels_lineHeightSelector__4Sj39",lineHeightOption:"novels_lineHeightOption__tZVfF",lineHeightActive:"novels_lineHeightActive__R_mMj",previewBox:"novels_previewBox__jj_wD",settingsActions:"novels_settingsActions__9iDco",resetBtn:"novels_resetBtn__KERdO",readerContainer:"novels_readerContainer__Eytc9",readerHeader:"novels_readerHeader__hJkq0",readerBackLink:"novels_readerBackLink__QEFYZ",readerHeaderRight:"novels_readerHeaderRight__toxrl",readerTitle:"novels_readerTitle__oDT2E",readerMeta:"novels_readerMeta__95gYw",readerContent:"novels_readerContent__QE0Pa",authorNoteBox:"novels_authorNoteBox__n9t2e",readerFooterNav:"novels_readerFooterNav__t0KSo",navBtn:"novels_navBtn__EEBTN",navBtnDisabled:"novels_navBtnDisabled__5t_7G",navBtnGhost:"novels_navBtnGhost__mmro_",readerLoading:"novels_readerLoading__4JcEm",readerError:"novels_readerError__E8EY_",readerNavButtons:"novels_readerNavButtons__Xkt_g",tocDrawer:"novels_tocDrawer__36mjB",tocDrawerOpen:"novels_tocDrawerOpen__6Ljbr",tocHeader:"novels_tocHeader__CaOi_",tocCount:"novels_tocCount__a1_8Y",tocList:"novels_tocList__b5cym",tocItem:"novels_tocItem__T2dV2",tocItemActive:"novels_tocItemActive__YLrzN",tocItemDate:"novels_tocItemDate__QNYtm",readerSettingsBtn:"novels_readerSettingsBtn__lkSA_",menuOverlay:"novels_menuOverlay__1K6_B",menuOverlayVisible:"novels_menuOverlayVisible__ht7Sv",readerMenu:"novels_readerMenu__Mnnh7",readerMenuOpen:"novels_readerMenuOpen__ppTwm",menuHandle:"novels_menuHandle__2yj9Y",menuHandleBar:"novels_menuHandleBar__M0wSQ",menuSection:"novels_menuSection__AaMn1",menuSectionLabel:"novels_menuSectionLabel__8nOnS",menuThemeRow:"novels_menuThemeRow__S8TAQ",menuThemeBtn:"novels_menuThemeBtn__MLmm7",menuThemeBtnActive:"novels_menuThemeBtnActive__uZEIE",menuFontSizeRow:"novels_menuFontSizeRow__HwGk7",menuStepBtn:"novels_menuStepBtn__nSBFT",menuFontSizeValue:"novels_menuFontSizeValue__FR_AW",menuFontFamilyRow:"novels_menuFontFamilyRow__WYfqF",menuFontFamilyBtn:"novels_menuFontFamilyBtn__JTSF8",menuFontFamilyBtnActive:"novels_menuFontFamilyBtnActive__L1YJ2",menuLineHeightRow:"novels_menuLineHeightRow__pwMed",menuLineHeightBtn:"novels_menuLineHeightBtn__mfVBH",menuLineHeightBtnActive:"novels_menuLineHeightBtnActive__fFD0G"}},32495:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var a=n(95155),o=n(6874),r=n.n(o),s=n(35695),_=n(30908),l=n.n(_);let c=[{label:"全部",path:"/novels",icon:"\uD83D\uDCDA",exact:!0},{label:"書櫃",path:"/novels/collection",icon:"⭐",exact:!1},{label:"設定",path:"/novels/settings",icon:"⚙️",exact:!1}];function i(){let e=(0,s.usePathname)();return(0,a.jsx)("nav",{className:l().bottomTabs,children:c.map(t=>{let n=t.exact?e===t.path:e.startsWith(t.path);return(0,a.jsxs)(r(),{href:t.path,className:"".concat(l().tabItem," ").concat(n?l().tabActive:""),children:[(0,a.jsx)("span",{className:l().tabIcon,children:t.icon}),(0,a.jsx)("span",{className:l().tabLabel,children:t.label})]},t.path)})})}},32588:(e,t,n)=>{"use strict";n.d(t,{L3:()=>_,hE:()=>s,wK:()=>r});var a=n(23464);let o="https://script.google.com/macros/s/AKfycbyXrD_ddpu_Z9w-DeUroC4mniQrwKsHdCQWbaE3o2dDlwSvHVB3fLapwepgA3dFaDfi4Q/exec",r=async()=>{try{let e=await a.A.get("".concat(o,"?action=getLibrary"));if(!e.data||"boolean"!=typeof e.data.success)throw Error("Unexpected response format: Expected success boolean");if(e.data.success&&!Array.isArray(e.data.data))throw Error("Unexpected response format: Expected data to be an array");return e.data}catch(e){throw console.error("Error fetching library data:",e),e}},s=async e=>{try{if(!e||"string"!=typeof e)throw Error("Book ID is required and must be a string");let t=await a.A.get("".concat(o,"?action=getChapters&bookId=").concat(e));if(!t.data||"boolean"!=typeof t.data.success)throw Error("Unexpected response format: Expected success boolean");if(t.data.success&&!Array.isArray(t.data.data))throw Error("Unexpected response format: Expected data to be an array");return t.data}catch(t){throw console.error("Error fetching chapters for book ".concat(e,":"),t),t}},_=async(e,t)=>{try{if(!e||"string"!=typeof e)throw Error("Book ID is required and must be a string");if(!Number.isInteger(t)||t<=0)throw Error("Chapter Index must be a positive integer");let n=await a.A.get("".concat(o,"?action=getChapterContent&bookId=").concat(e,"&chapterIndex=").concat(t));if(!n.data||"boolean"!=typeof n.data.success)throw Error("Unexpected response format: Expected success boolean");if(!n.data.success)throw Error(n.data.error||"Failed to fetch chapter content");return n.data}catch(n){throw console.error("Error fetching content for book ".concat(e,", chapter ").concat(t,":"),n),n}}},35695:(e,t,n)=>{"use strict";var a=n(18999);n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}})},55663:(e,t,n)=>{"use strict";n.d(t,{c7:()=>o,cT:()=>r,e4:()=>s});let a={SETTINGS:"novel_reader_settings",COLLECTION:"novel_my_collection"},o=(e,t)=>{try{let n=localStorage.getItem(a[e]);return n?JSON.parse(n):t}catch(n){return console.error("Error reading ".concat(e," from localStorage"),n),t}},r=(e,t)=>{try{localStorage.setItem(a[e],JSON.stringify(t))}catch(t){console.error("Error saving ".concat(e," to localStorage"),t)}},s=e=>{if(!e)return e;let t=e.match(/drive\.google\.com\/uc\?.*id=([^&]+)/);if(null==t?void 0:t[1])return"https://lh3.googleusercontent.com/d/".concat(t[1]);let n=e.match(/drive\.google\.com\/file\/d\/([^/]+)/);return(null==n?void 0:n[1])?"https://lh3.googleusercontent.com/d/".concat(n[1]):e}},89996:(e,t,n)=>{"use strict";n.d(t,{default:()=>v});var a=n(95155),o=n(12115),r=n(6874),s=n.n(r),_=n(32588),l=n(55663),c=n(32495),i=n(30908),d=n.n(i);function v(e){let{bookId:t}=e,[n,r]=(0,o.useState)(null),[i,v]=(0,o.useState)([]),[m,h]=(0,o.useState)(!1),[u,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!0),[b,S]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{try{f(!0),S(null);let[e,n]=await Promise.all([(0,_.wK)(),(0,_.hE)(t)]);if(e.success&&e.data){let n=e.data.find(e=>e.id===t);if(n)r(n);else throw Error("找不到這本書的資料")}n.success&&n.data&&v(n.data)}catch(e){S(e instanceof Error?e.message:"載入作品詳情時發生錯誤"),console.error(e)}finally{f(!1)}})()},[t]),(0,o.useEffect)(()=>{h((0,l.c7)("COLLECTION",[]).includes(t))},[t]);let x=(0,o.useCallback)(()=>{let e=(0,l.c7)("COLLECTION",[]),n=m?e.filter(e=>e!==t):[...e,t];(0,l.cT)("COLLECTION",n),h(!m)},[t,m]);return g?(0,a.jsxs)("div",{className:d().pageContainer,children:[(0,a.jsx)("div",{className:d().loadingState,children:"正在整理書頁..."}),(0,a.jsx)(c.A,{})]}):b||!n?(0,a.jsxs)("div",{className:d().pageContainer,children:[(0,a.jsx)("div",{className:d().errorState,children:b}),(0,a.jsx)(c.A,{})]}):(0,a.jsxs)("div",{className:d().pageContainer,children:[(0,a.jsx)("div",{className:d().backNav,children:(0,a.jsx)(s(),{href:"/novels",children:"← 返回藏書閣"})}),(0,a.jsxs)("div",{className:d().detailHeader,children:[(0,a.jsx)("div",{className:d().detailCover,children:n.cover_url&&!u?(0,a.jsx)("img",{src:(0,l.e4)(n.cover_url),alt:n.title,onError:()=>p(!0)}):(0,a.jsx)("img",{src:"/images/no_cover_5.png",alt:n.title})}),(0,a.jsxs)("div",{className:d().detailInfo,children:[(0,a.jsx)("h1",{children:n.title}),(0,a.jsxs)("p",{className:d().authorName,children:["作者：",n.author]}),(0,a.jsx)("div",{className:d().tagsContainer,children:n.tags.map((e,t)=>(0,a.jsx)("span",{className:d().tag,children:e},t))}),(0,a.jsxs)("div",{className:d().metaData,children:[(0,a.jsxs)("p",{children:["狀態：",n.status]}),(0,a.jsxs)("p",{children:["總字數：",n.total_words.toLocaleString()," 字"]})]}),(0,a.jsx)("button",{className:"".concat(d().favoriteBtn," ").concat(m?d().favorited:""),onClick:x,children:m?"★ 已收藏":"☆ 加入收藏"})]})]}),(0,a.jsxs)("div",{className:d().summarySection,children:[(0,a.jsx)("h2",{children:"作品簡介"}),(0,a.jsx)("p",{children:n.summary})]}),(0,a.jsxs)("div",{className:d().chaptersSection,children:[(0,a.jsxs)("div",{className:d().chaptersHeader,children:[(0,a.jsx)("h2",{children:"章節目錄"}),(0,a.jsxs)("span",{className:d().chapterCount,children:["共 ",i.length," 章"]})]}),(0,a.jsx)("div",{className:d().chapterList,children:i.length>0?i.map(e=>(0,a.jsxs)(s(),{href:"/novels/reader/".concat(t,"/").concat(e.chapter_index),className:d().chapterItem,children:[(0,a.jsxs)("span",{className:d().chapterTitle,children:["第 ",e.chapter_index," 章　",e.chapter_title]}),(0,a.jsx)("span",{className:d().chapterDate,children:e.publish_date})]},e.chapter_index)):(0,a.jsx)("p",{className:d().emptyState,children:"作者還在努力碼字中，尚未發布任何章節。"})})]}),(0,a.jsx)(c.A,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5095,3464,6874,8441,1684,7358],()=>t(2164)),_N_E=e.O()}]);