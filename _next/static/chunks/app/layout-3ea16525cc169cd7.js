(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{6476:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var s=n(95155),r=n(55028),a=n(77719);let o=(0,r.default)(()=>n.e(2990).then(n.bind(n,12990)),{loadableGenerated:{webpack:()=>[12990]}});function l(e){let{children:t}=e;return(0,s.jsxs)(a.tE,{children:[(0,s.jsx)(o,{children:t}),(0,s.jsx)(a.N9,{})]})}},17351:e=>{e.exports={container:"Toast_container__mG37V",toast:"Toast_toast__5rLqi",slideIn:"Toast_slideIn__t_S7d",icon:"Toast_icon__mPfnn",message:"Toast_message__9z4O2",closeButton:"Toast_closeButton__I_x04",success:"Toast_success__S4BuP",error:"Toast_error__xqcXB",warning:"Toast_warning__NW1GO",info:"Toast_info___BcG7"}},25778:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,69243,23)),Promise.resolve().then(n.bind(n,6476)),Promise.resolve().then(n.t.bind(n,30347,23)),Promise.resolve().then(n.t.bind(n,15685,23)),Promise.resolve().then(n.bind(n,39543))},30347:()=>{},39543:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var s=n(95155);let r="sk-g0R3kGTfmyDDwa8xNSI5cr855yuJEFI6glMj7HAnXyKeiyEv";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gpt-4o-mini",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;if(!r)throw Error("API Key 未設定，請在環境變數 NEXT_PUBLIC_CHATANYWHERE_API_KEY 設定");let s=new AbortController,a=setTimeout(()=>s.abort(),n);try{var o,l,i,c;let n=await fetch("https://api.chatanywhere.tech/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:t,messages:e}),signal:s.signal});if(clearTimeout(a),!n.ok){let e=await n.json().catch(()=>null),t=(null==e||null==(c=e.error)?void 0:c.message)||n.statusText||"API 呼叫失敗";throw Error(t)}let u=await n.json(),d=null==u||null==(i=u.choices)||null==(l=i[0])||null==(o=l.message)?void 0:o.content;if(!d)throw Error("API 回傳格式錯誤或無回覆內容");return{reply:d}}catch(e){if(e instanceof Error)throw Error(e.message);throw e}}var o=n(12115);let l=()=>{let[e,t]=(0,o.useState)(!1),[n,r]=(0,o.useState)([{text:"哈囉！有什麼我可以幫你的嗎？",sender:"bot"}]),[l,i]=(0,o.useState)(""),[c,u]=(0,o.useState)(!0),[d,h]=(0,o.useState)(!1),[x,m]=(0,o.useState)({x:0,y:0}),[p,g]=(0,o.useState)(!1),f=(0,o.useRef)(null),b=(0,o.useRef)(null),w=(0,o.useRef)(!1),v=(e,t)=>{g(!0),w.current=!1,f.current={x:e-x.x,y:t-x.y}},y=(e,t)=>{if(!p||!f.current)return;let n=e-f.current.x,s=t-f.current.y;(Math.abs(n-x.x)>5||Math.abs(s-x.y)>5)&&(w.current=!0),m({x:n,y:s})},_=()=>{g(!1),f.current=null};(0,o.useEffect)(()=>{let e=e=>y(e.clientX,e.clientY),t=()=>_();return p&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[p]);let j=async e=>{if(e.preventDefault(),!l.trim()||d)return;let t=[...n,{text:l,sender:"user"}];r(t),i(""),u(!1),h(!0);let s=t.map(e=>({role:"user"===e.sender?"user":"assistant",content:e.text}));try{r(e=>[...e,{text:"...",sender:"bot"}]);let{reply:e}=await a(s);r(t=>{let n=[...t];return n[n.length-1]={text:e,sender:"bot"},n})}catch(e){r(t=>{let n=[...t];return n[n.length-1]={text:e instanceof Error?e.message:"發生錯誤，請稍後再試。",sender:"bot"},n})}finally{h(!1)}};return(0,s.jsxs)("div",{ref:b,className:"position-fixed",style:{zIndex:1050,bottom:"20px",right:"20px",transform:"translate(".concat(x.x,"px, ").concat(x.y,"px)"),touchAction:"none",cursor:p?"grabbing":"default",display:"flex",flexDirection:"column",alignItems:"flex-end",transition:p?"none":"transform 0.3s ease"},onMouseDown:e=>{"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&v(e.clientX,e.clientY)},onTouchStart:e=>{if("TEXTAREA"===e.target.tagName||"INPUT"===e.target.tagName)return;let t=e.touches[0];v(t.clientX,t.clientY)},onTouchMove:e=>{let t=e.touches[0];y(t.clientX,t.clientY)},onTouchEnd:_,children:[!e&&(0,s.jsxs)("div",{className:"position-relative",children:[(0,s.jsx)("button",{onClick:()=>{w.current||(e||m({x:0,y:0}),t(!e),u(!1))},className:"btn btn-primary rounded-circle d-flex align-items-center justify-content-center shadow",style:{width:"56px",height:"56px",cursor:"grab"},"aria-label":"切換聊天視窗",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{width:"24px",height:"24px",pointerEvents:"none"},children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),c&&(0,s.jsx)("span",{className:"position-absolute bg-danger rounded-circle",style:{width:"12px",height:"12px",top:"0",right:"0",border:"2px solid white"}})]}),e&&(0,s.jsxs)("div",{className:"card shadow-lg border-0",style:{width:"320px",maxWidth:"calc(100vw - 40px)",height:"450px",maxHeight:"calc(100vh - 120px)",display:"flex",flexDirection:"column"},children:[(0,s.jsxs)("div",{className:"card-header bg-primary text-white d-flex justify-content-between align-items-center py-2",style:{cursor:"grab"},children:[(0,s.jsx)("span",{className:"fw-bold user-select-none",children:"聊天助手"}),(0,s.jsx)("button",{onClick:()=>t(!1),className:"btn-close btn-close-white","aria-label":"關閉聊天視窗",onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation()})]}),(0,s.jsx)("div",{className:"card-body overflow-auto d-flex flex-column flex-grow-1 p-3",style:{background:"#f8f9fa"},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:n.map((e,t)=>(0,s.jsx)("div",{className:"mb-2 d-flex ".concat("user"===e.sender?"justify-content-end":"justify-content-start"),children:(0,s.jsx)("div",{className:"p-2 rounded ".concat("user"===e.sender?"bg-primary text-white":"bg-white text-dark shadow-sm"),style:{maxWidth:"85%",wordBreak:"break-word"},children:e.text})},t))}),(0,s.jsx)("div",{className:"card-footer border-top p-2 bg-white",onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:(0,s.jsxs)("form",{onSubmit:j,className:"d-flex gap-2",children:[(0,s.jsx)("textarea",{value:l,onChange:e=>i(e.target.value),placeholder:"輸入消息...",className:"form-control","aria-label":"聊天輸入",disabled:d,rows:1,style:{resize:"none",minHeight:"38px",maxHeight:"80px"}}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary text-nowrap align-self-end",disabled:d||!l.trim(),"aria-label":"發送消息",children:"發送"})]})})]})]})}},77719:(e,t,n)=>{"use strict";n.d(t,{N9:()=>x,tE:()=>l,dj:()=>i});var s=n(95155),r=n(12115);let a=(0,r.createContext)(void 0),o=0,l=e=>{let{children:t}=e,[n,l]=(0,r.useState)([]),i=(0,r.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e))},[]),c=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,s="toast-".concat(++o),r={id:s,message:e,type:t,duration:n};l(e=>[...e,r]),n>0&&setTimeout(()=>{i(s)},n)},[i]),u=(0,r.useCallback)((e,t)=>c(e,"success",t),[c]),d=(0,r.useCallback)((e,t)=>c(e,"error",t),[c]),h=(0,r.useCallback)((e,t)=>c(e,"warning",t),[c]),x=(0,r.useCallback)((e,t)=>c(e,"info",t),[c]);return(0,s.jsx)(a.Provider,{value:{toasts:n,showToast:c,removeToast:i,success:u,error:d,warning:h,info:x},children:t})},i=()=>{let e=(0,r.useContext)(a);if(!e)throw Error("useToast must be used within a ToastProvider");return e};var c=n(17351),u=n.n(c);let d=e=>{switch(e){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}},h=e=>{let{toast:t,onClose:n}=e;return(0,s.jsxs)("div",{className:"".concat(u().toast," ").concat(u()[t.type]),children:[(0,s.jsx)("span",{className:u().icon,children:d(t.type)}),(0,s.jsx)("span",{className:u().message,children:t.message}),(0,s.jsx)("button",{className:u().closeButton,onClick:n,children:"✕"})]})},x=()=>{let{toasts:e,removeToast:t}=i();return 0===e.length?null:(0,s.jsx)("div",{className:u().container,children:e.map(e=>(0,s.jsx)(h,{toast:e,onClose:()=>t(e.id)},e.id))})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1698,7690,740,8482,8441,1684,7358],()=>t(25778)),_N_E=e.O()}]);