(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4487],{54487:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>R});var a=l(95155),i=l(12115),s=function(e){return e.COMMON="COMMON",e.RARE="RARE",e.BOSS="BOSS",e}({}),n=function(e){return e.MAIN_HAND="MAIN_HAND",e.HEAD="HEAD",e.BODY="BODY",e.HANDS="HANDS",e.LEGS="LEGS",e.RELIC="RELIC",e}({});function r(e){let{player:t,combatPower:l,stageId:i,onAvatarClick:s,onAscension:n,potentialPoints:r}=e,{system:o,wallet:c}=t,d=o.currentXp/o.requiredXp*100;return(0,a.jsxs)("header",{className:"ca-header",children:[(0,a.jsxs)("div",{className:"ca-player-profile",children:[(0,a.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:s,children:[(0,a.jsx)("div",{className:"ca-avatar-ring",children:(0,a.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,a.jsx)("div",{className:"ca-level-badge",children:o.level})]}),(0,a.jsxs)("div",{className:"ca-profile-info",children:[(0,a.jsxs)("div",{className:"ca-profile-top",children:[(0,a.jsxs)("span",{className:"ca-level-text",children:["Lv.",o.level]}),(0,a.jsx)("span",{className:"ca-player-name",children:"冒險者"})]}),(0,a.jsxs)("div",{className:"ca-exp-container",children:[(0,a.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,a.jsx)("div",{className:"ca-exp-bar",children:(0,a.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,d),"%")}})}),(0,a.jsxs)("div",{className:"ca-exp-text",children:[o.currentXp.toLocaleString(),"/",o.requiredXp.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"ca-combat-power",style:{justifyContent:"space-between",width:"100%"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,a.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,a.jsx)("span",{className:"ca-cp-value",children:l.toLocaleString()})]}),(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),n()},style:{display:"flex",alignItems:"center",gap:"4px",background:"linear-gradient(135deg, #a855f7 0%, #d946ef 100%)",color:"white",padding:"4px 10px",fontSize:"0.65rem",fontWeight:"bold",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:"0 0 10px rgba(168, 85, 247, 0.3)",flexShrink:0},children:["⚡ 渡劫飛升 (+",r.toLocaleString(),")"]})]})]})]}),(0,a.jsx)("div",{className:"ca-header-right",children:(0,a.jsxs)("div",{className:"ca-currency-stack",children:[(0,a.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{children:Math.floor(c.gold).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:Math.floor(c.clickPoints).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency text-xs",style:{color:"#10b981"},children:[(0,a.jsx)("span",{children:"\uD83C\uDD99"}),(0,a.jsx)("span",{children:Math.floor(c.levelPoints).toLocaleString()})]})]})})]})}function o(e){let{name:t,currentHp:l,maxHp:i,isBoss:s=!1}=e,n=Math.max(1,i),r=Math.min(Math.max(0,l),n);return(0,a.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,a.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,a.jsx)("span",{className:"text-slate-300 me-2",children:t})}),(0,a.jsx)("div",{className:"ca-hp-bar",children:(0,a.jsx)("div",{className:"ca-hp-bar-fill ".concat(s?"boss":"normal"),style:{width:"".concat(r/n*100,"%")}})}),(0,a.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[Math.ceil(r).toLocaleString()," /"," ",Math.ceil(n).toLocaleString()]})]})}l(66997);let c=e=>{let{monster:t}=e,[l,s]=(0,i.useState)(!1),[n,r]=(0,i.useState)(null);return((0,i.useEffect)(()=>{s(!1),t.configId?r("/clickAscension/monsters/".concat(t.configId,".webp")):r(null)},[t.configId]),!l&&n)?(0,a.jsx)("img",{src:n,alt:t.name,className:"ca-monster-image",onError:()=>s(!0)}):(0,a.jsx)(a.Fragment,{children:t.emoji||(t.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")})};function d(e){let{monster:t,stageId:l,onMonsterClick:s,baseDamage:n,criticalChance:r,criticalDamage:d,monstersKilled:p,monstersRequired:u,isBossActive:x,bossDamageMultiplier:m=1,mercenaryLevel:g=0,partnerLevel:h=0,archerLevel:f=0,knightLevel:v=0,warlordLevel:b=0,oracleLevel:D=0,voidLevel:y=0,titanLevel:j=0,potionCount:C=0,activeBuffs:S,onUsePotion:_,lastAutoAttack:A,lastAutoClickEvent:N,bossTimeLeft:M,bossTimeLimit:L=60,onChallengeBoss:w,autoUsePotion:k=!1,onToggleAutoPotion:I}=e,[E,T]=(0,i.useState)([]),[R,P]=(0,i.useState)(!1),[O,G]=(0,i.useState)(!1),[z,B]=(0,i.useState)(!1),[U,q]=(0,i.useState)(!1),[K,W]=(0,i.useState)(!1),[F,H]=(0,i.useState)(!1),[V,X]=(0,i.useState)(!1),[Y,J]=(0,i.useState)(!1),[Q,Z]=(0,i.useState)(!1),[$,ee]=(0,i.useState)(!1),et=(0,i.useRef)(null),el=(0,i.useRef)(null),ea=(0,i.useRef)(null),ei=(0,i.useRef)(null),es=(0,i.useRef)(null),en=(0,i.useRef)(null),er=(0,i.useRef)(null),eo=(0,i.useRef)(null),ec=(0,i.useRef)(null),ed=(0,i.useRef)(0),ep=(0,i.useRef)(""),eu=(null==S?void 0:S.ragePotionExpiresAt)&&S.ragePotionExpiresAt>Date.now(),ex=(e,t,l,a)=>{var i;let s=null==(i=et.current)?void 0:i.getBoundingClientRect(),n=s?Math.max(50,Math.min(s.width-50,t)):t,r=crypto.randomUUID();T(t=>[...t,{id:r,text:e,x:n,y:l,type:a,createdAt:Date.now()}]),setTimeout(()=>{T(e=>e.filter(e=>e.id!==r))},1e3)};i.useEffect(()=>{var e;if(!N||N.id===ep.current)return;ep.current=N.id,G(!0),setTimeout(()=>G(!1),50);let t=null==(e=et.current)?void 0:e.getBoundingClientRect();if(t){let e=t.width/2+(60*Math.random()-30),l=t.height/2+(60*Math.random()-30),a=N.isCrit?"CRIT":"CLICK";ex(N.damage.toLocaleString(),e,l,a)}},[N]),i.useEffect(()=>{var e;if(!A||A.time===ed.current)return;ed.current=A.time,G(!0),setTimeout(()=>G(!1),150);let t=null==(e=et.current)?void 0:e.getBoundingClientRect();if(A.breakdown&&t){let{mercenary:e,partner:l,archer:a,knight:i,warlord:s,oracle:n,void:r,titan:o}=A.breakdown;if(e>0&&el.current){let l=el.current.getBoundingClientRect(),a=l.left-t.left+l.width/2,i=l.top-t.top;ex("⚔️ ".concat(e.toLocaleString()),a,i-20,"AUTO"),B(!0),setTimeout(()=>B(!1),300)}if(l>0&&ea.current){let e=ea.current.getBoundingClientRect(),a=e.left-t.left+e.width/2,i=e.top-t.top;ex("\uD83E\uDDDA ".concat(l.toLocaleString()),a,i-20,"AUTO"),q(!0),setTimeout(()=>q(!1),400)}if(a>0&&ei.current){let e=ei.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,i=e.top-t.top;ex("\uD83C\uDFF9 ".concat(a.toLocaleString()),l,i-20,"AUTO"),W(!0),setTimeout(()=>W(!1),300)}if(i>0&&es.current){let e=es.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,a=e.top-t.top;ex("\uD83D\uDEE1️ ".concat(i.toLocaleString()),l,a-20,"AUTO"),H(!0),setTimeout(()=>H(!1),300)}if(s>0&&en.current){let e=en.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,a=e.top-t.top;ex("\uD83D\uDD31 ".concat(s.toLocaleString()),l,a-20,"AUTO"),X(!0),setTimeout(()=>X(!1),300)}if(n>0&&er.current){let e=er.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,a=e.top-t.top;ex("\uD83D\uDD2E ".concat(n.toLocaleString()),l,a-20,"AUTO"),J(!0),setTimeout(()=>J(!1),300)}if(r>0&&eo.current){let e=eo.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,a=e.top-t.top;ex("\uD83C\uDF0C ".concat(r.toLocaleString()),l,a-20,"AUTO"),Z(!0),setTimeout(()=>Z(!1),300)}if(o>0&&ec.current){let e=ec.current.getBoundingClientRect(),l=e.left-t.left+e.width/2,a=e.top-t.top;ex("⛰️ ".concat(o.toLocaleString()),l,a-20,"AUTO"),ee(!0),setTimeout(()=>ee(!1),300)}}},[A,g,h,f,v,b,D,y,j]);let em=e=>{var l,a,i,o,c;let p,u;if(!t||t.currentHp<=0)return;let x=n;eu&&(x*=2),t.isBoss&&(x*=m);let g=Math.random()<r,h=Math.ceil(x*(g?d:1)),f=null==(l=et.current)?void 0:l.getBoundingClientRect();if(!f)return;"touches"in e?(p=null!=(o=null==(a=e.touches[0])?void 0:a.clientX)?o:f.left+f.width/2,u=null!=(c=null==(i=e.touches[0])?void 0:i.clientY)?c:f.top+f.height/2):(p=e.clientX,u=e.clientY);let v=p-f.left+(60*Math.random()-30),b=u-f.top+(60*Math.random()-30);ex(h.toLocaleString(),v,b,g?"CRIT":"CLICK"),P(!0),G(!0),setTimeout(()=>P(!1),300),setTimeout(()=>G(!1),150),s(h,g)},eg=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,a.jsxs)("div",{ref:et,className:"ca-battle-area ".concat(R?"ca-shake":""),style:{background:eu?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:em,onTouchStart:em,children:[t&&(0,a.jsx)("div",{className:"ca-monster-sprite ".concat(t.isBoss?"boss":""," ").concat(O?"ca-hit-flash":""," ca-bounce-slow"),children:(0,a.jsx)(c,{monster:t})}),(0,a.jsx)("div",{className:"ca-monster-container",style:{position:"relative",zIndex:1,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:t?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",position:"relative"},children:[x&&(0,a.jsxs)("div",{style:{position:"absolute",top:"-120px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",width:"100%",maxWidth:"240px",zIndex:10},children:[(0,a.jsx)("div",{style:{fontSize:"0.75rem",color:"#ef4444",fontWeight:"bold",background:"rgba(239, 68, 68, 0.2)",padding:"2px 10px",borderRadius:"10px",border:"1px solid rgba(239, 68, 68, 0.4)",letterSpacing:"1px",marginBottom:"4px"},children:"\uD83D\uDC79 BOSS 戰進行中"}),null!=M&&(0,a.jsxs)("div",{style:{width:"100%"},children:[(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px"},children:(0,a.jsxs)("span",{style:{fontSize:"1.2rem",fontWeight:"900",color:M<=10?"#ff4d4d":"#fbbf24",textShadow:"0 0 10px rgba(0,0,0,0.8)",fontFamily:"monospace"},children:["⏱️ ",M,"s"]})}),(0,a.jsx)("div",{style:{width:"100%",height:"8px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)",marginTop:"2px"},children:(0,a.jsx)("div",{style:{height:"100%",width:"".concat(M/L*100,"%"),background:M<=10?"linear-gradient(90deg, #ef4444, #b91c1c)":"linear-gradient(90deg, #fbbf24, #d97706)",transition:"width 1s linear, background 0.3s"}})})]})]}),t.note&&(0,a.jsxs)("div",{className:"ca-note-badge",style:{position:"relative",top:"0",left:"0",transform:"none",marginBottom:"8px"},children:[(0,a.jsx)("span",{children:"\uD83D\uDCCD"}),(0,a.jsx)("span",{children:t.note})]}),(0,a.jsxs)("div",{className:"ca-stage-display",children:["第 ",l," 關"]}),!x&&(p>=u?(0,a.jsx)("button",{className:"ca-btn ca-btn-primary",onClick:e=>{e.stopPropagation(),null==w||w()},style:{pointerEvents:"auto",marginBottom:"16px",padding:"8px 20px",fontSize:"1rem",background:"linear-gradient(to right, #ef4444, #b91c1c)",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",border:"none"},children:"⚔️ 挑戰 BOSS"}):(0,a.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.5)",padding:"2px 8px",borderRadius:"12px"},children:[p," / ",u," \uD83D\uDC80"]})),(0,a.jsx)("div",{style:{height:"100px"}}),(0,a.jsx)("div",{className:"w-56",style:{marginTop:"auto"},children:(0,a.jsx)(o,{name:t.name,currentHp:t.currentHp,maxHp:t.maxHp,isBoss:t.isBoss})})]}):(0,a.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),(0,a.jsx)("div",{ref:el,className:z?"ca-attack-lunge-left":"",style:{position:"absolute",bottom:"20px",left:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:g>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"⚔️"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",g]})]})}),(0,a.jsx)("div",{ref:ea,className:U?"ca-attack-magic-right":"",style:{position:"absolute",bottom:"20px",right:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:h>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83E\uDDDA"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",h]})]})}),C>0&&(0,a.jsxs)("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",zIndex:20},children:[(0,a.jsxs)("div",{onClick:e=>{e.stopPropagation(),!eu&&_&&_()},style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:eu?"default":"pointer",opacity:eu?.5:1},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",filter:eu?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:eu?"scale(0.9)":"scale(1)",transition:"all 0.3s"},children:"\uD83E\uDDEA"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"10px",padding:"2px 6px",marginTop:"-10px"},children:["x",C]})]}),(0,a.jsxs)("div",{onClick:e=>{e.stopPropagation(),I&&I()},style:{display:"flex",alignItems:"center",gap:"6px",background:k?"rgba(34, 197, 94, 0.2)":"rgba(255, 255, 255, 0.1)",padding:"4px 10px",borderRadius:"20px",border:"1px solid ".concat(k?"rgba(34, 197, 94, 0.4)":"rgba(255, 255, 255, 0.2)"),cursor:"pointer",pointerEvents:"auto",transition:"all 0.3s"},children:[(0,a.jsx)("div",{style:{width:"10px",height:"10px",borderRadius:"50%",background:k?"#22c55e":"#94a3b8",boxShadow:k?"0 0 8px #22c55e":"none"}}),(0,a.jsx)("span",{style:{fontSize:"0.6rem",color:k?"#4ade80":"#94a3b8",fontWeight:"bold",letterSpacing:"0.5px",whiteSpace:"nowrap"},children:k?"AUTO ON":"AUTO OFF"})]})]}),(0,a.jsx)("div",{ref:ei,className:K?"ca-attack-lunge-left":"",style:{position:"absolute",top:"80px",left:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:f>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83C\uDFF9"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#a5b4fc"},children:["Lv.",f]})]})}),(0,a.jsx)("div",{ref:es,className:F?"ca-attack-lunge-right":"",style:{position:"absolute",top:"80px",right:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:v>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDEE1️"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fca5a5"},children:["Lv.",v]})]})}),(0,a.jsx)("div",{ref:en,className:V?"ca-attack-lunge-left":"",style:{position:"absolute",top:"160px",left:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:b>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDD31"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fb923c"},children:["Lv.",b]})]})}),(0,a.jsx)("div",{ref:er,className:Y?"ca-attack-magic-right":"",style:{position:"absolute",top:"160px",right:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:D>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDD2E"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#c084fc"},children:["Lv.",D]})]})}),(0,a.jsx)("div",{ref:eo,className:Q?"ca-attack-magic-left":"",style:{position:"absolute",top:"240px",left:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:y>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83C\uDF0C"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#818cf8"},children:["Lv.",y]})]})}),(0,a.jsx)("div",{ref:ec,className:$?"ca-attack-lunge-right":"",style:{position:"absolute",top:"240px",right:"30px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:j>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDC7A"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#71717a"},children:["Lv.",j]})]})}),(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",style:{zIndex:100},children:E.map(e=>(0,a.jsx)("div",{className:eg(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function p(e){let{activeView:t,onSwitchView:l,onOpenModal:i}=e;return(0,a.jsx)("footer",{className:"ca-footer",children:(0,a.jsxs)("nav",{className:"ca-footer-nav",children:[(0,a.jsxs)("button",{className:"ca-tab-btn ".concat("CHARACTER"===t?"active":""),onClick:()=>{l("CHARACTER"),i(null)},children:[(0,a.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,a.jsx)("span",{className:"label",children:"角色"})]}),(0,a.jsxs)("button",{className:"ca-tab-btn ".concat("BATTLE"===t?"active":""),onClick:()=>{l("BATTLE"),i(null)},children:[(0,a.jsx)("span",{className:"icon",children:"⚔️"}),(0,a.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,a.jsxs)("button",{className:"ca-tab-btn",onClick:()=>i("SHOP"),children:[(0,a.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,a.jsx)("span",{className:"label",children:"商店"})]})]})})}function u(e){let{isOpen:t,onClose:l,title:i,headerContent:s,children:n}=e;return t?(0,a.jsx)("div",{className:"ca-modal-overlay",onClick:l,children:(0,a.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"ca-modal-header",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,a.jsx)("h2",{className:"ca-modal-title",children:i}),s]}),(0,a.jsx)("button",{className:"ca-modal-close",onClick:l,children:"✕"})]}),(0,a.jsx)("div",{className:"ca-modal-content",children:n})]})}):null}let x=e=>e<=50?{name:"練氣期",color:"#a7f3d0"}:e<=150?{name:"築基期",color:"#6ee7b7"}:e<=300?{name:"金丹期",color:"#fbbf24"}:e<=500?{name:"元嬰期",color:"#f472b6"}:e<=800?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"};function m(e){let{player:t,onPurchase:l,onResetLevelPoints:s,gameConfig:n,autoGachaBox:r,onToggleAutoGacha:o}=e,[c,d]=(0,i.useState)("DAILY"),[p,u]=(0,i.useState)("UPGRADE"),[m,v]=(0,i.useState)(null),b=i.useMemo(()=>(null==n?void 0:n.upgrades)?n.upgrades.filter(e=>"CLICK"===e.Shop_Type).map(e=>e.ID).reduce((e,l)=>e+(t.clickShop[l]||0),0):0,[t.clickShop,n]),y=x(b);console.log("[ShopPage] Rendering. ActiveTab:",c,"isProbModalOpen:",m);let j=e=>"gold_shop_weapon"===e?t.goldShop.weaponLevel||0:"gold_shop_mercenary"===e?t.goldShop.mercenaryLevel||0:"gold_shop_partner"===e?t.goldShop.partnerLevel||0:"gold_shop_archer"===e?t.goldShop.archerLevel||0:"gold_shop_knight"===e?t.goldShop.knightLevel||0:"gold_shop_warlord"===e?t.goldShop.warlordLevel||0:"gold_shop_oracle"===e?t.goldShop.oracleLevel||0:"gold_shop_void"===e?t.goldShop.voidLevel||0:"gold_shop_titan"===e?t.goldShop.titanLevel||0:"gold_shop_amulet"===e?t.goldShop.amuletLevel||0:"gold_potion_rage"===e?t.inventory.ragePotionCount||0:e.startsWith("level_shop_")?t.levelShop[e]||0:e.startsWith("click_shop_")?t.clickShop[e]||0:(e.startsWith("ascension_shop_")||e.startsWith("asc_"))&&t.ascensionShop[e]||0,C=(e,t,l,a)=>"ADD_INVENTORY"===a?e:1===t||1===t?Math.floor(e+l):Math.floor(e*Math.pow(t,l)),S=e=>"GOLD"===e?"\uD83D\uDCB0":"LP"===e?"\uD83C\uDD99":"CP"===e?"⚡":"DIAMOND"===e?"\uD83D\uDC8E":"AP"===e?"\uD83D\uDD4A️":e,_=e=>"GOLD"===e?t.wallet.gold:"LP"===e?t.wallet.levelPoints:"CP"===e?t.wallet.clickPoints:"DIAMOND"===e?t.wallet.diamonds:"AP"===e?t.wallet.ascensionPoints:0,A=e=>0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"gray"},children:"無項目"}):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(e=>{let t=j(e.ID),i=C(e.Cost_Base,e.Cost_Mult,t,e.Effect_Type),s=S(e.Currency),n=_(e.Currency),r=Number(e.Max_Level||0),o=r>0&&t>=r,c=e.Desc_Template||e.Name;return c.includes("{val}")&&(c=c.replace("{val}",String(e.Effect_Val))),(0,a.jsx)(h,{name:e.Name,desc:"".concat(c," [Lv.").concat(t,"]"),level:t,cost:i,currencyLabel:s,canAfford:!o&&n>=i,isMaxed:o,onClick:()=>l(e.ID)},e.ID)})}),N=e=>n&&n.upgrades?A(n.upgrades.filter(t=>t.Shop_Type===e)):null,M=(()=>{if(!t.lastDailyRewardClaimTime)return!0;let e=new Date(t.lastDailyRewardClaimTime),l=new Date;return e.getDate()!==l.getDate()||e.getMonth()!==l.getMonth()||e.getFullYear()!==l.getFullYear()})();return(0,a.jsxs)("div",{className:"ca-shop-container",children:[(0,a.jsxs)("div",{className:"ca-shop-tabs",children:[(0,a.jsxs)("button",{onClick:()=>d("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===c?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,a.jsx)("div",{className:"label",children:"每日商店"}),M&&(0,a.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,a.jsxs)("button",{onClick:()=>d("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===c?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,a.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,a.jsxs)("button",{onClick:()=>d("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===c?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,a.jsx)("div",{className:"label",children:"等級商店"})]}),(0,a.jsxs)("button",{onClick:()=>d("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===c?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"⚡"}),(0,a.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,a.jsxs)("button",{onClick:()=>d("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===c?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,a.jsx)("div",{className:"label",children:"飛昇商店"})]}),(0,a.jsxs)("button",{onClick:()=>d("EQUIPMENT"),className:"ca-shop-tab-btn equipment ".concat("EQUIPMENT"===c?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"⚔️"}),(0,a.jsx)("div",{className:"label",children:"裝備扭蛋"})]})]}),(0,a.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===c&&(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,a.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,a.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,a.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,a.jsx)("div",{style:{fontSize:"3rem",filter:M?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#fde047"},children:"10 \uD83D\uDC8E + 500 \uD83D\uDCB0"})]}),(0,a.jsx)("button",{className:"ca-btn ".concat(M?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:M?1:.5,cursor:M?"pointer":"not-allowed",background:M?"":"#334155",color:M?"":"#64748b"},disabled:!M,onClick:()=>l("daily_checkin"),children:M?"領取獎勵":"明日再來"})]})}),"GOLD"===c&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:Math.floor(t.wallet.gold).toLocaleString()}),(0,a.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(0,a.jsxs)("div",{className:"ca-shop-subtabs",style:{display:"flex",gap:"10px",marginBottom:"8px"},children:[(0,a.jsx)("button",{className:"ca-btn ".concat("UPGRADE"===p?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"UPGRADE"===p?"":"rgba(255,255,255,0.1)"},onClick:()=>u("UPGRADE"),children:"\uD83D\uDEE0️ 金幣強化"}),(0,a.jsx)("button",{className:"ca-btn ".concat("RECRUIT"===p?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"RECRUIT"===p?"":"rgba(255,255,255,0.1)"},onClick:()=>u("RECRUIT"),children:"\uD83D\uDEA9 招兵買馬"})]}),(null==n?void 0:n.upgrades)?A(n.upgrades.filter(e=>"GOLD"===e.Shop_Type).filter(e=>"RECRUIT"===p?"ADD_AUTO_DMG"===e.Effect_Type:"ADD_AUTO_DMG"!==e.Effect_Type)):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,a.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config..."})}),(0,a.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,a.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,a.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,a.jsx)(g,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:t.wallet.diamonds>=10,onClick:()=>l("gold_pack_1")}),(0,a.jsx)(g,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:t.wallet.diamonds>=80,onClick:()=>l("gold_pack_2")})]})]}),"LEVEL"===c&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:t.wallet.levelPoints}),(0,a.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"}),s&&(0,a.jsx)("button",{onClick:s,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"\uD83D\uDD04 重製點數"})]}),(0,a.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,a.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==n?void 0:n.upgrades)?N("LEVEL"):(0,a.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===c&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:y.color},children:y.name}),(0,a.jsxs)("div",{className:"ca-realm-level",children:["修練總層數 ",b]})]}),(0,a.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,a.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==n?void 0:n.upgrades)?N("CLICK"):(0,a.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===c&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c084fc 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"飛昇商店 (Permanent)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff"},children:"永恆加成"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.7)",marginTop:"4px"},children:"飛昇後不會重置的永久強化"})]}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:N("ASCENSION")})]}),"EQUIPMENT"===c&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",position:"relative"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"裝備扭蛋 (Gacha)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.2rem"},children:"試試你的手氣！"})]}),(0,a.jsxs)("div",{className:"ca-shop-item-grid",style:{width:"100%"},children:[(0,a.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #94a3b8"},children:[(0,a.jsx)("button",{onClick:()=>v("basic"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,a.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDCE6"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fff"},children:"基礎裝備箱"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"隨機獲得裝備 (最高至 Epic)"}),(0,a.jsx)("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:"含: Common, Uncommon, Rare, Epic"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,a.jsx)(D,{label:"1 抽",cost:"1,000",onClick:()=>l("gacha_equipment_basic")}),(0,a.jsx)(D,{label:"10 抽",cost:"10,000",onClick:()=>l("gacha_equipment_basic_10")}),(0,a.jsx)(D,{label:"100 抽",cost:"100,000",onClick:()=>l("gacha_equipment_basic_100")}),(0,a.jsx)(D,{label:"1000 抽",cost:"1,000,000",onClick:()=>l("gacha_equipment_basic_1000")}),(0,a.jsxs)("div",{onClick:()=>null==o?void 0:o("basic"===r?null:"basic"),style:{padding:"12px 16px",borderRadius:"8px",background:"basic"===r?"#10b981":"rgba(255,255,255,0.1)",color:"basic"===r?"#fff":"#94a3b8",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid ".concat("basic"===r?"#4ade80":"rgba(255,255,255,0.2)"),transition:"all 0.3s",flex:"1 1 100%"},children:[(0,a.jsx)("span",{children:"basic"===r?"⏹️ 停止":"\uD83E\uDD16 自動"}),(0,a.jsx)("span",{children:"1000連抽"})]})]})]}),(0,a.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #eab308",background:"rgba(234, 179, 8, 0.05)"},children:[(0,a.jsx)("button",{onClick:()=>v("advanced"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,a.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83C\uDF81"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#facc15"},children:"高級裝備箱"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"更高機率獲得稀有裝備 (最高至 Legendary)"}),(0,a.jsx)("div",{style:{fontSize:"0.75rem",color:"#fef08a"},children:"含: Common ~ Legendary"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,a.jsx)(D,{label:"1 抽",cost:"10,000",color:"#facc15",onClick:()=>l("gacha_equipment_advanced")}),(0,a.jsx)(D,{label:"10 抽",cost:"100,000",color:"#facc15",onClick:()=>l("gacha_equipment_advanced_10")}),(0,a.jsx)(D,{label:"100 抽",cost:"1,000,000",color:"#facc15",onClick:()=>l("gacha_equipment_advanced_100")}),(0,a.jsx)(D,{label:"1000 抽",cost:"10,000,000",color:"#facc15",onClick:()=>l("gacha_equipment_advanced_1000")}),(0,a.jsxs)("div",{onClick:()=>null==o?void 0:o("advanced"===r?null:"advanced"),style:{padding:"12px 16px",borderRadius:"8px",background:"advanced"===r?"#f59e0b":"rgba(255,255,255,0.1)",color:"advanced"===r?"#fff":"#94a3b8",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid ".concat("advanced"===r?"#fbbf24":"rgba(255,255,255,0.2)"),transition:"all 0.3s",flex:"1 1 100%"},children:[(0,a.jsx)("span",{children:"advanced"===r?"⏹️ 停止":"\uD83E\uDD16 自動"}),(0,a.jsx)("span",{children:"1000連抽"})]})]})]}),(0,a.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center",position:"relative",border:"1px solid #a855f7",background:"rgba(168, 85, 247, 0.05)"},children:[(0,a.jsx)("button",{onClick:()=>v("premium"),style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer",zIndex:10},children:"裝備機率一覽"}),(0,a.jsx)("div",{style:{fontSize:"4rem"},children:"\uD83D\uDC8E"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#d8b4fe"},children:"頂級裝備箱"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"最高機率獲得稀有裝備 (最高至 Mythic)"}),(0,a.jsx)("div",{style:{fontSize:"0.75rem",color:"#e9d5ff"},children:"含: Common ~ Mythic (包含所有稀有度)"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px",width:"100%",justifyContent:"center",flexWrap:"wrap"},children:[(0,a.jsx)(D,{label:"1 抽",cost:"100,000",color:"#d8b4fe",onClick:()=>l("gacha_equipment_premium")}),(0,a.jsx)(D,{label:"10 抽",cost:"1,000,000",color:"#d8b4fe",onClick:()=>l("gacha_equipment_premium_10")}),(0,a.jsx)(D,{label:"100 抽",cost:"10,000,000",color:"#d8b4fe",onClick:()=>l("gacha_equipment_premium_100")}),(0,a.jsx)(D,{label:"1000 抽",cost:"100,000,000",color:"#d8b4fe",onClick:()=>l("gacha_equipment_premium_1000")}),(0,a.jsxs)("div",{onClick:()=>null==o?void 0:o("premium"===r?null:"premium"),style:{padding:"12px 16px",borderRadius:"8px",background:"premium"===r?"#ec4899":"rgba(255,255,255,0.1)",color:"premium"===r?"#fff":"#94a3b8",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid ".concat("premium"===r?"#f472b6":"rgba(255,255,255,0.2)"),transition:"all 0.3s",flex:"1 1 100%"},children:[(0,a.jsx)("span",{children:"premium"===r?"⏹️ 停止":"\uD83E\uDD16 自動"}),(0,a.jsx)("span",{children:"1000連抽"})]})]})]})]})]})]}),m&&(0,a.jsx)(f,{gameConfig:n,onClose:()=>v(null),boxType:m})]})}function g(e){let{name:t,desc:l,icon:i,cost:s,canAfford:n,onClick:r}=e;return(0,a.jsxs)("div",{className:"ca-glass-static ca-shop-item-card",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>n&&r(),children:[(0,a.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:i}),(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:t}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:l}),(0,a.jsx)("div",{className:"ca-btn ".concat(n?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:n?"":"#334155",color:n?"":"#64748b",cursor:n?"pointer":"not-allowed"},children:s})]})}function h(e){let{name:t,desc:l,level:i,cost:s,canAfford:n,onClick:r,currencyLabel:o="⚡",isMaxed:c}=e;return(0,a.jsxs)("div",{className:"ca-upgrade-row",children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:t}),(0,a.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",i]})]}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:l})]}),(0,a.jsxs)("button",{onClick:()=>!c&&n&&r(),disabled:c||!n,className:"ca-upgrade-btn",style:{opacity:c||!n?.5:1,cursor:c||!n?"not-allowed":"pointer"},children:[(0,a.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:"bold"},children:c?"已滿級":"升級"}),!c&&(0,a.jsxs)("span",{style:{fontSize:"0.7rem"},children:[o," ",s.toLocaleString()]})]})]})}function f(e){let{gameConfig:t,onClose:l,boxType:s}=e,[n,r]=i.useState(null),o=t&&t.equipments&&t.equipments.length>0,c=i.useMemo(()=>o?t.equipments.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===s||"gacha_equipment_basic"===s?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==s&&"gacha_equipment_advanced"!==s||"MYTHIC"!==t}):[],[o,t,s]),d=c.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),p={};d>0&&c.forEach(e=>{let t=Number(e.Gacha_Weight)||0;p[t]||(p[t]=[]),p[t].push(e)});let u=e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}};return(0,a.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:l,children:[(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"500px",maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#1e293b",border:"1px solid #334155",borderRadius:"16px",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"white"},children:["basic"===s?"基礎":"advanced"===s?"高級":"頂級","裝備機率一覽"]}),(0,a.jsx)("button",{onClick:l,style:{background:"none",border:"none",color:"gray",fontSize:"1.5rem",cursor:"pointer"},children:"\xd7"})]}),(0,a.jsx)("div",{style:{padding:"16px",overflowY:"auto",flex:1},children:o?Object.entries(p).sort((e,t)=>Number(t[0])-Number(e[0])).map(e=>{let[t,l]=e,i=(Number(t)/d*100).toFixed(2);return(0,a.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,a.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px",fontSize:"0.9rem",color:"#93c5fd",fontWeight:"bold"},children:["機率: ",i,"% (權重: ",t,", 共 ",l.length," 種)"]}),(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:l.map(e=>{var t;let l=u(e.Rarity);return(0,a.jsxs)("div",{onClick:()=>r(e),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:"pointer",transition:"transform 0.1s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[(0,a.jsx)("div",{style:{width:"56px",height:"56px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem",border:"1px solid ".concat(l,"44"),boxShadow:"inset 0 0 10px ".concat(l,"22")},children:b(e.Slot)}),(0,a.jsx)("div",{style:{fontSize:"0.65rem",color:l,textAlign:"center",lineHeight:"1.2",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",fontWeight:(null==(t=e.Rarity)?void 0:t.toLowerCase())==="common"?"normal":"bold"},children:e.Name})]},e.ID)})})]},t)}):(0,a.jsxs)("div",{style:{textAlign:"center",color:"var(--ca-text-muted)",padding:"20px"},children:["暫無裝備資料",(0,a.jsx)("br",{}),(0,a.jsx)("span",{style:{fontSize:"0.8rem"},children:"請檢查 Google Sheet 設定或重新載入"})]})})]}),n&&(0,a.jsx)(v,{item:n,onClose:()=>r(null)})]})}function v(e){let{item:t,onClose:l}=e,i=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(t.Rarity);return(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:10001,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:l,children:(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(i,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(i,"22")},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(i,"44")},children:b(t.Slot)}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:i},children:t.Name}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:i,fontWeight:"bold"},children:t.Rarity}),(0,a.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:t.Slot})]})]}),(0,a.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,a.jsx)("div",{style:{color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:"裝備初始屬性:"}),(0,a.jsx)("div",{children:function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=(Number(t.Base_Val)||0)+(l-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",a.toLocaleString())}(t.Desc_Template,t,1)}),(0,a.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"單件提升戰力 (Est. CP)"}),(0,a.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",(function(e,t){let l=(Number(e.Base_Val)||0)+0*(Number(e.Level_Mult)||0),a=String(e.Effect_Type||"").toUpperCase().trim();return["ADD_BASE_DMG","CLICK_DMG","ADD_DAMAGE","CLICK_DAMAGE","ADD_CLICK_DMG"].includes(a)?Math.floor(10*l):["ADD_AUTO_DMG","AUTO_DMG","AUTO_DAMAGE","ADD_AUTO"].includes(a)?Math.floor(20*l):["ADD_CRIT_CHANCE","CRIT_RATE","ADD_CRIT_RATE","LUCK","ADD_CRIT"].includes(a)?Math.floor(10*l):["ADD_CRIT_DMG","CRIT_DMG","CRIT_DAMAGE","ADD_CRIT_DMG"].includes(a)?Math.floor(5*l):0})(t,0).toLocaleString()]})]})]}),(0,a.jsx)("button",{className:"ca-btn",onClick:l,style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"},children:"返回"})]})})}function b(e){switch(e){case"MAIN_HAND":return"⚔️";case"HEAD":return"\uD83E\uDE96";case"BODY":return"\uD83D\uDC55";case"HANDS":return"\uD83E\uDDE4";case"LEGS":return"\uD83D\uDC62";case"RELIC":return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function D(e){let{label:t,cost:l,onClick:i,color:s="#22d3ee"}=e;return(0,a.jsxs)("button",{className:"ca-btn ca-btn-primary",style:{padding:"12px 16px",fontSize:"1rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",flex:1,borderColor:s,background:"linear-gradient(to bottom, rgba(0,0,0,0) 0%, ".concat(s,"22 100%)")},onClick:i,children:[(0,a.jsx)("span",{children:t}),(0,a.jsxs)("span",{style:{background:"rgba(0,0,0,0.2)",padding:"2px 8px",borderRadius:"12px",fontSize:"0.8rem",color:s},children:["\uD83D\uDCB0 ",l]})]})}function y(e){var t,l,s;let{player:n,effectiveStats:r,combatPower:o,userId:c,onLogin:d,onLogout:p,onManualSave:u,gameConfig:x}=e,{system:m,wallet:g,records:h}=n,[f,v]=i.useState(""),[b,D]=i.useState(!1),y=async()=>{if(!b){D(!0);try{await u()}finally{D(!1)}}},_=e=>Math.floor(e||0).toLocaleString(),A=e=>"".concat((100*e).toFixed(1),"%"),N=e=>{let t=Math.floor(e/3600),l=Math.floor(e%3600/60),a=e%60;return t>0?"".concat(t,"h ").concat(l,"m ").concat(a,"s"):l>0?"".concat(l,"m ").concat(a,"s"):"".concat(a,"s")},M=(null==(t=n.activeBuffs)?void 0:t.ragePotionExpiresAt)>Date.now(),L=Math.max(0,Math.floor(((null==(l=n.activeBuffs)?void 0:l.ragePotionExpiresAt)-Date.now())/1e3));return(0,a.jsxs)("div",{className:"ca-profile-page",style:{paddingBottom:"20px"},children:[(0,a.jsx)("div",{className:"ca-profile-section",children:(0,a.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,a.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(c||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,a.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",m.level]})]}),(0,a.jsx)("div",{className:"ca-profile-summary",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{children:["勇者 ",c]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,a.jsx)("button",{onClick:y,className:"ca-profile-action-btn",style:{background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",cursor:b?"wait":"pointer",opacity:b?.7:1},children:b?"上傳中":"上傳"}),(0,a.jsx)("button",{onClick:p,className:"ca-profile-action-btn",style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5"},children:"登出"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-cp",children:[(0,a.jsx)("span",{className:"label",children:"戰鬥力"}),(0,a.jsx)("span",{className:"value",children:_(o)})]}),(0,a.jsxs)("div",{className:"ca-profile-exp",children:[(0,a.jsxs)("div",{className:"info",children:[(0,a.jsx)("span",{children:"EXP"}),(0,a.jsxs)("span",{children:[_(m.currentXp)," /"," ",_(m.requiredXp)]})]}),(0,a.jsx)("div",{className:"bar-bg",children:(0,a.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,m.currentXp/m.requiredXp*100),"%")}})})]})]}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",width:"100%",minWidth:0},children:[(0,a.jsx)("div",{style:{fontSize:"0.85rem",color:"var(--ca-text-secondary)",fontWeight:"600"},children:"輸入 ID 以讀取/建立存檔"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"6px",width:"100%"},children:[(0,a.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,minWidth:0,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.15)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"0.9rem",outline:"none"},placeholder:"User ID...",value:f,onChange:e=>v(e.target.value)}),(0,a.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"0 16px",fontSize:"0.85rem",height:"auto",whiteSpace:"nowrap",flexShrink:0,borderRadius:"8px"},onClick:()=>f.trim()&&d(f.trim()),children:"讀取"})]})]})})]})}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"財富狀態"}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",background:"rgba(15, 23, 42, 0.4)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.05)"},children:[(0,a.jsx)(j,{icon:"\uD83D\uDCB0",label:"金幣",value:_(g.gold),color:"#fbbf24"}),(0,a.jsx)(j,{icon:"\uD83D\uDC8E",label:"鑽石",value:_(g.diamonds),color:"#38bdf8"}),(0,a.jsx)(j,{icon:"✨",label:"點擊點數",value:_(g.clickPoints),color:"#c084fc"}),(0,a.jsx)(j,{icon:"⚡",label:"飛昇點數",value:_(g.ascensionPoints),color:"#f472b6"}),(0,a.jsx)(j,{icon:"\uD83D\uDCDC",label:"等級積分",value:_(g.levelPoints),color:"#60a5fa"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"最終戰鬥屬性 (含裝備加成)"}),(0,a.jsxs)("div",{className:"ca-stats-grid",children:[(0,a.jsx)(C,{label:"點擊基礎傷害",value:_(r.baseDamage),icon:"⚔️"}),(0,a.jsx)(C,{label:"夥伴秒傷 (Ally DPS)",value:(e=>{let t=Math.floor(e||0);if(t>=1e8){let e=t/1e8;return"".concat(e.toFixed(2),"億")}if(t>=1e4){let e=t/1e4;return"".concat(e.toFixed(1),"萬")}return t.toLocaleString()})(r.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,a.jsx)(C,{label:"爆擊機率",value:A(r.criticalChance),icon:"\uD83C\uDFAF"}),(0,a.jsx)(C,{label:"爆擊傷害",value:A(r.criticalDamage),icon:"\uD83D\uDCA5"}),(0,a.jsx)(C,{label:"金幣獲取倍率",value:"".concat(r.goldMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCB0"}),(0,a.jsx)(C,{label:"經驗獲取倍率",value:"".concat(r.xpMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCD6"}),(0,a.jsx)(C,{label:"BOSS 傷害加成",value:"".concat(r.bossDamageMultiplier.toFixed(2),"x"),icon:"\uD83D\uDC79"}),(0,a.jsx)(C,{label:"點擊點數倍率",value:"".concat(r.cpMultiplier.toFixed(2),"x"),icon:"✨"}),(0,a.jsx)(C,{label:"自動點擊 (每秒)",value:"".concat(r.autoClickPerSec.toFixed(1)," 次"),icon:"⚡"}),(0,a.jsx)(C,{label:"關卡目標減少",value:"-".concat(_(r.monsterKillReduction)," 隻"),icon:"\uD83D\uDCC9"}),(0,a.jsx)(C,{label:"稀有怪出現機率",value:A(r.rareMonsterChance),icon:"\uD83C\uDF1F"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"當前狀態 / 藥水"}),(0,a.jsx)("div",{className:"ca-glass-static",style:{padding:"12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:M?(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[(0,a.jsx)("span",{style:{fontSize:"1.4rem"},children:"\uD83E\uDDEA"}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.95rem"},children:"狂暴藥水 (Rage Potion)"}),(0,a.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:["剩餘時間:"," ",(0,a.jsx)("span",{style:{fontFamily:"monospace"},children:N(L)})]})]}),(0,a.jsx)("div",{className:"ca-pulse",style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 10px #ef4444"}})]}):(0,a.jsx)("div",{style:{color:"var(--ca-text-muted)",fontSize:"0.85rem",textAlign:"center",padding:"10px"},children:"尚無啟用的增益效果"})})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"生涯冒險記錄"}),(0,a.jsxs)("div",{className:"ca-records-list ca-glass-static",style:{borderRadius:"12px"},children:[(0,a.jsx)(S,{label:"\uD83C\uDFAE 遊戲總點擊",value:_(h.totalClicks)}),(0,a.jsx)(S,{label:"⚔️ 累計總傷害",value:_(h.totalDamageDealt)}),(0,a.jsx)(S,{label:"\uD83D\uDC7E 擊敗怪物數",value:_(h.monstersKilled)}),(0,a.jsx)(S,{label:"\uD83D\uDE08 擊敗 BOSS 數",value:_(h.bossesKilled)}),(0,a.jsx)(S,{label:"\uD83D\uDCCD 歷史最高關卡",value:"第 ".concat(_(h.maxStageReached)," 關")}),(0,a.jsx)(S,{label:"\uD83D\uDC8E 累計儲蓄/金幣",value:_(h.totalGoldEarned)}),(0,a.jsx)(S,{label:"⏳ 生涯遊玩時間",value:N(h.playtimeSeconds)})]})]}),(0,a.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.7rem",opacity:.6},children:[(0,a.jsxs)("div",{children:["遊戲版本: ",String((null==x||null==(s=x.settings)?void 0:s.GAME_VERSION)||"1.0.0")]}),(0,a.jsx)("div",{style:{marginTop:"4px"},children:"Click Ascension Project \xa9 2026"})]})]})}function j(e){let{icon:t,label:l,value:i,color:s}=e;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("span",{style:{fontSize:"1rem"},children:t}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,a.jsx)("span",{style:{fontSize:"0.6rem",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:l}),(0,a.jsx)("span",{style:{fontSize:"0.85rem",color:s,fontWeight:"bold"},children:i})]})]})}function C(e){let{label:t,value:l,icon:i}=e;return(0,a.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,a.jsx)("div",{className:"ca-stat-icon",children:i}),(0,a.jsxs)("div",{className:"ca-stat-content",children:[(0,a.jsx)("div",{className:"ca-stat-label",children:t}),(0,a.jsx)("div",{className:"ca-stat-value",children:l})]})]})}function S(e){let{label:t,value:l}=e;return(0,a.jsxs)("div",{className:"ca-record-row",children:[(0,a.jsx)("span",{className:"ca-record-label",children:t}),(0,a.jsx)("span",{className:"ca-record-value",children:l})]})}function _(e){switch(null==e?void 0:e.toLowerCase()){case"common":default:return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b"}}function A(e){let{item:t,onClose:l,onEquip:i,onUnequip:s,isEquipped:n}=e,{config:r,level:o}=t,c=_(r.Rarity);return(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(c,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(c,"22")},children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(c,"44")},children:M(r.Slot)}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:c},children:r.Name}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:c,fontWeight:"bold"},children:r.Rarity}),(0,a.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:r.Slot})]})]}),(0,a.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:[(0,a.jsxs)("span",{children:["當前屬性 (Lv.",o,"/",r.Max_Level||"??","):"]}),o>=(r.Max_Level||99)&&(0,a.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold"},children:"MAX"})]}),(0,a.jsx)("div",{children:function(e,t,l){let a=(Number(t.Base_Val)||0)+(l-1)*(Number(t.Level_Mult)||0);return e.replace("{val}",a.toLocaleString())}(r.Desc_Template,r,o)}),(0,a.jsxs)("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"戰力加成 (Est. CP)"}),(0,a.jsxs)("span",{style:{fontSize:"0.9rem",color:"#fbbf24",fontWeight:"bold"},children:["+",(function(e,t){let l=(Number(e.Base_Val)||0)+(t-1)*(Number(e.Level_Mult)||0),a=String(e.Effect_Type||"").toUpperCase().trim();return["ADD_BASE_DMG","CLICK_DMG","ADD_DAMAGE","CLICK_DAMAGE","ADD_CLICK_DMG"].includes(a)?Math.floor(10*l):["ADD_AUTO_DMG","AUTO_DMG","AUTO_DAMAGE","ADD_AUTO"].includes(a)?Math.floor(20*l):["ADD_CRIT_CHANCE","CRIT_RATE","ADD_CRIT_RATE","LUCK","ADD_CRIT"].includes(a)?Math.floor(10*l):["ADD_CRIT_DMG","CRIT_DMG","CRIT_DAMAGE","ADD_CRIT_DMG"].includes(a)?Math.floor(5*l):0})(r,o).toLocaleString()]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"8px"},children:[n?(0,a.jsx)("button",{className:"ca-btn",onClick:()=>{s(r.Slot),l()},style:{flex:1,background:"#ef4444",color:"white",fontWeight:"bold"},children:"卸下"}):(0,a.jsx)("button",{className:"ca-btn",onClick:()=>{i(t.id,r.Slot),l()},style:{flex:1,background:"var(--ca-accent-gold)",color:"black",fontWeight:"bold"},children:"裝備"}),(0,a.jsx)("button",{className:"ca-btn",onClick:l,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"關閉"})]})]})})}function N(e){var t;let{player:l,effectiveStats:s,userId:r,gameConfig:o,onEquip:c,onUnequip:d}=e,[p,u]=i.useState(null),x=Object.entries((null==(t=l.equipment)?void 0:t.inventory)||{}).filter(e=>{let[,t]=e;return t>0}).map(e=>{var t;let[l,a]=e;return{id:l,level:a,config:null==o||null==(t=o.equipments)?void 0:t.find(e=>String(e.ID)===String(l))}}).filter(e=>!!e.config);return(0,a.jsxs)("div",{className:"ca-character-view",style:{flex:1,display:"flex",flexDirection:"column",width:"100%",height:"100%",padding:"12px",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"relative",paddingBottom:"12px"},children:[(0,a.jsxs)("div",{style:{width:"100%",maxWidth:"500px",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"8px",zIndex:10,padding:"0 4px"},children:[(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"⚔️"}),(0,a.jsx)("span",{className:"ca-stat-value",children:Math.floor(s.baseDamage).toLocaleString()}),s.baseDamage>l.stats.baseDamage&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(s.baseDamage-l.stats.baseDamage).toLocaleString(),")"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83C\uDFAF"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*s.criticalChance).toFixed(1),"%"]}),s.criticalChance>l.stats.criticalChance&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((s.criticalChance-l.stats.criticalChance)*100).toFixed(1),"%)"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83E\uDD16"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[Number(s.autoClickPerSec||0).toFixed(1),"/s"]}),s.autoClickPerSec>l.stats.autoClickPerSec&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(s.autoClickPerSec-l.stats.autoClickPerSec).toFixed(1),")"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCA5"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*s.criticalDamage).toFixed(0),"%"]}),s.criticalDamage>l.stats.criticalDamage&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((s.criticalDamage-l.stats.criticalDamage)*100).toFixed(0),"%)"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCB0"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*s.goldMultiplier).toFixed(0),"%"]}),s.goldMultiplier>l.stats.goldMultiplier&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((s.goldMultiplier-l.stats.goldMultiplier)*100).toFixed(0),"%)"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDC79"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*s.bossDamageMultiplier).toFixed(0),"%"]}),s.bossDamageMultiplier>l.stats.bossDamageMultiplier&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((s.bossDamageMultiplier-l.stats.bossDamageMultiplier)*100).toFixed(0),"%)"]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",width:"100%",maxWidth:"500px",justifyContent:"space-between",alignItems:"center",zIndex:2,padding:"0 4px"},children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,a.jsx)(L,{slot:n.MAIN_HAND,player:l,gameConfig:o,onClick:e=>{var t;let a=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));a&&u({id:e,level:l.equipment.inventory[e],config:a})}}),(0,a.jsx)(L,{slot:n.HEAD,player:l,gameConfig:o,onClick:e=>{var t;let a=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));a&&u({id:e,level:l.equipment.inventory[e],config:a})}}),(0,a.jsx)(L,{slot:n.BODY,player:l,gameConfig:o,onClick:e=>{var t;let a=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));a&&u({id:e,level:l.equipment.inventory[e],config:a})}})]}),(0,a.jsxs)("div",{className:"ca-character-figure ca-bounce-slow",style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(r||"Guest"),alt:"Character",style:{width:"110px",height:"110px",filter:"drop-shadow(0 10px 20px rgba(0,0,0,0.5))"}}),(0,a.jsxs)("div",{className:"ca-glass",style:{marginTop:"4px",padding:"2px 10px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(15, 23, 42, 0.6)"},children:[(0,a.jsxs)("span",{style:{fontSize:"0.9rem"},children:["Lv.",l.system.level]}),(0,a.jsx)("span",{style:{width:"1px",height:"10px",background:"rgba(255,255,255,0.2)"}}),(0,a.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold",fontSize:"0.8rem"},children:r||"Guest"})]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,a.jsx)(L,{slot:n.HANDS,player:l,gameConfig:o,onClick:e=>{var t;let a=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));a&&u({id:e,level:l.equipment.inventory[e],config:a})}}),(0,a.jsx)(L,{slot:n.LEGS,player:l,gameConfig:o,onClick:e=>{var t;let a=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));a&&u({id:e,level:l.equipment.inventory[e],config:a})}}),(0,a.jsx)(L,{slot:n.RELIC,player:l,gameConfig:o,onClick:e=>{var t;let a=null==o||null==(t=o.equipments)?void 0:t.find(t=>String(t.ID)===String(e));a&&u({id:e,level:l.equipment.inventory[e],config:a})}})]})]}),(0,a.jsx)("div",{style:{position:"absolute",top:"55%",left:"50%",transform:"translate(-50%, -50%)",width:"220px",height:"220px",background:"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",pointerEvents:"none",zIndex:0}})]}),(0,a.jsxs)("div",{style:{flex:"1 1 0px",width:"100%",background:"rgba(15, 23, 42, 0.4)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden",minHeight:"0"},children:[(0,a.jsxs)("div",{style:{padding:"8px 12px",background:"rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[(0,a.jsxs)("span",{style:{fontWeight:"bold",color:"#e2e8f0",fontSize:"0.9rem"},children:["\uD83C\uDF92 裝備倉庫 (",x.length,")"]}),(0,a.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--ca-text-muted)"},children:"點擊裝備以穿戴"})]}),(0,a.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px"},children:0===x.length?(0,a.jsx)("div",{style:{textAlign:"center",color:"gray",padding:"20px 0",fontSize:"0.8rem"},children:"倉庫空空如也..."}):(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(56px, 1fr))",gap:"8px"},children:x.map(e=>{var t;let i=Object.values((null==(t=l.equipment)?void 0:t.equipped)||{}).includes(e.id),s=_(e.config.Rarity);return(0,a.jsxs)("div",{onClick:()=>u(e),className:"ca-inventory-item",style:{width:"56px",height:"56px",background:"rgba(30, 41, 59, 0.6)",border:"2px solid ".concat(s),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",opacity:i?1:.8,boxShadow:i?"0 0 10px #22c55e, inset 0 0 5px #22c55e":"none"},title:"".concat(e.config.Name," (Lv.").concat(e.level,") - ").concat(e.config.Slot),children:[(0,a.jsx)("span",{style:{fontSize:"1.5rem"},children:M(e.config.Slot)}),(0,a.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"4px",fontWeight:"bold"},children:["L.",e.level]}),i&&(0,a.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",background:"#22c55e",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"3px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"E"})]},e.id)})})})]}),p&&(0,a.jsx)(A,{item:p,onClose:()=>u(null),onEquip:c,onUnequip:d,isEquipped:Object.values(l.equipment.equipped).includes(p.id)})]})}function M(e){switch(e){case n.MAIN_HAND:return"⚔️";case n.HEAD:return"\uD83E\uDE96";case n.BODY:return"\uD83D\uDC55";case n.HANDS:return"\uD83E\uDDE4";case n.LEGS:return"\uD83D\uDC62";case n.RELIC:return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function L(e){var t,l,i,s,n;let{slot:r,player:o,gameConfig:c,onClick:d}=e,p=null==(l=o.equipment)||null==(t=l.equipped)?void 0:t[r],u=p?null==c||null==(i=c.equipments)?void 0:i.find(e=>String(e.ID)===String(p)):null,x=p?(null==(n=o.equipment)||null==(s=n.inventory)?void 0:s[p])||1:0,m=u?_(u.Rarity):"rgba(255,255,255,0.1)";return(0,a.jsxs)("div",{className:"ca-equipment-slot",style:{width:"54px",height:"54px",background:"rgba(15, 23, 42, 0.6)",border:u?"2px solid ".concat(m):"1px dashed rgba(255,255,255,0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",transition:"all 0.2s",boxShadow:u?"0 0 15px ".concat(m,"44"):"none"},onClick:()=>p&&(null==d?void 0:d(p)),title:u?"".concat(u.Name," (Lv.").concat(x,")"):"Empty Slot",children:[(0,a.jsx)("div",{style:{fontSize:"1.6rem",opacity:u?1:.3},children:M(r)}),u&&(0,a.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"6px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.2)"},children:["Lv.",x]})]})}var w=l(23464);let k="https://script.google.com/macros/s/AKfycbxegFPp4kJZXDxUNqQopqiWVa2JLLM__rJbm700mUQsovg2nkE6wSJd2lFQyJQ4dg10/exec",I={loadPlayerSave:async e=>{try{let t=await w.A.get("".concat(k,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(t.data&&t.data.exists)return t.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,t)=>{try{if(!e)throw Error("User ID is required for saving");let l=await w.A.post(k,{action:"save_progress",userId:e,saveData:t},{headers:{"Content-Type":"text/plain"}});if(l.data&&l.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await w.A.get("".concat(k,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},E={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0,ascensionPoints:0,equipmentShards:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,bossDamageMultiplier:1,autoClickPerSec:1,monsterKillReduction:0,rareMonsterChance:0},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{},levelShop:{},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,warlordLevel:0,oracleLevel:0,voidLevel:0,titanLevel:0,amuletLevel:0},ascensionShop:{},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0},equipment:{inventory:{},equipped:{}},lastDailyRewardClaimTime:0},T={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,autoUsePotion:!1,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10,bossTimeLeft:null,bossTimeLimit:60};function R(){let[e,t]=(0,i.useState)(null),[l,n]=(0,i.useState)("BATTLE"),[o,c]=(0,i.useState)(E),[x,g]=(0,i.useState)(T),[h,f]=(0,i.useState)(null),[v,b]=(0,i.useState)(null),[D,j]=(0,i.useState)(null),[C,S]=(0,i.useState)(null),[_,A]=(0,i.useState)(null),[M,L]=(0,i.useState)(null),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"系統提示",l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return A({title:t,message:e,isAutoGacha:l,gachaResults:a})},k=i.useMemo(()=>{let e={baseDamage:o.stats.baseDamage||1,autoAttackDamage:0,criticalChance:o.stats.criticalChance||.05,criticalDamage:o.stats.criticalDamage||1.5,goldMultiplier:o.stats.goldMultiplier||1,cpMultiplier:o.stats.cpMultiplier||1,xpMultiplier:o.stats.xpMultiplier||1,bossDamageMultiplier:o.stats.bossDamageMultiplier||1,autoClickPerSec:o.stats.autoClickPerSec||1,monsterKillReduction:o.stats.monsterKillReduction||0,rareMonsterChance:o.stats.rareMonsterChance||0};return(null==v?void 0:v.equipments)&&(Object.values(o.equipment.equipped).forEach(t=>{if(!t)return;let l=v.equipments.find(e=>String(e.ID)===String(t));if(l){let a=Number(o.equipment.inventory[t]||1),i=Number(l.Base_Val||0)+(a-1)*Number(l.Level_Mult||0);switch(String(l.Effect_Type||"").toUpperCase().trim()){case"ADD_BASE_DMG":case"CLICK_DMG":case"CLICK_DAMAGE":case"ADD_DAMAGE":case"ADD_CLICK_DMG":e.baseDamage+=i;break;case"ADD_AUTO_DMG":case"AUTO_DMG":case"AUTO_DAMAGE":case"ADD_AUTO":e.autoAttackDamage+=i;break;case"ADD_CRIT_CHANCE":case"CRIT_RATE":case"ADD_CRIT_RATE":case"LUCK":e.criticalChance+=i/100;break;case"ADD_CRIT_DMG":case"CRIT_DMG":case"CRIT_DAMAGE":case"ADD_CRIT_DMG":e.criticalDamage+=i/100;break;case"ADD_GOLD_MULT":case"GOLD_MULT":case"ADD_GOLD":case"GOLD_BONUS":case"ADD_GOLD_MULT":e.goldMultiplier+=i/100;break;case"ADD_XP_MULT":case"XP_MULT":case"ADD_XP":case"XP_BONUS":case"ADD_XP_MULT":e.xpMultiplier+=i/100;break;case"ADD_BOSS_DMG":case"BOSS_DMG":case"BOSS_DAMAGE":e.bossDamageMultiplier+=i/100;break;case"CP_MULT":case"CP_BONUS":case"ADD_CP_MULT":e.cpMultiplier+=i/100;break;case"REDUCE_GOAL_V":case"REDUCE_STAGE_GOAL":e.monsterKillReduction+=i;break;case"RARE_CHANCE_P":case"RARE_SPAWN_CHANCE":case"RARE_CHANCE":e.rareMonsterChance+=i/100;break;case"AUTO_CLICK_V":case"AUTO_CLICK_CPS":e.autoClickPerSec+=i}}}),[{id:"gold_shop_weapon",levelKey:"weaponLevel"},{id:"gold_shop_mercenary",levelKey:"mercenaryLevel"},{id:"gold_shop_partner",levelKey:"partnerLevel"},{id:"gold_shop_archer",levelKey:"archerLevel"},{id:"gold_shop_knight",levelKey:"knightLevel"},{id:"gold_shop_warlord",levelKey:"warlordLevel"},{id:"gold_shop_oracle",levelKey:"oracleLevel"},{id:"gold_shop_void",levelKey:"voidLevel"},{id:"gold_shop_titan",levelKey:"titanLevel"},{id:"gold_shop_amulet",levelKey:"amuletLevel"}].forEach(t=>{var l;let{id:a,levelKey:i}=t,s=o.goldShop[i]||0;if(s<=0)return;let n=null==v||null==(l=v.upgrades)?void 0:l.find(e=>e.ID===a);if(n){let t=String(n.Effect_Type||"").toUpperCase().trim(),l=Number(n.Effect_Val||0)*s;("ADD_DAMAGE"===t||"CLICK_DMG"===t)&&(e.baseDamage+=l),("ADD_AUTO_DMG"===t||"AUTO_DMG"===t||"ADD_AUTO"===t)&&(e.autoAttackDamage+=l),("ADD_GOLD_MULT"===t||"GOLD_MULT"===t)&&(e.goldMultiplier+=l/100),("ADD_CRIT_DMG"===t||"CRIT_DMG"===t)&&(e.criticalDamage+=l/100)}})),e},[o.stats,o.equipment.equipped,o.equipment.inventory,o.goldShop,v]),R=(0,i.useCallback)((e,t)=>{var l,a,i,s;return{...e,...t,system:{...e.system,...t.system||{}},wallet:{...e.wallet,...t.wallet||{}},stats:{...e.stats,...t.stats||{}},records:{...e.records,...t.records||{}},clickShop:{...e.clickShop,...t.clickShop||{}},levelShop:{...e.levelShop,...t.levelShop||{}},goldShop:{...e.goldShop,...t.goldShop||{}},ascensionShop:{...e.ascensionShop,...t.ascensionShop||{}},inventory:{...e.inventory,...t.inventory||{}},activeBuffs:{...e.activeBuffs,...t.activeBuffs||{}},equipment:{...e.equipment,...t.equipment||{},inventory:{...(null==(l=e.equipment)?void 0:l.inventory)||{},...(null==(a=t.equipment)?void 0:a.inventory)||{}},equipped:{...(null==(i=e.equipment)?void 0:i.equipped)||{},...(null==(s=t.equipment)?void 0:s.equipped)||{}}}}},[]),P=k.autoAttackDamage,O=Math.floor(10*k.baseDamage+20*P+1e3*k.criticalChance+500*k.criticalDamage);(0,i.useEffect)(()=>{v&&(console.log("[Recalc] GameConfig loaded, refreshing stats..."),c(e=>({...e,stats:J(e)})))},[v]),(0,i.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await I.getGameConfigs();e&&(console.log("[Config] Loaded:",e),b(e))})();let e=localStorage.getItem("ca_last_user_id");e&&W(e)},[]);let G=(0,i.useCallback)(()=>{let e=x.isBossActive,t=Math.max(1,x.monstersRequiredForBoss-(k.monsterKillReduction||0));!e&&x.autoChallengeBoss&&x.monstersKilledInStage>=t?(e=!0,g(e=>({...e,isBossActive:!0,bossTimeLeft:e.bossTimeLimit}))):e&&null===x.bossTimeLeft&&g(e=>({...e,bossTimeLeft:e.bossTimeLimit}));let l=H(x.currentStageId,e,v),a=Math.ceil((20*Math.pow(1.18,x.currentStageId-1)+10*x.currentStageId)*l.hpMultiplier),i=.15*a*l.goldMultiplier,s=.08*a*l.xpMultiplier;f({id:crypto.randomUUID(),configId:l.configId,name:"".concat(l.name," Lv.").concat(x.currentStageId),level:x.currentStageId,maxHp:a,currentHp:a,isBoss:"BOSS"===l.rarity,rewardGold:Math.max(1,Math.floor(i)),rewardXp:Math.max(1,Math.floor(s)),emoji:l.emoji,note:l.note})},[x,k.monsterKillReduction]),[z,B]=(0,i.useState)(null);(0,i.useEffect)(()=>{h||G()},[h,G]),(0,i.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&W(e)},[]);let U=i.useRef(o),q=i.useRef(x),K=i.useRef(new Set);(0,i.useEffect)(()=>{U.current=o,q.current=x},[o,x]),(0,i.useEffect)(()=>{let e;return x.isBossActive&&h&&h.isBoss&&(null===x.bossTimeLeft||void 0===x.bossTimeLeft?g(e=>({...e,bossTimeLeft:e.bossTimeLimit||60})):x.bossTimeLeft>0?e=setInterval(()=>{g(e=>{var t,l;return{...e,bossTimeLeft:(null!=(t=e.bossTimeLeft)?t:0)>0?(null!=(l=e.bossTimeLeft)?l:0)-1:0}})},1e3):0===x.bossTimeLeft&&(g(e=>({...e,isBossActive:!1,autoChallengeBoss:!1,bossTimeLeft:null})),f(null),w("挑戰失敗！Boss 挑戰時間超時，已回到關卡掛機模式並關閉自動挑戰。","挑戰失敗"))),()=>{e&&clearInterval(e)}},[x.isBossActive,x.bossTimeLeft,null==h?void 0:h.id,null==h?void 0:h.isBoss]),(0,i.useEffect)(()=>{if(!z)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(z," to Cloud..."));let e={player:U.current,stage:q.current,timestamp:Date.now()};try{await I.savePlayerProgress(z,e),localStorage.setItem("ca_save_".concat(z),JSON.stringify(e))}catch(t){console.warn("[AutoSave] Cloud save failed, using local backup",t),localStorage.setItem("ca_save_".concat(z),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[z]),(0,i.useEffect)(()=>{if(!x.autoUsePotion||o.inventory.ragePotionCount<=0)return;let e=setInterval(()=>{Date.now()>=(o.activeBuffs.ragePotionExpiresAt||0)&&o.inventory.ragePotionCount>0&&Y("RAGE")},1e3);return()=>clearInterval(e)},[x.autoUsePotion,o.inventory.ragePotionCount,o.activeBuffs.ragePotionExpiresAt]),(0,i.useEffect)(()=>{if(!M)return;let e=setInterval(()=>{if(o.wallet.gold<({basic:1e6,advanced:1e7,premium:1e8})[M]){L(null),w("金幣不足，已停止自動連續抽卡。");return}X("gacha_equipment_".concat(M,"_1000"))},1e3);return()=>clearInterval(e)},[M,o.wallet.gold]);let W=async e=>{if(!e)return;B(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let t=await I.loadPlayerSave(e);if(t){console.log("[Login] Cloud save found!"),t.player&&c(e=>R(e,t.player)),t.stage&&g(e=>({...e,...t.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let t=localStorage.getItem("ca_save_".concat(e));if(t){console.log("[Login] Found local backup.");try{let e=JSON.parse(t);c(t=>({...t,...e.player})),g(t=>({...t,...e.stage}))}catch(e){}}};(0,i.useEffect)(()=>{let e=setInterval(()=>{c(e=>({...e,records:{...e.records,playtimeSeconds:(e.records.playtimeSeconds||0)+1}}))},1e3);return()=>clearInterval(e)},[]);let F=async()=>{if(!z)return;let e={player:o,stage:x,timestamp:Date.now()};try{await I.savePlayerProgress(z,e),w("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(z),JSON.stringify(e))}catch(t){console.error("Save failed",t),w("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(z),JSON.stringify(e))}};(0,i.useEffect)(()=>{if(!h||h.currentHp<=0||k.autoAttackDamage<=0)return;let e=setInterval(()=>{let e=k.autoAttackDamage,t=h.isBoss&&k.bossDamageMultiplier||1,l=Math.ceil(e*t);f(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-l;return t<=0?(setTimeout(()=>V(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),c(e=>{let t=+k.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalDamageDealt:e.records.totalDamageDealt+l}}});let a=(e,t)=>{var l;let a=o.goldShop[t]||0;if(a<=0)return 0;let i=null==v||null==(l=v.upgrades)?void 0:l.find(t=>t.ID===e);return i?Number(i.Effect_Val||0)*a:0},i=a("gold_shop_mercenary","mercenaryLevel"),s=a("gold_shop_partner","partnerLevel"),n=a("gold_shop_archer","archerLevel"),r=a("gold_shop_knight","knightLevel"),d=a("gold_shop_warlord","warlordLevel"),p=a("gold_shop_oracle","oracleLevel"),u=a("gold_shop_void","voidLevel"),x=a("gold_shop_titan","titanLevel"),m=i+s+n+r+d+p+u+x,g=Math.max(0,k.autoAttackDamage-m);j({time:Date.now(),damage:l,breakdown:{mercenary:Math.ceil(i*t),partner:Math.ceil(s*t),archer:Math.ceil(n*t),knight:Math.ceil(r*t),warlord:Math.ceil(d*t),oracle:Math.ceil(p*t),void:Math.ceil(u*t),titan:Math.ceil(x*t),player:Math.ceil(g*t)}})},1e3);return()=>clearInterval(e)},[null==h?void 0:h.id,k.autoAttackDamage,k.bossDamageMultiplier,k.cpMultiplier,o.goldShop.mercenaryLevel,o.goldShop.partnerLevel,o.goldShop.archerLevel,o.goldShop.knightLevel,o.goldShop.warlordLevel,o.goldShop.oracleLevel,o.goldShop.voidLevel,o.goldShop.titanLevel,v]),(0,i.useEffect)(()=>{let e=k.autoClickPerSec||0;if(e<=0||!h||h.currentHp<=0)return;let t=setInterval(()=>{var e,t;let l=Math.random()<k.criticalChance,a=((null==(t=U.current)||null==(e=t.activeBuffs)?void 0:e.ragePotionExpiresAt)||0)>Date.now(),i=l?Math.floor(k.baseDamage*k.criticalDamage):k.baseDamage;a&&(i*=2);let s=i;h.isBoss&&(s=Math.ceil(i*(k.bossDamageMultiplier||1))),f(e=>{if(!e||e.currentHp<=0)return e;let t=e.currentHp-s;return t<=0?(setTimeout(()=>V(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),c(e=>{let t=+k.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+t},records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+s}}}),S({id:crypto.randomUUID(),damage:s,isCrit:l})},Math.max(50,1e3/e));return()=>clearInterval(t)},[k.autoClickPerSec,k.baseDamage,k.criticalChance,k.criticalDamage,k.bossDamageMultiplier,k.cpMultiplier,null==h?void 0:h.id]);let H=(0,i.useCallback)((e,t,l)=>{let a={configId:"fallback",name:"未知怪物",emoji:"❓",rarity:s.COMMON,hpMultiplier:1,goldMultiplier:1,xpMultiplier:1};if(!l||!l.monsters||0===l.monsters.length)return a;let i=l.monsters.filter(l=>{let a=Number(l.Stage_Min)||1,i=Number(l.Stage_Max)||9999;if(e<a||e>i)return!1;let s=(l.Rarity||"COMMON").toUpperCase();return t?"BOSS"===s:"BOSS"!==s});if(0===i.length)return a;let n=Math.random()*i.reduce((e,t)=>e+(Number(t.Weight)||0),0);for(let e of i){let t=Number(e.Weight)||0;if(n<t)return console.log("Selected Monster Config:",e),{configId:e.ID,name:e.Name,emoji:e.Emoji,rarity:e.Rarity||s.COMMON,hpMultiplier:Number(e.HP_Mult)||1,goldMultiplier:Number(e.Gold_Mult)||1,xpMultiplier:Number(e.XP_Mult)||1,dropDiamonds:Number(e.Drop_Diamonds)||0,note:e.Notes};n-=t}return a},[]),V=e=>{if(!e||K.current.has(e.id))return;K.current.add(e.id),K.current.size>50&&K.current.clear();let t=Math.ceil(e.rewardGold*k.goldMultiplier),l=Math.ceil(e.rewardXp*k.xpMultiplier);c(a=>{let{level:i,currentXp:s,requiredXp:n}=a.system,{levelPoints:r}=a.wallet;for(s+=l;s>=n;)s-=n,i+=1,r+=5,n=Math.floor(1.2*n);return{...a,wallet:{...a.wallet,gold:a.wallet.gold+t,levelPoints:r},system:{...a.system,level:i,currentXp:s,requiredXp:n},records:{...a.records,monstersKilled:a.records.monstersKilled+1,totalGoldEarned:a.records.totalGoldEarned+t,bossesKilled:e.isBoss?a.records.bossesKilled+1:a.records.bossesKilled,maxStageReached:e.isBoss?Math.max(a.records.maxStageReached,e.level+1):a.records.maxStageReached}}}),g(t=>{if(e.isBoss)return{...t,currentStageId:e.level+1,maxStageReached:Math.max(t.maxStageReached,e.level+1),isBossActive:!1,monstersKilledInStage:0,bossTimeLeft:null};let l=t.monstersKilledInStage+1;return{...t,monstersKilledInStage:l}}),f(null)},X=e=>{var t,l,a,i,s,n,r;if("daily_checkin"===e)return void c(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+10,gold:e.wallet.gold+500},lastDailyRewardClaimTime:Date.now()}));if(e.startsWith("click_shop_")){let l=null==v||null==(t=v.upgrades)?void 0:t.find(t=>t.ID===e);if(!l)return;let a=o.clickShop[e]||0,i=Number(l.Max_Level||0);if(i>0&&a>=i)return void w("已達最大等級！");let n=Number(l.Cost_Base||0),r=Number(l.Cost_Mult||0),d=0;d=1===r||1===r?Math.floor(n+a):Math.floor(n*Math.pow(r,a));let p=l.Currency||"CP";return(s=o.wallet,("GOLD"===p?s.gold:"LP"===p?s.levelPoints:"DIAMOND"===p?s.diamonds:"AP"===p?s.ascensionPoints:s.clickPoints)>=d)?c(t=>{let i={...t.stats},s=l.Effect_Type,n=Number(l.Effect_Val||0);("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(i.baseDamage+=n),("ADD_CRIT_DMG"===s||"CRIT_DMG"===s)&&(i.criticalDamage+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(i.goldMultiplier+=n/100),"AUTO_CLICK_V"===s&&(i.autoClickPerSec+=n),"REDUCE_GOAL_V"===s&&(i.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(i.rareMonsterChance+=n/100);let r={...t.wallet};return"GOLD"===p?r.gold-=d:"LP"===p?r.levelPoints-=d:"DIAMOND"===p?r.diamonds-=d:"AP"===p?r.ascensionPoints-=d:r.clickPoints-=d,{...t,wallet:r,clickShop:{...t.clickShop,[e]:a+1},stats:i}}):w("".concat(p," 不足！")),void 0}if(e.startsWith("level_shop_")){let t=null==v||null==(l=v.upgrades)?void 0:l.find(t=>t.ID===e);if(!t)return;let a=o.levelShop[e]||0,i=Number(t.Max_Level||0);if(i>0&&a>=i)return void w("已達最大等級！");let s=Number(t.Cost_Base||0),r=Number(t.Cost_Mult||0),d=0;d=1===r||1===r?Math.floor(s+a):Math.floor(s*Math.pow(r,a));let p=t.Currency||"LP";return(n=o.wallet,("GOLD"===p?n.gold:"CP"===p?n.clickPoints:"DIAMOND"===p?n.diamonds:"AP"===p?n.ascensionPoints:n.levelPoints)>=d)?c(l=>{let i={...l.stats},s=t.Effect_Type,n=Number(t.Effect_Val||0);("ADD_XP"===s||"XP_MULT"===s)&&(i.xpMultiplier+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(i.goldMultiplier+=n/100),("ADD_AUTO"===s||"AUTO_DMG"===s)&&(i.autoAttackDamage+=n),("ADD_BOSS_DMG"===s||"BOSS_DMG"===s)&&(i.bossDamageMultiplier+=n/100),("ADD_CRIT"===s||"CRIT_RATE"===s)&&(i.criticalChance+=n/100),"AUTO_CLICK_V"===s&&(i.autoClickPerSec+=n),"REDUCE_GOAL_V"===s&&(i.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(i.rareMonsterChance+=n/100);let r={...l.wallet};return"GOLD"===p?r.gold-=d:"CP"===p?r.clickPoints-=d:"DIAMOND"===p?r.diamonds-=d:"AP"===p?r.ascensionPoints-=d:r.levelPoints-=d,{...l,wallet:r,levelShop:{...l.levelShop,[e]:a+1},stats:i}}):w("".concat(p," 不足！")),void 0}let d=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:"DIAMOND"},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:"DIAMOND"}].find(t=>t.id===e);if(d&&"DIAMOND"===d.currency&&o.wallet.diamonds>=d.cost&&c(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds-d.cost,gold:e.wallet.gold+d.reward}})),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:t}=o,l=null==v||null==(a=v.upgrades)?void 0:a.find(t=>t.ID===e);if(l){let a=e.replace("gold_shop_","")+"Level",i=t[a]||0,s=Number(l.Max_Level||0);if(s>0&&i>=s)return void w("已達最大等級！");let n=Number(l.Cost_Base||0),r=Number(l.Cost_Mult||1),d=0;return d="ADD_INVENTORY"===l.Effect_Type?n:1===r||1===r?Math.floor(n+i):Math.floor(n*Math.pow(r,i)),void(o.wallet.gold>=d?c(t=>{let i={...t.stats},s=l.Effect_Type,n=Number(l.Effect_Val||0);"ADD_DAMAGE"===s&&(i.baseDamage+=n),"ADD_AUTO_DMG"===s&&(i.autoAttackDamage+=n),"ADD_GOLD_MULT"===s&&(i.goldMultiplier+=n/100);let r={...t.goldShop};r[a]=(t.goldShop[a]||0)+1;let o={...t.inventory};return"ADD_INVENTORY"===s&&"gold_potion_rage"===e&&(o.ragePotionCount=(o.ragePotionCount||0)+1),{...t,wallet:{...t.wallet,gold:t.wallet.gold-d},goldShop:r,stats:i,inventory:o}}):w("金幣不足！"))}console.warn("[handleShopPurchase] Gold shop item not found in config: ".concat(e))}if(e.startsWith("gacha_equipment_")){let t=1;e.endsWith("_10")&&(t=10),e.endsWith("_100")&&(t=100),e.endsWith("_1000")&&(t=1e3);let l="basic";e.includes("advanced")&&(l="advanced"),e.includes("premium")&&(l="premium");let a=1e3;"advanced"===l&&(a=1e4),"premium"===l&&(a=1e5);let i=a*t;if(o.wallet.gold>=i){let e=(null==v?void 0:v.equipments)||[];if(e.length>0){let a=e.filter(e=>{let t=(e.Rarity||"COMMON").toUpperCase();return"basic"===l?"LEGENDARY"!==t&&"MYTHIC"!==t:"advanced"!==l||"MYTHIC"!==t});if(0===a.length)return void w("此箱子目前沒有可抽取的裝備設定。");let s=a.reduce((e,t)=>e+(Number(t.Gacha_Weight)||0),0),n={...o.equipment.inventory},r=[],d=[],p=0;for(let e=0;e<t;e++){let e=Math.random()*s,t=a[0];for(let l of a){let a=Number(l.Gacha_Weight)||0;if(e<a){t=l;break}e-=a}r.push(t);let l=n[t.ID]||0;if(l>=(Number(t.Max_Level)||10)){let e=(t.Rarity||"COMMON").toUpperCase(),l=1;switch(e){case"COMMON":default:l=1;break;case"UNCOMMON":l=3;break;case"RARE":l=10;break;case"EPIC":l=50;break;case"LEGENDARY":l=200;break;case"MYTHIC":l=1e3}p+=l,d.push({item:t,shards:l})}else n[t.ID]=l+1}if(c(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-i,equipmentShards:(e.wallet.equipmentShards||0)+p},equipment:{...e.equipment,inventory:n}})),1===t)if(d.length>0){let e=d[0];w("獲得裝備：".concat(e.item.Name," (已滿級)\n自動轉換為：\uD83E\uDDE9 裝備碎片 x").concat(e.shards),"獲得裝備")}else w("獲得裝備：".concat(r[0].Name," (Rarity: ").concat(r[0].Rarity,")"),"獲得裝備");else{let e={};r.forEach(t=>{e[t.Name]=(e[t.Name]||0)+1});let a=Object.entries(e).map(e=>{let[t,l]=e;return"".concat(t," x").concat(l)}).join("\n");p>0&&(a+="\n\n\uD83E\uDDE9 獲得碎片: ".concat(p," (滿級轉化)")),w("獲得 ".concat(t," 件裝備").concat("premium"===l?"(頂級)":"advanced"===l?"(高級)":"","：\n").concat(a),"獲得裝備",!!M,{summary:e,gainedShards:p,boxType:l,drawCount:t})}}else w("暫無裝備可抽取")}else w("金幣不足！"),M&&L(null)}if(e.startsWith("ascension_shop_")||e.startsWith("asc_")){let t=null==v||null==(i=v.upgrades)?void 0:i.find(t=>t.ID===e);if(!t)return;let l=o.ascensionShop[e]||0,a=Number(t.Max_Level||0);if(a>0&&l>=a)return void w("已達最大等級！");let s=Number(t.Cost_Base||0),n=Number(t.Cost_Mult||0),d=0;d=1===n||1===n?Math.floor(s+l):Math.floor(s*Math.pow(n,l));let p=t.Currency||"AP";(r=o.wallet,("GOLD"===p?r.gold:"CP"===p?r.clickPoints:"LP"===p?r.levelPoints:"DIAMOND"===p?r.diamonds:r.ascensionPoints)>=d)?c(a=>{let i={...a.stats},s=t.Effect_Type,n=Number(t.Effect_Val||0);("ADD_CRIT"===s||"CRIT_RATE"===s)&&(i.criticalChance+=n/100),("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(i.baseDamage+=n),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(i.goldMultiplier+=n/100),("ADD_XP"===s||"XP_MULT"===s)&&(i.xpMultiplier+=n/100),"REDUCE_GOAL_V"===s&&(i.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(i.rareMonsterChance+=n/100),"AUTO_CLICK_V"===s&&(i.autoClickPerSec+=n);let r={...a.wallet};return"GOLD"===p?r.gold-=d:"CP"===p?r.clickPoints-=d:"LP"===p?r.levelPoints-=d:"DIAMOND"===p?r.diamonds-=d:r.ascensionPoints-=d,{...a,wallet:r,ascensionShop:{...a.ascensionShop,[e]:l+1},stats:i}}):w("".concat(p," 不足！"))}},Y=e=>{"RAGE"===e&&o.inventory.ragePotionCount>0&&c(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))},J=e=>{let t={...E.stats};return[{id:"gold_shop_weapon",levelKey:"weaponLevel"},{id:"gold_shop_mercenary",levelKey:"mercenaryLevel"},{id:"gold_shop_partner",levelKey:"partnerLevel"},{id:"gold_shop_archer",levelKey:"archerLevel"},{id:"gold_shop_knight",levelKey:"knightLevel"},{id:"gold_shop_warlord",levelKey:"warlordLevel"},{id:"gold_shop_oracle",levelKey:"oracleLevel"},{id:"gold_shop_void",levelKey:"voidLevel"},{id:"gold_shop_titan",levelKey:"titanLevel"},{id:"gold_shop_amulet",levelKey:"amuletLevel"}].forEach(l=>{var a;let{id:i,levelKey:s}=l,n=e.goldShop[s]||0;if(n<=0)return;let r=null==v||null==(a=v.upgrades)?void 0:a.find(e=>e.ID===i);if(r){let e=r.Effect_Type,l=Number(r.Effect_Val||0)*n;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(t.baseDamage+=l),("ADD_AUTO_DMG"===e||"AUTO_DMG"===e||"ADD_AUTO"===e)&&(t.autoAttackDamage+=l),("ADD_GOLD_MULT"===e||"GOLD_MULT"===e)&&(t.goldMultiplier+=l/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(t.criticalDamage+=l/100)}}),["clickShop","levelShop","ascensionShop"].forEach(l=>{Object.entries(e[l]).forEach(e=>{var l;let[a,i]=e,s=null==v||null==(l=v.upgrades)?void 0:l.find(e=>e.ID===a);if(s&&i>0){let e=s.Effect_Type,l=Number(s.Effect_Val||0)*i;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(t.baseDamage+=l),("ADD_CRIT"===e||"CRIT_RATE"===e)&&(t.criticalChance+=l/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(t.criticalDamage+=l/100),("ADD_GOLD"===e||"GOLD_MULT"===e)&&(t.goldMultiplier+=l/100),("ADD_XP"===e||"XP_MULT"===e)&&(t.xpMultiplier+=l/100),("ADD_AUTO"===e||"AUTO_DMG"===e)&&(t.autoAttackDamage+=l),("ADD_BOSS_DMG"===e||"BOSS_DMG"===e)&&(t.bossDamageMultiplier+=l/100),"REDUCE_GOAL_V"===e&&(t.monsterKillReduction+=l),"RARE_CHANCE_P"===e&&(t.rareMonsterChance+=l/100),"AUTO_CLICK_V"===e&&(t.autoClickPerSec+=l)}})}),t},Q=()=>{Z<=0||(c(e=>{let t={...e,system:{level:1,currentXp:0,requiredXp:100},wallet:{...e.wallet,gold:0,levelPoints:0,ascensionPoints:(e.wallet.ascensionPoints||0)+Z,equipmentShards:e.wallet.equipmentShards||0},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,warlordLevel:0,oracleLevel:0,voidLevel:0,titanLevel:0,amuletLevel:0},levelShop:{},activeBuffs:{ragePotionExpiresAt:0}};return t.stats=J(t),t}),g(e=>({...e,currentStageId:1,monstersKilledInStage:0,isBossActive:!1,maxStageReached:1,bossTimeLeft:null})),f(null),w("⚡ 渡劫成功！獲得 ".concat(Z.toLocaleString()," 點飛昇點數！\n等級與等級點數已重製，裝備與點擊加成已保留。"),"渡劫成功"),n("BATTLE"))},Z=i.useMemo(()=>Math.floor(10*Math.pow(1.2,Math.max(0,x.maxStageReached-0))),[x.maxStageReached]);return(0,a.jsxs)("div",{className:"ca-game-container",children:[(0,a.jsx)(r,{player:o,combatPower:O,stageId:x.currentStageId,onAvatarClick:()=>t("PROFILE"),onAscension:()=>{if(Z<=0)return void w("尚未達到飛升條件！");window.confirm("確定要渡劫飛升嗎？\n\n將重置關卡與金幣，並獲得 ".concat(Z.toLocaleString()," 點飛升點數！"))&&Q()},potentialPoints:Z}),"BATTLE"===l?(0,a.jsx)(d,{monster:h,stageId:x.currentStageId,onMonsterClick:(e,t)=>{h&&!(h.currentHp<=0)&&(f(t=>{if(!t||t.currentHp<=0)return t;let l=Math.max(0,t.currentHp-e);return l<=0&&setTimeout(()=>V(t),0),{...t,currentHp:l}}),c(t=>({...t,records:{...t.records,totalClicks:t.records.totalClicks+1,totalDamageDealt:t.records.totalDamageDealt+e},wallet:{...t.wallet,clickPoints:t.wallet.clickPoints+ +k.cpMultiplier}})))},baseDamage:k.baseDamage,criticalChance:k.criticalChance,criticalDamage:k.criticalDamage,bossDamageMultiplier:k.bossDamageMultiplier||1,monstersKilled:x.monstersKilledInStage,monstersRequired:Math.max(1,x.monstersRequiredForBoss-(k.monsterKillReduction||0)),isBossActive:x.isBossActive,mercenaryLevel:o.goldShop.mercenaryLevel,partnerLevel:o.goldShop.partnerLevel,archerLevel:o.goldShop.archerLevel,knightLevel:o.goldShop.knightLevel,warlordLevel:o.goldShop.warlordLevel,oracleLevel:o.goldShop.oracleLevel,voidLevel:o.goldShop.voidLevel,titanLevel:o.goldShop.titanLevel,potionCount:o.inventory.ragePotionCount,activeBuffs:o.activeBuffs,onUsePotion:()=>Y("RAGE"),lastAutoAttack:D,lastAutoClickEvent:C,bossTimeLeft:x.bossTimeLeft,bossTimeLimit:x.bossTimeLimit,onChallengeBoss:()=>{g(e=>({...e,isBossActive:!0,bossTimeLeft:e.bossTimeLimit||60})),f(null)},autoUsePotion:x.autoUsePotion,onToggleAutoPotion:()=>g(e=>({...e,autoUsePotion:!e.autoUsePotion}))}):(0,a.jsx)(N,{player:o,effectiveStats:k,userId:z,gameConfig:v,onEquip:(e,t)=>{c(l=>({...l,equipment:{...l.equipment,equipped:{...l.equipment.equipped,[t]:e}}}))},onUnequip:e=>{c(t=>{let l={...t.equipment.equipped};return delete l[e],{...t,equipment:{...t.equipment,equipped:l}}})}}),(0,a.jsx)(p,{activeView:l,onSwitchView:n,onOpenModal:t}),(0,a.jsx)(u,{isOpen:"PROFILE"===e,onClose:()=>t(null),title:"玩家資料",children:(0,a.jsx)(y,{player:o,effectiveStats:k,combatPower:O,userId:z,onLogin:W,onLogout:()=>{B(null),localStorage.removeItem("ca_last_user_id"),c(E),g(T)},onManualSave:F,gameConfig:v})}),(0,a.jsx)(u,{isOpen:"SHOP"===e,onClose:()=>t(null),title:"商店",headerContent:(0,a.jsxs)("div",{className:"ca-shop-currency-bar",style:{display:"flex",flexWrap:"wrap",border:"none",background:"transparent",padding:"0 8px",gap:"12px"},children:[(0,a.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},title:"金幣",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{children:Math.floor(o.wallet.gold).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},title:"鑽石",children:[(0,a.jsx)("span",{children:"\uD83D\uDC8E"}),(0,a.jsx)("span",{children:o.wallet.diamonds.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"var(--ca-accent-cyan, #22d3ee)"},title:"點擊點數",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:Math.floor(o.wallet.clickPoints).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#4ade80"},title:"等級積分",children:[(0,a.jsx)("span",{children:"\uD83C\uDD99"}),(0,a.jsx)("span",{children:o.wallet.levelPoints.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#d8b4fe"},title:"飛昇點數",children:[(0,a.jsx)("span",{children:"\uD83D\uDD4A️"}),(0,a.jsx)("span",{children:o.wallet.ascensionPoints.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#fca5a5"},title:"裝備碎片",children:[(0,a.jsx)("span",{children:"\uD83E\uDDE9"}),(0,a.jsx)("span",{children:(o.wallet.equipmentShards||0).toLocaleString()})]})]}),children:(0,a.jsx)(m,{player:o,onPurchase:X,onResetLevelPoints:()=>{window.confirm("確定要重製等級積分嗎？\n所有已分配的點數將會返還，您可以重新分配天賦。")&&(c(e=>{let t=0;Object.entries(e.levelShop).forEach(e=>{var l;let[a,i]=e,s=null==v||null==(l=v.upgrades)?void 0:l.find(e=>e.ID===a);if(s)for(let e=0;e<i;e++){let l=Math.floor(s.Cost_Base*Math.pow(s.Cost_Mult,e));t+=l}});let l={...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints+t},levelShop:{}};return l.stats=J(l),l}),w("✅ 等級積分已重製！"))},gameConfig:v,autoGachaBox:M,onToggleAutoGacha:e=>L(e)})}),(0,a.jsx)(u,{isOpen:!!_,onClose:()=>A(null),title:(null==_?void 0:_.title)||"系統提示",children:(0,a.jsxs)("div",{style:{textAlign:(null==_?void 0:_.gachaResults)?"left":"center",padding:"20px",fontSize:"1rem",color:"#e2e8f0",maxHeight:"60vh",overflowY:"auto"},children:[(null==_?void 0:_.gachaResults)?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fbbf24",marginBottom:"16px",textAlign:"center"},children:["\uD83C\uDF8A 連抽結果摘要 (",_.gachaResults.drawCount," 抽)"]}),(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"10px",marginBottom:"20px"},children:Object.entries(_.gachaResults.summary).map(e=>{let[t,l]=e;return(0,a.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.9rem"},children:t}),(0,a.jsxs)("span",{style:{color:"#10b981",fontWeight:"bold",fontSize:"0.8rem"},children:["x",l]})]},t)})}),_.gachaResults.gainedShards>0&&(0,a.jsxs)("div",{style:{background:"rgba(16, 185, 129, 0.1)",padding:"12px",borderRadius:"8px",border:"1px solid rgba(16, 185, 129, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",fontWeight:"bold"},children:[(0,a.jsx)("span",{style:{fontSize:"1.2rem"},children:"\uD83E\uDDE9"}),(0,a.jsxs)("span",{style:{color:"#34d399"},children:["轉化獲得碎片: ",_.gachaResults.gainedShards]})]})]}):(0,a.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:null==_?void 0:_.message}),(0,a.jsxs)("div",{style:{marginTop:"24px",display:"flex",justifyContent:"center",gap:"12px",position:"sticky",bottom:0,background:"var(--ca-bg-modal, #1e293b)",paddingTop:"12px"},children:[(null==_?void 0:_.isAutoGacha)&&(0,a.jsxs)("button",{className:"ca-btn",style:{padding:"10px 24px",background:"linear-gradient(to bottom, #ef4444, #b91c1c)",color:"white",border:"none",fontWeight:"bold",boxShadow:"0 0 15px rgba(239, 68, 68, 0.4)",display:"flex",alignItems:"center",gap:"8px"},onClick:()=>{L(null),A(null)},children:[(0,a.jsx)("span",{children:"⏹️"})," 停止自動抽取"]}),(0,a.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"10px 32px",minWidth:"120px",fontWeight:"bold"},onClick:()=>A(null),children:"確定"})]})]})})]})}},66997:()=>{}}]);