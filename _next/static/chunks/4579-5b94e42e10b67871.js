(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4579],{66997:()=>{},94579:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>T});var a=t(95155),i=t(12115);function r(e){let{player:l,combatPower:t,stageId:i,onAvatarClick:r,onAscension:s,potentialPoints:n}=e,{system:o,wallet:c}=l,d=o.currentXp/o.requiredXp*100;return(0,a.jsxs)("header",{className:"ca-header",children:[(0,a.jsxs)("div",{className:"ca-player-profile",children:[(0,a.jsxs)("div",{className:"ca-avatar-container ca-avatar-clickable",onClick:r,children:[(0,a.jsx)("div",{className:"ca-avatar-ring",children:(0,a.jsx)("img",{src:"/images/default-avatar.png",alt:"玩家頭像",className:"ca-avatar-img",onError:e=>{e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234f46e5"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">\uD83D\uDE0E</text></svg>'}})}),(0,a.jsx)("div",{className:"ca-level-badge",children:o.level})]}),(0,a.jsxs)("div",{className:"ca-profile-info",children:[(0,a.jsxs)("div",{className:"ca-profile-top",children:[(0,a.jsxs)("span",{className:"ca-level-text",children:["Lv.",o.level]}),(0,a.jsx)("span",{className:"ca-player-name",children:"冒險者"})]}),(0,a.jsxs)("div",{className:"ca-exp-container",children:[(0,a.jsx)("div",{className:"ca-exp-label",children:"EXP"}),(0,a.jsx)("div",{className:"ca-exp-bar",children:(0,a.jsx)("div",{className:"ca-exp-fill",style:{width:"".concat(Math.min(100,d),"%")}})}),(0,a.jsxs)("div",{className:"ca-exp-text",children:[o.currentXp.toLocaleString(),"/",o.requiredXp.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"ca-combat-power",style:{justifyContent:"space-between",width:"100%"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,a.jsx)("span",{className:"ca-cp-label",children:"戰力"}),(0,a.jsx)("span",{className:"ca-cp-value",children:t.toLocaleString()})]}),(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),s()},style:{display:"flex",alignItems:"center",gap:"4px",background:"linear-gradient(135deg, #a855f7 0%, #d946ef 100%)",color:"white",padding:"4px 10px",fontSize:"0.65rem",fontWeight:"bold",borderRadius:"6px",border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:"0 0 10px rgba(168, 85, 247, 0.3)",flexShrink:0},children:["⚡ 渡劫飛升 (+",n.toLocaleString(),")"]})]})]})]}),(0,a.jsx)("div",{className:"ca-header-right",children:(0,a.jsxs)("div",{className:"ca-currency-stack",children:[(0,a.jsxs)("div",{className:"ca-currency ca-currency-gold text-xs",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{children:Math.floor(c.gold).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency ca-currency-cp text-xs",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:Math.floor(c.clickPoints).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency text-xs",style:{color:"#10b981"},children:[(0,a.jsx)("span",{children:"\uD83C\uDD99"}),(0,a.jsx)("span",{children:Math.floor(c.levelPoints).toLocaleString()})]})]})})]})}function s(e){let{name:l,currentHp:t,maxHp:i,isBoss:r=!1}=e,s=Math.max(1,i),n=Math.min(Math.max(0,t),s);return(0,a.jsxs)("div",{className:"w-full max-w-[220px] space-y-1",children:[(0,a.jsx)("div",{className:"flex justify-between text-[11px] font-bold",children:(0,a.jsx)("span",{className:"text-slate-300 me-2",children:l})}),(0,a.jsx)("div",{className:"ca-hp-bar",children:(0,a.jsx)("div",{className:"ca-hp-bar-fill ".concat(r?"boss":"normal"),style:{width:"".concat(n/s*100,"%")}})}),(0,a.jsxs)("div",{className:"text-center text-[10px] text-slate-500 font-mono",children:[Math.ceil(n).toLocaleString()," /"," ",Math.ceil(s).toLocaleString()]})]})}function n(e){let{monster:l,stageId:t,onMonsterClick:r,baseDamage:n,criticalChance:o,criticalDamage:c,monstersKilled:d,monstersRequired:p,isBossActive:u,mercenaryLevel:m=0,partnerLevel:x=0,archerLevel:g=0,knightLevel:h=0,potionCount:f=0,activeBuffs:v,onUsePotion:D,lastAutoAttack:y,lastAutoClickEvent:b}=e,[j,S]=(0,i.useState)([]),[M,C]=(0,i.useState)(!1),[N,_]=(0,i.useState)(!1),[w,A]=(0,i.useState)(!1),[k,L]=(0,i.useState)(!1),[E,I]=(0,i.useState)(!1),[R,O]=(0,i.useState)(!1),T=(0,i.useRef)(null),P=(0,i.useRef)(null),B=(0,i.useRef)(null),G=(0,i.useRef)(null),z=(0,i.useRef)(null),q=(0,i.useRef)(0),U=(0,i.useRef)(""),W=(null==v?void 0:v.ragePotionExpiresAt)&&v.ragePotionExpiresAt>Date.now(),H=(e,l,t,a)=>{let i=crypto.randomUUID();S(r=>[...r,{id:i,text:e,x:l,y:t,type:a,createdAt:Date.now()}]),setTimeout(()=>{S(e=>e.filter(e=>e.id!==i))},1e3)};i.useEffect(()=>{var e;if(!b||b.id===U.current)return;U.current=b.id,_(!0),setTimeout(()=>_(!1),50);let l=null==(e=T.current)?void 0:e.getBoundingClientRect();if(l){let e=l.width/2+(60*Math.random()-30),t=l.height/2+(60*Math.random()-30),a=b.isCrit?"CRIT":"CLICK";H(b.damage.toLocaleString(),e,t,a)}},[b]),i.useEffect(()=>{var e;if(!y||y.time===q.current)return;q.current=y.time,_(!0),setTimeout(()=>_(!1),150);let l=null==(e=T.current)?void 0:e.getBoundingClientRect();if(y.breakdown&&l){let{mercenary:e,partner:t,archer:a,knight:i,player:r}=y.breakdown;if(e>0&&P.current){let t=P.current.getBoundingClientRect(),a=t.left-l.left+t.width/2,i=t.top-l.top;H("⚔️ ".concat(e.toLocaleString()),a,i-20,"AUTO"),A(!0),setTimeout(()=>A(!1),300)}if(t>0&&B.current){let e=B.current.getBoundingClientRect(),a=e.left-l.left+e.width/2,i=e.top-l.top;H("\uD83E\uDDDA ".concat(t.toLocaleString()),a,i-20,"AUTO"),L(!0),setTimeout(()=>L(!1),400)}if(a>0&&G.current){let e=G.current.getBoundingClientRect(),t=e.left-l.left+e.width/2,i=e.top-l.top;H("\uD83C\uDFF9 ".concat(a.toLocaleString()),t,i-20,"AUTO"),I(!0),setTimeout(()=>I(!1),300)}if(i>0&&z.current){let e=z.current.getBoundingClientRect(),t=e.left-l.left+e.width/2,a=e.top-l.top;H("\uD83D\uDEE1️ ".concat(i.toLocaleString()),t,a-20,"AUTO"),O(!0),setTimeout(()=>O(!1),300)}if(r>0){let e=l.width/2+(40*Math.random()-20),t=l.height/2+(40*Math.random()-20)-50;H(r.toLocaleString(),e,t,"AUTO")}}else if(l){let e=l.width/2+(40*Math.random()-20),t=l.height/2+(40*Math.random()-20)-50;H(y.damage.toLocaleString(),e,t,"AUTO"),m>0&&(A(!0),setTimeout(()=>A(!1),300))}},[y,m,x,g,h]);let K=e=>{var t,a,i,s,d;let p,u;if(!l||l.currentHp<=0)return;let m=n;W&&(m*=2);let x=Math.random()<o,g=Math.ceil(m*(x?c:1)),h=null==(t=T.current)?void 0:t.getBoundingClientRect();if(!h)return;"touches"in e?(p=null!=(s=null==(a=e.touches[0])?void 0:a.clientX)?s:h.left+h.width/2,u=null!=(d=null==(i=e.touches[0])?void 0:i.clientY)?d:h.top+h.height/2):(p=e.clientX,u=e.clientY);let f=p-h.left+(60*Math.random()-30),v=u-h.top+(60*Math.random()-30);H(g.toLocaleString(),f,v,x?"CRIT":"CLICK"),C(!0),_(!0),setTimeout(()=>C(!1),300),setTimeout(()=>_(!1),150),r(g,x)},F=e=>{switch(e){case"CRIT":return"ca-float-damage-crit";case"AUTO":return"ca-float-damage-auto";default:return"ca-float-damage"}};return(0,a.jsxs)("div",{ref:T,className:"ca-battle-area ".concat(M?"ca-shake":""),style:{background:W?"radial-gradient(circle, rgba(220, 38, 38, 0.2) 0%, rgba(15, 23, 42, 1) 80%)":""},onClick:K,onTouchStart:K,children:[(0,a.jsx)("div",{className:"ca-monster-container",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"ca-stage-display",children:["第 ",t," 關"]}),!u&&(0,a.jsxs)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)",marginTop:"4px",marginBottom:"16px",background:"rgba(0,0,0,0.3)",padding:"2px 8px",borderRadius:"12px"},children:[d," / ",p," \uD83D\uDC80"]}),u&&(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"4px",marginBottom:"16px",fontWeight:"bold",background:"rgba(239, 68, 68, 0.1)",padding:"2px 8px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:"⚠️ BOSS 挑戰中 ⚠️"}),(0,a.jsx)("div",{className:"ca-monster-sprite ".concat(l.isBoss?"boss":""," ").concat(N?"ca-hit-flash":""," ca-bounce-slow"),children:l.emoji||(l.isBoss?"\uD83D\uDC32":"\uD83D\uDC7E")}),(0,a.jsx)("div",{className:"mt-6 w-56",children:(0,a.jsx)(s,{name:l.name,currentHp:l.currentHp,maxHp:l.maxHp,isBoss:l.isBoss})})]}):(0,a.jsx)("div",{className:"text-slate-500 text-sm animate-pulse",children:"搜尋目標中..."})}),(0,a.jsx)("div",{ref:P,className:w?"ca-attack-lunge":"",style:{position:"absolute",bottom:"20px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:m>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"⚔️"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",m]})]})}),(0,a.jsx)("div",{ref:B,className:k?"ca-attack-magic":"",style:{position:"absolute",bottom:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:x>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83E\uDDDA"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:["Lv.",x]})]})}),f>0&&(0,a.jsxs)("div",{onClick:e=>{e.stopPropagation(),!W&&D&&D()},style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",cursor:W?"default":"pointer",opacity:W?.5:1,zIndex:20},children:[(0,a.jsx)("div",{style:{fontSize:"2rem",filter:W?"grayscale(1)":"drop-shadow(0 0 5px #ef4444)",transform:W?"scale(0.9)":"scale(1)"},children:"\uD83E\uDDEA"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fff",fontWeight:"bold",background:"#ef4444",borderRadius:"10px",padding:"2px 6px",marginTop:"-10px"},children:["x",f]})]}),(0,a.jsx)("div",{ref:G,className:E?"ca-attack-lunge":"",style:{position:"absolute",top:"80px",left:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:g>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83C\uDFF9"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#a5b4fc"},children:["Lv.",g]})]})}),(0,a.jsx)("div",{ref:z,className:R?"ca-attack-lunge":"",style:{position:"absolute",top:"140px",right:"20px",display:"flex",flexDirection:"column",gap:"4px",alignItems:"center",zIndex:5},children:h>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{fontSize:"2rem"},children:"\uD83D\uDEE1️"}),(0,a.jsxs)("div",{style:{fontSize:"0.7rem",color:"#fca5a5"},children:["Lv.",h]})]})}),(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none overflow-visible",children:j.map(e=>(0,a.jsx)("div",{className:F(e.type),style:{left:e.x,top:e.y},children:e.text},e.id))})]})}function o(e){let{activeView:l,onSwitchView:t,onOpenModal:i}=e;return(0,a.jsx)("footer",{className:"ca-footer",children:(0,a.jsxs)("nav",{className:"ca-footer-nav",children:[(0,a.jsxs)("button",{className:"ca-tab-btn ".concat("CHARACTER"===l?"active":""),onClick:()=>{t("CHARACTER"),i(null)},children:[(0,a.jsx)("span",{className:"icon",children:"\uD83D\uDC64"}),(0,a.jsx)("span",{className:"label",children:"角色"})]}),(0,a.jsxs)("button",{className:"ca-tab-btn ".concat("BATTLE"===l?"active":""),onClick:()=>{t("BATTLE"),i(null)},children:[(0,a.jsx)("span",{className:"icon",children:"⚔️"}),(0,a.jsx)("span",{className:"label",children:"戰鬥"})]}),(0,a.jsxs)("button",{className:"ca-tab-btn",onClick:()=>i("SHOP"),children:[(0,a.jsx)("span",{className:"icon",children:"\uD83D\uDED2"}),(0,a.jsx)("span",{className:"label",children:"商店"})]})]})})}function c(e){let{isOpen:l,onClose:t,title:i,headerContent:r,children:s}=e;return l?(0,a.jsx)("div",{className:"ca-modal-overlay",onClick:t,children:(0,a.jsxs)("div",{className:"ca-modal-container",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"ca-modal-header",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",flex:1},children:[(0,a.jsx)("h2",{className:"ca-modal-title",children:i}),r]}),(0,a.jsx)("button",{className:"ca-modal-close",onClick:t,children:"✕"})]}),(0,a.jsx)("div",{className:"ca-modal-content",children:s})]})}):null}t(66997);let d=e=>e<=50?{name:"練氣期",color:"#a7f3d0"}:e<=150?{name:"築基期",color:"#6ee7b7"}:e<=300?{name:"金丹期",color:"#fbbf24"}:e<=500?{name:"元嬰期",color:"#f472b6"}:e<=800?{name:"化神期",color:"#818cf8"}:{name:"渡劫飛昇",color:"#c084fc"};function p(e){let{player:l,onPurchase:t,onResetLevelPoints:r,gameConfig:s}=e,[n,o]=(0,i.useState)("DAILY"),[c,p]=(0,i.useState)("UPGRADE"),[g,h]=(0,i.useState)(!1),f=i.useMemo(()=>(null==s?void 0:s.upgrades)?s.upgrades.filter(e=>"CLICK"===e.Shop_Type).map(e=>e.ID).reduce((e,t)=>e+(l.clickShop[t]||0),0):0,[l.clickShop,s]),v=d(f);console.log("[ShopPage] Rendering. ActiveTab:",n,"isProbModalOpen:",g);let D=e=>"gold_shop_weapon"===e?l.goldShop.weaponLevel||0:"gold_shop_mercenary"===e?l.goldShop.mercenaryLevel||0:"gold_shop_partner"===e?l.goldShop.partnerLevel||0:"gold_shop_archer"===e?l.goldShop.archerLevel||0:"gold_shop_knight"===e?l.goldShop.knightLevel||0:"gold_shop_amulet"===e?l.goldShop.amuletLevel||0:"gold_potion_rage"===e?l.inventory.ragePotionCount||0:e.startsWith("level_shop_")?l.levelShop[e]||0:e.startsWith("click_shop_")?l.clickShop[e]||0:(e.startsWith("ascension_shop_")||e.startsWith("asc_"))&&l.ascensionShop[e]||0,y=(e,l,t,a)=>"ADD_INVENTORY"===a?e:1===l||1===l?Math.floor(e+t):Math.floor(e*Math.pow(l,t)),b=e=>"GOLD"===e?"\uD83D\uDCB0":"LP"===e?"\uD83C\uDD99":"CP"===e?"⚡":"DIAMOND"===e?"\uD83D\uDC8E":"AP"===e?"⚡":e,j=e=>"GOLD"===e?l.wallet.gold:"LP"===e?l.wallet.levelPoints:"CP"===e?l.wallet.clickPoints:"DIAMOND"===e?l.wallet.diamonds:"AP"===e?l.wallet.ascensionPoints:0,S=e=>0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"gray"},children:"無項目"}):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:e.map(e=>{let l=D(e.ID),i=y(e.Cost_Base,e.Cost_Mult,l,e.Effect_Type),r=b(e.Currency),s=j(e.Currency),n=e.Desc_Template||e.Name;return n.includes("{val}")&&(n=n.replace("{val}",String(e.Effect_Val))),(0,a.jsx)(m,{name:e.Name,desc:"".concat(n," [Lv.").concat(l,"]"),level:l,cost:i,currencyLabel:r,canAfford:s>=i,onClick:()=>t(e.ID)},e.ID)})}),M=e=>s&&s.upgrades?S(s.upgrades.filter(l=>l.Shop_Type===e)):null,C=(()=>{if(!l.lastDailyRewardClaimTime)return!0;let e=new Date(l.lastDailyRewardClaimTime),t=new Date;return e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()||e.getFullYear()!==t.getFullYear()})();return(0,a.jsxs)("div",{className:"ca-shop-container",children:[(0,a.jsxs)("div",{className:"ca-shop-tabs",children:[(0,a.jsxs)("button",{onClick:()=>o("DAILY"),className:"ca-shop-tab-btn daily ".concat("DAILY"===n?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDCC5"}),(0,a.jsx)("div",{className:"label",children:"每日商店"}),C&&(0,a.jsx)("div",{style:{position:"absolute",top:"8px",right:"8px",width:"6px",height:"6px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 5px #ef4444"}})]}),(0,a.jsxs)("button",{onClick:()=>o("GOLD"),className:"ca-shop-tab-btn gold ".concat("GOLD"===n?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDCB0"}),(0,a.jsx)("div",{className:"label",children:"金幣商店"})]}),(0,a.jsxs)("button",{onClick:()=>o("LEVEL"),className:"ca-shop-tab-btn level ".concat("LEVEL"===n?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83C\uDD99"}),(0,a.jsx)("div",{className:"label",children:"等級商店"})]}),(0,a.jsxs)("button",{onClick:()=>o("CLICK"),className:"ca-shop-tab-btn click ".concat("CLICK"===n?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"⚡"}),(0,a.jsx)("div",{className:"label",children:"點擊商店"})]}),(0,a.jsxs)("button",{onClick:()=>o("ASCENSION"),className:"ca-shop-tab-btn ascension ".concat("ASCENSION"===n?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"\uD83D\uDD4A️"}),(0,a.jsx)("div",{className:"label",children:"飛昇商店"})]}),(0,a.jsxs)("button",{onClick:()=>o("EQUIPMENT"),className:"ca-shop-tab-btn equipment ".concat("EQUIPMENT"===n?"active":""),children:[(0,a.jsx)("div",{className:"icon",children:"⚔️"}),(0,a.jsx)("div",{className:"label",children:"裝備扭蛋"})]})]}),(0,a.jsxs)("div",{className:"ca-shop-content",children:["DAILY"===n&&(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"100%"},children:(0,a.jsxs)("div",{style:{background:"var(--ca-bg-card)",borderRadius:"var(--ca-radius-lg)",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 0 20px rgba(0,0,0,0.2)"},children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"每日簽到"}),(0,a.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--ca-text-muted)",textAlign:"center"},children:"每天登入領取免費獎勵！"}),(0,a.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",padding:"16px",background:"rgba(255,255,255,0.05)",borderRadius:"12px",width:"100%"},children:[(0,a.jsx)("div",{style:{fontSize:"3rem",filter:C?"drop-shadow(0 0 10px rgba(253, 224, 71, 0.5))":"grayscale(1)"},children:"\uD83C\uDF81"}),(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.2rem",color:"#fde047"},children:"10 \uD83D\uDC8E + 500 \uD83D\uDCB0"})]}),(0,a.jsx)("button",{className:"ca-btn ".concat(C?"ca-btn-primary":""),style:{marginTop:"16px",width:"100%",padding:"12px",opacity:C?1:.5,cursor:C?"pointer":"not-allowed",background:C?"":"#334155",color:C?"":"#64748b"},disabled:!C,onClick:()=>t("daily_checkin"),children:C?"領取獎勵":"明日再來"})]})}),"GOLD"===n&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #fbbf24 0%, #d97706 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"金幣 (Gold)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:Math.floor(l.wallet.gold).toLocaleString()}),(0,a.jsx)("div",{className:"ca-realm-level",style:{color:"#fde68a"},children:"擊殺怪物獲得"})]}),(0,a.jsxs)("div",{className:"ca-shop-subtabs",style:{display:"flex",gap:"10px",marginBottom:"8px"},children:[(0,a.jsx)("button",{className:"ca-btn ".concat("UPGRADE"===c?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"UPGRADE"===c?"":"rgba(255,255,255,0.1)"},onClick:()=>p("UPGRADE"),children:"\uD83D\uDEE0️ 金幣強化"}),(0,a.jsx)("button",{className:"ca-btn ".concat("RECRUIT"===c?"ca-btn-primary":""),style:{flex:1,padding:"8px",fontSize:"0.9rem",background:"RECRUIT"===c?"":"rgba(255,255,255,0.1)"},onClick:()=>p("RECRUIT"),children:"\uD83D\uDEA9 招兵買馬"})]}),(null==s?void 0:s.upgrades)?S(s.upgrades.filter(e=>"GOLD"===e.Shop_Type).filter(e=>"RECRUIT"===c?"ADD_AUTO_DMG"===e.Effect_Type:"ADD_AUTO_DMG"!==e.Effect_Type)):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:(0,a.jsx)("div",{style:{color:"gray",textAlign:"center"},children:"Loading Config..."})}),(0,a.jsx)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.1)",margin:"10px 0"}}),(0,a.jsx)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:"使用 \uD83D\uDC8E 購買金幣補給"}),(0,a.jsxs)("div",{className:"ca-shop-item-grid",children:[(0,a.jsx)(u,{name:"金幣小包",desc:"獲得 1,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 10",canAfford:l.wallet.diamonds>=10,onClick:()=>t("gold_pack_1")}),(0,a.jsx)(u,{name:"金幣大包",desc:"獲得 10,000 金幣",icon:"\uD83D\uDCB0",cost:"\uD83D\uDC8E 80",canAfford:l.wallet.diamonds>=80,onClick:()=>t("gold_pack_2")})]})]}),"LEVEL"===n&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"等級積分 (LP)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.5rem"},children:l.wallet.levelPoints}),(0,a.jsx)("div",{className:"ca-realm-level",style:{color:"#d1fae5"},children:"升級可獲得點數"}),r&&(0,a.jsx)("button",{onClick:r,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"\uD83D\uDD04 重製點數"})]}),(0,a.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗 ",(0,a.jsx)("span",{style:{color:"#10b981"},children:"\uD83C\uDD99 等級積分"})," ","學習永久天賦"]}),(null==s?void 0:s.upgrades)?M("LEVEL"):(0,a.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"CLICK"===n&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"當前境界"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:v.color},children:v.name}),(0,a.jsxs)("div",{className:"ca-realm-level",children:["修練總層數 ",f]})]}),(0,a.jsxs)("p",{className:"ca-text-muted",style:{fontSize:"0.8rem",paddingLeft:"4px"},children:["消耗"," ",(0,a.jsx)("span",{style:{color:"var(--ca-accent-cyan)"},children:"⚡ 點擊點數"})," ","提升修煉屬性"]}),(null==s?void 0:s.upgrades)?M("CLICK"):(0,a.jsx)("div",{style:{textAlign:"center"},children:"Loading..."})]}),"ASCENSION"===n&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c084fc 100%)"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"飛昇商店 (Permanent)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff"},children:"永恆加成"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.7)",marginTop:"4px"},children:"飛昇後不會重置的永久強化"})]}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:M("ASCENSION")})]}),"EQUIPMENT"===n&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px",alignItems:"center"},children:[(0,a.jsxs)("div",{className:"ca-realm-card",style:{background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",position:"relative"},children:[(0,a.jsx)("div",{className:"ca-realm-title",children:"裝備扭蛋 (Gacha)"}),(0,a.jsx)("div",{className:"ca-realm-name",style:{color:"#fff",fontSize:"1.2rem"},children:"試試你的手氣！"}),(0,a.jsx)("button",{onClick:()=>{console.log("[ShopPage] Click Probability Button"),h(!0)},style:{position:"absolute",top:"12px",right:"12px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontSize:"0.7rem",padding:"4px 8px",borderRadius:"12px",cursor:"pointer"},children:"裝備機率一覽"})]}),(0,a.jsx)("div",{className:"ca-shop-item-grid",style:{width:"100%"},children:(0,a.jsxs)("div",{className:"ca-glass-static",style:{gridColumn:"1 / -1",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"4rem",animation:"bounce 2s infinite"},children:"\uD83C\uDF81"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#fff"},children:"基礎裝備箱"}),(0,a.jsx)("div",{style:{fontSize:"0.8rem",color:"var(--ca-text-muted)"},children:"隨機獲得一件裝備 (全屬性)"})]}),(0,a.jsxs)("button",{className:"ca-btn ca-btn-primary",style:{padding:"12px 32px",fontSize:"1.1rem",display:"flex",alignItems:"center",gap:"8px"},onClick:()=>t("gacha_equipment_basic"),children:[(0,a.jsx)("span",{children:"抽取一次"}),(0,a.jsx)("span",{style:{background:"rgba(0,0,0,0.2)",padding:"2px 8px",borderRadius:"12px",fontSize:"0.9rem"},children:"\uD83D\uDCB0 1,000"})]})]})})]})]}),g&&(0,a.jsx)(x,{gameConfig:s,onClose:()=>h(!1)})]})}function u(e){let{name:l,desc:t,icon:i,cost:r,canAfford:s,onClick:n}=e;return(0,a.jsxs)("div",{className:"ca-glass-static ca-shop-item-card",style:{padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>s&&n(),children:[(0,a.jsx)("div",{style:{fontSize:"2rem",marginBottom:"4px"},children:i}),(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.85rem",color:"#fff"},children:l}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginBottom:"8px"},children:t}),(0,a.jsx)("div",{className:"ca-btn ".concat(s?"ca-btn-primary":""),style:{fontSize:"0.75rem",padding:"6px",width:"100%",background:s?"":"#334155",color:s?"":"#64748b",cursor:s?"pointer":"not-allowed"},children:r})]})}function m(e){let{name:l,desc:t,level:i,cost:r,canAfford:s,onClick:n,currencyLabel:o="⚡"}=e;return(0,a.jsxs)("div",{className:"ca-upgrade-row",children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#fff"},children:l}),(0,a.jsxs)("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",color:"var(--ca-accent-cyan)"},children:["Lv.",i]})]}),(0,a.jsx)("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:t})]}),(0,a.jsxs)("button",{onClick:()=>s&&n(),disabled:!s,className:"ca-upgrade-btn",children:[(0,a.jsx)("span",{style:{fontSize:"0.7rem",fontWeight:"bold"},children:"升級"}),(0,a.jsxs)("span",{style:{fontSize:"0.7rem"},children:[o," ",r.toLocaleString()]})]})]})}function x(e){let{gameConfig:l,onClose:t}=e,[r,s]=i.useState(null),n=l&&l.equipments&&l.equipments.length>0,o=n?l.equipments:[],c=o.reduce((e,l)=>e+(Number(l.Gacha_Weight)||0),0),d={};c>0&&o.forEach(e=>{let l=Number(e.Gacha_Weight)||0;d[l]||(d[l]=[]),d[l].push(e)});let p=e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}};return(0,a.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:[(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"500px",maxHeight:"85vh",display:"flex",flexDirection:"column",background:"#1e293b",border:"1px solid #334155",borderRadius:"16px",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{padding:"16px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"white"},children:"裝備機率一覽"}),(0,a.jsx)("button",{onClick:t,style:{background:"none",border:"none",color:"gray",fontSize:"1.5rem",cursor:"pointer"},children:"\xd7"})]}),(0,a.jsx)("div",{style:{padding:"16px",overflowY:"auto",flex:1},children:n?Object.entries(d).sort((e,l)=>Number(l[0])-Number(e[0])).map(e=>{let[l,t]=e,i=(Number(l)/c*100).toFixed(2);return(0,a.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,a.jsxs)("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 12px",borderRadius:"8px",marginBottom:"12px",fontSize:"0.9rem",color:"#93c5fd",fontWeight:"bold"},children:["機率: ",i,"% (權重: ",l,", 共 ",t.length," 種)"]}),(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(64px, 1fr))",gap:"12px"},children:t.map(e=>{var l;let t=p(e.Rarity);return(0,a.jsxs)("div",{onClick:()=>s(e),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",cursor:"pointer",transition:"transform 0.1s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[(0,a.jsx)("div",{style:{width:"56px",height:"56px",background:"rgba(0,0,0,0.3)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.8rem",border:"1px solid ".concat(t,"44"),boxShadow:"inset 0 0 10px ".concat(t,"22")},children:h(e.Slot)}),(0,a.jsx)("div",{style:{fontSize:"0.65rem",color:t,textAlign:"center",lineHeight:"1.2",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",fontWeight:(null==(l=e.Rarity)?void 0:l.toLowerCase())==="common"?"normal":"bold"},children:e.Name})]},e.ID)})})]},l)}):(0,a.jsxs)("div",{style:{textAlign:"center",color:"var(--ca-text-muted)",padding:"20px"},children:["暫無裝備資料",(0,a.jsx)("br",{}),(0,a.jsx)("span",{style:{fontSize:"0.8rem"},children:"請檢查 Google Sheet 設定或重新載入"})]})})]}),r&&(0,a.jsx)(g,{item:r,onClose:()=>s(null)})]})}function g(e){let{item:l,onClose:t}=e,i=(e=>{switch(null==e?void 0:e.toLowerCase()){case"common":return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b";default:return"#fff"}})(l.Rarity);return(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",zIndex:10001,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},onClick:t,children:(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(i,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(i,"22")},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(i,"44")},children:h(l.Slot)}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:i},children:l.Name}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:i,fontWeight:"bold"},children:l.Rarity}),(0,a.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:l.Slot})]})]}),(0,a.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,a.jsx)("div",{style:{color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:"裝備初始屬性:"}),(0,a.jsx)("div",{children:function(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=(l.Base_Val||0)+(t-1)*(l.Level_Mult||0);return e.replace("{val}",a.toLocaleString())}(l.Desc_Template,l,1)})]}),(0,a.jsx)("button",{className:"ca-btn",onClick:t,style:{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"#fff"},children:"返回"})]})})}function h(e){switch(e){case"MAIN_HAND":return"⚔️";case"HEAD":return"\uD83E\uDE96";case"BODY":return"\uD83D\uDC55";case"HANDS":return"\uD83E\uDDE4";case"LEGS":return"\uD83D\uDC62";case"RELIC":return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function f(e){var l,t,r;let{player:s,effectiveStats:n,combatPower:o,userId:c,onLogin:d,onLogout:p,onManualSave:u,gameConfig:m}=e,{system:x,wallet:g,records:h}=s,[f,b]=i.useState(""),[j,S]=i.useState(!1),M=async()=>{if(!j){S(!0);try{await u()}finally{S(!1)}}},C=e=>Math.floor(e||0).toLocaleString(),N=e=>"".concat((100*e).toFixed(1),"%"),_=e=>{let l=Math.floor(e/3600),t=Math.floor(e%3600/60),a=e%60;return l>0?"".concat(l,"h ").concat(t,"m ").concat(a,"s"):t>0?"".concat(t,"m ").concat(a,"s"):"".concat(a,"s")},w=(null==(l=s.activeBuffs)?void 0:l.ragePotionExpiresAt)>Date.now(),A=Math.max(0,Math.floor(((null==(t=s.activeBuffs)?void 0:t.ragePotionExpiresAt)-Date.now())/1e3));return(0,a.jsxs)("div",{className:"ca-profile-page",style:{paddingBottom:"20px"},children:[(0,a.jsx)("div",{className:"ca-profile-section",children:(0,a.jsxs)("div",{className:"ca-profile-header-card ca-glass-static",children:[(0,a.jsxs)("div",{className:"ca-profile-avatar-large",children:[(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(c||"Guest"),alt:"Avatar",className:"ca-profile-avatar-img"}),(0,a.jsxs)("div",{className:"ca-profile-level-badge",children:["Lv.",x.level]})]}),(0,a.jsx)("div",{className:"ca-profile-summary",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"ca-profile-name",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{children:["勇者 ",c]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,a.jsx)("button",{onClick:M,className:"ca-profile-action-btn",style:{background:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",cursor:j?"wait":"pointer",opacity:j?.7:1},children:j?"上傳中":"上傳"}),(0,a.jsx)("button",{onClick:p,className:"ca-profile-action-btn",style:{background:"rgba(239, 68, 68, 0.2)",color:"#fca5a5"},children:"登出"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-cp",children:[(0,a.jsx)("span",{className:"label",children:"戰鬥力"}),(0,a.jsx)("span",{className:"value",children:C(o)})]}),(0,a.jsxs)("div",{className:"ca-profile-exp",children:[(0,a.jsxs)("div",{className:"info",children:[(0,a.jsx)("span",{children:"EXP"}),(0,a.jsxs)("span",{children:[C(x.currentXp)," /"," ",C(x.requiredXp)]})]}),(0,a.jsx)("div",{className:"bar-bg",children:(0,a.jsx)("div",{className:"bar-fill",style:{width:"".concat(Math.min(100,x.currentXp/x.requiredXp*100),"%")}})})]})]}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",width:"100%",minWidth:0},children:[(0,a.jsx)("div",{style:{fontSize:"0.85rem",color:"var(--ca-text-secondary)",fontWeight:"600"},children:"輸入 ID 以讀取/建立存檔"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"6px",width:"100%"},children:[(0,a.jsx)("input",{type:"text",className:"ca-input",style:{flex:1,minWidth:0,background:"rgba(0,0,0,0.4)",border:"1px solid rgba(255,255,255,0.15)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"0.9rem",outline:"none"},placeholder:"User ID...",value:f,onChange:e=>b(e.target.value)}),(0,a.jsx)("button",{className:"ca-btn ca-btn-primary",style:{padding:"0 16px",fontSize:"0.85rem",height:"auto",whiteSpace:"nowrap",flexShrink:0,borderRadius:"8px"},onClick:()=>f.trim()&&d(f.trim()),children:"讀取"})]})]})})]})}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"財富狀態"}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",background:"rgba(15, 23, 42, 0.4)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.05)"},children:[(0,a.jsx)(v,{icon:"\uD83D\uDCB0",label:"金幣",value:C(g.gold),color:"#fbbf24"}),(0,a.jsx)(v,{icon:"\uD83D\uDC8E",label:"鑽石",value:C(g.diamonds),color:"#38bdf8"}),(0,a.jsx)(v,{icon:"✨",label:"點擊點數",value:C(g.clickPoints),color:"#c084fc"}),(0,a.jsx)(v,{icon:"⚡",label:"飛昇點數",value:C(g.ascensionPoints),color:"#f472b6"}),(0,a.jsx)(v,{icon:"\uD83D\uDCDC",label:"等級積分",value:C(g.levelPoints),color:"#60a5fa"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"最終戰鬥屬性 (含裝備加成)"}),(0,a.jsxs)("div",{className:"ca-stats-grid",children:[(0,a.jsx)(D,{label:"點擊基礎傷害",value:C(n.baseDamage),icon:"⚔️"}),(0,a.jsx)(D,{label:"夥伴秒傷 (Ally DPS)",value:C(n.autoAttackDamage),icon:"\uD83E\uDD16"}),(0,a.jsx)(D,{label:"爆擊機率",value:N(n.criticalChance),icon:"\uD83C\uDFAF"}),(0,a.jsx)(D,{label:"爆擊傷害",value:N(n.criticalDamage),icon:"\uD83D\uDCA5"}),(0,a.jsx)(D,{label:"金幣獲取倍率",value:"".concat(n.goldMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCB0"}),(0,a.jsx)(D,{label:"經驗獲取倍率",value:"".concat(n.xpMultiplier.toFixed(2),"x"),icon:"\uD83D\uDCD6"}),(0,a.jsx)(D,{label:"BOSS 傷害加成",value:"".concat(n.bossDamageMultiplier.toFixed(2),"x"),icon:"\uD83D\uDC79"}),(0,a.jsx)(D,{label:"點擊點數倍率",value:"".concat(n.cpMultiplier.toFixed(2),"x"),icon:"✨"}),(0,a.jsx)(D,{label:"自動點擊 (每秒)",value:"".concat(n.autoClickPerSec.toFixed(1)," 次"),icon:"⚡"}),(0,a.jsx)(D,{label:"關卡目標減少",value:"-".concat(C(n.monsterKillReduction)," 隻"),icon:"\uD83D\uDCC9"}),(0,a.jsx)(D,{label:"稀有怪出現機率",value:N(n.rareMonsterChance),icon:"\uD83C\uDF1F"})]})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"當前狀態 / 藥水"}),(0,a.jsx)("div",{className:"ca-glass-static",style:{padding:"12px",borderRadius:"12px",border:"1px solid rgba(239, 68, 68, 0.2)"},children:w?(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"#f87171"},children:[(0,a.jsx)("span",{style:{fontSize:"1.4rem"},children:"\uD83E\uDDEA"}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{fontWeight:"bold",fontSize:"0.95rem"},children:"狂暴藥水 (Rage Potion)"}),(0,a.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:["剩餘時間:"," ",(0,a.jsx)("span",{style:{fontFamily:"monospace"},children:_(A)})]})]}),(0,a.jsx)("div",{className:"ca-pulse",style:{width:"10px",height:"10px",borderRadius:"50%",background:"#ef4444",boxShadow:"0 0 10px #ef4444"}})]}):(0,a.jsx)("div",{style:{color:"var(--ca-text-muted)",fontSize:"0.85rem",textAlign:"center",padding:"10px"},children:"尚無啟用的增益效果"})})]}),(0,a.jsxs)("div",{className:"ca-profile-section",children:[(0,a.jsx)("h3",{className:"ca-section-title",children:"生涯冒險記錄"}),(0,a.jsxs)("div",{className:"ca-records-list ca-glass-static",style:{borderRadius:"12px"},children:[(0,a.jsx)(y,{label:"\uD83C\uDFAE 遊戲總點擊",value:C(h.totalClicks)}),(0,a.jsx)(y,{label:"⚔️ 累計總傷害",value:C(h.totalDamageDealt)}),(0,a.jsx)(y,{label:"\uD83D\uDC7E 擊敗怪物數",value:C(h.monstersKilled)}),(0,a.jsx)(y,{label:"\uD83D\uDE08 擊敗 BOSS 數",value:C(h.bossesKilled)}),(0,a.jsx)(y,{label:"\uD83D\uDCCD 歷史最高關卡",value:"第 ".concat(C(h.maxStageReached)," 關")}),(0,a.jsx)(y,{label:"\uD83D\uDC8E 累計儲蓄/金幣",value:C(h.totalGoldEarned)}),(0,a.jsx)(y,{label:"⏳ 生涯遊玩時間",value:_(h.playtimeSeconds)})]})]}),(0,a.jsxs)("div",{style:{marginTop:"24px",padding:"12px",textAlign:"center",color:"var(--ca-text-muted)",fontSize:"0.7rem",opacity:.6},children:[(0,a.jsxs)("div",{children:["遊戲版本: ",String((null==m||null==(r=m.settings)?void 0:r.GAME_VERSION)||"1.0.0")]}),(0,a.jsx)("div",{style:{marginTop:"4px"},children:"Click Ascension Project \xa9 2026"})]})]})}function v(e){let{icon:l,label:t,value:i,color:r}=e;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("span",{style:{fontSize:"1rem"},children:l}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,a.jsx)("span",{style:{fontSize:"0.6rem",color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:t}),(0,a.jsx)("span",{style:{fontSize:"0.85rem",color:r,fontWeight:"bold"},children:i})]})]})}function D(e){let{label:l,value:t,icon:i}=e;return(0,a.jsxs)("div",{className:"ca-stat-item ca-glass-static",children:[(0,a.jsx)("div",{className:"ca-stat-icon",children:i}),(0,a.jsxs)("div",{className:"ca-stat-content",children:[(0,a.jsx)("div",{className:"ca-stat-label",children:l}),(0,a.jsx)("div",{className:"ca-stat-value",children:t})]})]})}function y(e){let{label:l,value:t}=e;return(0,a.jsxs)("div",{className:"ca-record-row",children:[(0,a.jsx)("span",{className:"ca-record-label",children:l}),(0,a.jsx)("span",{className:"ca-record-value",children:t})]})}var b=function(e){return e.MAIN_HAND="MAIN_HAND",e.HEAD="HEAD",e.BODY="BODY",e.HANDS="HANDS",e.LEGS="LEGS",e.RELIC="RELIC",e}({});function j(e){switch(null==e?void 0:e.toLowerCase()){case"common":default:return"#94a3b8";case"uncommon":return"#22c55e";case"rare":return"#3b82f6";case"epic":return"#a855f7";case"legendary":return"#ef4444";case"mythic":return"#f59e0b"}}function S(e){let{item:l,onClose:t,onEquip:i,onUnequip:r,isEquipped:s}=e,{config:n,level:o}=l,c=j(n.Rarity);return(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,a.jsxs)("div",{className:"ca-card",style:{width:"100%",maxWidth:"320px",background:"#1e293b",border:"1px solid ".concat(c,"66"),borderRadius:"16px",padding:"24px",display:"flex",flexDirection:"column",gap:"16px",boxShadow:"0 0 30px ".concat(c,"22")},children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(0,0,0,0.3)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",border:"1px solid ".concat(c,"44")},children:C(n.Slot)}),(0,a.jsx)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:c},children:n.Name}),(0,a.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:c,fontWeight:"bold"},children:n.Rarity}),(0,a.jsx)("span",{style:{color:"rgba(255,255,255,0.2)"},children:"|"}),(0,a.jsx)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:n.Slot})]})]}),(0,a.jsxs)("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"8px",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"#94a3b8",marginBottom:"4px",fontSize:"0.8rem"},children:[(0,a.jsxs)("span",{children:["當前屬性 (Lv.",o,"/",n.Max_Level||"??","):"]}),o>=(n.Max_Level||99)&&(0,a.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold"},children:"MAX"})]}),(0,a.jsx)("div",{children:function(e,l,t){let a=(l.Base_Val||0)+(t-1)*(l.Level_Mult||0);return e.replace("{val}",a.toLocaleString())}(n.Desc_Template,n,o)})]}),(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"8px"},children:[s?(0,a.jsx)("button",{className:"ca-btn",onClick:()=>{r(n.Slot),t()},style:{flex:1,background:"#ef4444",color:"white",fontWeight:"bold"},children:"卸下"}):(0,a.jsx)("button",{className:"ca-btn",onClick:()=>{i(l.id,n.Slot),t()},style:{flex:1,background:"var(--ca-accent-gold)",color:"black",fontWeight:"bold"},children:"裝備"}),(0,a.jsx)("button",{className:"ca-btn",onClick:t,style:{flex:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"關閉"})]})]})})}function M(e){var l;let{player:t,effectiveStats:r,totalDps:s,userId:n,gameConfig:o,onEquip:c,onUnequip:d}=e,[p,u]=i.useState(null),m=Object.entries((null==(l=t.equipment)?void 0:l.inventory)||{}).filter(e=>{let[,l]=e;return l>0}).map(e=>{var l;let[t,a]=e;return{id:t,level:a,config:null==o||null==(l=o.equipments)?void 0:l.find(e=>String(e.ID)===String(t))}}).filter(e=>!!e.config);return(0,a.jsxs)("div",{className:"ca-character-view",style:{flex:1,display:"flex",flexDirection:"column",width:"100%",height:"100%",padding:"12px",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"relative",paddingBottom:"12px"},children:[(0,a.jsxs)("div",{style:{width:"100%",maxWidth:"500px",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"8px",zIndex:10,padding:"0 4px"},children:[(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"⚔️"}),(0,a.jsx)("span",{className:"ca-stat-value",children:Math.floor(r.baseDamage).toLocaleString()}),r.baseDamage>t.stats.baseDamage&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(r.baseDamage-t.stats.baseDamage).toLocaleString(),")"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83C\uDFAF"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*r.criticalChance).toFixed(1),"%"]}),r.criticalChance>t.stats.criticalChance&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((r.criticalChance-t.stats.criticalChance)*100).toFixed(1),"%)"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83E\uDD16"}),(0,a.jsx)("span",{className:"ca-stat-value",children:Math.floor(s).toLocaleString()}),r.autoAttackDamage>t.stats.autoAttackDamage&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",(r.autoAttackDamage-t.stats.autoAttackDamage).toLocaleString(),")"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCA5"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*r.criticalDamage).toFixed(0),"%"]}),r.criticalDamage>t.stats.criticalDamage&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((r.criticalDamage-t.stats.criticalDamage)*100).toFixed(0),"%)"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDCB0"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*r.goldMultiplier).toFixed(0),"%"]}),r.goldMultiplier>t.stats.goldMultiplier&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((r.goldMultiplier-t.stats.goldMultiplier)*100).toFixed(0),"%)"]})]}),(0,a.jsxs)("div",{className:"ca-stat-pill",children:[(0,a.jsx)("span",{className:"ca-stat-icon",children:"\uD83D\uDC79"}),(0,a.jsxs)("span",{className:"ca-stat-value",children:[(100*r.bossDamageMultiplier).toFixed(0),"%"]}),r.bossDamageMultiplier>t.stats.bossDamageMultiplier&&(0,a.jsxs)("span",{className:"ca-stat-bonus",children:["(+",((r.bossDamageMultiplier-t.stats.bossDamageMultiplier)*100).toFixed(0),"%)"]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",width:"100%",maxWidth:"500px",justifyContent:"space-between",alignItems:"center",zIndex:2,padding:"0 4px"},children:[(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,a.jsx)(N,{slot:b.MAIN_HAND,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(N,{slot:b.HEAD,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(N,{slot:b.BODY,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}})]}),(0,a.jsxs)("div",{className:"ca-character-figure ca-bounce-slow",style:{position:"relative",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)("img",{src:"https://api.dicebear.com/7.x/adventurer/svg?seed=".concat(n||"Guest"),alt:"Character",style:{width:"110px",height:"110px",filter:"drop-shadow(0 10px 20px rgba(0,0,0,0.5))"}}),(0,a.jsxs)("div",{className:"ca-glass",style:{marginTop:"4px",padding:"2px 10px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"8px",background:"rgba(15, 23, 42, 0.6)"},children:[(0,a.jsxs)("span",{style:{fontSize:"0.9rem"},children:["Lv.",t.system.level]}),(0,a.jsx)("span",{style:{width:"1px",height:"10px",background:"rgba(255,255,255,0.2)"}}),(0,a.jsx)("span",{style:{color:"var(--ca-accent-gold)",fontWeight:"bold",fontSize:"0.8rem"},children:n||"Guest"})]})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,a.jsx)(N,{slot:b.HANDS,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(N,{slot:b.LEGS,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}}),(0,a.jsx)(N,{slot:b.RELIC,player:t,gameConfig:o,onClick:e=>{var l;let a=null==o||null==(l=o.equipments)?void 0:l.find(l=>String(l.ID)===String(e));a&&u({id:e,level:t.equipment.inventory[e],config:a})}})]})]}),(0,a.jsx)("div",{style:{position:"absolute",top:"55%",left:"50%",transform:"translate(-50%, -50%)",width:"220px",height:"220px",background:"radial-gradient(circle, rgba(99,102,241,0.1) 0%, transparent 70%)",pointerEvents:"none",zIndex:0}})]}),(0,a.jsxs)("div",{style:{flex:"1 1 0px",width:"100%",background:"rgba(15, 23, 42, 0.4)",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden",minHeight:"0"},children:[(0,a.jsxs)("div",{style:{padding:"8px 12px",background:"rgba(0,0,0,0.2)",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[(0,a.jsxs)("span",{style:{fontWeight:"bold",color:"#e2e8f0",fontSize:"0.9rem"},children:["\uD83C\uDF92 裝備倉庫 (",m.length,")"]}),(0,a.jsx)("span",{style:{fontSize:"0.65rem",color:"var(--ca-text-muted)"},children:"點擊裝備以穿戴"})]}),(0,a.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px"},children:0===m.length?(0,a.jsx)("div",{style:{textAlign:"center",color:"gray",padding:"20px 0",fontSize:"0.8rem"},children:"倉庫空空如也..."}):(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(56px, 1fr))",gap:"8px"},children:m.map(e=>{var l;let i=Object.values((null==(l=t.equipment)?void 0:l.equipped)||{}).includes(e.id),r=j(e.config.Rarity);return(0,a.jsxs)("div",{onClick:()=>u(e),className:"ca-inventory-item",style:{width:"56px",height:"56px",background:"rgba(30, 41, 59, 0.6)",border:"2px solid ".concat(r),borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",opacity:i?1:.8,boxShadow:i?"0 0 10px #22c55e, inset 0 0 5px #22c55e":"none"},title:"".concat(e.config.Name," (Lv.").concat(e.level,") - ").concat(e.config.Slot),children:[(0,a.jsx)("span",{style:{fontSize:"1.5rem"},children:C(e.config.Slot)}),(0,a.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"4px",fontWeight:"bold"},children:["L.",e.level]}),i&&(0,a.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",background:"#22c55e",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"3px",fontWeight:"bold",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"E"})]},e.id)})})})]}),p&&(0,a.jsx)(S,{item:p,onClose:()=>u(null),onEquip:c,onUnequip:d,isEquipped:Object.values(t.equipment.equipped).includes(p.id)})]})}function C(e){switch(e){case b.MAIN_HAND:return"⚔️";case b.HEAD:return"\uD83E\uDE96";case b.BODY:return"\uD83D\uDC55";case b.HANDS:return"\uD83E\uDDE4";case b.LEGS:return"\uD83D\uDC62";case b.RELIC:return"\uD83D\uDD2E";default:return"\uD83D\uDCE6"}}function N(e){var l,t,i,r,s;let{slot:n,player:o,gameConfig:c,onClick:d}=e,p=null==(t=o.equipment)||null==(l=t.equipped)?void 0:l[n],u=p?null==c||null==(i=c.equipments)?void 0:i.find(e=>String(e.ID)===String(p)):null,m=p?(null==(s=o.equipment)||null==(r=s.inventory)?void 0:r[p])||1:0,x=u?j(u.Rarity):"rgba(255,255,255,0.1)";return(0,a.jsxs)("div",{className:"ca-equipment-slot",style:{width:"54px",height:"54px",background:"rgba(15, 23, 42, 0.6)",border:u?"2px solid ".concat(x):"1px dashed rgba(255,255,255,0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:"pointer",transition:"all 0.2s",boxShadow:u?"0 0 15px ".concat(x,"44"):"none"},onClick:()=>p&&(null==d?void 0:d(p)),title:u?"".concat(u.Name," (Lv.").concat(m,")"):"Empty Slot",children:[(0,a.jsx)("div",{style:{fontSize:"1.6rem",opacity:u?1:.3},children:C(n)}),u&&(0,a.jsxs)("div",{style:{position:"absolute",bottom:"-4px",right:"-4px",background:"#4f46e5",color:"white",fontSize:"0.55rem",padding:"1px 3px",borderRadius:"6px",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.2)"},children:["Lv.",m]})]})}let _={STAGE_1_20:[{name:"史萊姆",emoji:"\uD83D\uDC7E",rarity:"COMMON",hpMultiplier:1,goldMultiplier:1,xpMultiplier:1},{name:"小蘑菇",emoji:"\uD83C\uDF44",rarity:"COMMON",hpMultiplier:.9,goldMultiplier:.9,xpMultiplier:.9},{name:"野狼",emoji:"\uD83D\uDC3A",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1.1,xpMultiplier:1.1},{name:"野豬",emoji:"\uD83D\uDC17",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.1,xpMultiplier:1.1},{name:"青蛇",emoji:"\uD83D\uDC0D",rarity:"COMMON",hpMultiplier:.8,goldMultiplier:1,xpMultiplier:1.2}],STAGE_21_40:[{name:"大蝙蝠",emoji:"\uD83E\uDD87",rarity:"COMMON",hpMultiplier:.9,goldMultiplier:1.2,xpMultiplier:1.1},{name:"毒蜘蛛",emoji:"\uD83D\uDD77️",rarity:"COMMON",hpMultiplier:1,goldMultiplier:1.1,xpMultiplier:1.1},{name:"骷髏兵",emoji:"\uD83D\uDC80",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.1,xpMultiplier:1.1},{name:"蠍子",emoji:"\uD83E\uDD82",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.3,xpMultiplier:1.2},{name:"巨鼠",emoji:"\uD83D\uDC00",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1,xpMultiplier:1}],STAGE_41_60:[{name:"靈狐",emoji:"\uD83E\uDD8A",rarity:"COMMON",hpMultiplier:1.2,goldMultiplier:1.5,xpMultiplier:1.5},{name:"竹妖",emoji:"\uD83C\uDF8B",rarity:"COMMON",hpMultiplier:1.4,goldMultiplier:1.3,xpMultiplier:1.3},{name:"武道家",emoji:"\uD83E\uDD4B",rarity:"COMMON",hpMultiplier:1.5,goldMultiplier:1.4,xpMultiplier:1.6},{name:"白虎",emoji:"\uD83D\uDC2F",rarity:"COMMON",hpMultiplier:1.6,goldMultiplier:1.6,xpMultiplier:1.6},{name:"靈鷹",emoji:"\uD83E\uDD85",rarity:"COMMON",hpMultiplier:1.1,goldMultiplier:1.4,xpMultiplier:1.4}],STAGE_61_80:[{name:"火元素",emoji:"\uD83D\uDD25",rarity:"COMMON",hpMultiplier:1.4,goldMultiplier:1.6,xpMultiplier:1.5},{name:"冰魔像",emoji:"❄️",rarity:"COMMON",hpMultiplier:1.6,goldMultiplier:1.6,xpMultiplier:1.5},{name:"雷靈",emoji:"⚡",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.8,xpMultiplier:1.6},{name:"風怪",emoji:"\uD83C\uDF2A️",rarity:"COMMON",hpMultiplier:1.3,goldMultiplier:1.5,xpMultiplier:1.5},{name:"岩石巨人",emoji:"\uD83D\uDDFF",rarity:"COMMON",hpMultiplier:2,goldMultiplier:1.5,xpMultiplier:1.2}],STAGE_81_PLUS:[{name:"惡鬼",emoji:"\uD83D\uDC79",rarity:"COMMON",hpMultiplier:1.8,goldMultiplier:2,xpMultiplier:2},{name:"幽靈",emoji:"\uD83D\uDC7B",rarity:"COMMON",hpMultiplier:1.5,goldMultiplier:1.8,xpMultiplier:1.8},{name:"吸血鬼",emoji:"\uD83E\uDDDB",rarity:"COMMON",hpMultiplier:1.7,goldMultiplier:2.2,xpMultiplier:2},{name:"殭屍",emoji:"\uD83E\uDDDF",rarity:"COMMON",hpMultiplier:2.2,goldMultiplier:1.6,xpMultiplier:1.8}]},w=[{name:"黃金史萊姆",emoji:"\uD83D\uDCB0",rarity:"RARE",hpMultiplier:.5,goldMultiplier:5,xpMultiplier:1},{name:"金屬史萊姆",emoji:"\uD83E\uDD16",rarity:"RARE",hpMultiplier:5,goldMultiplier:1,xpMultiplier:5},{name:"寶箱怪",emoji:"\uD83D\uDCE6",rarity:"RARE",hpMultiplier:2,goldMultiplier:2,xpMultiplier:1,dropDiamonds:2},{name:"幸運草精",emoji:"\uD83C\uDF40",rarity:"RARE",hpMultiplier:.1,goldMultiplier:1,xpMultiplier:1}],A=[{name:"金剛",emoji:"\uD83E\uDD8D",rarity:"BOSS",hpMultiplier:5,goldMultiplier:10,xpMultiplier:10},{name:"巨鱷",emoji:"\uD83D\uDC0A",rarity:"BOSS",hpMultiplier:5,goldMultiplier:10,xpMultiplier:10},{name:"霸王龍",emoji:"\uD83E\uDD96",rarity:"BOSS",hpMultiplier:6,goldMultiplier:12,xpMultiplier:12}],k=[{name:"魔龍",emoji:"\uD83D\uDC32",rarity:"BOSS",hpMultiplier:15,goldMultiplier:20,xpMultiplier:20,dropDiamonds:5},{name:"赤鬼王",emoji:"\uD83D\uDC7A",rarity:"BOSS",hpMultiplier:12,goldMultiplier:18,xpMultiplier:18,dropDiamonds:3},{name:"克拉肯",emoji:"\uD83E\uDD91",rarity:"BOSS",hpMultiplier:14,goldMultiplier:19,xpMultiplier:19,dropDiamonds:4},{name:"撒旦",emoji:"\uD83D\uDC7F",rarity:"BOSS",hpMultiplier:16,goldMultiplier:25,xpMultiplier:25,dropDiamonds:6}];var L=t(23464);let E="https://script.google.com/macros/s/AKfycbxegFPp4kJZXDxUNqQopqiWVa2JLLM__rJbm700mUQsovg2nkE6wSJd2lFQyJQ4dg10/exec",I={loadPlayerSave:async e=>{try{let l=await L.A.get("".concat(E,"?action=load_save&userId=").concat(encodeURIComponent(e)));if(l.data&&l.data.exists)return l.data.data;return null}catch(e){throw console.error("Error loading player save:",e),e}},savePlayerProgress:async(e,l)=>{try{if(!e)throw Error("User ID is required for saving");let t=await L.A.post(E,{action:"save_progress",userId:e,saveData:l},{headers:{"Content-Type":"text/plain"}});if(t.data&&t.data.success)return{success:!0};throw Error("Save operation failed on backend")}catch(e){throw console.error("Error saving player progress:",e),e}},getGameConfigs:async()=>{try{let e=await L.A.get("".concat(E,"?action=load_static"));if(e.data&&(e.data.settings||e.data.monsters||e.data.upgrades))return e.data;return null}catch(e){return console.error("Error fetching game configs:",e),null}}},R={system:{level:1,currentXp:0,requiredXp:100},wallet:{gold:0,clickPoints:0,diamonds:10,levelPoints:0,ascensionPoints:0},stats:{baseDamage:1,autoAttackDamage:0,criticalChance:.05,criticalDamage:1.5,goldMultiplier:1,cpMultiplier:1,xpMultiplier:1,bossDamageMultiplier:1,autoClickPerSec:1,monsterKillReduction:0,rareMonsterChance:0},records:{totalClicks:0,totalDamageDealt:0,maxStageReached:1,totalGoldEarned:0,playtimeSeconds:0,monstersKilled:0,bossesKilled:0},clickShop:{},levelShop:{},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,amuletLevel:0},ascensionShop:{},inventory:{ragePotionCount:0},activeBuffs:{ragePotionExpiresAt:0},equipment:{inventory:{},equipped:{}},lastDailyRewardClaimTime:0},O={currentStageId:1,isBossActive:!1,autoChallengeBoss:!0,maxStageReached:1,monstersKilledInStage:0,monstersRequiredForBoss:10};function T(){let[e,l]=(0,i.useState)(null),[t,s]=(0,i.useState)("BATTLE"),[d,u]=(0,i.useState)(R),[m,x]=(0,i.useState)(O),[g,h]=(0,i.useState)(null),[v,D]=(0,i.useState)(null),[y,b]=(0,i.useState)(null),[j,S]=(0,i.useState)(null),C=i.useMemo(()=>{let e={baseDamage:d.stats.baseDamage||1,autoAttackDamage:d.stats.autoAttackDamage||0,criticalChance:d.stats.criticalChance||.05,criticalDamage:d.stats.criticalDamage||1.5,goldMultiplier:d.stats.goldMultiplier||1,cpMultiplier:d.stats.cpMultiplier||1,xpMultiplier:d.stats.xpMultiplier||1,bossDamageMultiplier:d.stats.bossDamageMultiplier||1,autoClickPerSec:d.stats.autoClickPerSec||1,monsterKillReduction:d.stats.monsterKillReduction||0,rareMonsterChance:d.stats.rareMonsterChance||0};return(null==v?void 0:v.equipments)&&Object.values(d.equipment.equipped).forEach(l=>{if(!l)return;let t=v.equipments.find(e=>String(e.ID)===String(l));if(t){let a=Number(d.equipment.inventory[l]||1),i=Number(t.Base_Val||0)+(a-1)*Number(t.Level_Mult||0);switch(String(t.Effect_Type||"").toUpperCase().trim()){case"ADD_BASE_DMG":case"CLICK_DMG":case"CLICK_DAMAGE":case"ADD_DAMAGE":case"ADD_CLICK_DMG":e.baseDamage+=i;break;case"ADD_AUTO_DMG":case"AUTO_DMG":case"AUTO_DAMAGE":case"ADD_AUTO":e.autoAttackDamage+=i;break;case"ADD_CRIT_CHANCE":case"CRIT_RATE":case"ADD_CRIT_RATE":case"LUCK":e.criticalChance+=i/100;break;case"ADD_CRIT_DMG":case"CRIT_DMG":case"CRIT_DAMAGE":case"ADD_CRIT_DMG":e.criticalDamage+=i/100;break;case"ADD_GOLD_MULT":case"GOLD_MULT":case"ADD_GOLD":case"GOLD_BONUS":case"ADD_GOLD_MULT":e.goldMultiplier+=i/100;break;case"ADD_XP_MULT":case"XP_MULT":case"ADD_XP":case"XP_BONUS":case"ADD_XP_MULT":e.xpMultiplier+=i/100;break;case"ADD_BOSS_DMG":case"BOSS_DMG":case"BOSS_DAMAGE":e.bossDamageMultiplier+=i/100;break;case"CP_MULT":case"CP_BONUS":case"ADD_CP_MULT":e.cpMultiplier+=i/100;break;case"REDUCE_GOAL_V":case"REDUCE_STAGE_GOAL":e.monsterKillReduction+=i;break;case"RARE_CHANCE_P":case"RARE_SPAWN_CHANCE":case"RARE_CHANCE":e.rareMonsterChance+=i/100;break;case"AUTO_CLICK_V":case"AUTO_CLICK_CPS":e.autoClickPerSec+=i}}}),e},[d.stats,d.equipment.equipped,d.equipment.inventory,v]),N=(0,i.useCallback)((e,l)=>{var t,a,i,r;return{...e,...l,system:{...e.system,...l.system||{}},wallet:{...e.wallet,...l.wallet||{}},stats:{...e.stats,...l.stats||{}},clickShop:{...e.clickShop,...l.clickShop||{}},levelShop:{...e.levelShop,...l.levelShop||{}},goldShop:{...e.goldShop,...l.goldShop||{}},ascensionShop:{...e.ascensionShop,...l.ascensionShop||{}},inventory:{...e.inventory,...l.inventory||{}},activeBuffs:{...e.activeBuffs,...l.activeBuffs||{}},equipment:{...e.equipment,...l.equipment||{},inventory:{...(null==(t=e.equipment)?void 0:t.inventory)||{},...(null==(a=l.equipment)?void 0:a.inventory)||{}},equipped:{...(null==(i=e.equipment)?void 0:i.equipped)||{},...(null==(r=l.equipment)?void 0:r.equipped)||{}}}}},[]),L=C.autoAttackDamage,E=Math.floor(10*C.baseDamage+20*L+1e3*C.criticalChance+500*C.criticalDamage);(0,i.useEffect)(()=>{v&&(console.log("[Recalc] GameConfig loaded, refreshing stats..."),u(e=>({...e,stats:F(e)})))},[v]),(0,i.useEffect)(()=>{(async()=>{console.log("[Config] Loading...");let e=await I.getGameConfigs();e&&(console.log("[Config] Loaded:",e),D(e))})();let e=localStorage.getItem("ca_last_user_id");e&&U(e)},[]);let T=(0,i.useCallback)(()=>{let e=m.isBossActive,l=Math.max(1,m.monstersRequiredForBoss-(C.monsterKillReduction||0));!e&&m.autoChallengeBoss&&m.monstersKilledInStage>=l&&(e=!0);let t=function(e,l){if(l)return e%10==0?k[Math.floor(Math.random()*k.length)]:A[Math.floor(Math.random()*A.length)];let t=Math.random();if(t<.11)return t<.05?w[0]:t<.08?w[1]:t<.1?w[2]:w[3];let a=_.STAGE_1_20;return e>80?a=_.STAGE_81_PLUS:e>60?a=_.STAGE_61_80:e>40?a=_.STAGE_41_60:e>20&&(a=_.STAGE_21_40),a[Math.floor(Math.random()*a.length)]}(m.currentStageId,e),a=Math.ceil((20*Math.pow(1.18,m.currentStageId-1)+10*m.currentStageId)*t.hpMultiplier),i=.15*a*t.goldMultiplier,r=.08*a*t.xpMultiplier;h({id:crypto.randomUUID(),name:"".concat(t.name," Lv.").concat(m.currentStageId),level:m.currentStageId,maxHp:a,currentHp:a,isBoss:"BOSS"===t.rarity,rewardGold:Math.max(1,Math.floor(i)),rewardXp:Math.max(1,Math.floor(r)),emoji:t.emoji})},[m,C.monsterKillReduction]),[P,B]=(0,i.useState)(null);(0,i.useEffect)(()=>{g||T()},[g,T]),(0,i.useEffect)(()=>{let e=localStorage.getItem("ca_last_user_id");e&&U(e)},[]);let G=i.useRef(d),z=i.useRef(m),q=i.useRef(new Set);(0,i.useEffect)(()=>{G.current=d,z.current=m},[d,m]),(0,i.useEffect)(()=>{if(!P)return;let e=setInterval(async()=>{console.log("[AutoSave] Saving for ".concat(P," to Cloud..."));let e={player:G.current,stage:z.current,timestamp:Date.now()};try{await I.savePlayerProgress(P,e),localStorage.setItem("ca_save_".concat(P),JSON.stringify(e))}catch(l){console.warn("[AutoSave] Cloud save failed, using local backup",l),localStorage.setItem("ca_save_".concat(P),JSON.stringify(e))}},3e4);return()=>clearInterval(e)},[P]);let U=async e=>{if(!e)return;B(e),localStorage.setItem("ca_last_user_id",e);try{console.log("[Login] Fetching cloud save for ".concat(e,"..."));let l=await I.loadPlayerSave(e);if(l){console.log("[Login] Cloud save found!"),l.player&&u(e=>N(e,l.player)),l.stage&&x(e=>({...e,...l.stage}));return}console.log("[Login] Cloud save not found or new user.")}catch(e){console.error("[Login] Cloud load error:",e)}let l=localStorage.getItem("ca_save_".concat(e));if(l){console.log("[Login] Found local backup.");try{let e=JSON.parse(l);u(l=>({...l,...e.player})),x(l=>({...l,...e.stage}))}catch(e){}}};(0,i.useEffect)(()=>{let e=setInterval(()=>{u(e=>({...e,records:{...e.records,playtimeSeconds:(e.records.playtimeSeconds||0)+1}}))},1e3);return()=>clearInterval(e)},[]);let W=async()=>{if(!P)return;let e={player:d,stage:m,timestamp:Date.now()};try{await I.savePlayerProgress(P,e),alert("✅ 上傳成功 (Cloud Save)"),localStorage.setItem("ca_save_".concat(P),JSON.stringify(e))}catch(l){console.error("Save failed",l),alert("❌ 上傳失敗，已存至本機備份。"),localStorage.setItem("ca_save_".concat(P),JSON.stringify(e))}};(0,i.useEffect)(()=>{if(!g||g.currentHp<=0||C.autoAttackDamage<=0)return;let e=setInterval(()=>{let e=C.autoAttackDamage,l=g.isBoss&&C.bossDamageMultiplier||1,t=Math.ceil(e*l);h(e=>{if(!e||e.currentHp<=0)return e;let l=e.currentHp-t;return l<=0?(setTimeout(()=>H(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,l)}}),u(e=>{let l=+C.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+l},records:{...e.records,totalDamageDealt:e.records.totalDamageDealt+t}}});let a=2*(d.goldShop.mercenaryLevel||0),i=5*(d.goldShop.partnerLevel||0),r=20*(d.goldShop.archerLevel||0),s=100*(d.goldShop.knightLevel||0),n=Math.max(0,C.autoAttackDamage-(a+i+r+s));b({time:Date.now(),damage:t,breakdown:{mercenary:Math.ceil(a*l),partner:Math.ceil(i*l),archer:Math.ceil(r*l),knight:Math.ceil(s*l),player:Math.ceil(n*l)}})},1e3);return()=>clearInterval(e)},[null==g?void 0:g.id,C.autoAttackDamage,C.bossDamageMultiplier,C.cpMultiplier,d.goldShop.mercenaryLevel,d.goldShop.partnerLevel,d.goldShop.archerLevel,d.goldShop.knightLevel]),(0,i.useEffect)(()=>{let e=C.autoClickPerSec||0;if(e<=0||!g||g.currentHp<=0)return;let l=setInterval(()=>{var e,l;let t=Math.random()<C.criticalChance,a=((null==(l=G.current)||null==(e=l.activeBuffs)?void 0:e.ragePotionExpiresAt)||0)>Date.now(),i=t?Math.floor(C.baseDamage*C.criticalDamage):C.baseDamage;a&&(i*=2),h(e=>{if(!e||e.currentHp<=0)return e;let l=i;e.isBoss&&(l=Math.ceil(i*(C.bossDamageMultiplier||1)));let t=e.currentHp-l;return t<=0?(setTimeout(()=>H(e),0),{...e,currentHp:0}):{...e,currentHp:Math.max(0,t)}}),u(e=>{let l=+C.cpMultiplier;return{...e,wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+l},records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+i}}}),S({id:crypto.randomUUID(),damage:i,isCrit:t})},Math.max(50,1e3/e));return()=>clearInterval(l)},[C.autoClickPerSec,C.baseDamage,C.criticalChance,C.criticalDamage,C.bossDamageMultiplier,C.cpMultiplier,null==g?void 0:g.id]);let H=e=>{if(!e||q.current.has(e.id))return;q.current.add(e.id),q.current.size>50&&q.current.clear();let l=Math.ceil(e.rewardGold*C.goldMultiplier),t=Math.ceil(e.rewardXp*C.xpMultiplier);u(a=>{let{level:i,currentXp:r,requiredXp:s}=a.system,{levelPoints:n}=a.wallet;for(r+=t;r>=s;)r-=s,i+=1,n+=5,s=Math.floor(1.2*s);return{...a,wallet:{...a.wallet,gold:a.wallet.gold+l,levelPoints:n},system:{...a.system,level:i,currentXp:r,requiredXp:s},records:{...a.records,monstersKilled:a.records.monstersKilled+1,totalGoldEarned:a.records.totalGoldEarned+l,bossesKilled:e.isBoss?a.records.bossesKilled+1:a.records.bossesKilled}}}),x(l=>{if(e.isBoss)return{...l,currentStageId:l.currentStageId+1,maxStageReached:Math.max(l.maxStageReached,l.currentStageId+1),isBossActive:!1,monstersKilledInStage:0};let t=l.monstersKilledInStage+1;return{...l,monstersKilledInStage:t}}),h(null)},K=e=>{"RAGE"===e&&d.inventory.ragePotionCount>0&&u(e=>({...e,inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount-1},activeBuffs:{...e.activeBuffs,ragePotionExpiresAt:Date.now()+3e4}}))},F=e=>{let l={...R.stats};return l.baseDamage+=+(e.goldShop.weaponLevel||0),l.autoAttackDamage+=2*(e.goldShop.mercenaryLevel||0)+5*(e.goldShop.partnerLevel||0)+20*(e.goldShop.archerLevel||0)+100*(e.goldShop.knightLevel||0),l.goldMultiplier+=.05*(e.goldShop.amuletLevel||0),["clickShop","levelShop","ascensionShop"].forEach(t=>{Object.entries(e[t]).forEach(e=>{var t;let[a,i]=e,r=null==v||null==(t=v.upgrades)?void 0:t.find(e=>e.ID===a);if(r&&i>0){let e=r.Effect_Type,t=Number(r.Effect_Val||0)*i;("ADD_DAMAGE"===e||"CLICK_DMG"===e)&&(l.baseDamage+=t),("ADD_CRIT"===e||"CRIT_RATE"===e)&&(l.criticalChance+=t/100),("ADD_CRIT_DMG"===e||"CRIT_DMG"===e)&&(l.criticalDamage+=t/100),("ADD_GOLD"===e||"GOLD_MULT"===e)&&(l.goldMultiplier+=t/100),("ADD_XP"===e||"XP_MULT"===e)&&(l.xpMultiplier+=t/100),("ADD_AUTO"===e||"AUTO_DMG"===e)&&(l.autoAttackDamage+=t),("ADD_BOSS_DMG"===e||"BOSS_DMG"===e)&&(l.bossDamageMultiplier+=t/100),"REDUCE_GOAL_V"===e&&(l.monsterKillReduction+=t),"RARE_CHANCE_P"===e&&(l.rareMonsterChance+=t/100),"AUTO_CLICK_V"===e&&(l.autoClickPerSec+=t)}})}),l},X=()=>{V<=0||(u(e=>{let l={...e,system:{level:1,currentXp:0,requiredXp:100},wallet:{...e.wallet,gold:0,levelPoints:0,ascensionPoints:(e.wallet.ascensionPoints||0)+V},goldShop:{weaponLevel:0,mercenaryLevel:0,partnerLevel:0,archerLevel:0,knightLevel:0,amuletLevel:0},levelShop:{},activeBuffs:{ragePotionExpiresAt:0}};return l.stats=F(l),l}),x(e=>({...e,currentStageId:1,monstersKilledInStage:0,isBossActive:!1,maxStageReached:1})),h(null),alert("⚡ 渡劫成功！獲得 ".concat(V.toLocaleString()," 點飛昇點數！\n等級與等級點數已重製，裝備與點擊加成已保留。")),s("BATTLE"))},V=i.useMemo(()=>Math.floor(10*Math.pow(1.2,Math.max(0,m.maxStageReached-0))),[m.maxStageReached]);return(0,a.jsxs)("div",{className:"ca-game-container",children:[(0,a.jsx)(r,{player:d,combatPower:E,stageId:m.currentStageId,onAvatarClick:()=>l("PROFILE"),onAscension:()=>{if(V<=0)return void alert("尚未達到飛升條件！");window.confirm("確定要渡劫飛升嗎？\n\n將重置關卡與金幣，並獲得 ".concat(V.toLocaleString()," 點飛升點數！"))&&X()},potentialPoints:V}),"BATTLE"===t?(0,a.jsx)(n,{monster:g,stageId:m.currentStageId,onMonsterClick:(e,l)=>{if(!g||g.currentHp<=0)return;let t=e;g.isBoss&&(t=Math.ceil(e*C.bossDamageMultiplier));let a=g.currentHp-t;h(e=>e?{...e,currentHp:Math.max(0,a)}:null),u(e=>({...e,records:{...e.records,totalClicks:e.records.totalClicks+1,totalDamageDealt:e.records.totalDamageDealt+t},wallet:{...e.wallet,clickPoints:e.wallet.clickPoints+ +C.cpMultiplier}})),a<=0&&H(g)},baseDamage:C.baseDamage,criticalChance:C.criticalChance,criticalDamage:C.criticalDamage,monstersKilled:m.monstersKilledInStage,monstersRequired:Math.max(1,m.monstersRequiredForBoss-(C.monsterKillReduction||0)),isBossActive:m.isBossActive,mercenaryLevel:d.goldShop.mercenaryLevel,partnerLevel:d.goldShop.partnerLevel,archerLevel:d.goldShop.archerLevel,knightLevel:d.goldShop.knightLevel,potionCount:d.inventory.ragePotionCount,activeBuffs:d.activeBuffs,onUsePotion:()=>K("RAGE"),lastAutoAttack:y,lastAutoClickEvent:j}):(0,a.jsx)(M,{player:d,effectiveStats:C,totalDps:L,userId:P,gameConfig:v,onEquip:(e,l)=>{u(t=>({...t,equipment:{...t.equipment,equipped:{...t.equipment.equipped,[l]:e}}}))},onUnequip:e=>{u(l=>{let t={...l.equipment.equipped};return delete t[e],{...l,equipment:{...l.equipment,equipped:t}}})}}),(0,a.jsx)(o,{activeView:t,onSwitchView:s,onOpenModal:l}),(0,a.jsx)(c,{isOpen:"PROFILE"===e,onClose:()=>l(null),title:"玩家資料",children:(0,a.jsx)(f,{player:d,effectiveStats:C,combatPower:E,userId:P,onLogin:U,onLogout:()=>{B(null),localStorage.removeItem("ca_last_user_id"),u(R),x(O)},onManualSave:W,gameConfig:v})}),(0,a.jsx)(c,{isOpen:"SHOP"===e,onClose:()=>l(null),title:"商店",headerContent:(0,a.jsxs)("div",{className:"ca-shop-currency-bar",style:{display:"flex",flexWrap:"wrap",border:"none",background:"transparent",padding:"0 8px",gap:"12px"},children:[(0,a.jsxs)("div",{className:"ca-currency ca-currency-gold",style:{fontSize:"0.8rem"},title:"金幣",children:[(0,a.jsx)("span",{children:"\uD83D\uDCB0"}),(0,a.jsx)("span",{children:Math.floor(d.wallet.gold).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency ca-currency-diamond",style:{fontSize:"0.8rem"},title:"鑽石",children:[(0,a.jsx)("span",{children:"\uD83D\uDC8E"}),(0,a.jsx)("span",{children:d.wallet.diamonds.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"var(--ca-accent-cyan, #22d3ee)"},title:"點擊點數",children:[(0,a.jsx)("span",{children:"⚡"}),(0,a.jsx)("span",{children:Math.floor(d.wallet.clickPoints).toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#4ade80"},title:"等級積分",children:[(0,a.jsx)("span",{children:"\uD83C\uDD99"}),(0,a.jsx)("span",{children:d.wallet.levelPoints.toLocaleString()})]}),(0,a.jsxs)("div",{className:"ca-currency",style:{fontSize:"0.8rem",color:"#d8b4fe"},title:"飛昇點數",children:[(0,a.jsx)("span",{children:"\uD83D\uDD4A️"}),(0,a.jsx)("span",{children:d.wallet.ascensionPoints.toLocaleString()})]})]}),children:(0,a.jsx)(p,{player:d,onPurchase:e=>{var l,t,a;if("daily_checkin"===e)return void u(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds+10,gold:e.wallet.gold+500},lastDailyRewardClaimTime:Date.now()}));if(e.startsWith("click_shop_")){let t=null==v||null==(l=v.upgrades)?void 0:l.find(l=>l.ID===e);if(!t)return;let a=d.clickShop[e]||0,i=Math.floor(t.Cost_Base*Math.pow(t.Cost_Mult,a));d.wallet.clickPoints>=i?u(l=>{let r={...l.stats},s=t.Effect_Type,n=Number(t.Effect_Val||0);return("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(r.baseDamage+=n),("ADD_CRIT_DMG"===s||"CRIT_DMG"===s)&&(r.criticalDamage+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(r.goldMultiplier+=n/100),"AUTO_CLICK_V"===s&&(r.autoClickPerSec+=n),"REDUCE_GOAL_V"===s&&(r.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(r.rareMonsterChance+=n/100),{...l,wallet:{...l.wallet,clickPoints:l.wallet.clickPoints-i},clickShop:{...l.clickShop,[e]:a+1},stats:r}}):alert("點擊點數不足！");return}if(e.startsWith("level_shop_")){let l=null==v||null==(t=v.upgrades)?void 0:t.find(l=>l.ID===e);if(!l)return;let a=d.levelShop[e]||0,i=Math.floor(l.Cost_Base*Math.pow(l.Cost_Mult,a));d.wallet.levelPoints>=i?u(t=>{let r={...t.stats},s=l.Effect_Type,n=Number(l.Effect_Val||0);return("ADD_XP"===s||"XP_MULT"===s)&&(r.xpMultiplier+=n/100),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(r.goldMultiplier+=n/100),("ADD_AUTO"===s||"AUTO_DMG"===s)&&(r.autoAttackDamage+=n),("ADD_BOSS_DMG"===s||"BOSS_DMG"===s)&&(r.bossDamageMultiplier+=n/100),("ADD_CRIT"===s||"CRIT_RATE"===s)&&(r.criticalChance+=n/100),"AUTO_CLICK_V"===s&&(r.autoClickPerSec+=n),"REDUCE_GOAL_V"===s&&(r.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(r.rareMonsterChance+=n/100),{...t,wallet:{...t.wallet,levelPoints:t.wallet.levelPoints-i},levelShop:{...t.levelShop,[e]:a+1},stats:r}}):alert("等級積分不足！");return}let i=[{id:"gold_pack_1",cost:10,reward:1e3,type:"GOLD",currency:"DIAMOND"},{id:"gold_pack_2",cost:80,reward:1e4,type:"GOLD",currency:"DIAMOND"}].find(l=>l.id===e);if(i&&"DIAMOND"===i.currency&&d.wallet.diamonds>=i.cost&&u(e=>({...e,wallet:{...e.wallet,diamonds:e.wallet.diamonds-i.cost,gold:e.wallet.gold+i.reward}})),e.startsWith("gold_shop_")||e.startsWith("gold_potion_")){let{goldShop:l}=d,t=0;switch(e){case"gold_shop_weapon":t=Math.floor(10*Math.pow(1.2,l.weaponLevel)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,weaponLevel:e.goldShop.weaponLevel+1},stats:{...e.stats,baseDamage:e.stats.baseDamage+1}}));break;case"gold_shop_mercenary":t=Math.floor(100*Math.pow(1.3,l.mercenaryLevel)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,mercenaryLevel:e.goldShop.mercenaryLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+2}}));break;case"gold_shop_partner":t=Math.floor(500*Math.pow(1.3,l.partnerLevel)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,partnerLevel:e.goldShop.partnerLevel+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+5}}));break;case"gold_shop_archer":t=Math.floor(2e3*Math.pow(1.4,l.archerLevel||0)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,archerLevel:(e.goldShop.archerLevel||0)+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+20}}));break;case"gold_shop_knight":t=Math.floor(1e4*Math.pow(1.5,l.knightLevel||0)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,knightLevel:(e.goldShop.knightLevel||0)+1},stats:{...e.stats,autoAttackDamage:e.stats.autoAttackDamage+100}}));break;case"gold_shop_amulet":t=Math.floor(5e3*Math.pow(1.5,l.amuletLevel||0)),d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},goldShop:{...e.goldShop,amuletLevel:(e.goldShop.amuletLevel||0)+1},stats:{...e.stats,goldMultiplier:e.stats.goldMultiplier+.05}}));break;case"gold_potion_rage":t=500,d.wallet.gold>=t&&u(e=>({...e,wallet:{...e.wallet,gold:e.wallet.gold-t},inventory:{...e.inventory,ragePotionCount:e.inventory.ragePotionCount+1}}))}}if("gacha_equipment_basic"===e)if(d.wallet.gold>=1e3){let e=(null==v?void 0:v.equipments)||[];if(e.length>0){let l=Math.random()*e.reduce((e,l)=>e+(Number(l.Gacha_Weight)||0),0),t=e[0];for(let a of e){let e=Number(a.Gacha_Weight)||0;if(l<e){t=a;break}l-=e}u(e=>{var l,a;let i=(null==(a=e.equipment)||null==(l=a.inventory)?void 0:l[t.ID])||0,r=t.Max_Level||99;if(i>=r){let l=Math.floor(500);return alert("".concat(t.Name," 已達最高等級 (Lv.").concat(r,")！\n轉化為補償金幣：").concat(l)),{...e,wallet:{...e.wallet,gold:e.wallet.gold-1e3+l}}}return{...e,wallet:{...e.wallet,gold:e.wallet.gold-1e3},equipment:{...e.equipment,inventory:{...e.equipment.inventory,[t.ID]:i+1}}}}),alert("獲得裝備：".concat(t.Name," (Rarity: ").concat(t.Rarity,")"))}else alert("暫無裝備可抽取")}else alert("金幣不足！");if(e.startsWith("ascension_shop_")||e.startsWith("asc_")){let l=null==v||null==(a=v.upgrades)?void 0:a.find(l=>l.ID===e);if(!l)return;let t=d.ascensionShop[e]||0,i=Math.floor(l.Cost_Base*Math.pow(l.Cost_Mult,t));d.wallet.ascensionPoints>=i?u(a=>{let r={...a.stats},s=l.Effect_Type,n=Number(l.Effect_Val||0);return("ADD_CRIT"===s||"CRIT_RATE"===s)&&(r.criticalChance+=n/100),("ADD_DAMAGE"===s||"CLICK_DMG"===s)&&(r.baseDamage+=n),("ADD_GOLD"===s||"GOLD_MULT"===s)&&(r.goldMultiplier+=n/100),("ADD_XP"===s||"XP_MULT"===s)&&(r.xpMultiplier+=n/100),"REDUCE_GOAL_V"===s&&(r.monsterKillReduction+=n),"RARE_CHANCE_P"===s&&(r.rareMonsterChance+=n/100),"AUTO_CLICK_V"===s&&(r.autoClickPerSec+=n),{...a,wallet:{...a.wallet,ascensionPoints:a.wallet.ascensionPoints-i},ascensionShop:{...a.ascensionShop,[e]:t+1},stats:r}}):alert("氣運點數不足！")}},onResetLevelPoints:()=>{window.confirm("確定要重製等級積分嗎？\n所有已分配的點數將會返還，您可以重新分配天賦。")&&(u(e=>{let l=0;Object.entries(e.levelShop).forEach(e=>{var t;let[a,i]=e,r=null==v||null==(t=v.upgrades)?void 0:t.find(e=>e.ID===a);if(r)for(let e=0;e<i;e++){let t=Math.floor(r.Cost_Base*Math.pow(r.Cost_Mult,e));l+=t}});let t={...e,wallet:{...e.wallet,levelPoints:e.wallet.levelPoints+l},levelShop:{}};return t.stats=F(t),t}),alert("✅ 等級積分已重製！"))},gameConfig:v})})]})}}}]);